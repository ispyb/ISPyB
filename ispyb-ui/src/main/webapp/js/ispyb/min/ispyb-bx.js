/*******************************************************************************
 * This file is part of ISPyB.
 * 
 * ISPyB is free software: you can redistribute it and/or modify it under the
 * terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * ISPyB is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with ISPyB. If not, see <http://www.gnu.org/licenses/>.
 * 
 * Contributors : S. Delageniere, R. Leal, L. Launer, K. Levik, S. Veyrier, P.
 * Brenchereau, M. Bodin,  A. De Maria Antolinos
 ******************************************************************************/
// **** EVENT INTERFACE ****//
/*
 * var Event = function (sender) { this._sender = sender; this._listeners = []; };
 */

function Event(sender) {
	this._sender = sender;
	this._listeners = [];
}

Event.prototype = {
	attach : function(listener) {
		this._listeners.push(listener);
	},
	notify : function(args) {
		for (var i = 0; i < this._listeners.length; i++) {
			this._listeners[i](this._sender, args);
		}
	}
};

function GenericGraph(args) {
	this.width = 600;
	this.height = 400;

	this.targetId = null;
	/** Free spaces in the borders * */
	this.top = 10;
	this.left = 10;
	this.bottom = 50;
	this.right = 40;

	/** Ruler * */
	this.rulerHeight = 50;
	this.rulerWidth = 50;
	this.rulerStroke = 2;
	this.rulerVerticalMarksNumber = 5;

	this.rulerMaxValue = null;
	this.rulerMinValue = null;

	/** plot options * */
	this.plotPoints = true;
	this.pointRadius = 2;
	this.fillOpacityPoint = 0.2;
	this.strokeOpacityPoint = 0.2;

	/** Cluster titles * */
	this.clusterTitleHeight = 20;
	this.interClassesSpace = 2;
	this.interClustersSpace = 4;
	this.fontSize = 7;

	/**
	 * If true classes and title will be rendender in the rule otherwise will be
	 * integer values
	 */
	this.plotHorizontalByCluster = true;

	if (args != null) {
		if (args.targetId != null) {
			this.targetId = args.targetId;
		}
		if (args.plotHorizontalByCluster != null) {
			this.plotHorizontalByCluster = args.plotHorizontalByCluster;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.rulerMinValue != null) {
			this.rulerMinValue = args.rulerMinValue;
		}
		if (args.rulerMaxValue != null) {
			this.rulerMaxValue = args.rulerMaxValue;
		}
		if (args.rulerHeight != null) {
			this.rulerHeight = args.rulerHeight;
		}

	}
}

GenericGraph.prototype.calculate = function(data) {
	var result = {};

	var checked = this.cleanArray(data);

	/** sorting array * */
	checked.sort(function(a, b) {
		return a - b;
	});

	var median = this.getMedian(checked);

	result.median = median;
	result.Q1 = Number(this.getQ1(checked));
	result.Q2 = Number(this.getQ2(checked));
	result.Q3 = Number(this.getQ3(checked));
	result.population = checked;

	result.IQR = Number(result.Q3 - result.Q1);
	result.outlier_below_limit = result.Q1 - (1.5 * result.IQR);
	result.outlier_above_limit = result.Q3 + (1.5 * result.IQR);
	result.below_outliers = this.getBelowOutliers(result.outlier_below_limit, checked);
	result.above_outliers = this.getAboveOutliers(result.outlier_above_limit, checked);

	result.min_whisker = this.minValueWhisker(result.outlier_below_limit, result.Q1, checked);
	result.max_whisker = this.maxValueWhisker(result.outlier_above_limit, result.Q3, checked);

	return result;
};

GenericGraph.prototype.drawSVGVerticalText = function(x, y, text, properties) {
	var transform = [ "transform", "translate(" + x + ", " + y + "), rotate(-90) " ];
	properties.push(transform);
	SVG.drawText(0, 0, text, this.svg, properties);
};

/** Plot the numbers on the axis * */
GenericGraph.prototype.plotRuler = function(rulerProperties) {

	SVG.drawRectangle(rulerProperties.vertical.x, rulerProperties.vertical.y, rulerProperties.vertical.width, rulerProperties.vertical.height,
			this.svg, [ [ "fill", "black" ] ]);
	var distance = rulerProperties.vertical.height / (this.rulerVerticalMarksNumber + 1);
	for ( var i = 0; i <= this.rulerVerticalMarksNumber + 1; i++) {
		var deltaHeight = distance * i;
		var aux = rulerProperties.vertical.height - deltaHeight;

		var text = Number((aux / rulerProperties.vertical.height) * (rulerProperties.maxPoint - rulerProperties.minPoint) + rulerProperties.minPoint)
				.toFixed(3);

		SVG.drawLine(rulerProperties.horizontal.x, this.top + deltaHeight, rulerProperties.horizontal.x - rulerProperties.markWidth, 
				this.top + deltaHeight, this.svg, [ [ "stroke", "black" ] ]);
		SVG.drawText(this.left, this.top + distance * i + 5, text, this.svg, [ [ "style", "font-size:xx-small" ] ]);
		/** Drawing the mark up to the end * */
		SVG.drawLine(rulerProperties.horizontal.x, this.top + deltaHeight, this.width - this.right, this.top + deltaHeight, this.svg, [
			[ "stroke", rulerProperties.markColor ], [ "stroke-width", "0.3" ] ]);

		if (i == this.rulerVerticalMarksNumber + 1) {
			SVG.drawLine(rulerProperties.horizontal.x, this.top + deltaHeight, this.width - this.right, this.top + deltaHeight, this.svg, [ [
				"stroke", rulerProperties.markColor ] ]);
		}
	}

	/** Drawing horizontal rulers * */
	if (!this.plotHorizontalByCluster) {
		var width = rulerProperties.horizontal.width;
		var ratio = width / (rulerProperties.horizontal.xValues.range);
		for ( i = 0; i < rulerProperties.horizontal.xValues.values.length; i++) {
			var coorX = rulerProperties.horizontal.xValues.values[i] - rulerProperties.horizontal.xValues.min;
			SVG.drawText(rulerProperties.horizontal.x + coorX * ratio, this.height - (this.bottom + (this.clusterTitleHeight)),
					rulerProperties.horizontal.xValues.values[i], this.svg, [ [ "style", "font-size:small" ] ]);
		}
	}
};

GenericGraph.prototype.plotAxes = function(properties) {
	/**
	 * Drawing canvas plot-free spaces SVG.drawRectangle(0, this.top, this.left,
	 * this.height, this.svg, [["fill", "pink"]]); SVG.drawRectangle(this.width -
	 * this.right, this.top, plot.width, plot.height, this.svg, [["fill",
	 * "pink"]]); SVG.drawRectangle(0, 0, this.width, this.top, this.svg,
	 * [["fill", "red"]]); SVG.drawRectangle(0, this.height - this.bottom,
	 * this.width, this.bottom, this.svg, [["fill", "red"]]);
	 */

	/** Drawing ruler Space * */
	this.plotRuler({
		minPoint : Number(properties.minPoint),
		maxPoint : Number(properties.maxPoint),
		markColor : "black",
		markWidth : 20,
		vertical : {
			x : this.left + this.rulerWidth - this.rulerStroke,
			y : this.top,
			width : this.rulerStroke,
			height : this.height - (this.top + this.bottom + this.clusterTitleHeight) - this.rulerHeight
		},
		horizontal : {
			x : this.left + this.rulerWidth - this.rulerStroke,
			y : this.height - (this.bottom + this.clusterTitleHeight + this.rulerHeight),
			width : properties.width,
			height : this.rulerStroke,
			xValues : properties.xValues
		}
	});

};

/** Remove nulls and NaN elements in the array * */
GenericGraph.prototype.cleanArray = function(data) {
	var checked = [];

	/** checking data are numbers * */
	for ( var i = 0; i < data.length; i++) {
		if (data[i] != null) {
			if (!isNaN(data[i])) {
				checked.push(data[i]);
			}
		}
	}
	return checked;
};

GenericGraph.prototype.refresh = function(data) {
	document.getElementById(this.targetId).innerHTML = "";
	this.draw(this.targetId, data);
};

GenericGraph.prototype.getClassColor = function(className) {
	for ( var i = 0; i < this.data.clusters.length; i++) {
		var cluster = this.data.clusters[i];
		for ( var j = 0; j < cluster.classes.length; j++) {
			var classes = cluster.classes[j];
			if (classes.name == className) {
				if (classes.color != null) {
					return classes.color;
				}
			}
		}
	}
	return "black";
};

GenericGraph.prototype.getDimensions = function(data) {
	var results = {};
	var points = [];

	this.data = data;
	var classesNumber = 0;
	var xValues = [];

	for ( var i = 0; i < data.clusters.length; i++) {
		var cluster = data.clusters[i];
		if (!this.plotHorizontalByCluster) {
			xValues.push(data.clusters[i].x);
		}
		for ( var j = 0; j < cluster.classes.length; j++) {
			var classes = cluster.classes[j];
			points = points.concat(classes.values);
			classesNumber = classesNumber + 1;
		}
	}

	var checked = this.cleanArray(points);

	checked.sort(function(a, b) {
		return a - b;
	});

	results.minPoint = checked[0];
	if (this.rulerMinValue != null) {
		results.minPoint = this.rulerMinValue;
	}
	results.maxPoint = checked[checked.length - 1];
	if (this.rulerMaxValue != null) {
		results.maxPoint  = this.rulerMaxValue;
	}

	results.classesNumber = classesNumber;
	results.clusterNumber = data.clusters.length;

	var totalInterClassesFreeSpace = (classesNumber - data.clusters.length) * this.interClassesSpace;
	var totalInterClusterFreeSpace = (data.clusters.length) * this.interClustersSpace;
	results.classWidth = (this.width - (this.rulerWidth + this.left + this.right + totalInterClassesFreeSpace + totalInterClusterFreeSpace))/ classesNumber;
	results.width = this.width - (this.right + this.left) - this.rulerWidth + this.rulerStroke;

	results.xValues = {};

	xValues.sort(function(a, b) {
		return a - b;
	});
	results.xValues.values = xValues;
	if (xValues.length > 0) {
		results.xValues.min = xValues[0];
		results.xValues.max = xValues[xValues.length - 1];
		results.xValues.range = results.xValues.max - results.xValues.min;
	}
	return results;

};

GenericGraph.prototype.draw = function(targetId, data) {
	this.targetId = targetId;
	var properties = (this.getDimensions(data));
	this.svg = SVG.createSVGCanvas(document.getElementById(this.targetId), [ [ "width", this.width ], [ "height", this.height ] ]);
	this.plotAxes(properties);
};

GenericGraph.prototype.getMedian = function(checked) {
	/** Calculating median * */
	if (checked.length % 2 == 1) {
		return checked[Math.floor(checked.length / 2)];
	} else {
		return (Number(checked[(checked.length / 2) - 1]) + Number(checked[checked.length / 2])) / 2;
	}
};

GenericGraph.prototype.pointToPixel = function(value, boxProperties) {
	var ratio = (value - boxProperties.minPoint) / (boxProperties.maxPoint - boxProperties.minPoint);
	var pixelLength = boxProperties.height - boxProperties.y + this.top;
	return (-1 * ratio) * (pixelLength) + (boxProperties.y + boxProperties.height);
};

GenericGraph.prototype.maxValueWhisker = function(aboveLimit, q3, array) {
	var points = [];
	for ( var i = 0; i < array.length; i++) {
		if ((array[i] > q3) && (array[i]) <= aboveLimit) {
			points.push(array[i]);
		}
	}
	if (points.length > 0) {
		points.sort(function(a, b) {
			return a - b;
		});
		return points[points.length - 1];
	}
	return null;
};

GenericGraph.prototype.input = function() {
	return DATADOC.getBoxWhikerData();
};

GenericGraph.prototype.test = function(targetId) {
	var plot = new GenericGraph({
		targetId : targetId,
		height : 350,
		width : 450,
		maxBoxWidth : 25
	});
	plot.refresh(this.input());
};

/**
 * Using dygraph it plots a chart. Params: targetId, labelsContainerId, args
 * 
 * @width
 * @height
 * @labelsWidth
 * @targetId
 * @customBars
 * @ylabel
 * @xlabel
 * @showRangeSelector Show or hide the range selector widget.
 */
function DygraphWidget(targetId, args) {
	this.width = 1000;
	this.height = 600;
	this.labelsWidth = 100;
	this.targetId = targetId;
	this.customBars = false;
	this.ylabel = "";
	this.xlabel = "";
	this.id = BUI.id();
	this.showRangeSelector = false;
	this.interactionModel = null;
	this.labelsDivStyles = null;

	this.ranges = {};

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}

		if (args.labelsWidth != null) {
			this.labelsWidth = args.labelsWidth;
		}
		if (args.labelsDivStyles != null) {
			this.labelsDivStyles = args.labelsDivStyles;
		}
		if (args.customBars != null) {
			this.customBars = args.customBars;
		}
		if (args.ylabel != null) {
			this.ylabel = args.ylabel;
		}
		if (args.xlabel != null) {
			this.xlabel = args.xlabel;
		}
		if (args.showRangeSelector != null) {
			this.showRangeSelector = args.showRangeSelector;
		}
		if (args.interactionModel != null) {
			this.interactionModel = args.interactionModel;
		}

		if (args.scaled != null) {
			this.scaled = args.scaled;
		}
		if (args.ranges != null) {
			this.ranges = args.ranges;
		}

	}

	this.onZoomX = new Event(this);
	this.onResetZoom = new Event(this);
	this.dblclick = new Event(this);
}

/** Draws it on targetId 
 * data: dygraphs.com/data.html
 * 
 * **/

DygraphWidget.prototype.dblclick = function(event, g, context) {
	g.widget.dblclick.notify({
		x : g.lastx_
	});
};

DygraphWidget.prototype._createHTLMWrapper = function(data, colors, labels) {
	/** If plot is set in a tab it is possible that it is not renderer yet **/
	if (document.getElementById(this.targetId) == null) {
		return;
	}
	document.getElementById(this.targetId).innerHTML = "";
	/** Creating legend in a table **/
	var table = document.createElement("table");
	var tr = document.createElement("tr");
	var tdCanvas = document.createElement("td");

	this.canvasDiv = document.createElement("div");
	this.canvasDiv.setAttribute("id", "dygraph_canvas_" + this.id);
	this.canvasDiv.setAttribute("style", "width:" + this.width + "px;height:" + this.height + "px");
	tdCanvas.appendChild(this.canvasDiv);

	this.legendDiv = document.createElement("div");
	tr.appendChild(tdCanvas);
	table.appendChild(tr);
	document.getElementById(this.targetId).appendChild(table);
};

DygraphWidget.prototype.draw = function(data, colors, labels) {
	this._createHTLMWrapper(data, colors, labels);
	this.dygraph = new Dygraph(this.canvasDiv, data, {
		labels : labels,
		labelsDiv : this.legendDiv,
		labelsSeparateLines : true,
		highlightCircleSize : 3,
		strokeWidth : 1,
		customBars : this.customBars,
		colors : colors,
		scaled : this.scaled,
		ranges : this.ranges,
		xlabel : this.xlabel,
		ylabel : this.ylabel,
		showRangeSelector : this.showRangeSelector,
		rangeSelectorPlotStrokeColor : 'rgba(50,50,50,0.3)',
		rangeSelectorPlotFillColor : 'rgba(50,50,50,0.1)',
		labelsDivStyles : this.labelsDivStyles,
		interactionModel : this.interactionModel
	});

};

/**
 * It shows all the measurements done for a proposal sorted by run number
 * 
 * @showAveragesHistory shows all the averages instead of only the last one.
 *                      Specially useful when something has been reprocessed
 * @isGrouped to be grouped by day
 * @tbar top bar is visible
 */
function QueueGrid(args) {
	this.height = 700;
	this.searchBar = false;
	this.tbar = false;
	this.bbar = true;
	this.collapsed = false;
	this.id = BUI.id();

	this.margin = 0;
	this.key = {};
	var _this = this;
	this.filters = [ function(item) {
		if (item.data.dataCollectionId == null) {
			return false;
		}
		if (_this.key[item.data.dataCollectionId] == null) {
			_this.key[item.data.dataCollectionId] = [];
		}
		_this.key[item.data.dataCollectionId].push(item.data);
		
		return item.data.macromoleculeId != null;
	} ];

	this.sorter = [ {
		property : 'measurementId',
		direction : 'DESC'
	} ];

	this.url = BUI.getQueueUrl();

	this.showAveragesHistory = false;
	this.isGrouped = true;

	/** Limit of datacollection to be fecthed * */
	this._limit = 150;
	this.pageSize = 30;
	this.pageCount = null;
	this.currentPage = 1;

	// this.title =this.getTitle();
	this.hideSolvents = false;

	/** Selected items * */
	this.selected = [];

	/** This is the precission to be shown in the grid * */
	this.decimals = 3;
	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.pageSize != null) {
			this.pageSize = args.pageSize;
		}
		if (args.sorter != null) {
			this.sorter = args.sorter;
		}
		if (args.margin != null) {
			this.margin = args.margin;
		}
		if (args.url != null) {
			this.url = args.url;
		}
		if (args.filters != null) {
			this.filters = args.filters;
		}
		if (args.bbar != null) {
			this.bbar = args.bbar;
		}
		if (args.searchBar != null) {
			this.searchBar = args.searchBar;
		}
		if (args.isGrouped != null) {
			this.isGrouped = args.isGrouped;
		}
		if (args.title != null) {
			this.title = args.title;
		}

		if (args.tbar != null) {
			this.tbar = args.tbar;
		}

		if (args.collapsed != null) {
			this.collapsed = args.collapsed;
		}

		if (args.width != null) {
			this.width = args.width;
		}

		if (args._limit != null) {
			this._limit = args._limit;
		}
	}
}

QueueGrid.prototype.getTitle = function() {
	return 'Last ' + this._limit + ' Data Collections'
};

QueueGrid.prototype.setLimit = function(limit) {
	this._limit = limit;
	this.grid.setTitle(this.getTitle());
};

QueueGrid.prototype.refresh = function(data) {
	if (data != null) {
		this.key = {}
		this.store.loadData(data);
	} else {
		this.store.load();

	}
};

QueueGrid.prototype._addRecord = function(record, data) {
	data.push(record);
	return data;

};

QueueGrid.prototype._prepareData = function(records) {
	var data = [];
	this.groupingKey = {};
	for (var i = 0; i < records.length; i++) {
		var record = records[i];
		records[i]["date"] = moment(records[i].creationDate).format("YYYYMMDD");
		if (record.dataCollectionId != null) {
			if (record.macromoleculeId != null) {
				this.groupingKey[record.dataCollectionId] = record.macromoleculeAcronym + "  " + record.concentration;
			}
		}
	}
	return records;
};

QueueGrid.prototype.getTbar = function() {
	var button = {
		text : 'Primary Data Processing ',
		xtype : 'button',
		icon : '../images/magnif.png',
		handler : function() {
			var mergeIds = [];
			var subtractionIds = [];
			for (var i = 0; i < _this.selected.length; i++) {
				if (_this.selected[i].mergeId != null) {
					mergeIds.push(_this.selected[i].mergeId);
				}
				/** Buffers row contains also their subtractionId * */
				if (_this.selected[i].macromoleculeId != null) {
					if (_this.selected[i].subtractionId != null) {
						subtractionIds.push(_this.selected[i].subtractionId);
					}
				}
			}
			_this.openCurveVisualizer(mergeIds, subtractionIds);

		}
	};

	var _this = this;
	function onItemCheck(option, b) {
		/** Only it does something when limit changes * */
		if (option.text != _this._limit) {
			if (option.text == "All") {
				_this.setLimit(2000);
			} else {
				_this.setLimit(option.text);
				_this.update();
			}
		}
	}

	function onHideSolventCheck(option, b) {
		_this.hideSolvents = option.checked;

		_this.refresh(_this.data);
	}

	return Ext.create('Ext.toolbar.Toolbar', {
		flex : 1,
		border : 1,
		items : [ {
			xtype : 'button',
			text : 'Search',
			icon : '../images/magnif.png',
			menu : [ {
				text : 'By date'
			}, {
				text : 'By macromolecule'
			} ]
		},

		{
			xtype : 'button',
			text : 'View',
			menu : [ {
				text : 'Hide solvents',
				checked : false,
				checkHandler : onHideSolventCheck
			}, {
				text : 'Fetch',
				menu : { // <-- submenu by nested config object
					items : [
					// stick any markup in a menu
					'<b class="menu-title">Choose a number of data collection to be fetched</b>', {
						text : '25',
						checked : true,
						group : 'theme',
						checkHandler : onItemCheck
					}, {
						text : '100',
						checked : false,
						group : 'theme',
						checkHandler : onItemCheck
					}, {
						text : '200',
						checked : false,
						group : 'theme',
						checkHandler : onItemCheck
					}, {
						text : '500',
						checked : false,
						group : 'theme',
						checkHandler : onItemCheck
					}, {
						text : '1000',
						checked : false,
						group : 'theme',
						checkHandler : onItemCheck
					}, {
						text : 'All',
						checked : false,
						group : 'theme',
						checkHandler : onItemCheck
					} ]
				}
			}

			]
		} ]
	});
};

QueueGrid.prototype._getPorod = function() {
	return {
		text : 'Porod',
		name : 'Porod',
		columns : [
				{
					text : 'Volume',
					dataIndex : 'volumePorod',
					width : 80,
					sortable : true,
					renderer : function(val, y, sample) {
						if (sample.raw.macromoleculeId != null) {
							if (sample.raw.subtractionId != null) {
								if (sample.raw.volumePorod != null)
									return BUI.formatValuesUnits(sample.raw.volumePorod, '') + "<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>";
							}
						}
					}
				},
				{
					text : 'MM Vol. est.',
					dataIndex : 'volumeEdna',
					tooltip : '[Volume/2 - Volume/1.5] (Guinier)',
					sortable : true,
					width : 95,
					renderer : function(val, y, sample) {
						var html = "";
						if (sample.raw.macromoleculeId != null) {
							if (sample.raw.subtractionId != null) {
								if (sample.raw.volume != null)
									html = html + Number(sample.raw.volumePorod / 2).toFixed(1) + " - " + Number(sample.raw.volumePorod / 1.5).toFixed(1)
											+ "<span style='font-size:8px;color:gray;'>kD</span>";
							}
						}
						return html;
					}
				} ]
	};
};

QueueGrid.prototype._getHTMLRow = function(key, value, error, units, decimals) {
	if (value != null) {
		if (decimals != null) {
			value = Number(value).toFixed(decimals);
		}

		if (error != null) {
			return "<td style='padding:2px;color:gray'>" + key + ": </td><td style='padding-left:10px;font-size:12px;'>" + value + " " + units
					+ "  <span style='font-size:10px;padding-left:5px;'>&#177; " + error + "</span></td>";

		} else {
			return "<tr><td style='padding:2px;color:gray'>" + key + ": </td><td style='padding-left:10px'>" + value + " " + units + "</td></tr>";
		}
	}
	return "";
};

QueueGrid.prototype.openCurveVisualizerBySelected = function(mergeIds, subtractionIds) {
	var mergeIds = [];
	var subtractionIds = [];
	for (var i = 0; i < this.selected.length; i++) {
		if (this.selected[i].mergeId != null) {
			mergeIds.push(this.selected[i].mergeId);
		}
		/** Buffers row contains also their subtractionId * */
		if (this.selected[i].macromoleculeId != null) {
			if (this.selected[i].subtractionId != null) {
				subtractionIds.push(this.selected[i].subtractionId);
			}
		}
	}
	this.openCurveVisualizer(mergeIds, subtractionIds);
};

QueueGrid.prototype.openCurveVisualizer = function(mergeIds, subtractionIds) {
	/**
	 * When showing subtraction we want to show 1) Sample Average 2) Buffer
	 * Average 3) Frames used for the subtraction
	 */
	var viz = new SubtractionCurveVisualizer();
	var panel = viz.getPanel();
	Ext.create('Ext.window.Window', {
		title : 'Primary Data Processing',
		height : 500,
		width : 800,
		layout : 'fit',
		items : [ panel ]
	}).show();

	viz.refresh(mergeIds, subtractionIds);
};

QueueGrid.prototype.getStore = function() {
	var _this = this;
	Ext.define('Queue', {
		extend : 'Ext.data.Model',
		fields : [ 'name', 'date', 'volumePorod', 'runCreationDate', 'measurementCode', 'macromoleculeAcronym', 'bufferAcronym', 'I0', 'I0Stdev', 'acronym', 'averageFilePath',
				'bufferAverageFilePath', 'bufferId', 'bufferOnedimensionalFiles', 'code', 'comments', 'composition', 'concentration', 'creationDate', 'creationTime',
				'dataAcquisitionFilePath', 'dataCollectionId', 'discardedFrameNameList', 'dmax', 'experimentId', 'experimentType', 'exposureTemperature', 'extintionCoefficient',
				'extraFlowTime', 'firstPointUsed', 'flow', 'frameListId', 'framesCount', 'framesMerge', 'gnomFilePath', 'gnomFilePathOutput', 'guinierFilePath', 'isagregated',
				'kratkyFilePath', 'lastPointUsed', {
					name : 'macromoleculeId',
					id : 'macromoleculeId'

				}, {
					name : 'measurementId',
					type : 'int'
				}, 'mergeId', 'molecularMass', 'name', 'pH', 'priorityLevelId', 'proposalId', 'quality', 'rg', 'rgGnom', 'rgGuinier', 'rgStdev', 'runId', 'safetyLevelId',
				'sampleAverageFilePath', 'sampleOneDimensionalFiles', 'samplePlatePositionId', 'scatteringFilePath', 'sequence', 'sessionId', 'sourceFilePath', 'specimenId',
				'status', 'stockSolutionId', 'substractedFilePath', 'subtractionId', 'total', 'transmission', 'viscosity', 'volume', 'volumeToLoad', 'waitTime', 'reference',
				'refined', 'fitCount', 'superposisitionCount', 'rigidbodyCount', 'abinitioCount' ]
	});

	this.store = Ext.create('Ext.data.Store', {
		model : 'Queue',
		groupField : 'dataCollectionId',
		groupDir : 'DESC',
		filters : this.filters,
		remoteFilter : false,
		pageSize : this.pageSize,
		remoteSort : true,
		listeners : {
			beforeload : function() {
				_this.key = {};
				return true;
			},
			load : function(store, records) {

			}
		},
		proxy : {
			autoload : false,
			type : 'ajax',
			url : this.url,
			reader : {
				type : 'json',
				totalProperty : 'results',
				root : 'rows'
			}
		}
	});
	return this.store;

};

QueueGrid.prototype.getPanel = function() {
	var _this = this;
	this.data = _this._prepareData([]);
	/**
	 * Store in Memory
	 */
	this.store = this.getStore();

	var features = [];

	if (this.isGrouped) {
		/** Grouping by date * */
		features.push(Ext.create('Ext.grid.feature.Grouping', {
			groupHeaderTpl : '{[values.rows[0].dataCollectionId]}',
			hideGroupedHeader : false,
			startCollapsed : false
		}));

	}

	/**
	 * Selection mode is multi in order to compare all the frames from different
	 * data collections (measurements)
	 */
	var selModel = Ext.create('Ext.selection.RowModel', {
		allowDeselect : true,
		mode : 'MULTI',
		listeners : {
			selectionchange : function(sm, selections) {
				_this.selected = new Array();
				for (var i = 0; i < selections.length; i++) {
					_this.selected.push(selections[i].raw);
				}
			}
		}
	});

	this.grid = Ext.create('Ext.grid.Panel', {
		title : this.title,
		collapsible : false,
		features : features,
		resizable : true,
		autoscroll : true,
		store : this.store,
		layout : 'fit',
		border : 1,
		height : this.height,
		emptyText : "No datacollections",
		width : this.width,
		columns : this.getColumns(),
		rowLines : false,
		margin : this.margin,
		viewConfig : {
			enableTextSelection : true,
			preserveScrollOnRefresh : true,
			stripeRows : false,
			rowLines : false,
			getRowClass : function(record, rowIdx, params, store) {
				// return "queue-grid-row";
			},
			listeners : {
				celldblclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonAction') {
						if (e.target.defaultValue == 'Data Reduction') {
							//							_this.openCurveVisualizerBySelected();
							_this.onDataReductionButtonClicked(record.raw);
						}

						if (e.target.defaultValue == 'Abinitio') {
							_this.onAbinitioButtonClicked(record.raw);
						}

						if (e.target.defaultValue == 'Fit') {
							_this.onFitButtonClicked(record.raw);
						}

						if (e.target.defaultValue == 'Superposition') {
							_this.onSuperpositionButtonClicked(record.raw);
						}

						if (e.target.defaultValue == 'Rigid Body') {
							_this.onRigidBodyButtonClicked(record.raw);
						}
					}
				}
			}
		}
	});

	/** Adding the tbar * */
	if (this.tbar) {
		this.grid.addDocked(this.getTbar());
	}

	if (this.bbar) {
		this.grid.addDocked({
			xtype : 'pagingtoolbar',
			store : this.store,
			dock : 'bottom',
			displayInfo : true
		});
	}
	return this.grid;
};

QueueGrid.prototype.onDataReductionButtonClicked = function(record) {
	var adapter = new BiosaxsDataAdapter();
	var dataReductionForm = new DataReductionForm({});

	Ext.create('Ext.window.Window', {
		title : 'Data Reduction',
		height : 540,
		width : 1000,
		modal : true,
		items : [ dataReductionForm.getPanel() ]
	}).show();

	dataReductionForm.panel.setLoading();
	adapter.onSuccess.attach(function(sender, subtractions) {
		dataReductionForm.refresh(subtractions);
		dataReductionForm.panel.setLoading(false);
	});
	adapter.getAbinitioModelsBySubtractionId([ record.subtractionId ]);
};

QueueGrid.prototype.onAbinitioButtonClicked = function(record) {
	var adapter = new BiosaxsDataAdapter();
	var abinitioForm = new AbinitioForm({});

	Ext.create('Ext.window.Window', {
		title : 'Abinitio Modeling',
		height : 630,
		width : 800,
		items : [ abinitioForm.getPanel() ]
	}).show();

	abinitioForm.panel.setLoading();
	adapter.onSuccess.attach(function(sender, subtractions) {
		abinitioForm.refresh(subtractions);
		abinitioForm.panel.setLoading(false);
	});
	adapter.getAbinitioModelsBySubtractionId([ record.subtractionId ]);
};

QueueGrid.prototype.onRigidBodyButtonClicked = function(record) {
	var adapter = new BiosaxsDataAdapter();
	var rigidForm = new RigidBodyModelingResultForm({});

	Ext.create('Ext.window.Window', {
		title : 'Rigid Body Modeling',
		height : 600,
		width : 800,
		items : [ rigidForm.getPanel() ]
	}).show();

	rigidForm.panel.setLoading();
	adapter.onSuccess.attach(function(sender, subtractions) {
		rigidForm.refresh(subtractions);
		rigidForm.panel.setLoading(false);
	});
	adapter.getSubtractionsByIdsList([ record.subtractionId ]);
};

/** It opens the fit window form **/
QueueGrid.prototype.onFitButtonClicked = function(record) {
	var adapter = new BiosaxsDataAdapter();
	var fitForm = new FitForm({});

	Ext.create('Ext.window.Window', {
		title : 'Fit',
		height : 600,
		width : 800,
		items : [ fitForm.getPanel() ]
	}).show();

	fitForm.panel.setLoading();
	adapter.onSuccess.attach(function(sender, subtractions) {
		fitForm.refresh(subtractions);
		fitForm.panel.setLoading(false);
	});
	adapter.getSubtractionsByIdsList([ record.subtractionId ]);
};

/** It opens the superposition window form **/
QueueGrid.prototype.onSuperpositionButtonClicked = function(record) {
	var adapter = new BiosaxsDataAdapter();
	var superpositionForm = new SuperpositionForm({});

	Ext.create('Ext.window.Window', {
		title : 'Superposition',
		height : 620,
		width : 900,
		items : [ superpositionForm.getPanel() ]
	}).show();

	superpositionForm.panel.setLoading();
	adapter.onSuccess.attach(function(sender, subtractions) {
		superpositionForm.refresh(subtractions);
		superpositionForm.panel.setLoading(false);
	});
	adapter.getSubtractionsByIdsList([ record.subtractionId ]);
};

QueueGrid.prototype._openVisualizer = function(experimentList, subtraction, record) {
	var merges = experimentList.getMergesByDataCollectionId(subtraction.dataCollectionId);
	var mergeIdList = [];
	for (var i = 0; i < merges.length; i++) {
		mergeIdList.push(merges[i].mergeId);
	}

	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, merges) {
		var dataCollectionCurveVisualizer = new DataCollectionCurveVisualizer();
		dataCollectionCurveVisualizer.draw();
		dataCollectionCurveVisualizer.refresh(merges, experimentList, subtraction.dataCollectionId, record);
	});

	dataAdapter.onError.attach(function(sender, error) {
	});

	dataAdapter.getMergesByIdsList(mergeIdList);
};

QueueGrid.prototype.getFramesHTML = function(sample) {
	var dataCollectionId = sample.data.dataCollectionId;
	var table = document.createElement("table");
	
	var measurementId = {};
	
	if (this.key[dataCollectionId] != null) {

		this.key[dataCollectionId].sort(function(a, b) {
			return b.measurementId - a.measurementId
		});

		for (i in this.key[dataCollectionId]) {
			var specimen = this.key[dataCollectionId][i];
			
			if (measurementId[specimen.measurementId] == null){
				measurementId[specimen.measurementId] = true;
				var tr = document.createElement("tr");
				var td = document.createElement("td");
				if (specimen.macromoleculeId == null) {
					td.setAttribute("style", "padding-top:8px;width:130px;color:gray;");
					td.appendChild(document.createTextNode(specimen.bufferAcronym));
				} else {
					td.setAttribute("style", "padding-top:8px;width:130px;font-weight:bold;");
					td.appendChild(document.createTextNode(specimen.macromoleculeAcronym));
				}
				tr.appendChild(td);
				var frames = specimen.framesMerge + "/" + specimen.framesCount;
				var tdFrames = document.createElement("td");
				if ( specimen.framesMerge < 5){
					tdFrames.setAttribute("style", "padding-top:8px;");
				}
				else{
					tdFrames.setAttribute("style", "padding-top:8px;");
				}
				tdFrames.appendChild(document.createTextNode(frames));
				tr.appendChild(tdFrames);
	
				var td = document.createElement("td");
				td.setAttribute("style", "padding-top:8px;");
				var a = document.createElement("a");
				if (specimen.macromoleculeId == null) {
					a.setAttribute("href", BUI.getZipURLByAverageId(specimen.mergeId, specimen.measurementCode));
				} else {
					a.setAttribute("href", BUI.getZipURLBySubtractionId(specimen.subtractionId, specimen.measurementCode));
				}
	
				var img = document.createElement("img");
				img.setAttribute("src", "../images/download.png");
				img.setAttribute("style", "width:12px;height:12px;cursor:pointer;");
				a.appendChild(img);
				td.appendChild(a);
				tr.appendChild(td);
	
				table.appendChild(tr);
			}
		}

	}
	return "<table>" + table.innerHTML + "</table>";
};

QueueGrid.prototype.getRunHTML = function(sample) {
	var dataCollectionId = sample.data.dataCollectionId;
	var table = document.createElement("table");
	
	var measurementId = {};
	if (this.key[dataCollectionId] != null) {

		this.key[dataCollectionId].sort(function(a, b) {
			return b.measurementId - a.measurementId
		});
		

		for (i in this.key[dataCollectionId]) {
			var specimen = this.key[dataCollectionId][i];
			if (measurementId[specimen.measurementId] == null){
				measurementId[specimen.measurementId] = true;
				var tr = document.createElement("tr");
				var td = document.createElement("td");
				if (specimen.macromoleculeId == null) {
					td.setAttribute("style", "padding-top:8px;width:130px;color:gray;");
					td.appendChild(document.createTextNode("# " + specimen.measurementCode));
				} else {
					td.setAttribute("style", "padding-top:8px;width:130px;font-weight:bold;");
					td.appendChild(document.createTextNode("# " + specimen.measurementCode));
				}
				tr.appendChild(td);
				table.appendChild(tr);
			}
		}

	}
	return "<table>" + table.innerHTML + "</table>";
};

QueueGrid.prototype.getColumns = function() {
	var _this = this;
	return [
			{
				header : "dataCollectionId",
				name : "dataCollectionId",
				dataIndex : "dataCollectionId",
				hidden : true
			},
			{
				header : "Exp. Id",
				name : "experimentId",
				dataIndex : "experimentId",
				hidden : true
			},
			{
				header : "Exp. Name",
				name : "name",
				dataIndex : "name",
				hidden : true
			},
			{
				header : "MeasurementId",
				name : "measurementId",
				dataIndex : "measurementId",
				hidden : true,
				renderer : function(val, y, sample) {
					return sample.raw.measurementId;
				}
			},
			{
				header : "Date",
				name : "date",
				width : 150,
				dataIndex : "runCreationDate",
				hidden : true
			},

			{
				header : "Run",
				width : 50,
				name : "runNumber",
				dataIndex : "measurementCode",
				renderer : function(val, y, sample) {
					return _this.getRunHTML(sample);//"<span style='font-weight:bold;'>#" + val + "</span>";
				}
			},
			{
				header : "Frames (Average/Total)",
				dataIndex : "macromoleculeId",
				name : "macromoleculeAcronym",
				width : 175,
				// locked : true,
				hidden : false,
				renderer : function(val, meta, sample) {
					return _this.getFramesHTML(sample);

				}
			},
			{
				text : 'Scattering',
				dataIndex : 'subtractionId',
				width : 70,
				// locked : true,
				name : 'subtractionId',
				renderer : function(val, y, sample) {
					if (sample.raw.macromoleculeId != null) {
						if (sample.raw.subtractionId != null) {
							var url = BUI.getURL() + '&type=scattering&subtractionId=' + sample.raw.subtractionId;
							var event = "OnClick= window.open('" + url + "')";
							return '<img src=' + url + '   height="60" width="60" ' + event + '>';
						}
					}
				}
			},
			{
				header : "Macromolecule",
				name : "macromoleculeAcronym",
				dataIndex : "macromoleculeAcronym",
				flex : 1,
				hidden : true
			},
			{
				header : "Concentration",
				name : "concentration",
				width : 100,
				dataIndex : "concentration",
				hidden : false,
				renderer : function(val, y, sample) {
					if (sample.raw.concentration != 0) {
						return BUI.formatValuesUnits(sample.raw.concentration, "mg/ml", 7, this.decimals);
					}
				}
			},
			{
				header : "Exp. Temp.",
				name : "bufferAcronym",
				width : 75,
				dataIndex : "bufferAcronym",
				hidden : true,
				renderer : function(val, y, sample) {
					return BUI.formatValuesUnits(sample.raw.exposureTemperature, "C", 10, this.decimals);
				}
			},
			{
				header : "Sample",
				dataIndex : "macromoleculeId",
				name : "macromoleculeAcronym",
				locked : false,
				hidden : true,
				renderer : function(val, y, sample) {
					var html = "<table>"
					var macromolecule = BIOSAXS.proposal.getMacromoleculeById(sample.raw.macromoleculeId);
					if (macromolecule != null) {
						html = html + '<tr><td style="vertical-align:center;">' + macromolecule.acronym + '</td></tr>';
					}
					if (sample.raw.bufferId != null) {
						if (BIOSAXS.proposal.getBufferById(sample.raw.bufferId) != null) {
							var bufferAcronym = BIOSAXS.proposal.getBufferById(sample.raw.bufferId).acronym;
							if ((bufferAcronym == "") || (bufferAcronym == null)) {
								bufferAcronym = "";
							}
							html = html + '<tr><td>' + bufferAcronym + '</td></tr>';
						}
					}
					return html + "</table>";
				}
			},
			{
				header : "Frames",
				dataIndex : "macromoleculeId",
				name : "macromoleculeAcronym",
				width : 85,
				locked : false,
				hidden : true,
				renderer : function(val, y, sample) {
					var html = "<table style='width:100%;text-align:center;'>";
					if (sample.raw.runId != null) {
						if (sample.raw.framesMerge != null) {
							/**
							 * Because of some problem on the webservices frames
							 * count and frames average was inverted for some
							 * time, just check that the values are coherent *
							 */
							if (sample.raw.framesCount != null) {
								if (parseFloat(sample.raw.framesCount) < parseFloat(sample.raw.framesMerge)) {
									var aux = sample.raw.framesCount;
									sample.raw.framesCount = sample.raw.framesMerge;
									sample.raw.framesMerge = aux;
								}
							}

							function getColorFrame(framesMerged, total) {
								if (framesMerged / total < 0.5) {
									return "#FA5858";
								}
								if ((framesMerged / total >= 0.5) && (framesMerged / total < 0.8)) {
									return "#FFCC80";
								}
								return null;
							}
							var color = getColorFrame(sample.raw.framesMerge, sample.raw.framesCount);
							if (color) {
								html = html + "<tr style='border:1px solid gray; width:10px;background-color:" + color + ";' ><td >" + sample.raw.framesMerge + " of "
										+ sample.raw.framesCount + "</td>";
							} else {
								html = html + "<tr><td >" + sample.raw.framesMerge + " of " + sample.raw.framesCount + "</td>";
							}
							html = html + "</table>";
							return html;
						}

					}
					if (this.showAveragesHistory) {
						if (sample.raw.averages != null) {
							for (var i = 1; i < sample.raw.averages.length; i++) {
								if (sample.raw.averages[i].framesMerge != null) {
									var f = 'new SubtractionCurveVisualizer().refresh([' + sample.raw.averages[i].mergeId + '], [])';
									html = html + "<tr onmouseover='' style='color:gray;font-style: italic; cursor: pointer;'  onclick='" + f + "'><td >"
											+ sample.raw.averages[i].framesMerge + " of " + sample.raw.averages[i].framesCount + "</td></tr>";
								}
							}
						}
					}
				}
			},
			{
				text : 'Kratky.',
				dataIndex : 'subtractionId',
				width : 66,
				hidden : true,
				name : 'subtractionId',
				renderer : function(val, y, sample) {
					if (sample.raw.macromoleculeId != null) {
						if (sample.raw.subtractionId != null) {
							var url = BUI.getURL() + '&type=kratky&subtractionId=' + sample.raw.subtractionId;
							var event = "OnClick= window.open('" + url + "')";
							return '<img src=' + url + '   height="60" width="60" ' + event + '>';
						}
					}
				}
			},
			{
				text : 'P(r).',
				hidden : true,
				width : 66,
				dataIndex : 'subtractionId',
				type : 'string',
				renderer : function(val, y, sample) {
					if (sample.raw.macromoleculeId != null) {
						if (sample.raw.subtractionId != null) {
							var url = BUI.getURL() + '&type=gnom&subtractionId=' + sample.raw.subtractionId;
							var event = "OnClick= window.open('" + url + "')";
							return '<img src=' + url + '   height="60" width="60" ' + event + '>';
						}
					}
				}
			},
			{
				text : 'Guinier.',
				hidden : true,
				width : 66,
				dataIndex : 'subtractionId',
				type : 'string',
				renderer : function(val, y, sample) {
					if (sample.raw.macromoleculeId != null) {
						if (sample.raw.subtractionId != null) {
							var url = BUI.getURL() + '&type=guinier&subtractionId=' + sample.raw.subtractionId;
							var event = "OnClick= window.open('" + url + "')";
							return '<img src=' + url + '   height="60" width="60" ' + event + '>sdfsdfs</img>';
						}
					}
				}
			},
			{
				text : 'Guinier',
				name : 'Guinier',
				columns : [
						{
							text : 'Rg',
							dataIndex : 'rg',
							name : 'rg',
							width : 80,
							tooltip : 'In polymer physics, the radius of gyration is used to describe the dimensions of a polymer chain.',
							sortable : true,
							renderer : function(val, y, sample) {
								val = sample.raw.rg;
								if (val != null) {
									if (sample.raw.macromoleculeId != null) {
										if (sample.raw.subtractionId != null) {
											/**
											 * Show warning if rgGuinier and
											 * rgGnom differ more than 10% *
											 */
											if (Math.abs(val - sample.raw.rgGnom) > (val * 0.1)) {
												return "<span style='color:orange;'>" + BUI.formatValuesUnits(val, "") + "</span>";

											}
											return BUI.formatValuesUnits(val, "nm", 12, this.decimals);
										}
									}
								}
							}
						},
						{
							text : 'Points',
							dataIndex : 'points',
							sortable : true,
							hidden : false,
							width : 80,
							type : 'string',
							renderer : function(val, y, sample) {
								if (sample.raw.macromoleculeId != null) {
									if (sample.raw.subtractionId != null) {
										if ((sample.raw.firstPointUsed == "") || (sample.raw.firstPointUsed == null))
											return;
										return "<span>" + sample.raw.firstPointUsed + " - " + sample.raw.lastPointUsed + "<br/> ("
												+ (sample.raw.lastPointUsed - sample.raw.firstPointUsed) + " )</span>";
									}
								}
							}
						},
						{
							text : 'I(0)',
							dataIndex : 'I0',
							sortable : true,
							tooltip : 'Extrapolated scattering intensity at zero angle I(0) (forward scattering)',
							width : 80,
							type : 'string',
							renderer : function(val, y, sample) {
								val = sample.raw.I0;
								if (sample.raw.macromoleculeId != null) {
									if (sample.raw.subtractionId != null) {
										if (val != null) {
											return BUI.formatValuesErrorUnitsScientificFormat(val, sample.raw.I0Stdev, "");
										}
									}
								}
							}
						},
						{
							text : 'Quality',
							dataIndex : 'quality',
							hidden : true,
							tooltip : 'Estimated data quality. 1.0 - means ideal quality, 0.0 - unusable data. In table format it is given in percent (100% - ideal quality, 0% - unusable data). Please note that this estimation is based only on the Guinier interval (very low angles).',
							width : 80,
							sortable : true,
							renderer : function(val, y, sample) {
								val = sample.raw.quality;
								if (sample.raw.macromoleculeId != null) {
									if (sample.raw.subtractionId != null) {
										if (val != null) {
											if ((val != null) && (val != "")) {
												return "<span>" + (Number(val)).toFixed(2); // +
												// "</span><span
												// style='font-size:8px;color:gray;'>
												// %</span>";
											}
										}
									}
								}
							}
						}, {
							text : 'Aggregated',
							tooltip : "If aggregation was detected from the slope of the data curve at low angles the value is '1', otherwise '0'.",
							dataIndex : 'isagregated',
							hidden : true,
							width : 80,
							renderer : function(val, y, sample) {
								if (sample.raw.macromoleculeId != null) {
									if (sample.raw.subtractionId != null) {
										if ((sample.raw.isagregated != null)) {
											if (val == true) {
												return "Yes";
											} else {
												return "No";
											}
										}
									}
								}
							}
						} ]
			}, {
				text : 'Gnom',
				name : 'Gnom',
				columns : [ {
					text : 'Rg',
					dataIndex : 'rgGnom',
					type : 'string',
					// flex : 1,
					sortable : true,
					renderer : function(val, y, sample) {
						if (sample.raw.macromoleculeId != null) {
							if (sample.raw.subtractionId != null) {
								/**
								 * Show warning if rgGuinier and rgGnom differ
								 * more than 10% *
								 */
								if (sample.raw.rgGnom != null) {
									if (Math.abs(sample.raw.rgGuinier - sample.raw.rgGnom) > (sample.raw.rgGuinier * 0.1)) {
										return "<span style='color:orange;'>" + BUI.formatValuesUnits(sample.raw.rgGnom, "") + "</span>";

									}
									return BUI.formatValuesUnits(sample.raw.rgGnom, "nm");
								}
							}
						}
					}
				}, {
					text : 'Total',
					dataIndex : 'total',
					width : 60,
					sortable : true,
					renderer : function(val, y, sample) {
						if (sample.raw.macromoleculeId != null) {
							if (sample.raw.subtractionId != null) {
								if (sample.raw.total != null)
									return BUI.formatValuesUnits(sample.raw.total, '');
							}
						}
					}
				}, {
					text : 'D<sup>max</sup>',
					dataIndex : 'dmax',
					width : 70,
					sortable : true,
					renderer : function(val, y, sample) {
						if (sample.raw.macromoleculeId != null) {
							if (sample.raw.subtractionId != null) {
								if (sample.raw.dmax != null)
									return BUI.formatValuesUnits(sample.raw.dmax, "") + "<span style='font-size:8px;color:gray;'> nm</span>";
							}
						}
					}
				}, {
					text : 'P(r)',
					sortable : true,
					hidden : true,
					// flex : 1,
					dataIndex : 'subtractionId',
					type : 'string',
					renderer : function(val, y, sample) {
						if (sample.raw.macromoleculeId != null) {
							if (sample.raw.subtractionId != null) {
								var url = BUI.getURL() + '&type=gnom&subtractionId=' + sample.raw.subtractionId;
								var event = "OnClick= window.open('" + url + "')";
								return '<img src=' + url + '   height="60" width="60" ' + event + '>';
							}
						}
					}
				} ]
			}, this._getPorod(), {
				text : 'Advanced',
				id : this.id + 'buttonAction',
				dataIndex : 'subtrationId',
				witdh : 100,
				renderer : function(val, y, sample) {
					// 'fitCount', 'superposisitionCount', 'rigidbodyCount',
					// 'abinitioCount'
					var html = "<table><tr><td style='padding-bottom: 1px;'>" + BUI.getGreenButton("Data Reduction", {
						width : 90,
						height : 15
					}) + "</td></tr>";

					if (sample.raw.abinitioCount > 0) {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getGreenButton("Abinitio", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					} else {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getBlueButton("Abinitio", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					}

					if (sample.raw.fitCount > 0) {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getGreenButton("Fit", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					} else {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getBlueButton("Fit", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					}

					if (sample.raw.superposisitionCount > 0) {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getGreenButton("Superposition", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					} else {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getBlueButton("Superposition", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					}
					if (sample.raw.rigidbodyCount > 0) {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getGreenButton("Rigid Body", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					} else {
						html = html + "<tr><td style='padding-bottom: 1px;'>" + BUI.getBlueButton("Rigid Body", {
							width : 90,
							height : 15
						}) + "</td></tr>";
					}

					return html + "</table>";
				}

			} ]
};

function MacromoleculeConditionGrid(args) {

	this.height = 100;
	this.btnEditVisible = true;
	this.btnRemoveVisible = true;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
		if (args.btnRemoveVisible != null) {
			this.btnRemoveVisible = args.btnRemoveVisible;
		}
	}

	/** Events **/
	this.onEditButtonClicked = new Event(this);
	this.onAddButtonClicked = new Event(this);
	this.onRemoveButtonClicked = new Event(this);
	this.onDuplicateButtonClicked = new Event(this);
}

MacromoleculeConditionGrid.prototype._getColumns = function() {
	var _this = this;

	function actionItemRenderer(value, meta, record, rowIx, ColIx, store) {
		/*if (record.raw.specimen3VOs.length > 0){
			return 'x-hide-display';
		}*/
	}

	var columns = [ {
		header : 'Code',
		dataIndex : 'code',
		name : 'code',
		type : 'string',
		flex : 1
	}, {
		header : 'Bar Code',
		dataIndex : 'barCode',
		name : 'barCode',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'BeamLine',
		dataIndex : 'barCode',
		type : 'string',
		flex : 1,
		renderer : function(comp, val, record) {
			if (record.raw.sessionVO != null) {
				return "<span style='font-weight:bold;'>" + record.raw.sessionVO.beamlineName + "</span>";
			}
		}
	}, {
		header : 'Session',
		dataIndex : 'barCode',
		type : 'string',
		flex : 1,
		renderer : function(comp, val, record) {
			if (record.raw.sessionVO != null) {
				return "<span>" + moment(record.raw.sessionVO.startDate).format("MMM Do YY") + "</span>";
			}
		}
	}, {
		header : 'Status',
		dataIndex : 'dewarStatus',
		name : 'dewarStatus',
		type : 'string',
		flex : 1,
		renderer : function(comp, val, record) {
			if (new String(record.raw.dewarStatus).toUpperCase() == 'OPENED') {
				return "<span style='color:green;font-weight:bold;'>" + new String(record.raw.dewarStatus).toUpperCase() + "</span>";
			}
			return "<span style='font-weight:bold;'>" + new String(record.raw.dewarStatus).toUpperCase() + "</span>";
		}
	}, {
		header : 'Type',
		dataIndex : 'type',
		name : 'type',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'Sample Plates',
		dataIndex : 'plates',
		name : 'plates',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'Stock Solutions',
		dataIndex : 'plates',
		name : 'plates',
		type : 'string',
		width : 100,
		renderer : function(comp, val, record) {
			var html = "<div>";
			var stockSolutions = BIOSAXS.proposal.getStockSolutionsByDewarId(record.raw.dewarId);
			html = html + "<span style='font-size:18px'>" + stockSolutions.length + "</span> x<img height='15px' src='/ispyb/images/SampleHolder_24x24_01.png'>";
			return html + "</div>";
		}
	}, {
		header : 'isStorageDewar',
		dataIndex : 'isStorageDewar',
		name : 'isStorageDewar',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'Tracking Number From Synchrotron',
		dataIndex : 'trackingNumberFromSynchrotron',
		name : 'trackingNumberFromSynchrotron',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'Tracking Number To Synchrotron',
		dataIndex : 'trackingNumberToSynchrotron',
		name : 'trackingNumberToSynchrotron',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'Storage Location',
		dataIndex : 'storageLocation',
		name : 'storageLocation',
		type : 'string',
		flex : 1,
		hidden : false
	}, {
		header : 'Comments',
		dataIndex : 'comments',
		name : 'comments',
		type : 'string',
		flex : 1,
		hidden : false
	} ];

	if (this.btnEditVisible) {
		columns.push({
			id : _this.id + 'buttonEdit',
			text : '',
			hidden : !_this.btnEditVisible,
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getGreenButton('EDIT');
			}
		});
	}

	if (this.btnRemoveVisible) {
		columns.push({
			id : _this.id + 'buttonRemove',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnRemoveVisible) {
					return BUI.getRedButton('REMOVE');
				}
			}
		});
	}

	columns.push({
		dataIndex : 'comments',
		type : 'string',
		width : 85,
		hidden : false,
		renderer : function(comp, val, record) {
			return BUI.getBlueButton("LABELS", {
				href : BUI.getPrintcomponentURL(record.raw.dewarId)
			});
		}
	});

	return columns;
};

MacromoleculeConditionGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	/** ADD BUTTON **/
	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add',
		disabled : false,
		handler : function(widget, event) {
			_this.onAddButtonClicked.notify();
		}
	}));

	return actions;
};

MacromoleculeConditionGrid.prototype.refresh = function(dewars) {
	this.features = dewars;
	this.store.loadData(this._prepareData(dewars), false);
};

MacromoleculeConditionGrid.prototype._sort = function(store) {
	store.sort('dewarId', 'DESC');
};

MacromoleculeConditionGrid.prototype._prepareData = function() {
	var data = [];
	for (var i = 0; i < this.features.length; i++) {
		data.push(this.features[i]);
	}
	return data;
};

MacromoleculeConditionGrid.prototype.getPanel = function() {
	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		height : this.height,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this._edit(record.raw);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this._edit(record.raw);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						_this.onRemoveButtonClicked.notify(_this.store.getAt(rowIndex).raw.dewarId);
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for (var i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for (var i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};

MacromoleculeConditionGrid.prototype._getStoreFields = function(data) {
	return [ {
		name : 'dewarId',
		type : 'string'
	}, {
		name : 'barCode',
		type : 'string'
	}, {
		name : 'code',
		type : 'string'
	}, {
		name : 'comments',
		type : 'string'
	}, {
		name : 'dewarStatus',
		type : 'string'
	}, {
		name : 'isStorageDewar',
		type : 'string'
	}, {
		name : 'plates',
		type : 'string'
	}, {
		name : 'transportValue',
		type : 'string'
	}, {
		name : 'trackingNumberFromSynchrotron',
		type : 'string'
	}, {
		name : 'trackingNumberToSynchrotron',
		type : 'string'
	}, {
		name : 'timeStamp',
		type : 'string'
	}, {
		name : 'storageLocation',
		type : 'string'
	}, {
		name : 'type',
		type : 'string'
	}

	];
};

MacromoleculeConditionGrid.prototype._renderGrid = function() {
	var _this = this;

	/** Store **/
	var data = this._prepareData();
	this.store = Ext.create('Ext.data.Store', {
		fields : this._getStoreFields(data),
		autoload : true,
		data : data
	});
	this._sort(this.store);

	this.store.loadData(data, false);

	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		height : this.height,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this._edit(record.raw);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this._edit(record.raw);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						_this.onRemoveButtonClicked.notify(_this.store.getAt(rowIndex).raw.dewarId);
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for (var i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for (var i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};

MacromoleculeConditionGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10(),
		dewars : DATADOC.getDewars_10()

	};
};

MacromoleculeConditionGrid.prototype.test = function(targetId) {
	var MacromoleculeConditionGrid = new MacromoleculeConditionGrid({
		height : 150
	});
	BIOSAXS.proposal = new Proposal(MacromoleculeConditionGrid.input().proposal);
	var panel = MacromoleculeConditionGrid.getPanel(MacromoleculeConditionGrid.input().dewars);
	panel.render(targetId);

};

function ItemGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	this.id = id;
	this.args = new Object();
	
	this.defaultFormat = new ItemFormat(defaultFormat);
	
	if(selectedFormat != null){
		this.selected = new ItemFormat(selectedFormat);
	}
	else{
		this.selected = new ItemFormat(defaultFormat);
	}
	
	if(overFormat != null){
		this.over = new ItemFormat(overFormat);
	}
	else{
		this.over = new ItemFormat(defaultFormat);
	}
	
	if(draggingFormat != null){
		this.dragging = new ItemFormat(draggingFormat);
	}
	else{
		this.dragging = new ItemFormat(defaultFormat);
	}
	
	//Events
	this.stateChanged  = new Event(this);

	
	//Attaching events
	var _this = this;
	this._setEvents();
};

ItemGraphFormatter.prototype.getType = function(){
	return this.args.type;
};


ItemGraphFormatter.prototype.toJSON = function(){
	var json = this.args;
	json.defaultFormat = this.getDefault().toJSON();
	json.over = this.getOver().toJSON();
	json.selected = this.getSelected().toJSON();
	json.dragging = this.getDragging().toJSON();
	json.id = this.id;
	return json;
};

ItemGraphFormatter.prototype.loadFromJSON = function(json){
	this.args = json;
	this.defaultFormat = new ItemFormat(json.defaultFormat);
	this.over = new ItemFormat(json.over);
	this.selected = new ItemFormat(json.selected);
	this.dragging = new ItemFormat(json.dragging);
	this._setEvents();
};

ItemGraphFormatter.prototype._setEvents = function(){
	//Attaching events
	var _this = this;
	
	this.defaultFormat.changed.attach(function (sender, item){
		_this.over.setSize(_this.defaultFormat.getSize());
		_this.selected.setSize(_this.defaultFormat.getSize());
		_this.dragging.setSize(_this.defaultFormat.getSize());
		_this.stateChanged.notify(_this);
	});
	
	this.selected.changed.attach(function (sender, item){
		_this.stateChanged.notify(_this);
	});
	
	this.over.changed.attach(function (sender, item){
		_this.stateChanged.notify(_this);
	});
	
	this.dragging.changed.attach(function (sender, item){
		_this.stateChanged.notify(_this);
	});
};

/** Getters **/
ItemGraphFormatter.prototype.getId = function(){return this.id;};
ItemGraphFormatter.prototype.getDefault = function(){return this.defaultFormat;};
ItemGraphFormatter.prototype.getSelected = function(){return this.selected;};
ItemGraphFormatter.prototype.getOver = function(){return this.over;};
ItemGraphFormatter.prototype.getDragging = function(){return this.dragging;};

function ItemFormat(args){
	this.defaultFormat = new Object();
	this.args = new Object();
	this.args.title = new Object();
	//Defult properties
	this.args.visible = true;
	this.args.hidden = false;
	this.args.stroke = "#000000";
	this.args.strokeOpacity = 0.8;
	this.args["stroke-width"] = 1;
	this.args.fill = "#000000";
	this.args["fill-opacity"] = 1;
	this.args.size = 1;
	this.args.opacity = 1;
	this.args.fontSize = "8";
	this.args.fontColor = "#000000";
	
	/** For directed edge with arrow **/ 
	//this.args.arrowSize = 1;
	
	
	if (args != null){
		if (args.visible != null){
			this.args.visible = args.visible;
		}
		if (args.opacity != null){
			this.args.opacity = args.opacity;
		}
		if (args.size != null){
			this.args.size = args.size;
		}
		if (args.hidden != null){
			this.args.hidden = args.hidden;
		}
		if (args.stroke != null){
			this.args.stroke = this._fixColor(args.stroke);
		}
		if (args.strokeOpacity != null){
			this.args.strokeOpacity = args.strokeOpacity;
		}
		if (args["stroke-width"]!=null){
			this.args["stroke-width"] = args["stroke-width"];
		}
		if (args["fill-opacity"]!=null){
			this.args["fill-opacity"] = args["fill-opacity"];
		}
		if (args.shape!=null){
			this.args.shape = args.shape;
		}
		if (args.fill!=null){
				this.args.fill = this._fixColor(args.fill);
		}
		
		
		if (args.title!=null){
			if (args.title.fontSize!=null){
				this.args.title.fontSize = args.title.fontSize;
			}
			if (args.title.fill!=null){
				this.args.title.fill = this._fixColor(args.title.fill);
			}
		}
		
		/** For directed edge with arrow **/
		/*if (args.arrowSize!=null){
			this.args.arrowSize = args.arrowSize;
		}*/
	
	}
	
	this.changed = new Event();
};

ItemFormat.prototype._fixColor = function(color){
	var fixed = color;
	if (color.indexOf("green") != -1){
		fixed = '#04B431';
	}
	
	if (color.indexOf("blue") != -1){
		fixed = '#045FB4';
	}
	
	if (color.indexOf("red") != -1){
		fixed = '#DF0101';
	}
	
	if (color.indexOf("black") != -1){
		fixed = '#000000';
	}
	
	if (color.indexOf("white") != -1){
		fixed = '#FFFFFF';
	}
	
	if (color.indexOf("#") == -1){
		fixed = "#" + color;
	}
	return fixed;
};

ItemFormat.prototype.toJSON = function(){
	if(this.args.strokeOpacity != null){
		this.args["stroke-opacity"] = this.args.strokeOpacity;
		delete this.args.strokeOpacity;
	}
	
//	if(this.args.strokeWidth != null){
//		this.args["stroke-width"] = this.args.strokeWidth;
//		delete this.args["stroke-width"];
//	}

	if(this.args.title.fontColor != null){
		this.args.title["font-color"] = this.args.title.fontColor;
	}
	else{
		this.args.title["font-color"] = this.args.fontColor;//;this.args.title.fontColor;
	}
	
	if(this.args.title.fontSize != null){
		this.args.title["font-size"] = this.args.title.fontSize;//;this.args.title.fontColor;
	}
	else{ 
		this.args.title["font-size"] = this.args.fontSize;//;this.args.title.fontColor;
	}
	//return this.args;
	return this.args;
};

ItemFormat.prototype.getAttribute = function(name){return this.args[name];};

//Getters and Setters
ItemFormat.prototype.setVisible = function(visible){
	if (this.args.visible != visible){
		this.args.visible = visible;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getVisible = function(){return this.args.visible;};

ItemFormat.prototype.setHidden = function(hidden){
	if (this.args.hidden != hidden){
		this.args.hidden = hidden;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getHidden = function(){return this.args.hidden;};


ItemFormat.prototype.setStroke = function(stroke){
	if (this.args.stroke != stroke){
		this.args.stroke = stroke;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getStroke = function(){return this.args.stroke;};

ItemFormat.prototype.setStrokeOpacity = function(strokeOpacity){
	if (this.args.strokeOpacity != strokeOpacity){
		this.args.strokeOpacity = strokeOpacity;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getStrokeOpacity = function(){return this.args["stroke-opacity"];};

ItemFormat.prototype.setStrokeWidth = function(strokeWidth){
	if (this.args["stroke-width"] != strokeWidth){
		this.args["stroke-width"] = strokeWidth;
		this.changed.notify(this);
	}
};


ItemFormat.prototype.getFillOpacity = function(){return this.args["fill-opacity"];};

ItemFormat.prototype.setfillOpacity = function(strokeWidth){
	if (this.args["fill-opacity"] != strokeWidth){
		this.args["fill-opacity"] = strokeWidth;
		this.changed.notify(this);
	}
};


ItemFormat.prototype.getStrokeWidth = function(){
	return this.args["stroke-width"];
};

ItemFormat.prototype.setFill = function(fill){
	if (this.args.fill != fill){
		this.args.fill = fill;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getFill = function(){return this.args.fill;};

ItemFormat.prototype.setSize = function(size){
	if (this.args.size != size){
		this.args.size = size;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getSize = function(){return this.args.size;};

ItemFormat.prototype.setOpacity = function(opacity){
	if (this.args.opacity != opacity){
		this.args.opacity = opacity;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getOpacity = function(){return this.args.opacity;};

ItemFormat.prototype.getArrowSize = function(){return this.args.arrowSize;};

ItemFormat.prototype.setArrowSize = function(arrowSize){
	if (this.args.arrowSize != arrowSize){
		this.args.arrowSize = arrowSize;
		this.changed.notify(this);
	}
};

ItemFormat.prototype.getFontSize = function(){return this.args.title.fontSize;};

ItemFormat.prototype.setFontSize = function(fontSize){

	if (this.args.title.fontSize != fontSize){
		this.args.title.fontSize = fontSize;
		this.changed.notify(this);
	}
};





/**
 * This class executes the actions
 */

function BiosaxsDataAdapter() {
	this.type = "POST";
	/** Events * */
	this.onSuccess = new Event(this);
	this.onError = new Event(this);
}

BiosaxsDataAdapter.prototype._doAction = function(reqCode, data) {
	var _this = this;
	$.ajax({
		type : "POST",
		url : "dataadapter.do?reqCode=" + reqCode,
		data : data,
		datatype : "text/json",
		success : function(json) {
			_this.onSuccess.notify(json);
		},
		error : function(xhr) {
			_this.onError.notify(xhr.responseText);
		}
	});
};


BiosaxsDataAdapter.prototype.getDataPlot = function(frames, subtractions, models, fits, rbms) {
	if (frames == null){
		frames = [];
	}
	if (subtractions == null){
		subtractions = [];
	}
	if (models == null){
		models = [];
	}
	if (fits == null){
		fits = [];
	}
	if (rbms == null){
		rbms = [];
	}
	this._doAction("getDataPlot", {
		frames : frames.toString(),
		subtractions : subtractions.toString(),
		models : models.toString(),
		fits : fits.toString(),
		rbms : rbms.toString()
	});
};

BiosaxsDataAdapter.prototype.getDataPDB = function(models, superpositions) {
	if (models == null){
		models = [];
	}
	if (superpositions == null){
		superpositions = [];
	}
	this._doAction("getDataPDB", {
		models : JSON.stringify(models), /** This is a json **/
		superpositions : superpositions.toString()
	});
};



BiosaxsDataAdapter.prototype.getFitStructureToExperimentalDataBySubtractionId = function(subtractionId) {
	this._doAction("getFitStructureToExperimentalDataBySubtractionId", {
		subtractionId : subtractionId
	});
};

BiosaxsDataAdapter.prototype.getAbinitioModelsBySubtractionId = function(subtractionIdList) {
	this._doAction("getAbinitioModelsBySubtractionId", {
		subtractionIdList : subtractionIdList.toString()
	});
};

BiosaxsDataAdapter.prototype.saveStructure = function(structure) {
	this._doAction("saveStructure", {
		structure : JSON.stringify(structure)
	});
};

BiosaxsDataAdapter.prototype.getSuperpositionBySubtractionId = function(subtractionId) {
	this._doAction("getSuperpositionBySubtractionId", {
		subtractionId : subtractionId
	});
};

BiosaxsDataAdapter.prototype.getRigidBodyModelingBySubtractionId = function(subtractionId) {
	this._doAction("getRigidBodyModelingBySubtractionId", {
		subtractionId : subtractionId
	});
};

BiosaxsDataAdapter.prototype.addFitStructureData = function(fitStructureToExperimentalData) {
	this._doAction("addFitStructureData", {
		fitStructureToExperimentalData : JSON.stringify(fitStructureToExperimentalData)
	});
};

BiosaxsDataAdapter.prototype.addWorkflow = function(workflow, inputParameters) {
	this._doAction("addWorkflow", {
		workflow : JSON.stringify(workflow),
		inputParameters : JSON.stringify(inputParameters)
	});
};

BiosaxsDataAdapter.prototype.getFitStructureToExperimentalDataFile = function(fitStructureToExperimentalDataId, type, format) {
	this._doAction("getFitStructureToExperimentalDataFile", {
		fitStructureToExperimentalDataId : fitStructureToExperimentalDataId,
		type : type,
		format : format
	});
};

BiosaxsDataAdapter.prototype.getStructureFile = function(structureId) {
	this._doAction("getStructureFile", {
		structureId : structureId
	});
};

BiosaxsDataAdapter.prototype.getCompactAnalysisByProposalId = function(limit) {
	if (limit == null) {
		limit = 100;
	}
	this._doAction("getCompactAnalysisByProposalId", {
		limit : limit

	});
};

BiosaxsDataAdapter.prototype.getCompactAnalysisByMacromoleculeId = function(macromoleculeId) {
	this._doAction("getCompactAnalysisByMacromoleculeId", {
		macromoleculeId : macromoleculeId
	});
};


BiosaxsDataAdapter.prototype.getCompactAnalysisBySubtractionId = function(subtractionId) {
	this._doAction("getCompactAnalysisBySubtractionId", {
		subtractionId : subtractionId
	});
};

/*
 BiosaxsDataAdapter.prototype.getAbinitioById = function(abinitioId) {
 this._doAction("getAbinitioById", {
 abinitioId : abinitioId
 });
 };
 */
BiosaxsDataAdapter.prototype.getAbinitioByIdsList = function(abinitioIdList) {
	this._doAction("getAbinitioByIdsList", {
		abinitioIdsList : abinitioIdList.toString()
	});
};

BiosaxsDataAdapter.prototype.getCompactAnalysisByExperimentId = function(experimentId) {
	this._doAction("getCompactAnalysisByExperimentId", {
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.saveExperiment = function(experimentId, name, type, comments) {
	this._doAction("saveExperiment", {
		experimentId : experimentId,
		name : name,
		type : type,
		comments : comments
	});
};

BiosaxsDataAdapter.prototype.saveStoichiometry = function(hostmacromoleculeId, macromoleculeId, ratio, comments) {
	this._doAction("saveStoichiometry", {
		macromoleculeId : macromoleculeId,
		hostmacromoleculeId : hostmacromoleculeId,
		ratio : ratio,
		comments : comments
	});
};

BiosaxsDataAdapter.prototype.removeStoichiometry = function(stoichiometryId) {
	this._doAction("removeStoichiometry", {
		stoichiometryId : stoichiometryId
	});
};

BiosaxsDataAdapter.prototype.removeStructure = function(structureId) {
	this._doAction("removeStructure", {
		structureId : structureId
	});
};

BiosaxsDataAdapter.prototype.sortMeasurements = function(experimentId, type) {
	this._doAction("sortMeasurements", {
		experimentId : experimentId,
		sortBy : type
	});
};

BiosaxsDataAdapter.prototype.setMeasurementParameters = function(measurementIds, parameter, value) {
	this._doAction("setMeasurementParameters", {
		measurementIds : measurementIds.toString(),
		parameter : parameter,
		value : value
	});
};

BiosaxsDataAdapter.prototype.getZipFileByAverageListId = function(mergeIdsList) {
	this._doAction("getZipFileByAverageListId", {
		mergeIdsList : mergeIdsList.toString(),
		fileName : "test"
	});
};

BiosaxsDataAdapter.prototype.getZipFileByMacromoleculeId = function(macromoleculeId) {
	this._doAction("getZipFileByMacromoleculeId", {
		macromoleculeId : macromoleculeId
	});
};

BiosaxsDataAdapter.prototype.getH5FrameScattering = function(experimentId, frames) {
	this._doAction("getH5FrameScattering", {
		experimentId : experimentId,
		frames : frames
	});
};

BiosaxsDataAdapter.prototype.getH5FramesMerge = function(experimentId, frames) {
	this._doAction("getH5FramesMerge", {
		experimentId : experimentId,
		frames : frames
	});
};

BiosaxsDataAdapter.prototype.getH5fileParameters = function(experimentId, parameters) {
	this._doAction("getH5fileParameters", {
		experimentId : experimentId,
		parameters : parameters.toString()
	});
};

BiosaxsDataAdapter.prototype.mergeSpecimens = function(specimenId, targetId) {
	this._doAction("mergeSpecimens", {
		specimenTargetId : targetId,
		specimenOriginId : specimenId
	});
};

BiosaxsDataAdapter.prototype.getReport = function(experimentId, filename, type, format) {
	var data = {
		experimentId : experimentId,
		format : format,
		filename : filename,
		type : 'DATA_ACQUISITION'
	};
	if (Ext.urlDecode(window.location.href).sessionId != null) {
		data.sessionId = Ext.urlDecode(window.location.href).sessionId;
	}
	this._doAction("getReport", data);
};

BiosaxsDataAdapter.prototype.updateDataBaseFromSMIS = function() {
	this._doAction("updateDataBaseFromSMIS", {});
};

/** type is 'FIT' or 'FIR' * */
BiosaxsDataAdapter.prototype.getModelFile = function(type, modelId, format) {
	if (format == null) {
		format = 'json';
	}
	this._doAction("getModelFile", {
		type : type,
		modelId : modelId,
		format : format
	});
};

BiosaxsDataAdapter.prototype.getImage = function(subtractionId, type) {
	this._doAction("getImage", {
		subtractionId : subtractionId,
		type : type
	});
};

BiosaxsDataAdapter.prototype.removeExperimentContentById = function(experimentId) {
	this._doAction("removeExperimentContent", {
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.getAbinitioModelsByExperimentId = function(experimentId) {
	this._doAction("getAbinitioModelsByExperimentId", {
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.getMergesByIdsList = function(mergeIdsList) {
	this._doAction("getMergesByIdsList", {
		mergeIdsList : mergeIdsList.toString()
	});
};

BiosaxsDataAdapter.prototype.getScatteringCurveByFrameIdsList = function(frameIdsList, mergeIdsList, subtractionIds, fitToExperimentDataIds) {
	if (!fitToExperimentDataIds) {
		fitToExperimentDataIds = [3141];
	}
	this._doAction("getScatteringCurveByFrameIdsList", {
		frameIdsList : frameIdsList.toString(),
		mergeIdsList : mergeIdsList.toString(),
		subtractionIds : subtractionIds.toString(),
		fitToExperimentDataIds : fitToExperimentDataIds.toString()
	});
};

BiosaxsDataAdapter.prototype.getSubtractionsByIdsList = function(subtractionIds) {
	this._doAction("getSubtractionByIdList", {
		subtractionIdList : subtractionIds.toString()
	});
};

BiosaxsDataAdapter.prototype.removeExperimentById = function(experimentId) {
	this._doAction("removeExperiment", {
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.getProposal = function(sessionId, scope) {
	this._doAction("getProposal", {
		sessionId : sessionId,
		scope : scope
	});
};

BiosaxsDataAdapter.prototype.getExperimentById = function(experimentId, scope) {
	if (scope == null) {
		scope = "MINIMAL";
	}
	this._doAction("getExperimentById", {
		experimentId : experimentId,
		scope : scope,
		sessionId : Ext.urlDecode(window.location.href).sessionId
	});
};

BiosaxsDataAdapter.prototype._getInformationByMacromoleculeId = function(data) {
	this._doAction("getInformationByMacromoleculeId", {
		data : JSON.stringify(data)
	});
};

BiosaxsDataAdapter.prototype.getInformationByMacromoleculeId = function(macromoleculeId, bufferId) {
	var data = {
		macromoleculeId : macromoleculeId
	};
	if (bufferId != null) {
		data.bufferId = bufferId;
	}
	var result = [ data ];
	this._getInformationByMacromoleculeId(result);
};

BiosaxsDataAdapter.prototype.getPDBContentByModelList = function(models) {
	this._doAction("getPDBContentByModelList", {
		properties : JSON.stringify(models)
	});
};

BiosaxsDataAdapter.prototype.getAbinitioPDBContentBySuperpositionList = function(models) {
	this._doAction("getAbinitioPDBContentBySuperpositionList", {
		properties : JSON.stringify(models)
	});
};

BiosaxsDataAdapter.prototype.getAlignedPDBContentBySuperpositionList = function(models) {
	this._doAction("getAlignedPDBContentBySuperpositionList", {
		properties : JSON.stringify(models)
	});
};


BiosaxsDataAdapter.prototype.getAnalysisCalibrationByProposalId = function() {
	this._doAction("getAnalysisCalibrationByProposalId", {
		sessionId : Ext.urlDecode(window.location.href).sessionId
	});
};

BiosaxsDataAdapter.prototype.getAnalysisInformationByExperimentId = function(experimentId) {
	this._doAction("getAnalysisInformationByExperimentId", {
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.createTemplate = function(name, comments, measurements, experimentId) {
	this._doAction("createTemplate", {
		experimentId : experimentId,
		name : name,
		comments : comments,
		measurements : measurements.toString()
	});
};

BiosaxsDataAdapter.prototype.addMeasurements = function(name, comments, measurements, experimentId) {
	this._doAction("createTemplate", {
		experimentId : experimentId,
		name : name,
		comments : comments,
		measurements : measurements.toString()
	});
};

BiosaxsDataAdapter.prototype.getExperimentInformationByProposalId = function(sessionId) {
	this._doAction("getExperimentInformationByProposalId", {
		sessionId : sessionId
	});
};

BiosaxsDataAdapter.prototype.getAllInformationByExperimentId = function(experimentId) {
	this._doAction("getAllInformationByExperimentId", {
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.getAnalysisByProposalId = function() {
	this._doAction("getAnalysisByProposalId", {});
};

BiosaxsDataAdapter.prototype.getExperimentsByProposalId = function(scope) {
	if (scope == null) {
		scope = "MINIMAL";
	}
	this._doAction("getExperimentsByProposalId", {
		scope : scope
	});
};

BiosaxsDataAdapter.prototype.saveMacromolecule = function(macromolecule) {
	this._doAction("saveMacromolecule", {
		macromolecule : JSON.stringify(macromolecule)
	});
};

BiosaxsDataAdapter.prototype.saveBuffer = function(buffer) {
	this._doAction("saveBuffer", {
		buffer : JSON.stringify(buffer)
	});
};

BiosaxsDataAdapter.prototype.saveSpecimen = function(specimen, experiment) {
	this._doAction("saveSpecimen", {
		specimen : JSON.stringify(specimen),
		experimentId : experiment.json.experimentId
	});
};

BiosaxsDataAdapter.prototype.saveMeasurement = function(measurement, experiment) {
	this._doAction("saveMeasurement", {
		measurement : JSON.stringify(measurement),
		experimentId : experiment.json.experimentId
	});
};

BiosaxsDataAdapter.prototype.removeMeasurement = function(measurement) {
	this._doAction("removeMeasurement", {
		measurementId : JSON.stringify(measurement)
	});
};

BiosaxsDataAdapter.prototype.savePlates = function(plates, experimentId) {
	var data = {
		plates : JSON.stringify(plates)
	};
	if (experimentId != null) {
		data.experimentId = experimentId;
		data.scope = "MEDIUM";
	}
	this._doAction("savePlate", data);
};

BiosaxsDataAdapter.prototype.emptyPlate = function(sampleplateId, experimentId) {
	this._doAction("emptyPlate", {
		scope : 'MEDIUM',
		sampleplateId : sampleplateId,
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.autoFillPlate = function(sampleplateId, experimentId) {
	this._doAction("autoFillPlate", {
		scope : 'MEDIUM',
		sampleplateId : sampleplateId,
		experimentId : experimentId
	});
};

BiosaxsDataAdapter.prototype.createShipment = function(shippingId, name, status, comments, sendingLabContactId, returnLabContactId, returnCourier, courierAccount,
		BillingReference, dewarAvgCustomsValue, dewarAvgTransportValue) {
	var _this = this;
	$.ajax({
		type : this.type,
		url : "dataadapter.do?reqCode=saveShipment",
		data : {
			shippingId : shippingId,
			name : name,
			status : status,
			comments : comments,
			sendingLabContactId : sendingLabContactId,
			returnLabContactId : returnLabContactId,
			returnCourier : returnCourier,
			courierAccount : courierAccount,
			BillingReference : BillingReference,
			dewarAvgCustomsValue : dewarAvgCustomsValue,
			dewarAvgTransportValue : dewarAvgTransportValue
		},
		datatype : "text/json",
		success : function(data) {
			_this.onSuccess.notify(data);
		},
		error : function(xhr) {
			_this.onError.notify(xhr.responseText);
		}
	});
};

BiosaxsDataAdapter.prototype.removeShipment = function(shippingId) {
	this._doAction("removeShipment", {
		shippingId : shippingId
	});
};

BiosaxsDataAdapter.prototype.addCase = function(shippingId) {
	this._doAction("addCase", {
		shippingId : shippingId
	});
};

BiosaxsDataAdapter.prototype.saveCase = function(shippingId, dewar) {
	/** We dont want to store session so: * */
	dewar.sessionVO = null;
	this._doAction("saveCase", {
		dewar : JSON.stringify(dewar),
		dewarId : dewar.dewarId,
		shippingId : shippingId
	});
};

BiosaxsDataAdapter.prototype.removeCase = function(dewarId, shippingId) {
	this._doAction("removeCase", {
		dewarId : dewarId,
		shippingId : shippingId
	});
};

BiosaxsDataAdapter.prototype.removeStockSolution = function(stockSolutionId) {
	this._doAction("removeStockSolution", {
		stockSolutionId : stockSolutionId
	});
};

BiosaxsDataAdapter.prototype.saveStockSolution = function(stockSolution) {
	this._doAction("saveStockSolution", {
		stockSolution : JSON.stringify(stockSolution)
	});
};

/** ERROR * */
function showError(error) {
	error = JSON.parse(error);
	var title = "Internal server error";
	var meesage = error.message;

	if (this.panel == null) {
		this.panel = Ext.create('Ext.Window', {
			title : title,
			resizable : false,
			constrain : false,
			closable : true,
			padding : '15',
			items : [ {
				xtype : 'label',
				forId : 'myFieldId',
				text : meesage,
				margin : '5 0 0 10'
			}, {
				xtype : 'textareafield',
				value : error.trace,
				fieldLabel : 'Trace',
				width : 600,
				height : 300,
				margin : '20 0 0 10'
			} ],
			width : 680,
			height : 400,
			buttonAlign : 'right',
			listeners : {
				scope : this,
				minimize : function() {
					this.panel.hide();
				},
				destroy : function() {
					delete this.panel;
				}
			}
		});
		this.panel.setLoading();
	}
	this.panel.show();
}

function showWarning(warnings) {
	BUI.showWarning(warnings);
}

/**
 * 
 * This class represents an data Acquisition
 * 
 * @json a json with the serialization of Experiment3VO
 * 
 */
function Experiment(json) {
	this.json = json;
	this.onSaved = new Event(this);
	this.onError = new Event(this);

	this.name = json.name;
	this.experimentId = json.experimentId;
	this.creationDate = json.creationDate;

	/** For all specimens asynchronous **/
	this.onPlateSaved = new Event(this);

	this.bufferColors =  $.extend({}, BIOSAXS.proposal.bufferColors);
	
	this.specimenBuffersColors = this.getSpecimenColors();
	
	for ( var bufferId in this.bufferColors) {
		this.bufferColors[bufferId] = 'black';
	}
	this.setMacromoleculesColors();
}

Experiment.prototype.getSpecimenColorByBufferId = function(specimenId) {
	return this.specimenBuffersColors[specimenId];
};

Experiment.prototype.setMacromoleculesColors = function (){
	var colors = [
					"#66c2a5",
					"#fc8d62",
					"#8da0cb",
					"#e78ac3",
					"#a6d854",
					"#ffd92f",
					"#e5c494"]
	
	
	this.macromoleculeColors = {};
	var macromolecules = this.getMacromolecules();
	for (var i = 0; i < macromolecules.length; i++) {
		this.macromoleculeColors[macromolecules[i].macromoleculeId] = colors[i%colors.length];
	}
};

Experiment.prototype.getHPLCMacromolecule = function() {
	var dcs = this.getDataCollections()
	if (dcs.length >  0){
		for ( var i = 0; i < 1; i++) {
			var meToDc = dcs[i].measurementtodatacollection3VOs;
			if (meToDc != null){
				for ( var j = 0; j < meToDc.length; j++) {
					if (meToDc[j].dataCollectionOrder == 2){
						return this.getSampleById(this.getMeasurementById(meToDc[j].measurementId).specimenId).macromolecule3VO;
					}
				}
			}
		}
	}
};

/**
 * If ((specimen1.specimenId <> specimen2.specimenId)&&(specimen1.bufferId == specimen2.bufferId)) then specimen1.color < specimen2.color
 */
Experiment.prototype.getSpecimenColors = function() {
	var specimens = this.getSamples();
	var bufferSamples = [];

	for ( var i = 0; i < specimens.length; i++) {
		if (specimens[i].macromolecule3VO === null) {
			bufferSamples.push(specimens[i]);
		}
	}

	var colors = {};
	var buffercolors = BIOSAXS.proposal.getBufferColors();
	for ( i = 0; i < bufferSamples.length; i++) {
		colors[bufferSamples[i].specimenId] = buffercolors[i % buffercolors.length];
	}
	return colors;
};

Experiment.prototype.getBuffers = function() {
	var samples = this.getSamples();
	var bufferHash = {};
	var buffers = [];
	if (samples !== null) {
		for ( var i = 0; i < samples.length; i++) {
			if (bufferHash[samples[i].bufferId] === null) {
				buffers.push(BIOSAXS.proposal.getBufferById(samples[i].bufferId));
				bufferHash[samples[i].bufferId] = true;
			}
		}
	}
	return buffers;
};

/** BUFFER **/
Experiment.prototype.getBufferById = function(bufferId) {
	return BIOSAXS.proposal.getBufferById(bufferId);
};

/** STOCK SOLUTION **/
Experiment.prototype.getStockSolutions = function() {
	return this.json.stockSolution3VOs;
};

Experiment.prototype.getStockSolutionById = function(stockSolutionId) {
	var stockSolutions = this.getStockSolutions();
	for ( var i = 0; i < stockSolutions.length; i++) {
		if (stockSolutions[i].stockSolutionId == stockSolutionId) {
			return stockSolutions[i];
		}
	}
};

/** This method gets all the macromolecules of the Experiment **/
Experiment.prototype.getMacromolecules = function() {
	var specimens = this.getSamples();
	var macromoleculeIds = {};
	
	var macromolecules = [];
	for (var i = 0; i < specimens.length; i++) {
		if (specimens[i].macromolecule3VO != null){
			if (macromoleculeIds[specimens[i].macromolecule3VO.macromoleculeId] == null){
				macromolecules.push(specimens[i].macromolecule3VO);
				macromoleculeIds[specimens[i].macromolecule3VO.macromoleculeId] = true;
			}
		}
	}
	return macromolecules;
};

/** Return an array with all the specimens collected, it means, where run3VO is not null **/
Experiment.prototype.getMeasurementsWithSubtractionAssociated = function() {
	var specimens = this.getMeasurements();
	var specimenCollected = [];
	for ( var i = 0; i < specimens.length; i++) {
		var specimen = specimens[i];
		if (specimen.run3VO !== null) {
			specimenCollected.push(specimen);
		}
	}
	return specimenCollected;
};

Experiment.prototype.getSamples = function() {
	return this.json.samples3VOs;
};

/** Deprecated changed to getSpecimenById **/
Experiment.prototype.getSampleById = function(specimenId) {
	return this.getSpecimenById(specimenId);
};

Experiment.prototype.getSpecimenById = function(specimenId) {
	var samples = this.getSamples();
	for ( var i = 0; i < samples.length; i++) {
		if (samples[i].specimenId == specimenId) {
			return samples[i];
		}
	}
	return null;
};

Experiment.prototype.getSpecimenByDataCollectionId = function(dataCollectionId) {
	var dataCollection = this.getDataCollectionById(dataCollectionId);
	var measurementHash = {};
	var results = [];
	for ( var j = 0; j < dataCollection.measurementtodatacollection3VOs.length; j++) {
		var measurement = this.getMeasurementById(dataCollection.measurementtodatacollection3VOs[j].measurementId);
		if (measurementHash[measurement.specimenId] == null) {
			results.push(measurement);
			measurementHash[measurement.specimenId] = true;
		}
	}
	return results;
};

Experiment.prototype.setSpecimenById = function(specimen) {
	for ( var i = 0; i < this.json.samples3VOs.length; i++) {
		if (this.json.samples3VOs[i].specimenId == specimen.specimenId) {
			this.json.samples3VOs[i] = specimen;
			return;
		}
	}
	console.log("Specimen with id: " + specimen.specimenId + " not found");
};

Experiment.prototype.setMeasurement = function(measurement) {
	var measurements = this.getMeasurements();
	for ( var i = 0; i < measurements.length; i++) {
		if (measurements[i].measurementId == measurement.measurementId) {
			measurements[i] = measurement;
			return;
		}
	}
};

Experiment.prototype.getConcentrations = function() {
	var concentrations = {};
	var specimens = this.getMeasurements();
	for ( var i = 0; i < specimens.length; i++) {
		if (specimens[i].concentration != null) {
			concentrations[specimens[i].concentration] = [ specimens[i].concentration ];
		}
	}
	var concValues = [];
	for ( var conc in concentrations) {
		if (conc != "null") {
			concValues.push(conc);
		}

	}
	return concValues;
};

Experiment.prototype.getConcentrationsBysample = function(sample) {
	var concentrations = {};
	var samples = this.getSamples();
	for ( var i = 0; i < samples.length; i++) {
		if (samples[i].macromolecule3VO != null) {
			if (samples[i].macromolecule3VO.macromoleculeId == sample.macromolecule3VO.macromoleculeId) {
				if (samples[i].concentration != null) {
					concentrations[samples[i].concentration] = [ samples[i].concentration ];
				}
			}
		}
	}
	var concValues = [];
	for ( var conc in concentrations) {
		if (conc != "null") {
			concValues.push(conc);
		}

	}
	return concValues;
};

Experiment.prototype.setSpecimen = function(specimen) {
	var buffers = this.getBuffers();
	for ( var i = 0; i < buffers.length; i++) {
		var buffer = buffers[i];
		for ( var j = 0; j < buffer.specimen3VOs.length; j++) {
			var specimen3vo = buffer.specimen3VOs[j];
			if (specimen3vo.specimenId == specimen.specimenId) {
				buffer.specimen3VOs[j] = specimen;
				return buffer;
			}
		}
	}
};

/** SAMPLE PLATES **/
Experiment.prototype.getSamplePlates = function() {
	return this.json.samplePlate3VOs;
};

Experiment.prototype.getSamplePlateById = function(samplePlateId) {
	var plates = this.getSamplePlates();
	for ( var i = 0; i < plates.length; i++) {
		if (plates[i].samplePlateId == samplePlateId) {
			return plates[i];
		}
	}
};

Experiment.prototype.getSamplePlateBySlotPositionColumn = function(slotPositionColumn) {
	var plates = this.getSamplePlates();
	for ( var i = 0; i < plates.length; i++) {
		if (plates[i].slotPositionColumn == slotPositionColumn) {
			return plates[i];
		}
	}
};

Experiment.prototype.getSpecimenByPosition = function(samplePlateId, rowNumber, columnNumber) {
	return this.getSampleByPosition();
};

Experiment.prototype.getSpecimensBySamplePlateId = function(samplePlateId) {
	var specimens = this.getSamples();
	var result = [];
	for ( var i = 0; i < specimens.length; i++) {
		if (specimens[i].sampleplateposition3VO != null) {
			if (specimens[i].sampleplateposition3VO.samplePlateId == samplePlateId) {
				result.push(specimens[i]);
			}
		}
	}
	return result;
};

Experiment.prototype.getSampleByPosition = function(samplePlateId, rowNumber, columnNumber) {
	var specimens = this.getSamples();
	var result = [];
	for ( var i = 0; i < specimens.length; i++) {
		if (specimens[i].sampleplateposition3VO != null) {
			if ((specimens[i].sampleplateposition3VO.samplePlateId == samplePlateId) && (specimens[i].sampleplateposition3VO.rowNumber == rowNumber) && (specimens[i].sampleplateposition3VO.columnNumber == columnNumber)) {
				result.push(specimens[i]);
			}
		}
	}
	return result;
};

Experiment.prototype.getPlateGroups = function() {
	var plates = this.getSamplePlates();
	var plateGroups = [];
	var keys = {};
	for ( var i = 0; i < plates.length; i++) {
		if (plates[i].plategroup3VO != null) {
			var id = plates[i].plategroup3VO.plateGroupId;
			if (keys[id] == null) {
				plateGroups.push(plates[i].plategroup3VO);
				keys[id] = true;
			}
		}
	}
	return plateGroups;
};

Experiment.prototype.getPlatesByPlateGroupId = function(plateGroupId) {
	var plates = this.getSamplePlates();
	var result = [];
	for ( var i = 0; i < plates.length; i++) {
		if (plates[i].plategroup3VO != null) {
			if (plates[i].plategroup3VO.plateGroupId == plateGroupId) {
				result.push(plates[i]);
			}
		}
	}
	return result;
};

Experiment.prototype.getMeasurements = function() {
	var speciments = [];
	var samples = this.getSamples();
	if (samples == null) {
		return [];
	}
	for ( var i = 0; i < samples.length; i++) {
		var sample = samples[i];
		for ( var j = 0; j < sample.measurements.length; j++) {
			speciments.push(sample.measurements[j]);
		}
	}
	return speciments;
};

Experiment.prototype.getMeasurementById = function(measurementId) {
	var specimens = this.getMeasurements();
	for ( var i = 0; i < specimens.length; i++) {
		if (specimens[i].measurementId == measurementId) {
			return specimens[i];
		}
	}
	return null;
};

Experiment.prototype.getMeasurementByDataCollectionId = function(dataCollectionId) {
	var result = [];
	var dataCollection = this.getDataCollectionById(dataCollectionId);
	for ( var i = 0; i < dataCollection.measurementtodatacollection3VOs.length; i++) {
		result.push(this.getMeasurementById(dataCollection.measurementtodatacollection3VOs[i].measurementId));
	}
	return result;
};

/** Data Collection **/

Experiment.prototype.getDataCollections = function() {
	var dc = this.json.dataCollections;
	var dataCollections = [];
	for ( var i = 0; i < dc.length; i++) {
		if (dc[i].measurementtodatacollection3VOs.length != 0) {
			dataCollections.push(dc[i]);
		}
	}
	return dataCollections;
};

Experiment.prototype.getDataCollectionsBySpecimenId = function(specimenId) {
	var measurements = this.getMeasurementsBySpecimenId(specimenId);
	var result = [];
	var resultHash = {};
	for ( var i = 0; i < measurements.length; i++) {
		var measurement = measurements[i];
		var dcs = this.getDataCollectionByMeasurementId(measurement.measurementId);
		for ( var j = 0; j < dcs.length; j++) {
			if (resultHash[dcs[j].dataCollectionId] == null) {
				resultHash[dcs[j].dataCollectionId] = true;
				result.push(dcs[j]);
			}
		}
	}
	return result;
};

Experiment.prototype.getMeasurementsBySpecimenId = function(specimenId) {
	var measurements = this.getMeasurements();
	var result = [];
	for ( var i = 0; i < measurements.length; i++) {
		if (measurements[i].specimenId == specimenId) {
			result.push(measurements[i]);
		}
	}
	return result;
};

Experiment.prototype.getDataCollectionByMeasurementId = function(measurementId) {
	var dc = this.getDataCollections();
	var result = [];
	
	function localSort(a, b) {
		return a.dataCollectionOrder - b.dataCollectionOrder;
	}
	
	for ( var i = 0; i < dc.length; i++) {
		if (dc[i].measurementtodatacollection3VOs.length != 0) {
			for ( var j = 0; j < dc[i].measurementtodatacollection3VOs.length; j++) {
				var measurement = dc[i].measurementtodatacollection3VOs[j];
				if (measurement.measurementId == measurementId) {
					/** Sorting by dataCollectionOrder **/
					dc[i].measurementtodatacollection3VOs.sort(localSort);
					result.push(dc[i]);
				}
			}
		}
	}
	return result;
};

Experiment.prototype.getSubtractionById = function(subtractionId) {
	var dc = this.getDataCollections();
	for ( var i = 0; i < dc.length; i++) {
		if (dc[i].substraction3VOs != null) {
			if (dc[i].substraction3VOs.length > 0) {
				for ( var j = 0; j < dc[i].substraction3VOs.length; j++) {
					if (dc[i].substraction3VOs[j].subtractionId == subtractionId) {
						return dc[i].substraction3VOs[j];
					}
				}
			}
		}
	}
	return null;
};

Experiment.prototype.getDataCollectionById = function(dataCollectionId) {
	var dc = this.json.dataCollections;
	for ( var i = 0; i < dc.length; i++) {
		if (dc[i].dataCollectionId == dataCollectionId) {
			return dc[i];
		}
	}
};

/** For a specimen calculates the volume to load adding all the volume to load of all the measurements **/
Experiment.prototype.getVolumeToLoadBySampleId = function(specimenId) {
	var sample = this.getSpecimenById(specimenId);
	if (sample != null) {
		var volumeToLoad = 0;
		for ( var i = 0; i < sample.measurements.length; i++) {
			volumeToLoad = volumeToLoad + Number(sample.measurements[i].volumeToLoad);
		}
		return volumeToLoad;
	}
};


function ExperimentList(experiments){
	this.experiments = experiments;
	
	this.macromoleculeColors = {}; 
	
	for (var i = 0; i < experiments.length; i++) {
		this.macromoleculeColors = $.extend({}, this.macromoleculeColors, experiments[i].macromoleculeColors); 
	}
}

ExperimentList.prototype.getSpecimenColorByBufferId = function (bufferId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var color = experiment.getSpecimenColorByBufferId(bufferId);
		if (color != null){
			return color;
		}
	}
	return 'black';
};

ExperimentList.prototype.getColorByMacromoleculeId = function (bufferId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var color = experiment.getColorByMacromoleculeId(bufferId);
		if (color != null){
			return color;
		}
	}
	return 'black';
};


ExperimentList.prototype.getMeasurements = function (){
	var result = [];
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var measurements = experiment.getMeasurements();
		for ( var j = 0; j < measurements.length; j++) {
			result.push(measurements[j]);
		} 
	} 
	return result;
};

ExperimentList.prototype.getMeasurementByDataCollectionId = function (dataCollectionId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var dataCollection = this.experiments[i].getMeasurementByDataCollectionId(dataCollectionId);
		if (dataCollection.length != 0){
			return dataCollection;
		}
	}
	return [];
};

ExperimentList.prototype.getMergesByMeasurements = function (measurements){
	var merges = [];
	for ( var i = 0; i < measurements.length; i++) {
		if (measurements[i].merge3VOs != null){
			for ( var j = 0; j < measurements[i].merge3VOs.length; j++) {
				merges.push(measurements[i].merge3VOs[j]);
			}
		}
	}
	return merges;
};

ExperimentList.prototype.getSamplePlateById = function (samplePlateId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var samplePlate = this.experiments[i].getSamplePlateById(samplePlateId);
		if (samplePlate != null){
			return samplePlate;
		}
	}
	return null;
};

ExperimentList.prototype.getMergesByDataCollectionId = function (dataCollectionId){
	return this.getMergesByMeasurements(this.getMeasurementByDataCollectionId(dataCollectionId));
};

ExperimentList.prototype.getMerges = function (){
	return this.getMergesByMeasurements(this.getMeasurements());
};

ExperimentList.prototype.getDataCollectionById = function (dataCollectionId){
	var result = [];
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var dc = experiment.getDataCollectionById(dataCollectionId);
		if (dc != null){
			return dc;
		}
	}
	return result;
};

ExperimentList.prototype.getDataCollectionByMeasurementId = function (measurementId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var result = experiment.getDataCollectionByMeasurementId(measurementId);
		if (result != null){
			return result;
		}
	}
	return null;
};


ExperimentList.prototype.getMeasurementsNotCollected = function (){
	var result = [];
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var measurements = experiment.getMeasurements();
		for ( var j = 0; j < measurements.length; j++) {
			if (measurements[j].run3VO == null){
				result.push(measurements[j]);
			}
		}
	}
	return result;
};

ExperimentList.prototype.getMeasurementsCollected = function (){
	var result = [];
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		var measurements = experiment.getMeasurements();
		for ( var j = 0; j < measurements.length; j++) {
			if (measurements[j].run3VO != null){
				result.push(measurements[j]);
			}
		}
	}
	return result;
};

ExperimentList.prototype.getMeasurementById = function (specimenId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var specimen = this.experiments[i].getMeasurementById(specimenId);
		if (specimen != null){
			return specimen;
		}
	}
	return null;
};

ExperimentList.prototype.getBufferById = function (bufferId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var buffer = this.experiments[i].getBufferById(bufferId);
		if (buffer != null){
			return buffer;
		}
	}
	return null;
};

ExperimentList.prototype.getSampleById = function (sampleId){
	for ( var i = 0; i < this.experiments.length; i++) {
		var sample = this.experiments[i].getSampleById(sampleId);
		if (sample != null){
			return sample;
		}
	}
	return null;
};

ExperimentList.prototype.getSamplesByCondition = function (macromoleculeId, bufferId){
	var result = [];
	for ( var i = 0; i < this.experiments.length; i++) {
		var samples = this.experiments[i].getSamples();
		for ( var j = 0; j < samples.length; j++) {
			if (samples[j].macromolecule3VO != null){
				if (samples[j].macromolecule3VO.macromoleculeId == macromoleculeId){
					if (samples[j].bufferId == bufferId){
						result.push(samples[j]);
					}
				}
			}
		}
	}
	return result;
};

ExperimentList.prototype.getFrames = function (mergesList){
	var frames = [];
	for ( var i = 0; i < mergesList.length; i++) {
		var merge = mergesList[i];
		if (merge.framelist3VO != null){
			if (merge.framelist3VO.frametolist3VOs != null){
				for ( var j = 0; j < merge.framelist3VO.frametolist3VOs.length; j++) {
					var frame = merge.framelist3VO.frametolist3VOs[j].frame3VO;
					if (frame!= null){
						frames.push(frame);
					}
				}
			}
		}
	}
	return frames;
};

/**
 * Static class loaded almost always on entrypoint. It represent all the
 * information about the proposal
 * 
 * @json Serialization of a hashmap containing: macromolecules, buffers,
 *       assemblies, stockSolutions, labcontacts, shippings
 */
function Proposal(json) {
	this.macromolecules = null;

	/** Events * */
	this.onDataRetrieved = new Event(this);
	this.onError = new Event(this);
	this.onInitialized = new Event(this);

	this.buffers = null;
	this.macromolecules = null;
	this.stockSolutions = null;
	this.plateTypes = null;

	this._colors = null;
	this.bufferColors = {};
	this.macromoleculeColors = {};

	if (json != undefined) {
		this.setItems(json);
	}
	
	this.flavour = 'ESRF';
}

Proposal.prototype.getAdditiveTypes = function() {
	return [
		[ '', '' ], [ 'LIPID', 'LIPID' ], [ 'SALT', 'SALT' ], [ 'DETERGENT', 'DETERGENT' ],
		[ 'LIGAND', 'LIGAND' ], [ 'OTHER', 'OTHER' ] ];
};

Proposal.prototype.getBufferById = function(bufferId) {
	var buffers = this.getBuffers();
	for ( var i = 0; i < buffers.length; i++) {
		if (buffers[i].bufferId == bufferId) {
			return buffers[i];
		}
	}
};

Proposal.prototype.getShipmentByDewarId = function(dewarId) {
	var shippings = this.getShipments();
	for ( var i = 0; i < shippings.length; i++) {
		for ( var j = 0; j < shippings[i].dewarVOs.length; j++) {
			if (shippings[i].dewarVOs[j].dewarId == dewarId) {
				return shippings[i];
			}
		}
	}
	return null;
};

Proposal.prototype.getAssemblies = function() {
	return this.assemblies;
};

Proposal.prototype.getStockSolutions = function() {
	return this.stockSolutions;
};

Proposal.prototype.getSessions = function() {
	return this._data.sessions;
};

Proposal.prototype.getStructures = function() {
	var structures = [];
	var macromolecules = this.getMacromolecules();
	for (var i = 0; i < macromolecules.length; i++) {
		for (var j = 0; j < macromolecules[i].structure3VOs.length; j++) {
			structures.push(macromolecules[i].structure3VOs[j]);
		}
	}
	return structures;
};

Proposal.prototype.getStructuresById = function(structureId) {
	var structures = [];
	var macromolecules = this.getMacromolecules();
	for (var i = 0; i < macromolecules.length; i++) {
		for (var j = 0; j < macromolecules[i].structure3VOs.length; j++) {
			if (macromolecules[i].structure3VOs[j].structureId == structureId){
				return macromolecules[i].structure3VOs[j];
			}
		}
	}
	return structures;
};

Proposal.prototype.getUnpackedStockSolutions = function() {
	var stockSolutions = this.getStockSolutions();
	var result = [];
	for ( var i = 0; i < stockSolutions.length; i++) {
		if (stockSolutions[i].boxId == null) {
			result.push(stockSolutions[i]);
		}
	}
	return result;
};

Proposal.prototype.getStockSolutionsByDewarId = function(dewarId) {
	var stockSolutions = this.getStockSolutions();
	var result = [];
	for ( var i = 0; i < stockSolutions.length; i++) {
		if (stockSolutions[i].boxId == dewarId) {
			result.push(stockSolutions[i]);
		}
	}
	return result;
};

Proposal.prototype.sortByName = function(a, b) {
	if (a.acronym < b.acronym)
		return -1;
	if (a.acronym > b.acronym)
		return 1;
	return 0;
};

Proposal.prototype.setMacromolecules = function(macromolecules) {
	this.macromolecules = macromolecules;
	this.setColors();
};

Proposal.prototype._getColors = function() {
	if (this._colors == null) {
		var colors = [];
		var colorsCount = 8;
		for ( var i = 0; i < colorsCount; i++) {
			colors.push(BUI.rainbow(colorsCount, i));
		}
		this._colors = colors;
	}
	return this._colors;
};

Proposal.prototype.getMacromoleculeColors = function() {
	return this._getColors().slice(0, 3); // ["#ff0000", "#ffff00", "#00ff00",
											// "#00ffff", "#0000ff", "#ff00ff"];
};

Proposal.prototype.getBufferColors = function() {
	return [
	"#ffffcc",
	"#c7e9b4",
	"#7fcdbb",
	"#41b6c4",
	"#2c7fb8",
	"#253494"];
//	return ["blue"]
//	return this._getColors().slice(4, this._colors.length - 1); // [ "#ff99cc",
																// "#ffcc00",
																// "#00ff33",
																// "#00ffcc",
																// "#0099ff",
																// "#cc00cc"];
};

/** Set colors using the funcion rainbow on BUI /* */
Proposal.prototype.setColors = function() {
	var macromolecules = this.macromolecules.sort(this.sortByName);

	var colors = [];
	var colorsCount = 16;
	for ( var i = 0; i < colorsCount; i++) {
		colors.push(BUI.rainbow(colorsCount, i));
	}

	var macromoleculeColors = this.getMacromoleculeColors();
	var bufferColors = this.getBufferColors();
												
	var count = 0;
	for ( i = 0; i < macromolecules.length; i++) {
		this.macromoleculeColors[macromolecules[i].macromoleculeId] = macromoleculeColors[i% macromoleculeColors.length];
		count++;
	}
	
	var buffers = this.getBuffers().sort(this.sortByName);
	count = 0;
	if (buffers != null) {
		for (i = 0; i < buffers.length; i++) {
			this.bufferColors[buffers[i].bufferId] = bufferColors[i % bufferColors.length];
			count++;
		}
	}
};

Proposal.prototype.getBuffers = function() {
	return this.buffers;
};

Proposal.prototype.getLabcontacts = function() {
	return this.labcontacts;
};

Proposal.prototype.getShipments = function() {
	return this.shippings;
};

Proposal.prototype.getShipmentById = function(shipmentId) {
	var shipments = this.getShipments();
	for ( var i = 0; i < shipments.length; i++) {
		if (shipments[i].shippingId == shipmentId) {
			return shipments[i];
		}
	}
};

Proposal.prototype.getPlateTypes = function() {
	return this.plateTypes;
};

Proposal.prototype.getPlateByFlavour= function() {
	if (this.flavour == 'ESRF'){
		return [this.plateTypes[0], this.plateTypes[2], this.plateTypes[3]];
	}
};

Proposal.prototype.getPlateTypeById = function(plateTypeId) {
	var types = this.getPlateTypes();
	for ( var i = 0; i < types.length; i++) {
		if (types[i].plateTypeId == plateTypeId) {
			return types[i];
		}
	}
	return null;
};

Proposal.prototype.getSafetyLevels = function() {
	var safetyLevels = [];
	safetyLevels.push({
		safetyLevelId : "",
		name : "UNKNOWN"
	});
	safetyLevels.push({
		safetyLevelId : 1,
		name : "GREEN"
	});
	safetyLevels.push({
		safetyLevelId : 2,
		name : "YELLOW"
	});
	safetyLevels.push({
		safetyLevelId : 3,
		name : "RED"
	});
	return safetyLevels;
};

Proposal.prototype.setItems = function(data) {
	this._data = data;
	if (data.assemblies){
		this.assemblies = data.assemblies;
	}
	
	if (data.macromolecules){
		this.macromolecules = data.macromolecules;
	}
	if (data.buffers){
		this.buffers = data.buffers;
	}
	if (data.stockSolutions){
		this.stockSolutions = data.stockSolutions;
	}
	if (data.labcontacts){
		this.labcontacts = data.labcontacts;
	}
	if (data.shippings){
		this.shippings = data.shippings;
	}
	if (data.plateTypes){
		this.plateTypes = data.plateTypes;
	}
	this.setColors();
};

/** Get all the related items to the proposal : sessions, labcontacs, shippings, etc... **/
Proposal.prototype.init = function(sessionId) {
	var _this = this;
	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, data) {
		_this.setItems(data);
		_this.onInitialized.notify();
	});
	dataAdapter.getProposal(sessionId);
};


/** scope: DATA, PROPOSAL **/
Proposal.prototype.initialize = function(sessionId, scope) {
	var _this = this;
	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, data) {
		_this.setItems(data);
		_this.onInitialized.notify();
	});
	dataAdapter.getProposal(sessionId, scope);
};



/**
 * Remove the listeners in case we want to reinit the single class BIOSAXS.proposal 
 */
Proposal.prototype.removeListeners = function() {
	this.onInitialized = new Event(this);
};


Proposal.prototype.getMacromoleculeById = function(macromoleculeId) {
	for ( var i = 0; i < this.macromolecules.length; i++) {
		if (this.macromolecules[i].macromoleculeId == macromoleculeId) {
			return this.macromolecules[i];
		}
	}
	return null;
};

Proposal.prototype.getMacromoleculeByAcronym= function(acronym) {
	for ( var i = 0; i < this.macromolecules.length; i++) {
		if (this.macromolecules[i].acronym == acronym) {
			return this.macromolecules[i];
		}
	}
	return null;
};

Proposal.prototype.getStockSolutionById = function(stockSolutionId) {
	for ( var i = 0; i < this.stockSolutions.length; i++) {
		if (this.stockSolutions[i].stockSolutionId == stockSolutionId) {
			return this.stockSolutions[i];
		}
	}
	return null;
};

Proposal.prototype.getStockSolutionsBySpecimen = function(macromoleculeId, bufferId) {
	var result = [];
	for ( var i = 0; i < this.stockSolutions.length; i++) {
		if (this.stockSolutions[i].macromoleculeId == macromoleculeId) {
			if (this.stockSolutions[i].bufferId == bufferId) {
				result.push(this.stockSolutions[i]);
			}
		}
	}
	return result;
};

Proposal.prototype.getMacromolecules = function() {
	return this.macromolecules;
};

Proposal.prototype.getSafetyLabelName = function(safetyLevelId) {
	var safetyLevels = this.getSafetyLevels();
	for ( var i = 0; i < safetyLevels.length; i++) {
		if (safetyLevels[i].safetyLevelId == safetyLevelId) {
			return safetyLevels[i].name;
		}
	}
	return "UNKNOWN";
};

Proposal.prototype.getPlatesByProposal = function() {
	var _this = this;
	var dataAdapter = new BiosaxsDataAdapter();

	dataAdapter.onSuccess.attach(function(sender, data) {
		var experiments = [];
		for ( var i = 0; i < data.length; i++) {
			experiments.push(new Experiment(data[i]));
		}

		data = [];
		for (  i = 0; i < experiments.length; i++) {
			var samplePlates = experiments[i].getSamplePlates();
			for ( var j = 0; j < samplePlates.length; j++) {
				data.push(samplePlates[j]);
			}
		}

		_this.onDataRetrieved.notify(data);
	});
	dataAdapter.getExperimentsByProposalId("MEDIUM");
};

Proposal.prototype.getLabContactsByProposalId = function() {
	var _this = this;
	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onLabContactsRetrieved.attach(function(sender, labContacts) {
		_this.onDataRetrieved.notify(labContacts);
	});

	dataAdapter.onError.attach(function(sender, error) {
		_this.onError.notify(error);
	});

	dataAdapter.getLabContactsByProposalId();
};

function Shipment(json) {
	this.json = json;
	this.onSaved = new Event(this);
	this.onError = new Event(this);
}

Shipment.prototype.getDewars = function() {
	return this.json.dewarVOs;
};

Shipment.prototype.getDewars = function() {
	return this.json.dewarVOs;
};

Shipment.prototype.removeCase = function(dewarId) {
	var _this = this;
	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, shipment) {
		_this.onSaved.notify(shipment);
	});

	dataAdapter.onError.attach(function(sender, error) {
		_this.onError.notify(error);
	});

	dataAdapter.removeCase(dewarId, this.json.shippingId);
};



var DATADOC = {
		getExperiment_10 : function(){
			return {'experimentId':1305,'name':'test','creationDate':'Sep 5, 2013 9:28:29 AM','sourceFilePath':null,'type':'TEMPLATE','comments':'[BsxCube] Generated from BsxCube','dataAcquisitionFilePath':null,'status':null,'proposalId':10,'samplePlate3VOs':[{'samplePlateId':3915,'platetype3VO':{'plateTypeId':1,'name':'Deep Well','description':null,'rowCount':8,'columnCount':12,'shape':'REC'},'instructionSet3VO':null,'plategroup3VO':{'plateGroupId':1305,'storageTemperature':'0','name':'BsxCube Group 1'},'boxId':null,'name':'Deep Well','slotPositionRow':'1','slotPositionColumn':'1','storageTemperature':'0','sampleplateposition3VOs':[],'experimentId':1305},{'samplePlateId':3914,'platetype3VO':{'plateTypeId':2,'name':' 4 x ( 8 + 3 ) Block','description':null,'rowCount':4,'columnCount':11,'shape':'REC'},'instructionSet3VO':null,'plategroup3VO':{'plateGroupId':1305,'storageTemperature':'0','name':'BsxCube Group 1'},'boxId':null,'name':' 4 x ( 8 + 3 ) Block','slotPositionRow':'1','slotPositionColumn':'2','storageTemperature':'0','sampleplateposition3VOs':[{'samplePlatePositionId':10244,'samplePlateId':3914,'rowNumber':1,'columnNumber':11,'volume':null},{'samplePlatePositionId':10234,'samplePlateId':3914,'rowNumber':1,'columnNumber':1,'volume':null},{'samplePlatePositionId':10242,'samplePlateId':3914,'rowNumber':1,'columnNumber':9,'volume':null},{'samplePlatePositionId':10245,'samplePlateId':3914,'rowNumber':2,'columnNumber':1,'volume':null},{'samplePlatePositionId':10239,'samplePlateId':3914,'rowNumber':1,'columnNumber':6,'volume':null},{'samplePlatePositionId':10235,'samplePlateId':3914,'rowNumber':1,'columnNumber':2,'volume':null},{'samplePlatePositionId':10236,'samplePlateId':3914,'rowNumber':1,'columnNumber':3,'volume':null},{'samplePlatePositionId':10240,'samplePlateId':3914,'rowNumber':1,'columnNumber':7,'volume':null},{'samplePlatePositionId':10237,'samplePlateId':3914,'rowNumber':1,'columnNumber':4,'volume':null},{'samplePlatePositionId':10243,'samplePlateId':3914,'rowNumber':1,'columnNumber':10,'volume':null},{'samplePlatePositionId':10246,'samplePlateId':3914,'rowNumber':2,'columnNumber':2,'volume':null},{'samplePlatePositionId':10238,'samplePlateId':3914,'rowNumber':1,'columnNumber':5,'volume':null},{'samplePlatePositionId':10241,'samplePlateId':3914,'rowNumber':1,'columnNumber':8,'volume':null},{'samplePlatePositionId':10247,'samplePlateId':3914,'rowNumber':2,'columnNumber':3,'volume':null},{'samplePlatePositionId':10248,'samplePlateId':3914,'rowNumber':2,'columnNumber':4,'volume':null}],'experimentId':1305},{'samplePlateId':3913,'platetype3VO':{'plateTypeId':4,'name':'96 Well plate','description':null,'rowCount':8,'columnCount':12,'shape':'REC'},'instructionSet3VO':null,'plategroup3VO':{'plateGroupId':1305,'storageTemperature':'0','name':'BsxCube Group 1'},'boxId':null,'name':'96 Well plate','slotPositionRow':'1','slotPositionColumn':'3','storageTemperature':'0','sampleplateposition3VOs':[],'experimentId':1305}],'platetype3VOs':[{'plateTypeId':4,'name':'96 Well plate','description':null,'rowCount':8,'columnCount':12,'shape':'REC'},{'plateTypeId':3,'name':'Disk Well plate','description':null,'rowCount':8,'columnCount':2,'shape':'CIR'},{'plateTypeId':2,'name':' 4 x ( 8 + 3 ) Block','description':null,'rowCount':4,'columnCount':11,'shape':'REC'},{'plateTypeId':1,'name':'Deep Well','description':null,'rowCount':8,'columnCount':12,'shape':'REC'}],'samples3VOs':[{'specimenId':9647,'macromolecule3VO':{'macromoleculeId':34,'safetylevelId':null,'proposalId':10,'name':'a53t5_25r','acronym':'a53t5_25r','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10234,'samplePlateId':3914,'rowNumber':1,'columnNumber':1,'volume':null},'bufferId':121,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'1?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24827,'specimenId':9647,'flow':false,'priority':15,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':34,'macromolecule':'a53t5_25r','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':1,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':155,'acronym':'a53t5_25r','buffer':'milliQwater2'},{'specimenId':9649,'macromolecule3VO':{'macromoleculeId':34,'safetylevelId':null,'proposalId':10,'name':'a53t5_25r','acronym':'a53t5_25r','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10235,'samplePlateId':3914,'rowNumber':1,'columnNumber':2,'volume':null},'bufferId':121,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'3.4','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24830,'specimenId':9649,'flow':false,'priority':17,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':34,'macromolecule':'a53t5_25r','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':2,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':155,'acronym':'a53t5_25r','buffer':'milliQwater2'},{'specimenId':9638,'macromolecule3VO':{'macromoleculeId':218,'safetylevelId':null,'proposalId':10,'name':'tRNA','acronym':'tRNA','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10238,'samplePlateId':3914,'rowNumber':1,'columnNumber':5,'volume':null},'bufferId':410,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'2?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24839,'specimenId':9638,'flow':false,'priority':24,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':218,'macromolecule':'tRNA','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':5,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':628,'acronym':'tRNA','buffer':'p38buffer'},{'specimenId':9640,'macromolecule3VO':null,'sampleplateposition3VO':{'samplePlatePositionId':10248,'samplePlateId':3914,'rowNumber':2,'columnNumber':4,'volume':null},'bufferId':121,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'0','code':'','volume':'240','comments':null,'measurements':[{'measurementId':24826,'specimenId':9640,'flow':false,'priority':14,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'milliQwater2','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24831,'specimenId':9640,'flow':false,'priority':18,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'milliQwater2','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24828,'specimenId':9640,'flow':false,'priority':16,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'milliQwater2','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24834,'specimenId':9640,'flow':false,'priority':20,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'milliQwater2','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':null,'samplePlateId':3914,'rowNumber':2,'columnNumber':4,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':121,'acronym':'Buffers','buffer':'milliQwater2'},{'specimenId':9642,'macromolecule3VO':{'macromoleculeId':647,'safetylevelId':null,'proposalId':10,'name':'C2','acronym':'C2','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10244,'samplePlateId':3914,'rowNumber':1,'columnNumber':11,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'2?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24812,'specimenId':9642,'flow':false,'priority':4,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':647,'macromolecule':'C2','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':11,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':1069,'acronym':'C2','buffer':'B1'},{'specimenId':9646,'macromolecule3VO':{'macromoleculeId':481,'safetylevelId':null,'proposalId':10,'name':'MIX','acronym':'MIX','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10242,'samplePlateId':3914,'rowNumber':1,'columnNumber':9,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'3?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24824,'specimenId':9646,'flow':false,'priority':12,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':481,'macromolecule':'MIX','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':9,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':903,'acronym':'MIX','buffer':'B1'},{'specimenId':9644,'macromolecule3VO':{'macromoleculeId':481,'safetylevelId':null,'proposalId':10,'name':'MIX','acronym':'MIX','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10240,'samplePlateId':3914,'rowNumber':1,'columnNumber':7,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'1?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24818,'specimenId':9644,'flow':false,'priority':8,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':481,'macromolecule':'MIX','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':7,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':903,'acronym':'MIX','buffer':'B1'},{'specimenId':9648,'macromolecule3VO':null,'sampleplateposition3VO':{'samplePlatePositionId':10247,'samplePlateId':3914,'rowNumber':2,'columnNumber':3,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'0','code':'','volume':'480','comments':null,'measurements':[{'measurementId':24816,'specimenId':9648,'flow':false,'priority':7,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24808,'specimenId':9648,'flow':false,'priority':1,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24813,'specimenId':9648,'flow':false,'priority':5,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24810,'specimenId':9648,'flow':false,'priority':3,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24822,'specimenId':9648,'flow':false,'priority':11,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24819,'specimenId':9648,'flow':false,'priority':9,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24825,'specimenId':9648,'flow':false,'priority':13,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'480','comments':'','code':'B1','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':null,'samplePlateId':3914,'rowNumber':2,'columnNumber':3,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':422,'acronym':'Buffers','buffer':'B1'},{'specimenId':9635,'macromolecule3VO':{'macromoleculeId':34,'safetylevelId':null,'proposalId':10,'name':'a53t5_25r','acronym':'a53t5_25r','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10236,'samplePlateId':3914,'rowNumber':1,'columnNumber':3,'volume':null},'bufferId':121,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'3?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24833,'specimenId':9635,'flow':false,'priority':19,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':34,'macromolecule':'a53t5_25r','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':3,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':155,'acronym':'a53t5_25r','buffer':'milliQwater2'},{'specimenId':9639,'macromolecule3VO':{'macromoleculeId':218,'safetylevelId':null,'proposalId':10,'name':'tRNA','acronym':'tRNA','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10237,'samplePlateId':3914,'rowNumber':1,'columnNumber':4,'volume':null},'bufferId':410,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'1?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24836,'specimenId':9639,'flow':false,'priority':22,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':218,'macromolecule':'tRNA','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':4,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':628,'acronym':'tRNA','buffer':'p38buffer'},{'specimenId':9637,'macromolecule3VO':null,'sampleplateposition3VO':{'samplePlatePositionId':10246,'samplePlateId':3914,'rowNumber':2,'columnNumber':2,'volume':null},'bufferId':410,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'0','code':'','volume':'240','comments':null,'measurements':[{'measurementId':24843,'specimenId':9637,'flow':false,'priority':27,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'p38buffer','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24840,'specimenId':9637,'flow':false,'priority':25,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'p38buffer','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24835,'specimenId':9637,'flow':false,'priority':21,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'p38buffer','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null},{'measurementId':24837,'specimenId':9637,'flow':false,'priority':23,'exposureTemperature':'4','viscosity':'false','extraFlowTime':'0','volumeToLoad':'240','comments':'','code':'p38buffer','transmission':'0','waitTime':'10','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':null,'samplePlateId':3914,'rowNumber':2,'columnNumber':2,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':410,'acronym':'Buffers','buffer':'p38buffer'},{'specimenId':9636,'macromolecule3VO':{'macromoleculeId':218,'safetylevelId':null,'proposalId':10,'name':'tRNA','acronym':'tRNA','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10239,'samplePlateId':3914,'rowNumber':1,'columnNumber':6,'volume':null},'bufferId':410,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'3?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24842,'specimenId':9636,'flow':false,'priority':26,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':218,'macromolecule':'tRNA','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':6,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':628,'acronym':'tRNA','buffer':'p38buffer'},{'specimenId':9643,'macromolecule3VO':{'macromoleculeId':647,'safetylevelId':null,'proposalId':10,'name':'C2','acronym':'C2','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10245,'samplePlateId':3914,'rowNumber':2,'columnNumber':1,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'3?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24815,'specimenId':9643,'flow':false,'priority':6,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':647,'macromolecule':'C2','exposureTemperature':[],'samplePlateId':3914,'rowNumber':2,'columnNumber':1,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':1069,'acronym':'C2','buffer':'B1'},{'specimenId':9641,'macromolecule3VO':{'macromoleculeId':647,'safetylevelId':null,'proposalId':10,'name':'C2','acronym':'C2','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10243,'samplePlateId':3914,'rowNumber':1,'columnNumber':10,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'1?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24809,'specimenId':9641,'flow':false,'priority':2,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':647,'macromolecule':'C2','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':10,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':1069,'acronym':'C2','buffer':'B1'},{'specimenId':9645,'macromolecule3VO':{'macromoleculeId':481,'safetylevelId':null,'proposalId':10,'name':'MIX','acronym':'MIX','molecularMass':null,'extintionCoefficient':null,'sequence':null,'creationDate':null,'comments':null,'stoichiometry3VOsForHostMacromoleculeId':[],'structure3VOs':[]},'sampleplateposition3VO':{'samplePlatePositionId':10241,'samplePlateId':3914,'rowNumber':1,'columnNumber':8,'volume':null},'bufferId':422,'stockSolutionId':null,'experimentId':1305,'safetyLevelId':null,'concentration':'2?','code':'','volume':'40','comments':null,'measurements':[{'measurementId':24821,'specimenId':9645,'flow':false,'priority':10,'exposureTemperature':'20','viscosity':'medium','extraFlowTime':'0','volumeToLoad':'50','comments':'','code':'4','transmission':'100','waitTime':'2','run3VO':null,'merge3VOs':[],'dataCollectionOrder':null}],'macromoleculeId':481,'macromolecule':'MIX','exposureTemperature':[],'samplePlateId':3914,'rowNumber':1,'columnNumber':8,'plateGroupName':'BsxCube Group 1','samplePlateName':' 4 x ( 8 + 3 ) Block  [BsxCube Group 1]','slotPositionColumn':'2','groupIndex':903,'acronym':'MIX','buffer':'B1'}],'dataCollections':[{'dataCollectionId':8275,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24824,'measurementId':24824,'dataCollectionOrder':2},{'measurementToDataCollectionId':24823,'measurementId':24822,'dataCollectionOrder':1},{'measurementToDataCollectionId':24825,'measurementId':24825,'dataCollectionOrder':3}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8281,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24841,'measurementId':24840,'dataCollectionOrder':1},{'measurementToDataCollectionId':24843,'measurementId':24843,'dataCollectionOrder':3},{'measurementToDataCollectionId':24842,'measurementId':24842,'dataCollectionOrder':2}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8272,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24815,'measurementId':24815,'dataCollectionOrder':2},{'measurementToDataCollectionId':24816,'measurementId':24816,'dataCollectionOrder':3},{'measurementToDataCollectionId':24814,'measurementId':24813,'dataCollectionOrder':1}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8277,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24830,'measurementId':24830,'dataCollectionOrder':2},{'measurementToDataCollectionId':24831,'measurementId':24831,'dataCollectionOrder':3},{'measurementToDataCollectionId':24829,'measurementId':24828,'dataCollectionOrder':1}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8271,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24812,'measurementId':24812,'dataCollectionOrder':2},{'measurementToDataCollectionId':24811,'measurementId':24810,'dataCollectionOrder':1},{'measurementToDataCollectionId':24813,'measurementId':24813,'dataCollectionOrder':3}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8273,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24818,'measurementId':24818,'dataCollectionOrder':2},{'measurementToDataCollectionId':24817,'measurementId':24816,'dataCollectionOrder':1},{'measurementToDataCollectionId':24819,'measurementId':24819,'dataCollectionOrder':3}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8270,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24809,'measurementId':24809,'dataCollectionOrder':2},{'measurementToDataCollectionId':24808,'measurementId':24808,'dataCollectionOrder':1},{'measurementToDataCollectionId':24810,'measurementId':24810,'dataCollectionOrder':3}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8278,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24832,'measurementId':24831,'dataCollectionOrder':1},{'measurementToDataCollectionId':24834,'measurementId':24834,'dataCollectionOrder':3},{'measurementToDataCollectionId':24833,'measurementId':24833,'dataCollectionOrder':2}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8280,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24839,'measurementId':24839,'dataCollectionOrder':2},{'measurementToDataCollectionId':24840,'measurementId':24840,'dataCollectionOrder':3},{'measurementToDataCollectionId':24838,'measurementId':24837,'dataCollectionOrder':1}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8276,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24827,'measurementId':24827,'dataCollectionOrder':2},{'measurementToDataCollectionId':24826,'measurementId':24826,'dataCollectionOrder':1},{'measurementToDataCollectionId':24828,'measurementId':24828,'dataCollectionOrder':3}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8279,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24835,'measurementId':24835,'dataCollectionOrder':1},{'measurementToDataCollectionId':24836,'measurementId':24836,'dataCollectionOrder':2},{'measurementToDataCollectionId':24837,'measurementId':24837,'dataCollectionOrder':3}],'experimentId':1305,'substraction3VOs':[],'comments':null},{'dataCollectionId':8274,'measurementtodatacollection3VOs':[{'measurementToDataCollectionId':24821,'measurementId':24821,'dataCollectionOrder':2},{'measurementToDataCollectionId':24822,'measurementId':24822,'dataCollectionOrder':3},{'measurementToDataCollectionId':24820,'measurementId':24819,'dataCollectionOrder':1}],'experimentId':1305,'substraction3VOs':[],'comments':null}]};
		},
		getMeasurements_10 : function(){
			return [{"measurementId":24827,"specimenId":9647,"flow":false,"priority":15,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24830,"specimenId":9649,"flow":false,"priority":17,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24839,"specimenId":9638,"flow":false,"priority":24,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24826,"specimenId":9640,"flow":false,"priority":14,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"milliQwater2","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24831,"specimenId":9640,"flow":false,"priority":18,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"milliQwater2","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24828,"specimenId":9640,"flow":false,"priority":16,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"milliQwater2","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24834,"specimenId":9640,"flow":false,"priority":20,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"milliQwater2","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24812,"specimenId":9642,"flow":false,"priority":4,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24824,"specimenId":9646,"flow":false,"priority":12,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24818,"specimenId":9644,"flow":false,"priority":8,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24816,"specimenId":9648,"flow":false,"priority":7,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24808,"specimenId":9648,"flow":false,"priority":1,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24813,"specimenId":9648,"flow":false,"priority":5,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24810,"specimenId":9648,"flow":false,"priority":3,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24822,"specimenId":9648,"flow":false,"priority":11,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24819,"specimenId":9648,"flow":false,"priority":9,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24825,"specimenId":9648,"flow":false,"priority":13,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"480","comments":"","code":"B1","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24833,"specimenId":9635,"flow":false,"priority":19,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24836,"specimenId":9639,"flow":false,"priority":22,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24843,"specimenId":9637,"flow":false,"priority":27,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"p38buffer","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24840,"specimenId":9637,"flow":false,"priority":25,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"p38buffer","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24835,"specimenId":9637,"flow":false,"priority":21,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"p38buffer","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24837,"specimenId":9637,"flow":false,"priority":23,"exposureTemperature":"4","viscosity":"false","extraFlowTime":"0","volumeToLoad":"240","comments":"","code":"p38buffer","transmission":"0","waitTime":"10","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24842,"specimenId":9636,"flow":false,"priority":26,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null},{"measurementId":24815,"specimenId":9643,"flow":false,"priority":6,"exposureTemperature":"20","viscosity":"medium","extraFlowTime":"0","volumeToLoad":"50","comments":"","code":"4","transmission":"100","waitTime":"2","run3VO":null,"merge3VOs":[],"dataCollectionOrder":null}];
		},
		getProposal_10 : function(){
			return {"plateTypes":[{"plateTypeId":4,"name":"96 Well plate","description":null,"rowCount":8,"columnCount":12,"shape":"REC"},{"plateTypeId":3,"name":"Disk Well plate","description":null,"rowCount":8,"columnCount":2,"shape":"CIR"},{"plateTypeId":2,"name":" 4 x ( 8 + 3 ) Block","description":null,"rowCount":4,"columnCount":11,"shape":"REC"},{"plateTypeId":1,"name":"Deep Well","description":null,"rowCount":8,"columnCount":12,"shape":"REC"}],"assemblies":[],"sessions":[],"labcontacts":[],"buffers":[{"bufferId":637,"proposalId":10,"safetyLevelId":null,"name":"","acronym":"","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":412,"proposalId":10,"safetyLevelId":null,"name":"AE","acronym":"AE","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":419,"proposalId":10,"safetyLevelId":null,"name":"AMP","acronym":"AMP","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":420,"proposalId":10,"safetyLevelId":null,"name":"AMPR5P","acronym":"AMPR5P","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":418,"proposalId":10,"safetyLevelId":null,"name":"ATP","acronym":"ATP","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":422,"proposalId":10,"safetyLevelId":null,"name":"B1","acronym":"B1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":426,"proposalId":10,"safetyLevelId":null,"name":"B2","acronym":"B2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":408,"proposalId":10,"safetyLevelId":null,"name":"B2dtt","acronym":"B2dtt","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":425,"proposalId":10,"safetyLevelId":null,"name":"B3","acronym":"B3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":409,"proposalId":10,"safetyLevelId":null,"name":"BSA","acronym":"BSA","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":411,"proposalId":10,"safetyLevelId":null,"name":"C3","acronym":"C3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":732,"proposalId":10,"safetyLevelId":null,"name":"CB-RE","acronym":"CB-RE","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":414,"proposalId":10,"safetyLevelId":null,"name":"CVP0011","acronym":"CVP0011","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":249,"proposalId":10,"safetyLevelId":null,"name":"CaCl2","acronym":"CaCl2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":16,"proposalId":10,"safetyLevelId":null,"name":"Hepes Fum","acronym":"Hepes Fum","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":708,"proposalId":10,"safetyLevelId":null,"name":"KPi","acronym":"KPi","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":707,"proposalId":10,"safetyLevelId":null,"name":"MES","acronym":"MES","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":416,"proposalId":10,"safetyLevelId":null,"name":"MgCl","acronym":"MgCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":413,"proposalId":10,"safetyLevelId":null,"name":"PBS1x","acronym":"PBS1x","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":417,"proposalId":10,"safetyLevelId":null,"name":"PRPP","acronym":"PRPP","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":415,"proposalId":10,"safetyLevelId":null,"name":"R5P","acronym":"R5P","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":638,"proposalId":10,"safetyLevelId":null,"name":"a","acronym":"a","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":14,"proposalId":10,"safetyLevelId":null,"name":"air","acronym":"air","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":1,"proposalId":10,"safetyLevelId":null,"name":"bbsa","acronym":"bbsa","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":191,"proposalId":10,"safetyLevelId":null,"name":"bh169t","acronym":"bh169t","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":571,"proposalId":10,"safetyLevelId":null,"name":"bp38","acronym":"bp38","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":734,"proposalId":10,"safetyLevelId":null,"name":"buf","acronym":"buf","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":13,"proposalId":10,"safetyLevelId":null,"name":"buffer","acronym":"buffer","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":362,"proposalId":10,"safetyLevelId":null,"name":"bufferw","acronym":"bufferw","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":12,"proposalId":10,"safetyLevelId":null,"name":"bwater","acronym":"bwater","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":79,"proposalId":10,"safetyLevelId":null,"name":"bwaterhj","acronym":"bwaterhj","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":639,"proposalId":10,"safetyLevelId":null,"name":"common buffer","acronym":"common buffer","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":182,"proposalId":10,"safetyLevelId":null,"name":"eds1","acronym":"eds1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":361,"proposalId":10,"safetyLevelId":null,"name":"hepes","acronym":"hepes","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":26,"proposalId":10,"safetyLevelId":null,"name":"k2cl_buffer_0.06","acronym":"k2cl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":27,"proposalId":10,"safetyLevelId":null,"name":"k2cl_buffer_0.2","acronym":"k2cl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":28,"proposalId":10,"safetyLevelId":null,"name":"k2cl_buffer_0.5","acronym":"k2cl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":30,"proposalId":10,"safetyLevelId":null,"name":"k3cl_buffer_0.06","acronym":"k3cl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":29,"proposalId":10,"safetyLevelId":null,"name":"k3cl_buffer_0.2","acronym":"k3cl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":31,"proposalId":10,"safetyLevelId":null,"name":"k3cl_buffer_0.5","acronym":"k3cl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":2,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.06","acronym":"kcl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":21,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.1","acronym":"kcl_buffer_0.1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":7,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.2","acronym":"kcl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":22,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.3","acronym":"kcl_buffer_0.3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":20,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.4","acronym":"kcl_buffer_0.4","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":6,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.5","acronym":"kcl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":19,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.6","acronym":"kcl_buffer_0.6","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":18,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_0.8","acronym":"kcl_buffer_0.8","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":17,"proposalId":10,"safetyLevelId":null,"name":"kcl_buffer_1.0","acronym":"kcl_buffer_1.0","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":25,"proposalId":10,"safetyLevelId":null,"name":"klicl_buffer_0.06","acronym":"klicl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":23,"proposalId":10,"safetyLevelId":null,"name":"klicl_buffer_0.2","acronym":"klicl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":24,"proposalId":10,"safetyLevelId":null,"name":"klicl_buffer_0.5","acronym":"klicl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":9,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.06","acronym":"licl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":145,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.1","acronym":"licl_buffer_0.1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":11,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.2","acronym":"licl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":144,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.3","acronym":"licl_buffer_0.3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":143,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.4","acronym":"licl_buffer_0.4","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":10,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.5","acronym":"licl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":142,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.6","acronym":"licl_buffer_0.6","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":141,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_0.8","acronym":"licl_buffer_0.8","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":146,"proposalId":10,"safetyLevelId":null,"name":"licl_buffer_1.0","acronym":"licl_buffer_1.0","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":80,"proposalId":10,"safetyLevelId":null,"name":"milliQwater","acronym":"milliQwater","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":119,"proposalId":10,"safetyLevelId":null,"name":"milliQwater1","acronym":"milliQwater1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":122,"proposalId":10,"safetyLevelId":null,"name":"milliQwater11","acronym":"milliQwater11","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":121,"proposalId":10,"safetyLevelId":null,"name":"milliQwater2","acronym":"milliQwater2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":123,"proposalId":10,"safetyLevelId":null,"name":"milliQwater22","acronym":"milliQwater22","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":120,"proposalId":10,"safetyLevelId":null,"name":"milliQwater23","acronym":"milliQwater23","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":128,"proposalId":10,"safetyLevelId":null,"name":"milliQwater3","acronym":"milliQwater3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":127,"proposalId":10,"safetyLevelId":null,"name":"milliQwater32","acronym":"milliQwater32","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":125,"proposalId":10,"safetyLevelId":null,"name":"milliQwater33","acronym":"milliQwater33","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":126,"proposalId":10,"safetyLevelId":null,"name":"milliQwater42","acronym":"milliQwater42","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":124,"proposalId":10,"safetyLevelId":null,"name":"milliQwater43","acronym":"milliQwater43","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":5,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.06","acronym":"nacl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":134,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.1","acronym":"nacl_buffer_0.1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":4,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.2","acronym":"nacl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":133,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.3","acronym":"nacl_buffer_0.3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":132,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.4","acronym":"nacl_buffer_0.4","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":3,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.5","acronym":"nacl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":130,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.6","acronym":"nacl_buffer_0.6","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":129,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_0.8","acronym":"nacl_buffer_0.8","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":131,"proposalId":10,"safetyLevelId":null,"name":"nacl_buffer_1.0","acronym":"nacl_buffer_1.0","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":33,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.06","acronym":"nh4cl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":140,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.1","acronym":"nh4cl_buffer_0.1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":34,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.2","acronym":"nh4cl_buffer_0.2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":139,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.3","acronym":"nh4cl_buffer_0.3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":138,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.4","acronym":"nh4cl_buffer_0.4","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":32,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.5","acronym":"nh4cl_buffer_0.5","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":136,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.6","acronym":"nh4cl_buffer_0.6","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":135,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_0.8","acronym":"nh4cl_buffer_0.8","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":137,"proposalId":10,"safetyLevelId":null,"name":"nh4cl_buffer_1.0","acronym":"nh4cl_buffer_1.0","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":410,"proposalId":10,"safetyLevelId":null,"name":"p38buffer","acronym":"p38buffer","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":421,"proposalId":10,"safetyLevelId":null,"name":"plain","acronym":"plain","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":185,"proposalId":10,"safetyLevelId":null,"name":"proj1","acronym":"proj1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":186,"proposalId":10,"safetyLevelId":null,"name":"proj2","acronym":"proj2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":187,"proposalId":10,"safetyLevelId":null,"name":"proj3","acronym":"proj3","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":184,"proposalId":10,"safetyLevelId":null,"name":"projekt1","acronym":"projekt1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":15,"proposalId":10,"safetyLevelId":null,"name":"rep_licl_buffer_0.06","acronym":"rep_licl_buffer_0.06","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":183,"proposalId":10,"safetyLevelId":null,"name":"swantje","acronym":"swantje","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":569,"proposalId":10,"safetyLevelId":null,"name":"tampongf","acronym":"tampongf","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":8,"proposalId":10,"safetyLevelId":null,"name":"water","acronym":"water","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":360,"proposalId":10,"safetyLevelId":null,"name":"wbuff","acronym":"wbuff","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null}],"shippings":[],"macromolecules":[{"macromoleculeId":1095,"safetylevelId":null,"proposalId":10,"name":"","acronym":"","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":643,"safetylevelId":null,"proposalId":10,"name":"A","acronym":"A","molecularMass":"2","extintionCoefficient":"1","sequence":null,"creationDate":null,"comments":"","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":480,"safetylevelId":null,"proposalId":10,"name":"BSAlyso","acronym":"BSAlyso","molecularMass":"","extintionCoefficient":"","sequence":null,"creationDate":null,"comments":"nfgnf","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":646,"safetylevelId":null,"proposalId":10,"name":"C1","acronym":"C1","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":638,"safetylevelId":null,"proposalId":10,"name":"C1_C3","acronym":"C1_C3","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":647,"safetylevelId":null,"proposalId":10,"name":"C2","acronym":"C2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":640,"safetylevelId":null,"proposalId":10,"name":"C2_iC3b","acronym":"C2_iC3b","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":645,"safetylevelId":null,"proposalId":10,"name":"C3","acronym":"C3","molecularMass":"1","extintionCoefficient":"","sequence":null,"creationDate":null,"comments":"","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":639,"safetylevelId":null,"proposalId":10,"name":"C3_C3","acronym":"C3_C3","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":2,"safetylevelId":null,"proposalId":10,"name":"GMP","acronym":"GMP","molecularMass":"","extintionCoefficient":"","sequence":null,"creationDate":null,"comments":"","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":3,"safetylevelId":null,"proposalId":10,"name":"GMPK","acronym":"GMPK","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":7,"safetylevelId":null,"proposalId":10,"name":"GMPNa","acronym":"GMPNa","molecularMass":"","extintionCoefficient":"","sequence":null,"creationDate":null,"comments":"","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":111,"safetylevelId":null,"proposalId":10,"name":"H169T_DntR","acronym":"H169T_DntR","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":644,"safetylevelId":null,"proposalId":10,"name":"L","acronym":"L","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":649,"safetylevelId":null,"proposalId":10,"name":"L9","acronym":"L9","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":659,"safetylevelId":null,"proposalId":10,"name":"L9_3RNA","acronym":"L9_3RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":661,"safetylevelId":null,"proposalId":10,"name":"L9_5RNA","acronym":"L9_5RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":662,"safetylevelId":null,"proposalId":10,"name":"L9_ADD","acronym":"L9_ADD","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":660,"safetylevelId":null,"proposalId":10,"name":"L_3RNA","acronym":"L_3RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":663,"safetylevelId":null,"proposalId":10,"name":"L_5RNA","acronym":"L_5RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":658,"safetylevelId":null,"proposalId":10,"name":"L_ADD","acronym":"L_ADD","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":112,"safetylevelId":null,"proposalId":10,"name":"MG386","acronym":"MG386","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4500,"safetylevelId":null,"proposalId":10,"name":"MG386sh","acronym":"MG386sh","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":481,"safetylevelId":null,"proposalId":10,"name":"MIX","acronym":"MIX","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":802,"safetylevelId":null,"proposalId":10,"name":"TcCRT_281","acronym":"TcCRT_281","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":803,"safetylevelId":null,"proposalId":10,"name":"TcCRT_281_2","acronym":"TcCRT_281_2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":108,"safetylevelId":null,"proposalId":10,"name":"Unkown","acronym":"Unkown","molecularMass":"","extintionCoefficient":"","sequence":null,"creationDate":null,"comments":"","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5,"safetylevelId":null,"proposalId":10,"name":"WATER","acronym":"WATER","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4,"safetylevelId":null,"proposalId":10,"name":"Water","acronym":"Water","molecularMass":"","extintionCoefficient":"","sequence":null,"creationDate":null,"comments":"","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":83,"safetylevelId":null,"proposalId":10,"name":"a30p10_25","acronym":"a30p10_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":86,"safetylevelId":null,"proposalId":10,"name":"a30p10_37","acronym":"a30p10_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":89,"safetylevelId":null,"proposalId":10,"name":"a30p10_37rep","acronym":"a30p10_37rep","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":99,"safetylevelId":null,"proposalId":10,"name":"a30p137_dgas","acronym":"a30p137_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":85,"safetylevelId":null,"proposalId":10,"name":"a30p1_25","acronym":"a30p1_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":88,"safetylevelId":null,"proposalId":10,"name":"a30p1_37","acronym":"a30p1_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":90,"safetylevelId":null,"proposalId":10,"name":"a30p1_45","acronym":"a30p1_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":96,"safetylevelId":null,"proposalId":10,"name":"a30p537_dgas","acronym":"a30p537_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":84,"safetylevelId":null,"proposalId":10,"name":"a30p5_25","acronym":"a30p5_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":87,"safetylevelId":null,"proposalId":10,"name":"a30p5_37","acronym":"a30p5_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":91,"safetylevelId":null,"proposalId":10,"name":"a30p5_45","acronym":"a30p5_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":101,"safetylevelId":null,"proposalId":10,"name":"a53t1037_dgas","acronym":"a53t1037_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":25,"safetylevelId":null,"proposalId":10,"name":"a53t10_25","acronym":"a53t10_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":35,"safetylevelId":null,"proposalId":10,"name":"a53t10_25r","acronym":"a53t10_25r","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":29,"safetylevelId":null,"proposalId":10,"name":"a53t10_37","acronym":"a53t10_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":32,"safetylevelId":null,"proposalId":10,"name":"a53t10_45","acronym":"a53t10_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":98,"safetylevelId":null,"proposalId":10,"name":"a53t137_dgas","acronym":"a53t137_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":27,"safetylevelId":null,"proposalId":10,"name":"a53t1_25","acronym":"a53t1_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":36,"safetylevelId":null,"proposalId":10,"name":"a53t1_25r","acronym":"a53t1_25r","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":30,"safetylevelId":null,"proposalId":10,"name":"a53t1_37","acronym":"a53t1_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":33,"safetylevelId":null,"proposalId":10,"name":"a53t1_45","acronym":"a53t1_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":94,"safetylevelId":null,"proposalId":10,"name":"a53t537_dgas","acronym":"a53t537_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":26,"safetylevelId":null,"proposalId":10,"name":"a53t5_25","acronym":"a53t5_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":34,"safetylevelId":null,"proposalId":10,"name":"a53t5_25r","acronym":"a53t5_25r","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":28,"safetylevelId":null,"proposalId":10,"name":"a53t5_37","acronym":"a53t5_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":31,"safetylevelId":null,"proposalId":10,"name":"a53t5_45","acronym":"a53t5_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4499,"safetylevelId":null,"proposalId":10,"name":"bR_1","acronym":"bR_1","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4498,"safetylevelId":null,"proposalId":10,"name":"bR_2","acronym":"bR_2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4496,"safetylevelId":null,"proposalId":10,"name":"bR_3","acronym":"bR_3","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4494,"safetylevelId":null,"proposalId":10,"name":"bR_4","acronym":"bR_4","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4493,"safetylevelId":null,"proposalId":10,"name":"bR_5","acronym":"bR_5","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":1,"safetylevelId":null,"proposalId":10,"name":"bsa","acronym":"bsa","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":641,"safetylevelId":null,"proposalId":10,"name":"cA","acronym":"cA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":642,"safetylevelId":null,"proposalId":10,"name":"cE","acronym":"cE","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":1897,"safetylevelId":null,"proposalId":10,"name":"ccp2425","acronym":"ccp2425","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":1896,"safetylevelId":null,"proposalId":10,"name":"ccp242526","acronym":"ccp242526","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":1898,"safetylevelId":null,"proposalId":10,"name":"ccp2526","acronym":"ccp2526","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":6,"safetylevelId":null,"proposalId":10,"name":"chmp","acronym":"chmp","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":805,"safetylevelId":null,"proposalId":10,"name":"cr1_2mod","acronym":"cr1_2mod","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":804,"safetylevelId":null,"proposalId":10,"name":"cr1_3mod","acronym":"cr1_3mod","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4490,"safetylevelId":null,"proposalId":10,"name":"cx43_1","acronym":"cx43_1","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4491,"safetylevelId":null,"proposalId":10,"name":"cx43_2","acronym":"cx43_2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4495,"safetylevelId":null,"proposalId":10,"name":"cx43_3","acronym":"cx43_3","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4497,"safetylevelId":null,"proposalId":10,"name":"cx43_4","acronym":"cx43_4","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4492,"safetylevelId":null,"proposalId":10,"name":"cx43_5","acronym":"cx43_5","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":102,"safetylevelId":null,"proposalId":10,"name":"e46k1037_dgas","acronym":"e46k1037_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":39,"safetylevelId":null,"proposalId":10,"name":"e46k10_25","acronym":"e46k10_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":40,"safetylevelId":null,"proposalId":10,"name":"e46k10_37","acronym":"e46k10_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":44,"safetylevelId":null,"proposalId":10,"name":"e46k10_45","acronym":"e46k10_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":100,"safetylevelId":null,"proposalId":10,"name":"e46k137_dgas","acronym":"e46k137_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":38,"safetylevelId":null,"proposalId":10,"name":"e46k1_25","acronym":"e46k1_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":41,"safetylevelId":null,"proposalId":10,"name":"e46k1_37","acronym":"e46k1_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":45,"safetylevelId":null,"proposalId":10,"name":"e46k1_45","acronym":"e46k1_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":95,"safetylevelId":null,"proposalId":10,"name":"e46k537_dgas","acronym":"e46k537_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":37,"safetylevelId":null,"proposalId":10,"name":"e46k5_25","acronym":"e46k5_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":42,"safetylevelId":null,"proposalId":10,"name":"e46k5_37","acronym":"e46k5_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":43,"safetylevelId":null,"proposalId":10,"name":"e46k5_45","acronym":"e46k5_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":93,"safetylevelId":null,"proposalId":10,"name":"g51d1037_dgas","acronym":"g51d1037_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":76,"safetylevelId":null,"proposalId":10,"name":"g51d10_25","acronym":"g51d10_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":78,"safetylevelId":null,"proposalId":10,"name":"g51d10_37","acronym":"g51d10_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":82,"safetylevelId":null,"proposalId":10,"name":"g51d10_45","acronym":"g51d10_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":92,"safetylevelId":null,"proposalId":10,"name":"g51d137_dgas","acronym":"g51d137_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":74,"safetylevelId":null,"proposalId":10,"name":"g51d1_25","acronym":"g51d1_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":77,"safetylevelId":null,"proposalId":10,"name":"g51d1_37","acronym":"g51d1_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":80,"safetylevelId":null,"proposalId":10,"name":"g51d1_45","acronym":"g51d1_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":97,"safetylevelId":null,"proposalId":10,"name":"g51d537_dgas","acronym":"g51d537_dgas","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":75,"safetylevelId":null,"proposalId":10,"name":"g51d5_25","acronym":"g51d5_25","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":79,"safetylevelId":null,"proposalId":10,"name":"g51d5_37","acronym":"g51d5_37","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":81,"safetylevelId":null,"proposalId":10,"name":"g51d5_45","acronym":"g51d5_45","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":635,"safetylevelId":null,"proposalId":10,"name":"h20","acronym":"h20","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":634,"safetylevelId":null,"proposalId":10,"name":"h2o","acronym":"h2o","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":479,"safetylevelId":null,"proposalId":10,"name":"lysozyme","acronym":"lysozyme","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":482,"safetylevelId":null,"proposalId":10,"name":"lyzo","acronym":"lyzo","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":636,"safetylevelId":null,"proposalId":10,"name":"p38","acronym":"p38","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":637,"safetylevelId":null,"proposalId":10,"name":"p38GRA24","acronym":"p38GRA24","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4780,"safetylevelId":null,"proposalId":10,"name":"prot1","acronym":"prot1","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4781,"safetylevelId":null,"proposalId":10,"name":"prot2","acronym":"prot2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4782,"safetylevelId":null,"proposalId":10,"name":"prot3","acronym":"prot3","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":648,"safetylevelId":null,"proposalId":10,"name":"sA","acronym":"sA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":24,"safetylevelId":null,"proposalId":10,"name":"syn_wt","acronym":"syn_wt","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":218,"safetylevelId":null,"proposalId":10,"name":"tRNA","acronym":"tRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4390,"safetylevelId":null,"proposalId":10,"name":"test","acronym":"test","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":632,"safetylevelId":null,"proposalId":10,"name":"wat","acronym":"wat","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":633,"safetylevelId":null,"proposalId":10,"name":"wat2","acronym":"wat2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]}],"stockSolutions":[{"stockSolutionId":1,"proposalId":10,"macromoleculeId":640,"bufferId":420,"instructionSet3VO":null,"boxId":null,"storageTemperature":"","volume":"300","concentration":"1.4","comments":"test","name":"ACRO","samples":[]},{"stockSolutionId":2,"proposalId":10,"macromoleculeId":643,"bufferId":422,"instructionSet3VO":null,"boxId":null,"storageTemperature":"20","volume":"40","concentration":"50","comments":"","name":"ST_A_B1","samples":[]},{"stockSolutionId":3,"proposalId":10,"macromoleculeId":null,"bufferId":422,"instructionSet3VO":null,"boxId":null,"storageTemperature":"","volume":"80","concentration":"5","comments":"","name":"ST_B1","samples":[]},{"stockSolutionId":4,"proposalId":10,"macromoleculeId":643,"bufferId":422,"instructionSet3VO":null,"boxId":null,"storageTemperature":"","volume":"120","concentration":"40","comments":"","name":"ST_A_B1","samples":[]},{"stockSolutionId":5,"proposalId":10,"macromoleculeId":643,"bufferId":422,"instructionSet3VO":null,"boxId":null,"storageTemperature":"","volume":"120","concentration":"45","comments":"","name":"ST_A_B1","samples":[]},{"stockSolutionId":6,"proposalId":10,"macromoleculeId":643,"bufferId":422,"instructionSet3VO":null,"boxId":null,"storageTemperature":"","volume":"120","concentration":"12","comments":"","name":"ST_A_B1","samples":[]},{"stockSolutionId":7,"proposalId":10,"macromoleculeId":643,"bufferId":422,"instructionSet3VO":null,"boxId":null,"storageTemperature":"","volume":"120","concentration":"56","comments":"","name":"ST_A_B1","samples":[]}]};
		},
		getProposal_3367 : function(){
			return {"plateTypes":[{"plateTypeId":4,"name":"96 Well plate","description":null,"rowCount":8,"columnCount":12,"shape":"REC"},{"plateTypeId":3,"name":"Disk Well plate","description":null,"rowCount":8,"columnCount":2,"shape":"CIR"},{"plateTypeId":2,"name":" 4 x ( 8 + 3 ) Block","description":null,"rowCount":4,"columnCount":11,"shape":"REC"},{"plateTypeId":1,"name":"Deep Well","description":null,"rowCount":8,"columnCount":12,"shape":"REC"}],"assemblies":[],"sessions":[{"sessionId":35357,"expSessionPk":49239,"projectCode":null,"startDate":"2013 12 09","endDate":"2013 12 11","beamlineName":"BM29","scheduled":1,"nbShifts":3,"comments":null,"beamlineOperator":"MCCARTHY  A","usedFlag":null,"sessionTitle":null,"structureDeterminations":null,"dewarTransport":null,"databackupFrance":null,"databackupEurope":null,"visit_number":null,"operatorSiteNumber":"98693","timeStamp":"2013 09 20"},{"sessionId":34962,"expSessionPk":48811,"projectCode":null,"startDate":"2013 09 25","endDate":"2013 09 27","beamlineName":"BM29","scheduled":1,"nbShifts":3,"comments":null,"beamlineOperator":"ROUND  A","usedFlag":null,"sessionTitle":null,"structureDeterminations":null,"dewarTransport":null,"databackupFrance":null,"databackupEurope":null,"visit_number":null,"operatorSiteNumber":"140374","timeStamp":"2013 08 09"}],"labcontacts":[],"buffers":[{"bufferId":810,"proposalId":3367,"safetyLevelId":null,"name":"bwater","acronym":"bwater","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":811,"proposalId":3367,"safetyLevelId":null,"name":"bbsa","acronym":"bbsa","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":812,"proposalId":3367,"safetyLevelId":null,"name":"buffer miriam","acronym":"buffer miriam","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":813,"proposalId":3367,"safetyLevelId":null,"name":"NDSB_EDTA","acronym":"NDSB_EDTA","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":814,"proposalId":3367,"safetyLevelId":null,"name":"NDSB","acronym":"NDSB","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":815,"proposalId":3367,"safetyLevelId":null,"name":"classic","acronym":"classic","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":816,"proposalId":3367,"safetyLevelId":null,"name":"bmc158","acronym":"bmc158","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":817,"proposalId":3367,"safetyLevelId":null,"name":"bmc91","acronym":"bmc91","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":818,"proposalId":3367,"safetyLevelId":null,"name":"bbmp2","acronym":"bbmp2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":819,"proposalId":3367,"safetyLevelId":null,"name":"bmc64","acronym":"bmc64","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":820,"proposalId":3367,"safetyLevelId":null,"name":"classic_1MGdmCl","acronym":"classic_1MGdmCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":821,"proposalId":3367,"safetyLevelId":null,"name":"classic_3MGdmCl","acronym":"classic_3MGdmCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":822,"proposalId":3367,"safetyLevelId":null,"name":"classic_2MGdmCl","acronym":"classic_2MGdmCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":823,"proposalId":3367,"safetyLevelId":null,"name":"brgmbmp","acronym":"brgmbmp","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":824,"proposalId":3367,"safetyLevelId":null,"name":"brgmneo","acronym":"brgmneo","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":825,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB","acronym":"half_NDSB","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":826,"proposalId":3367,"safetyLevelId":null,"name":"brgmneobmp","acronym":"brgmneobmp","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":827,"proposalId":3367,"safetyLevelId":null,"name":"half_classic","acronym":"half_classic","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":828,"proposalId":3367,"safetyLevelId":null,"name":"quarter_NDSB","acronym":"quarter_NDSB","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":829,"proposalId":3367,"safetyLevelId":null,"name":"classic_EDTA","acronym":"classic_EDTA","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":830,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB_EDTA","acronym":"half_NDSB_EDTA","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":831,"proposalId":3367,"safetyLevelId":null,"name":"brgmneobmp1","acronym":"brgmneobmp1","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":832,"proposalId":3367,"safetyLevelId":null,"name":"brgmneobmp2","acronym":"brgmneobmp2","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":833,"proposalId":3367,"safetyLevelId":null,"name":"hepes","acronym":"hepes","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":834,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB_2MGdmCl","acronym":"half_NDSB_2MGdmCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":835,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB_1MGdmCl","acronym":"half_NDSB_1MGdmCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":836,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB_lowTris","acronym":"half_NDSB_lowTris","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":837,"proposalId":3367,"safetyLevelId":null,"name":"H2O","acronym":"H2O","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":838,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB_225NaCl","acronym":"half_NDSB_225NaCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null},{"bufferId":839,"proposalId":3367,"safetyLevelId":null,"name":"half_NDSB_3MGdmCl","acronym":"half_NDSB_3MGdmCl","ph":null,"composition":null,"bufferhasadditive3VOs":[],"comments":null}],"shippings":[],"macromolecules":[{"macromoleculeId":4980,"safetylevelId":null,"proposalId":3367,"name":"PlexA2","acronym":"PlexA2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Plexin-A2","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4981,"safetylevelId":null,"proposalId":3367,"name":"PUVGP","acronym":"PUVGP","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Puumula virus attachment glycoprotein","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4982,"safetylevelId":null,"proposalId":3367,"name":"CBLN1","acronym":"CBLN1","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Cerebellin","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4983,"safetylevelId":null,"proposalId":3367,"name":"BVDVE","acronym":"BVDVE","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Bovine Diarrhoea Virus E protein","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4984,"safetylevelId":null,"proposalId":3367,"name":"FGF","acronym":"FGF","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"FGF-FGFR complexes","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4985,"safetylevelId":null,"proposalId":3367,"name":"NRP1","acronym":"NRP1","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Mouse Neuropilin 1","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4986,"safetylevelId":null,"proposalId":3367,"name":"CID","acronym":"CID","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Poly-uridylylation polymerase","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4987,"safetylevelId":null,"proposalId":3367,"name":"3P","acronym":"3P","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Recombinant Flu virus polymerase","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4988,"safetylevelId":null,"proposalId":3367,"name":"HepE","acronym":"HepE","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Hepatitis E Antigen","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4989,"safetylevelId":null,"proposalId":3367,"name":"mHMPV","acronym":"mHMPV","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Matrix protein of HMPV","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4990,"safetylevelId":null,"proposalId":3367,"name":"NP2PTX","acronym":"NP2PTX","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Neuronal pentraxin 2","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":4991,"safetylevelId":null,"proposalId":3367,"name":"LRP6","acronym":"LRP6","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Low-density lipoprotein receptor-related protein 6","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5255,"safetylevelId":null,"proposalId":3367,"name":"pHMPV","acronym":"pHMPV","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Phospho protein of HMPV","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5256,"safetylevelId":null,"proposalId":3367,"name":"hNEO","acronym":"hNEO","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Human Neogenin 1","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5257,"safetylevelId":null,"proposalId":3367,"name":"RGMB","acronym":"RGMB","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"Human RGMB","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5258,"safetylevelId":null,"proposalId":3367,"name":"M2HMPV","acronym":"M2HMPV","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":"M2-1 protein of HMPV","macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5936,"safetylevelId":null,"proposalId":3367,"name":"WATER","acronym":"WATER","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5937,"safetylevelId":null,"proposalId":3367,"name":"BSA","acronym":"BSA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5938,"safetylevelId":null,"proposalId":3367,"name":"Miriams_protein","acronym":"Miriams_protein","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5939,"safetylevelId":null,"proposalId":3367,"name":"M21","acronym":"M21","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5940,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237","acronym":"M21_P135_237","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5941,"safetylevelId":null,"proposalId":3367,"name":"P135_237","acronym":"P135_237","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5942,"safetylevelId":null,"proposalId":3367,"name":"BMP2","acronym":"BMP2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5943,"safetylevelId":null,"proposalId":3367,"name":"MC158","acronym":"MC158","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5944,"safetylevelId":null,"proposalId":3367,"name":"MC91","acronym":"MC91","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5945,"safetylevelId":null,"proposalId":3367,"name":"MC64","acronym":"MC64","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5946,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237RNA","acronym":"M21_P135_237RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5947,"safetylevelId":null,"proposalId":3367,"name":"P135_237_2MGdmCl","acronym":"P135_237_2MGdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5948,"safetylevelId":null,"proposalId":3367,"name":"P135_237_1MGdmCl","acronym":"P135_237_1MGdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5949,"safetylevelId":null,"proposalId":3367,"name":"P135_237_0GdmCl","acronym":"P135_237_0GdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5950,"safetylevelId":null,"proposalId":3367,"name":"P135_237_3MGdmCl","acronym":"P135_237_3MGdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5951,"safetylevelId":null,"proposalId":3367,"name":"RGMNEO","acronym":"RGMNEO","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5952,"safetylevelId":null,"proposalId":3367,"name":"RGMBMP","acronym":"RGMBMP","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5953,"safetylevelId":null,"proposalId":3367,"name":"M21_1RNA","acronym":"M21_1RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5954,"safetylevelId":null,"proposalId":3367,"name":"M21_40RNA","acronym":"M21_40RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5955,"safetylevelId":null,"proposalId":3367,"name":"M21_20RNA","acronym":"M21_20RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5956,"safetylevelId":null,"proposalId":3367,"name":"M21_80RNA","acronym":"M21_80RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5957,"safetylevelId":null,"proposalId":3367,"name":"M21_noRNA","acronym":"M21_noRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5958,"safetylevelId":null,"proposalId":3367,"name":"M21_10RNA","acronym":"M21_10RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5959,"safetylevelId":null,"proposalId":3367,"name":"M21_5RNA","acronym":"M21_5RNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5960,"safetylevelId":null,"proposalId":3367,"name":"FGMBMP","acronym":"FGMBMP","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5961,"safetylevelId":null,"proposalId":3367,"name":"RGMNEOBMP","acronym":"RGMNEOBMP","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5962,"safetylevelId":null,"proposalId":3367,"name":"M21_5RNA_EDTA","acronym":"M21_5RNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5963,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_5RNA_5EDTA","acronym":"M21_P135_237_5RNA_5EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5964,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_1RNA_5EDTA","acronym":"M21_P135_237_1RNA_5EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5965,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_noRNA","acronym":"M21_P135_237_noRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5966,"safetylevelId":null,"proposalId":3367,"name":"M21_1RNA_EDTA","acronym":"M21_1RNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5967,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_noRNA_5EDTA","acronym":"M21_P135_237_noRNA_5EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5968,"safetylevelId":null,"proposalId":3367,"name":"M21_10RNA_EDTA","acronym":"M21_10RNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5969,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_2p5RNA_5EDTA","acronym":"M21_P135_237_2p5RNA_5EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5970,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_5RNA_10EDTA","acronym":"M21_P135_237_5RNA_10EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5971,"safetylevelId":null,"proposalId":3367,"name":"M21_2p5RNA_EDTA","acronym":"M21_2p5RNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5972,"safetylevelId":null,"proposalId":3367,"name":"M21_noRNA_EDTA","acronym":"M21_noRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5973,"safetylevelId":null,"proposalId":3367,"name":"M21_5LRNA_EDTA","acronym":"M21_5LRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5974,"safetylevelId":null,"proposalId":3367,"name":"M21_10LRNA_EDTA","acronym":"M21_10LRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5975,"safetylevelId":null,"proposalId":3367,"name":"M21_noLRNA_EDTA","acronym":"M21_noLRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5976,"safetylevelId":null,"proposalId":3367,"name":"M21_1LRNA_EDTA","acronym":"M21_1LRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5977,"safetylevelId":null,"proposalId":3367,"name":"M21_2p5LRNA_EDTA","acronym":"M21_2p5LRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5978,"safetylevelId":null,"proposalId":3367,"name":"M21_20LRNA_EDTA","acronym":"M21_20LRNA_EDTA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5979,"safetylevelId":null,"proposalId":3367,"name":"M21_noLRNA","acronym":"M21_noLRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5980,"safetylevelId":null,"proposalId":3367,"name":"M21_5LRNA","acronym":"M21_5LRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5981,"safetylevelId":null,"proposalId":3367,"name":"M21_2p5LRNA","acronym":"M21_2p5LRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5982,"safetylevelId":null,"proposalId":3367,"name":"M21_10LRNA","acronym":"M21_10LRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5983,"safetylevelId":null,"proposalId":3367,"name":"M21_1LRNA","acronym":"M21_1LRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5984,"safetylevelId":null,"proposalId":3367,"name":"M21_20LRNA","acronym":"M21_20LRNA","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5985,"safetylevelId":null,"proposalId":3367,"name":"M21_1MGdmCl","acronym":"M21_1MGdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5986,"safetylevelId":null,"proposalId":3367,"name":"M21_0GdmCl","acronym":"M21_0GdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5987,"safetylevelId":null,"proposalId":3367,"name":"M21_2MGdmCl","acronym":"M21_2MGdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5988,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_500NDSB_225NaCl","acronym":"M21_P135_237_500NDSB_225NaCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5989,"safetylevelId":null,"proposalId":3367,"name":"L_RNA_0p33mM","acronym":"L_RNA_0p33mM","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5990,"safetylevelId":null,"proposalId":3367,"name":"M21_3MGdmCl","acronym":"M21_3MGdmCl","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5991,"safetylevelId":null,"proposalId":3367,"name":"M21_P135_237_500NDSB_lowTris","acronym":"M21_P135_237_500NDSB_lowTris","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},{"macromoleculeId":5992,"safetylevelId":null,"proposalId":3367,"name":"GE_RNA_1mM","acronym":"GE_RNA_1mM","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]}],"stockSolutions":[]};
		},
		getExperimentList_10 : function(){
			return [{"sourceFilePath":"/data/pyarch/bm29/opd29/224/syn_mutdeg_45.xml","experimentId":225,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":11,"measurementAveragedCount":32,"measurementDoneCount":32,"dataAcquisitionFilePath":null,"specimenCount":21,"creationDate":"Apr 14, 2013 4:28:52 PM","name":"syn_mutdeg_45.xml","measurementCount":32,"dataCollectionCount":11,"macromolecules":"e46k537_dgas, e46k1037_dgas, e46k137_dgas, g51d537_dgas, g51d137_dgas, a30p137_dgas, g51d1037_dgas, a30p537_dgas, a53t1037_dgas, a53t537_dgas, a53t137_dgas","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/321/ISPyB test.xml","experimentId":321,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Apr 23, 2013 1:08:52 PM","name":"ISPyB test.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/365/Water.xml","experimentId":365,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Apr 27, 2013 9:33:24 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/377/DNase1-digest.xml","experimentId":377,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":5,"measurementAveragedCount":11,"measurementDoneCount":11,"dataAcquisitionFilePath":null,"specimenCount":6,"creationDate":"Apr 27, 2013 4:46:06 PM","name":"DNase1-digest.xml","measurementCount":11,"dataCollectionCount":5,"macromolecules":"tRNA","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/468/Water.xml","experimentId":468,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 4, 2013 9:44:57 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/542/Water.xml","experimentId":542,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 8:04:27 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/543/water.xml","experimentId":543,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 9:11:06 AM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/544/groupb.xml","experimentId":544,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":19,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 8, 2013 10:01:09 AM","name":"groupb.xml","measurementCount":19,"dataCollectionCount":9,"macromolecules":"BSAlyso, bsa, lysozyme","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/545/water.xml","experimentId":545,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 11:37:19 AM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/546/check.xml","experimentId":546,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":19,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 8, 2013 12:17:59 PM","name":"check.xml","measurementCount":19,"dataCollectionCount":9,"macromolecules":"MIX, bsa, lysozyme","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/547/check.xml","experimentId":547,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":19,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 8, 2013 3:16:30 PM","name":"check.xml","measurementCount":19,"dataCollectionCount":9,"macromolecules":"MIX, bsa, lysozyme","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/548/water.xml","experimentId":548,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 5:32:21 PM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/549/water.xml","experimentId":549,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 5:36:32 PM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/550/water.xml","experimentId":550,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":2,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 5:37:34 PM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/551/water.xml","experimentId":551,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 8, 2013 5:43:11 PM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/552/mix.xml","experimentId":552,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":19,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 8, 2013 5:54:44 PM","name":"mix.xml","measurementCount":19,"dataCollectionCount":9,"macromolecules":"MIX, bsa, lyzo","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/553/H2O.xml","experimentId":553,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 9, 2013 9:32:56 AM","name":"H2O.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/554/H2O.xml","experimentId":554,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 9, 2013 9:40:00 AM","name":"H2O.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/660/wait.xml","experimentId":660,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 12:41:30 PM","name":"wait.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"wat","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/661/wait.xml","experimentId":661,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 12:44:27 PM","name":"wait.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"wat","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/662/wait.xml","experimentId":662,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 12:51:23 PM","name":"wait.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"wat","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/663/wait.xml","experimentId":663,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 1:10:16 PM","name":"wait.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"wat","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/664/wait.xml","experimentId":664,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 1:10:33 PM","name":"wait.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"wat","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/665/temp.xml","experimentId":665,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 1:37:15 PM","name":"temp.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Unkown","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/666/temp.xml","experimentId":666,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 1:40:45 PM","name":"temp.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Unkown","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/667/temp.xml","experimentId":667,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 14, 2013 2:37:36 PM","name":"temp.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"Unkown","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/668/ttte.xml","experimentId":668,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"May 14, 2013 2:46:54 PM","name":"ttte.xml","measurementCount":12,"dataCollectionCount":4,"macromolecules":"h2o","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/669/Water.xml","experimentId":669,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 1:18:57 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/670/Water.xml","experimentId":670,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 1:31:27 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/671/bsa.xml","experimentId":671,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 1:41:22 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/672/bsa.xml","experimentId":672,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 1:50:24 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/673/bsa.xml","experimentId":673,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 2:24:09 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/674/bsa.xml","experimentId":674,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 2:58:57 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/675/bsatest.xml","experimentId":675,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":10,"measurementAveragedCount":21,"measurementDoneCount":21,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 3:18:52 PM","name":"bsatest.xml","measurementCount":21,"dataCollectionCount":10,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/676/bsatest2.xml","experimentId":676,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":10,"measurementAveragedCount":21,"measurementDoneCount":21,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 4:04:12 PM","name":"bsatest2.xml","measurementCount":21,"dataCollectionCount":10,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/677/bsatest3.xml","experimentId":677,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":17,"measurementAveragedCount":28,"measurementDoneCount":21,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 15, 2013 5:20:44 PM","name":"bsatest3.xml","measurementCount":21,"dataCollectionCount":10,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/678/Water.xml","experimentId":678,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 17, 2013 8:46:47 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/679/Water.xml","experimentId":679,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 17, 2013 8:48:37 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/680/Water.xml","experimentId":680,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 17, 2013 8:49:39 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/681/Water.xml","experimentId":681,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 17, 2013 8:54:30 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/682/BSA.xml","experimentId":682,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 17, 2013 9:09:15 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/683/p38.xml","experimentId":683,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":19,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 17, 2013 10:25:20 AM","name":"p38.xml","measurementCount":19,"dataCollectionCount":9,"macromolecules":"p38","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/684/p38.xml","experimentId":684,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"May 17, 2013 11:32:09 AM","name":"p38.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"p38","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/685/p38.xml","experimentId":685,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":4,"creationDate":"May 17, 2013 11:49:51 AM","name":"p38.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"p38GRA24","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/686/p38.xml","experimentId":686,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":3,"measurementAveragedCount":7,"measurementDoneCount":7,"dataAcquisitionFilePath":null,"specimenCount":4,"creationDate":"May 17, 2013 11:54:14 AM","name":"p38.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"p38GRA24","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/687/Water.xml","experimentId":687,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 21, 2013 4:52:09 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/688/BSA.xml","experimentId":688,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"May 21, 2013 5:28:30 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/689/C3.xml","experimentId":689,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":19,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 21, 2013 5:48:55 PM","name":"C3.xml","measurementCount":19,"dataCollectionCount":9,"macromolecules":"C3_C3, C1_C3, C2_iC3b","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/690/cA cE.xml","experimentId":690,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":6,"measurementAveragedCount":13,"measurementDoneCount":13,"dataAcquisitionFilePath":null,"specimenCount":7,"creationDate":"May 21, 2013 6:34:45 PM","name":"cA cE.xml","measurementCount":13,"dataCollectionCount":6,"macromolecules":"cA, cE","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/691/cA cE.xml","experimentId":691,"experimentType":"STATIC","status":null,"dataCollectionDoneCount":9,"measurementAveragedCount":19,"measurementDoneCount":18,"dataAcquisitionFilePath":null,"specimenCount":10,"creationDate":"May 21, 2013 7:22:25 PM","name":"cA cE.xml","measurementCount":18,"dataCollectionCount":8,"macromolecules":"L, A","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/692/BSA.xml","experimentId":692,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/692/692.zip","specimenCount":2,"creationDate":"Jun 3, 2013 10:20:14 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/693/Water.xml","experimentId":693,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jun 5, 2013 9:29:31 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/694/Water.xml","experimentId":694,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/694/694.zip","specimenCount":2,"creationDate":"Jun 5, 2013 9:31:45 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/695/Water.xml","experimentId":695,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/695/695.zip","specimenCount":2,"creationDate":"Jun 5, 2013 9:39:38 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/696/BSA.xml","experimentId":696,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/696/696.zip","specimenCount":2,"creationDate":"Jun 5, 2013 9:52:31 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/697/C.xml","experimentId":697,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":11,"measurementAveragedCount":24,"measurementDoneCount":24,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/697/697.zip","specimenCount":13,"creationDate":"Jun 5, 2013 12:22:57 PM","name":"C.xml","measurementCount":24,"dataCollectionCount":11,"macromolecules":"cA, cE, C3, C2, C1","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/698/sA.xml","experimentId":698,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":14,"creationDate":"Jun 5, 2013 2:21:48 PM","name":"sA.xml","measurementCount":21,"dataCollectionCount":7,"macromolecules":"sA","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/699/sA.xml","experimentId":699,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":7,"measurementAveragedCount":21,"measurementDoneCount":21,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/699/699.zip","specimenCount":14,"creationDate":"Jun 5, 2013 2:24:42 PM","name":"sA.xml","measurementCount":21,"dataCollectionCount":7,"macromolecules":"sA","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/700/Land L9.xml","experimentId":700,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":8,"measurementAveragedCount":17,"measurementDoneCount":17,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/700/700.zip","specimenCount":9,"creationDate":"Jun 5, 2013 3:30:30 PM","name":"Land L9.xml","measurementCount":17,"dataCollectionCount":8,"macromolecules":"L, L9","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/706/Land L9 PLUS rna.xml","experimentId":706,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":24,"measurementAveragedCount":51,"measurementDoneCount":51,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/706/706.zip","specimenCount":27,"creationDate":"Jun 6, 2013 4:00:05 PM","name":"Land L9 PLUS rna.xml","measurementCount":51,"dataCollectionCount":24,"macromolecules":"L9_3RNA, L9_5RNA, L9_ADD, L_ADD, L_3RNA, L_5RNA","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/850/BSA.xml","experimentId":850,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jun 18, 2013 5:17:34 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/851/BSA.xml","experimentId":851,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/851/851.zip","specimenCount":2,"creationDate":"Jun 18, 2013 5:20:45 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/854/BSA.xml","experimentId":854,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jun 20, 2013 2:20:24 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/855/BSA.xml","experimentId":855,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/855/855.zip","specimenCount":2,"creationDate":"Jun 20, 2013 2:24:13 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/856/H20.xml","experimentId":856,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/856/856.zip","specimenCount":2,"creationDate":"Jun 20, 2013 5:57:00 PM","name":"H20.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/857/pool1.xml","experimentId":857,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":3,"measurementAveragedCount":7,"measurementDoneCount":7,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/857/857.zip","specimenCount":4,"creationDate":"Jun 20, 2013 6:22:30 PM","name":"pool1.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"TcCRT_281","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/858/pool2.xml","experimentId":858,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":3,"measurementAveragedCount":7,"measurementDoneCount":7,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/858/858.zip","specimenCount":4,"creationDate":"Jun 20, 2013 6:40:18 PM","name":"pool2.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"TcCRT_281_2","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/859/3modules.xml","experimentId":859,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":3,"measurementAveragedCount":7,"measurementDoneCount":7,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/859/859.zip","specimenCount":4,"creationDate":"Jun 20, 2013 7:18:06 PM","name":"3modules.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"cr1_3mod","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/860/2modules.xml","experimentId":860,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/860/860.zip","specimenCount":3,"creationDate":"Jun 20, 2013 7:33:33 PM","name":"2modules.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"cr1_2mod","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/861/pool2-bis.xml","experimentId":861,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/861/861.zip","specimenCount":2,"creationDate":"Jun 20, 2013 7:53:29 PM","name":"pool2-bis.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"TcCRT_281_2","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/862/3modules-bis.xml","experimentId":862,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/862/862.zip","specimenCount":2,"creationDate":"Jun 20, 2013 8:10:29 PM","name":"3modules-bis.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"cr1_3mod","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/866/Water.xml","experimentId":866,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/866/866.zip","specimenCount":2,"creationDate":"Jun 21, 2013 1:47:29 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/867/Water.xml","experimentId":867,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/867/867.zip","specimenCount":2,"creationDate":"Jun 21, 2013 2:00:28 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/868/BSA.xml","experimentId":868,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/868/868.zip","specimenCount":2,"creationDate":"Jun 21, 2013 2:08:15 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/869/BSA.xml","experimentId":869,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":6,"measurementAveragedCount":13,"measurementDoneCount":13,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/869/869.zip","specimenCount":7,"creationDate":"Jun 21, 2013 2:21:37 PM","name":"BSA.xml","measurementCount":13,"dataCollectionCount":6,"macromolecules":"p38","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/888/water.xml","experimentId":888,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/888/888.zip","specimenCount":2,"creationDate":"Jun 23, 2013 8:40:20 PM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/959/BSA.xml","experimentId":959,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/959/959.zip","specimenCount":2,"creationDate":"Jul 1, 2013 7:21:41 PM","name":"BSA.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1048/BSA.xml","experimentId":1048,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1048/1048.zip","specimenCount":3,"creationDate":"Jul 9, 2013 3:53:14 PM","name":"BSA.xml","measurementCount":6,"dataCollectionCount":2,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1049/BSA.xml","experimentId":1049,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1049/1049.zip","specimenCount":3,"creationDate":"Jul 9, 2013 5:21:33 PM","name":"BSA.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1050/FHinSC_modified.xml","experimentId":1050,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 9, 2013 7:06:03 PM","name":"FHinSC_modified.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"cr1_3mod","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1051/FHinSC_modified.xml","experimentId":1051,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1051/1051.zip","specimenCount":2,"creationDate":"Jul 9, 2013 7:06:31 PM","name":"FHinSC_modified.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"cr1_3mod","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1052/FHinSC_modified.xml","experimentId":1052,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1052/1052.zip","specimenCount":2,"creationDate":"Jul 9, 2013 7:13:47 PM","name":"FHinSC_modified.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"cr1_3mod","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1053/bsa_lys_table.xml","experimentId":1053,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":2,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"Jul 9, 2013 7:18:57 PM","name":"bsa_lys_table.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1054/bsa_lys_table.xml","experimentId":1054,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":6,"creationDate":"Jul 9, 2013 7:23:15 PM","name":"bsa_lys_table.xml","measurementCount":13,"dataCollectionCount":5,"macromolecules":"tRNA","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1055/bsa_lys_table.xml","experimentId":1055,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":5,"measurementAveragedCount":11,"measurementDoneCount":11,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1055/1055.zip","specimenCount":6,"creationDate":"Jul 9, 2013 7:26:17 PM","name":"bsa_lys_table.xml","measurementCount":13,"dataCollectionCount":5,"macromolecules":"tRNA","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":null,"experimentId":1056,"experimentType":"TEMPLATE","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"Jul 10, 2013 10:26:05 AM","name":"Template Test from ISPyB","measurementCount":9,"dataCollectionCount":3,"macromolecules":"A","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1058/BSA.xml","experimentId":1058,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 10, 2013 2:37:10 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1059/BSA.xml","experimentId":1059,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 10, 2013 2:41:21 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1060/BSA.xml","experimentId":1060,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1060/1060.zip","specimenCount":2,"creationDate":"Jul 10, 2013 2:44:24 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1061/Water.xml","experimentId":1061,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1061/1061.zip","specimenCount":2,"creationDate":"Jul 10, 2013 6:10:21 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1066/ccp242526_DTT.xml","experimentId":1066,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":3,"measurementAveragedCount":7,"measurementDoneCount":7,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1066/1066.zip","specimenCount":4,"creationDate":"Jul 10, 2013 10:45:18 PM","name":"ccp242526_DTT.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"ccp242526","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1067/ccp2425_DTT.xml","experimentId":1067,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":4,"measurementAveragedCount":9,"measurementDoneCount":9,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1067/1067.zip","specimenCount":5,"creationDate":"Jul 10, 2013 11:29:30 PM","name":"ccp2425_DTT.xml","measurementCount":9,"dataCollectionCount":4,"macromolecules":"ccp2425","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1068/ccp2526_DTT.xml","experimentId":1068,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":3,"measurementAveragedCount":7,"measurementDoneCount":7,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1068/1068.zip","specimenCount":4,"creationDate":"Jul 11, 2013 12:15:33 AM","name":"ccp2526_DTT.xml","measurementCount":7,"dataCollectionCount":3,"macromolecules":"ccp2526","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1069/Water.xml","experimentId":1069,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 11, 2013 8:33:30 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1070/Water.xml","experimentId":1070,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1070/1070.zip","specimenCount":2,"creationDate":"Jul 11, 2013 8:40:19 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":null,"experimentId":1076,"experimentType":"TEMPLATE","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":25,"creationDate":"Jul 11, 2013 2:03:05 PM","name":"dodo","measurementCount":60,"dataCollectionCount":21,"macromolecules":"a30p5_37, GMPK, a30p1_37, e46k1_45","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":null,"experimentId":1079,"experimentType":"TEMPLATE","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":7,"creationDate":"Jul 11, 2013 2:58:39 PM","name":"demonstration","measurementCount":25,"dataCollectionCount":11,"macromolecules":"bsa, BSAlyso","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":null,"experimentId":1080,"experimentType":"TEMPLATE","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":4,"creationDate":"Jul 11, 2013 3:03:21 PM","name":"test","measurementCount":19,"dataCollectionCount":9,"macromolecules":"BSAlyso","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":null,"experimentId":1116,"experimentType":"TEMPLATE","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"Jul 16, 2013 10:19:43 AM","name":"lyso","measurementCount":6,"dataCollectionCount":2,"macromolecules":"A, C1","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1117/BSA.xml","experimentId":1117,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 16, 2013 3:42:53 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1118/BSA.xml","experimentId":1118,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1118/1118.zip","specimenCount":2,"creationDate":"Jul 16, 2013 3:47:14 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1119/BSA.xml","experimentId":1119,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":null,"specimenCount":7,"creationDate":"Jul 16, 2013 3:53:58 PM","name":"BSA.xml","measurementCount":16,"dataCollectionCount":6,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1120/test.xml","experimentId":1120,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"Jul 16, 2013 4:52:50 PM","name":"test.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1121/test.xml","experimentId":1121,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1121/1121.zip","specimenCount":2,"creationDate":"Jul 16, 2013 4:55:27 PM","name":"test.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1122/test1.xml","experimentId":1122,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1122/1122.zip","specimenCount":2,"creationDate":"Jul 16, 2013 5:38:50 PM","name":"test1.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1123/test1.xml","experimentId":1123,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 16, 2013 5:45:24 PM","name":"test1.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1124/test1.xml","experimentId":1124,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1124/1124.zip","specimenCount":2,"creationDate":"Jul 16, 2013 5:49:09 PM","name":"test1.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1125/test1.xml","experimentId":1125,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 16, 2013 6:02:59 PM","name":"test1.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1126/test1.xml","experimentId":1126,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 16, 2013 6:08:56 PM","name":"test1.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1127/test1.xml","experimentId":1127,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 16, 2013 6:15:03 PM","name":"test1.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1128/test1.xml","experimentId":1128,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1128/1128.zip","specimenCount":2,"creationDate":"Jul 16, 2013 6:19:35 PM","name":"test1.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"test","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1129/Water.xml","experimentId":1129,"experimentType":"CALIBRATION","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 17, 2013 11:44:58 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1130/Water.xml","experimentId":1130,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1130/1130.zip","specimenCount":2,"creationDate":"Jul 17, 2013 11:55:23 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1131/Water.xml","experimentId":1131,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1131/1131.zip","specimenCount":2,"creationDate":"Jul 17, 2013 12:16:56 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1132/Water.xml","experimentId":1132,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1132/1132.zip","specimenCount":2,"creationDate":"Jul 17, 2013 1:18:13 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1133/bsa.xml","experimentId":1133,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1133/1133.zip","specimenCount":2,"creationDate":"Jul 17, 2013 1:44:57 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1134/Br cx43.xml","experimentId":1134,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":10,"measurementAveragedCount":22,"measurementDoneCount":22,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1134/1134.zip","specimenCount":12,"creationDate":"Jul 17, 2013 3:08:39 PM","name":"Br cx43.xml","measurementCount":22,"dataCollectionCount":10,"macromolecules":"bR_1, cx43_1, cx43_2, cx43_3, bR_5, cx43_4, bR_4, cx43_5, bR_3, bR_2","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1135/MG386.xml","experimentId":1135,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":6,"measurementAveragedCount":14,"measurementDoneCount":14,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1135/1135.zip","specimenCount":8,"creationDate":"Jul 17, 2013 4:28:39 PM","name":"MG386.xml","measurementCount":14,"dataCollectionCount":6,"macromolecules":"MG386, MG386sh","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1136/MG386_2.xml","experimentId":1136,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"Jul 17, 2013 5:05:50 PM","name":"MG386_2.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"MG386","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1137/MG386_2.xml","experimentId":1137,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1137/1137.zip","specimenCount":3,"creationDate":"Jul 17, 2013 5:08:37 PM","name":"MG386_2.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"MG386","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1141/BSA.xml","experimentId":1141,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 19, 2013 10:16:39 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1177/robot.xml","experimentId":1177,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":0,"measurementAveragedCount":4,"measurementDoneCount":4,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1177/1177.zip","specimenCount":3,"creationDate":"Jul 23, 2013 6:11:44 PM","name":"robot.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"A, C1","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1178/robot.xml","experimentId":1178,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":2,"measurementAveragedCount":5,"measurementDoneCount":5,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1178/1178.zip","specimenCount":3,"creationDate":"Jul 23, 2013 6:19:47 PM","name":"robot.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"A, C1","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1179/Water.xml","experimentId":1179,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1179/1179.zip","specimenCount":2,"creationDate":"Jul 24, 2013 7:45:09 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1180/bsa.xml","experimentId":1180,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1180/1180.zip","specimenCount":2,"creationDate":"Jul 24, 2013 7:57:15 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1181/bsa.xml","experimentId":1181,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 24, 2013 8:26:02 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1185/sc.xml","experimentId":1185,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":12,"creationDate":"Jul 25, 2013 8:30:36 AM","name":"sc.xml","measurementCount":23,"dataCollectionCount":11,"macromolecules":"prot3, prot2, prot1","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1186/sc.xml","experimentId":1186,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1186/1186.zip","specimenCount":0,"creationDate":"Jul 25, 2013 8:41:45 AM","name":"sc.xml","measurementCount":0,"dataCollectionCount":0,"macromolecules":null,"proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1187/sc.xml","experimentId":1187,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1187/1187.zip","specimenCount":2,"creationDate":"Jul 25, 2013 8:51:01 AM","name":"sc.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1188/Water.xml","experimentId":1188,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1188/1188.zip","specimenCount":2,"creationDate":"Jul 25, 2013 9:06:12 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1189/Water.xml","experimentId":1189,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1189/1189.zip","specimenCount":2,"creationDate":"Jul 25, 2013 9:21:43 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1256/water.xml","experimentId":1256,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1256/1256.zip","specimenCount":2,"creationDate":"Jul 29, 2013 10:52:59 AM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1257/BSA.xml","experimentId":1257,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1257/1257.zip","specimenCount":2,"creationDate":"Jul 29, 2013 11:23:31 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1258/water.xml","experimentId":1258,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1258/1258.zip","specimenCount":2,"creationDate":"Jul 30, 2013 9:08:07 AM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1259/water.xml","experimentId":1259,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1259/1259.zip","specimenCount":2,"creationDate":"Jul 30, 2013 9:17:22 AM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1260/BSA.xml","experimentId":1260,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Jul 30, 2013 9:30:36 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1261/bsa2.xml","experimentId":1261,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1261/1261.zip","specimenCount":2,"creationDate":"Jul 30, 2013 9:38:37 AM","name":"bsa2.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1269/Water.xml","experimentId":1269,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Aug 29, 2013 5:01:50 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1270/Water.xml","experimentId":1270,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1270/1270.zip","specimenCount":2,"creationDate":"Aug 29, 2013 5:18:28 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1271/Water.xml","experimentId":1271,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Aug 30, 2013 11:34:24 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1272/Water.xml","experimentId":1272,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1272/1272.zip","specimenCount":2,"creationDate":"Aug 30, 2013 1:39:05 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1273/Water.xml","experimentId":1273,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1273/1273.zip","specimenCount":2,"creationDate":"Aug 30, 2013 1:48:56 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":null,"experimentId":1274,"experimentType":"TEMPLATE","status":null,"dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":24,"creationDate":"Aug 30, 2013 1:51:35 PM","name":"Radiation Test","measurementCount":42,"dataCollectionCount":18,"macromolecules":"lysozyme","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1275/BSA.xml","experimentId":1275,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1275/1275.zip","specimenCount":2,"creationDate":"Aug 30, 2013 1:56:05 PM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1276/lysozyme.xml","experimentId":1276,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":18,"measurementAveragedCount":42,"measurementDoneCount":42,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1276/1276.zip","specimenCount":24,"creationDate":"Aug 30, 2013 2:17:56 PM","name":"lysozyme.xml","measurementCount":42,"dataCollectionCount":18,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1277/Water.xml","experimentId":1277,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":1,"measurementDoneCount":1,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Sep 2, 2013 9:46:44 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1278/Water.xml","experimentId":1278,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1278/1278.zip","specimenCount":2,"creationDate":"Sep 2, 2013 9:58:52 AM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1279/BSA.xml","experimentId":1279,"experimentType":"CALIBRATION","status":"ABORTED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1279/1279.zip","specimenCount":2,"creationDate":"Sep 2, 2013 10:16:01 AM","name":"BSA.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":" Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1280/Water.xml","experimentId":1280,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1280/1280.zip","specimenCount":2,"creationDate":"Sep 4, 2013 2:09:59 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1281/Water.xml","experimentId":1281,"experimentType":"CALIBRATION","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1281/1281.zip","specimenCount":2,"creationDate":"Sep 4, 2013 2:16:21 PM","name":"Water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1335/water.xml","experimentId":1335,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1335/1335.zip","specimenCount":2,"creationDate":"Sep 10, 2013 4:29:55 PM","name":"water.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1336/bsa.xml","experimentId":1336,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1336/1336.zip","specimenCount":2,"creationDate":"Sep 10, 2013 4:38:23 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1337/bsa.xml","experimentId":1337,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1337/1337.zip","specimenCount":2,"creationDate":"Sep 10, 2013 4:44:50 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1338/bsa.xml","experimentId":1338,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1338/1338.zip","specimenCount":2,"creationDate":"Sep 10, 2013 4:49:00 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1339/bsa.xml","experimentId":1339,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1339/1339.zip","specimenCount":2,"creationDate":"Sep 10, 2013 4:58:45 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1340/bsa.xml","experimentId":1340,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1340/1340.zip","specimenCount":2,"creationDate":"Sep 10, 2013 5:08:02 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1341/bsa.xml","experimentId":1341,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1341/1341.zip","specimenCount":2,"creationDate":"Sep 10, 2013 5:17:50 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1342/bsa.xml","experimentId":1342,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1342/1342.zip","specimenCount":2,"creationDate":"Sep 10, 2013 5:28:05 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1343/bsa.xml","experimentId":1343,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1343/1343.zip","specimenCount":2,"creationDate":"Sep 10, 2013 5:38:08 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1344/bsa.xml","experimentId":1344,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1344/1344.zip","specimenCount":2,"creationDate":"Sep 10, 2013 7:18:00 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1345/bsa.xml","experimentId":1345,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1345/1345.zip","specimenCount":2,"creationDate":"Sep 10, 2013 7:38:15 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1346/bsa.xml","experimentId":1346,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1346/1346.zip","specimenCount":2,"creationDate":"Sep 11, 2013 3:32:32 PM","name":"bsa.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1348/H2O.xml","experimentId":1348,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1348/1348.zip","specimenCount":2,"creationDate":"Sep 12, 2013 1:27:16 PM","name":"H2O.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1349/bsalys.xml","experimentId":1349,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":6,"measurementAveragedCount":13,"measurementDoneCount":13,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1349/1349.zip","specimenCount":7,"creationDate":"Sep 12, 2013 2:57:33 PM","name":"bsalys.xml","measurementCount":13,"dataCollectionCount":6,"macromolecules":"bsa, LYS","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1350/bsalys.xml","experimentId":1350,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":6,"measurementAveragedCount":13,"measurementDoneCount":13,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1350/1350.zip","specimenCount":7,"creationDate":"Sep 12, 2013 5:01:05 PM","name":"bsalys.xml","measurementCount":13,"dataCollectionCount":6,"macromolecules":"bsa, LYS","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1353/calibration.xml","experimentId":1353,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1353/1353.zip","specimenCount":2,"creationDate":"Sep 13, 2013 8:47:54 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1354/calibration.xml","experimentId":1354,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1354/1354.zip","specimenCount":2,"creationDate":"Sep 13, 2013 8:52:41 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1355/calibration.xml","experimentId":1355,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1355/1355.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:11:43 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1356/calibration.xml","experimentId":1356,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1356/1356.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:16:26 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1357/calibration.xml","experimentId":1357,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1357/1357.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:20:41 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1358/calibration.xml","experimentId":1358,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":0,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1358/1358.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:24:35 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1359/calibration.xml","experimentId":1359,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1359/1359.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:28:46 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1360/calibration.xml","experimentId":1360,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":2,"creationDate":"Sep 13, 2013 9:34:09 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1361/calibration.xml","experimentId":1361,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":2,"measurementDoneCount":2,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1361/1361.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:50:15 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1362/calibration.xml","experimentId":1362,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1362/1362.zip","specimenCount":2,"creationDate":"Sep 13, 2013 9:57:34 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1363/calibration.xml","experimentId":1363,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1363/1363.zip","specimenCount":2,"creationDate":"Sep 13, 2013 10:05:47 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1364/calibration.xml","experimentId":1364,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1364/1364.zip","specimenCount":2,"creationDate":"Sep 13, 2013 10:12:43 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1365/calibration.xml","experimentId":1365,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1365/1365.zip","specimenCount":2,"creationDate":"Sep 13, 2013 10:20:25 AM","name":"calibration.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1381/scan5.xml","experimentId":1381,"experimentType":"STATIC","status":"ABORTED","dataCollectionDoneCount":0,"measurementAveragedCount":0,"measurementDoneCount":0,"dataAcquisitionFilePath":null,"specimenCount":3,"creationDate":"Sep 17, 2013 2:21:22 PM","name":"scan5.xml","measurementCount":5,"dataCollectionCount":2,"macromolecules":"b2b3","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1382/wat_pin.xml","experimentId":1382,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1382/1382.zip","specimenCount":2,"creationDate":"Sep 17, 2013 2:37:46 PM","name":"wat_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1383/bsa_pin.xml","experimentId":1383,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1383/1383.zip","specimenCount":2,"creationDate":"Sep 17, 2013 2:48:03 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1384/bsa_pin.xml","experimentId":1384,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1384/1384.zip","specimenCount":2,"creationDate":"Sep 17, 2013 3:06:52 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1385/bsa_pin.xml","experimentId":1385,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1385/1385.zip","specimenCount":2,"creationDate":"Sep 17, 2013 3:26:34 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1386/bsa_pin.xml","experimentId":1386,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1386/1386.zip","specimenCount":2,"creationDate":"Sep 17, 2013 3:37:10 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1387/bsa_pin.xml","experimentId":1387,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1387/1387.zip","specimenCount":2,"creationDate":"Sep 17, 2013 3:44:54 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1388/bsa_pin.xml","experimentId":1388,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1388/1388.zip","specimenCount":2,"creationDate":"Sep 18, 2013 4:01:13 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1389/bsa_pin.xml","experimentId":1389,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1389/1389.zip","specimenCount":2,"creationDate":"Sep 18, 2013 5:05:21 PM","name":"bsa_pin.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"bsa","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1390/H2O.xml","experimentId":1390,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":1,"measurementAveragedCount":3,"measurementDoneCount":3,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1390/1390.zip","specimenCount":2,"creationDate":"Sep 19, 2013 10:51:12 AM","name":"H2O.xml","measurementCount":3,"dataCollectionCount":1,"macromolecules":"Water","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"},{"sourceFilePath":"/data/pyarch/bm29/opd29/1391/core.xml","experimentId":1391,"experimentType":"STATIC","status":"FINISHED","dataCollectionDoneCount":5,"measurementAveragedCount":11,"measurementDoneCount":11,"dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1391/1391.zip","specimenCount":6,"creationDate":"Sep 19, 2013 12:29:13 PM","name":"core.xml","measurementCount":11,"dataCollectionCount":5,"macromolecules":"coreacetilated, coredesacet","proposalId":10,"comments":"[BsxCube] Generated from BsxCube"}];
		},
		getShippings_10 : function(){
			return [{"shippingId":304107,"shippingName":"TEST","deliveryAgentAgentName":null,"deliveryAgentShippingDate":null,"deliveryAgentDeliveryDate":null,"deliveryAgentAgentCode":null,"deliveryAgentFlightCode":null,"shippingStatus":"opened","timeStamp":"2013 09 25","laboratoryId":null,"isStorageShipping":null,"creationDate":"2013 09 25","comments":"test","sendingLabContactVO":{"labContactId":787,"personVO":{"personId":304252,"personUUID":null,"familyName":"KIM","givenName":"Henry","title":null,"emailAddress":"henry-sung.kim@ibs.fr","phoneNumber":"","login":"","passwd":"","faxNumber":""},"cardName":"KIM-Institut de Bio","defaultCourrierCompany":"22","courierAccount":"","billingReference":"","dewarAvgCustomsValue":0,"dewarAvgTransportValue":0},"returnLabContactVO":{"labContactId":787,"personVO":{"personId":304252,"personUUID":null,"familyName":"KIM","givenName":"Henry","title":null,"emailAddress":"henry-sung.kim@ibs.fr","phoneNumber":"","login":"","passwd":"","faxNumber":""},"cardName":"KIM-Institut de Bio","defaultCourrierCompany":"22","courierAccount":"","billingReference":"","dewarAvgCustomsValue":0,"dewarAvgTransportValue":0},"returnCourier":null,"dateOfShippingToUser":null,"shippingType":"DewarTracking","dewarVOs":[{"dewarId":305861,"code":"ESRF-TEST","comments":"comments","storageLocation":"FRIDGE","dewarStatus":"opened","timeStamp":null,"isStorageDewar":null,"barCode":"ESRF305861","customsValue":null,"transportValue":null,"trackingNumberToSynchrotron":"3333","trackingNumberFromSynchrotron":"224466","type":"Dewar","sessionVO":{"sessionId":31697,"expSessionPk":null,"projectCode":null,"startDate":"2012 07 21","endDate":"2012 07 23","beamlineName":"BM29","scheduled":1,"nbShifts":2,"comments":null,"beamlineOperator":"PERNOT  P","usedFlag":null,"sessionTitle":null,"structureDeterminations":null,"dewarTransport":null,"databackupFrance":null,"databackupEurope":null,"visit_number":null,"operatorSiteNumber":"14061","timeStamp":"2012 04 25"}}]}];
		},
		getDewars_10 : function(){
			return [{"dewarId":305861,"code":"ESRF-TEST","comments":"comments","storageLocation":"FRIDGE","dewarStatus":"opened","timeStamp":null,"isStorageDewar":null,"barCode":"ESRF305861","customsValue":null,"transportValue":null,"trackingNumberToSynchrotron":"3333","trackingNumberFromSynchrotron":"224466","type":"Dewar","sessionVO":{"sessionId":31697,"expSessionPk":null,"projectCode":null,"startDate":"2012 07 21","endDate":"2012 07 23","beamlineName":"BM29","scheduled":1,"nbShifts":2,"comments":null,"beamlineOperator":"PERNOT  P","usedFlag":null,"sessionTitle":null,"structureDeterminations":null,"dewarTransport":null,"databackupFrance":null,"databackupEurope":null,"visit_number":null,"operatorSiteNumber":"14061","timeStamp":"2012 04 25"}}];
		},
		getData_3367 : function(){
			return [{"total":null,"bufferBeforeMeasurementId":25252,"sampleMergeId":null,"averagedModelId":null,"I0":null,"proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":null,"framesCount":null,"bufferBeforeMergeId":null,"averageFilePath":null,"bufferAfterMeasurementId":25254,"rgGuinier":null,"subtractedFilePath":null,"firstPointUsed":null,"chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5936,"code":"20.0","transmission":"100.0","timeStart":null,"bufferAcronym":"bwater","quality":null,"shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":810,"isagregated":null,"dmax":null,"bufferBeforeAverageFilePath":null,"exposureTemperature":"20.0","subtractionId":null,"conc":"1.0","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 9:02:47 AM","lastPointUsed":null,"modelListId":null,"framesMerge":null,"rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":null,"nsdFilePath":null,"bufferAfterFramesMerged":null,"experimentId":1393,"macromoleculeAcronym":"WATER","i0stdev":null,"sampleMeasurementId":25253,"measurementComments":"[1] water","priorityLevelId":2,"bufferBeforeFramesMerged":null,"substractionCreationTime":null,"proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.703296272071","bufferBeforeMeasurementId":25255,"sampleMergeId":14287,"averagedModelId":null,"I0":"19.8232","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14288,"framesCount":"10","bufferBeforeMergeId":14286,"averageFilePath":" /data/pyarch/bm29/mx1540/1394/1d/calib_002_ave.dat","bufferAfterMeasurementId":25257,"rgGuinier":"0.149532","subtractedFilePath":" /data/pyarch/bm29/mx1540/1394/1d/calib_002_sub.dat","firstPointUsed":"64","chi2RgFilePath":null,"abInitioModelId":959,"macromoleculeId":5936,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 09:05:19.093279","bufferAcronym":"bwater","quality":"0.813842","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":810,"isagregated":"False","dmax":"0.3439236","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1394/1d/calib_001_ave.dat","exposureTemperature":"20.0","subtractionId":5956,"conc":"1.0","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 9:03:30 AM","lastPointUsed":"398","modelListId":959,"framesMerge":"10","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1394/1d/calib_003_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1394,"macromoleculeAcronym":"WATER","i0stdev":"0.0057911","sampleMeasurementId":25256,"measurementComments":"[1] water","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 9:07:18 AM","proposalNumber":"1540","rgGnom":"0.107768922383","volume":"0.440206","shapeDeterminationModel":null,"comments":null},{"total":null,"bufferBeforeMeasurementId":25258,"sampleMergeId":null,"averagedModelId":null,"I0":null,"proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":null,"framesCount":null,"bufferBeforeMergeId":null,"averageFilePath":null,"bufferAfterMeasurementId":25260,"rgGuinier":null,"subtractedFilePath":null,"firstPointUsed":null,"chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5937,"code":"4.0","transmission":"100.0","timeStart":null,"bufferAcronym":"bbsa","quality":null,"shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":811,"isagregated":null,"dmax":null,"bufferBeforeAverageFilePath":null,"exposureTemperature":"4.0","subtractionId":null,"conc":"4.5999999999999996","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 9:55:56 AM","lastPointUsed":null,"modelListId":null,"framesMerge":null,"rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":null,"nsdFilePath":null,"bufferAfterFramesMerged":null,"experimentId":1395,"macromoleculeAcronym":"BSA","i0stdev":null,"sampleMeasurementId":25259,"measurementComments":"[1] bsa","priorityLevelId":2,"bufferBeforeFramesMerged":null,"substractionCreationTime":null,"proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.602562962573","bufferBeforeMeasurementId":25261,"sampleMergeId":14290,"averagedModelId":142716,"I0":"61.9402173913","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1396/1d/damaver.pdb","bufferAfterMergeId":14291,"framesCount":"10","bufferBeforeMergeId":14289,"averageFilePath":" /data/pyarch/bm29/mx1540/1396/1d/calib_005_ave.dat","bufferAfterMeasurementId":25263,"rgGuinier":"3.07533","subtractedFilePath":" /data/pyarch/bm29/mx1540/1396/1d/calib_005_sub.dat","firstPointUsed":"61","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1396/1d/chi2_R.png","abInitioModelId":960,"macromoleculeId":5937,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 10:02:43.980218","bufferAcronym":"bbsa","quality":"0.690486","shapeDeterminationModelId":142718,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":811,"isagregated":"False","dmax":"10.763655","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1396/1d/calib_004_ave.dat","exposureTemperature":"20.0","subtractionId":5957,"conc":"4.5999999999999996","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1396/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:01:01 AM","lastPointUsed":"92","modelListId":960,"framesMerge":"10","rapidShapeDeterminationModelId":142717,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1396/1d/calib_006_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1396/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1396,"macromoleculeAcronym":"BSA","i0stdev":"0.0695645652174","sampleMeasurementId":25262,"measurementComments":"[1] bsa","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:04:38 AM","proposalNumber":"1540","rgGnom":"3.1441153682","volume":"117.609","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1396/1d/dammin.pdb","comments":null},{"total":"0.575154683088","bufferBeforeMeasurementId":25276,"sampleMergeId":14303,"averagedModelId":143549,"I0":"206.998","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14304,"framesCount":"10","bufferBeforeMergeId":14302,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_012_ave.dat","bufferAfterMeasurementId":25278,"rgGuinier":"4.28693","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_012_sub.dat","firstPointUsed":"35","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":965,"macromoleculeId":5941,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:21:22.547281","bufferAcronym":"classic","quality":"0.669308","shapeDeterminationModelId":143551,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"15.004255","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_011_ave.dat","exposureTemperature":"20.0","subtractionId":5962,"conc":"0.20000000000000001","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"61","modelListId":965,"framesMerge":"10","rapidShapeDeterminationModelId":143550,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_013_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"P135_237","i0stdev":"0.754155","sampleMeasurementId":25277,"measurementComments":"[5] P135-237 C7 classic","priorityLevelId":12,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:23:18 AM","proposalNumber":"1540","rgGnom":"4.35451164856","volume":"191.051","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.51134492243","bufferBeforeMeasurementId":25290,"sampleMergeId":14314,"averagedModelId":143716,"I0":"0.0","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14315,"framesCount":"10","bufferBeforeMergeId":14313,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_023_ave.dat","bufferAfterMeasurementId":25293,"rgGuinier":"14.5874582322","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_023_sub.dat","firstPointUsed":"0","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":966,"macromoleculeId":5938,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:34:28.424630","bufferAcronym":"buffer miriam","quality":"0.0","shapeDeterminationModelId":143718,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":812,"isagregated":"False","dmax":"51.0561038126","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_022_ave.dat","exposureTemperature":"20.0","subtractionId":5967,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"0","modelListId":966,"framesMerge":"7","rapidShapeDeterminationModelId":143717,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_024_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"Miriams_protein","i0stdev":"0.0","sampleMeasurementId":25292,"measurementComments":"[10] Miriams protein","priorityLevelId":23,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:36:25 AM","proposalNumber":"1540","rgGnom":"14.9908843929","volume":"5547.39","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.654529927622","bufferBeforeMeasurementId":25288,"sampleMergeId":14312,"averagedModelId":143883,"I0":"633.504","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14313,"framesCount":"10","bufferBeforeMergeId":14311,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_021_ave.dat","bufferAfterMeasurementId":25290,"rgGuinier":"17.2774","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_021_sub.dat","firstPointUsed":"2","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":967,"macromoleculeId":5938,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:32:08.771769","bufferAcronym":"buffer miriam","quality":"0.0","shapeDeterminationModelId":143885,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":812,"isagregated":"False","dmax":"59.175095","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_020_ave.dat","exposureTemperature":"20.0","subtractionId":5966,"conc":"0.10000000000000001","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"11","modelListId":967,"framesMerge":"10","rapidShapeDeterminationModelId":143884,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_022_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"Miriams_protein","i0stdev":"10.1113","sampleMeasurementId":25289,"measurementComments":"[9] Miriams protein E5","priorityLevelId":21,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:34:02 AM","proposalNumber":"1540","rgGnom":"16.6709052544","volume":"9906.41","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.745741290638","bufferBeforeMeasurementId":25284,"sampleMergeId":14309,"averagedModelId":144388,"I0":"86.26875","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14310,"framesCount":"10","bufferBeforeMergeId":14308,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_018_ave.dat","bufferAfterMeasurementId":25287,"rgGuinier":"4.32169","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_018_sub.dat","firstPointUsed":"30","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":970,"macromoleculeId":5940,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:28:38.921200","bufferAcronym":"classic","quality":"0.730637","shapeDeterminationModelId":144390,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"15.125915","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_017_ave.dat","exposureTemperature":"20.0","subtractionId":5965,"conc":"0.16","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"63","modelListId":970,"framesMerge":"10","rapidShapeDeterminationModelId":144389,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_019_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21_P135_237","i0stdev":"0.61473","sampleMeasurementId":25286,"measurementComments":"[8] M21 P135-237 complex pool","priorityLevelId":18,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:30:31 AM","proposalNumber":"1540","rgGnom":"4.4575414208","volume":"302.273","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.698114660916","bufferBeforeMeasurementId":25264,"sampleMergeId":14293,"averagedModelId":142883,"I0":"54.4234","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14294,"framesCount":"10","bufferBeforeMergeId":14292,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_002_ave.dat","bufferAfterMeasurementId":25266,"rgGuinier":"3.59055","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_002_sub.dat","firstPointUsed":"12","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":961,"macromoleculeId":5939,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:09:39.421164","bufferAcronym":"NDSB_EDTA","quality":"0.927088","shapeDeterminationModelId":142885,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":813,"isagregated":"False","dmax":"12.566925","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_001_ave.dat","exposureTemperature":"20.0","subtractionId":5958,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"71","modelListId":961,"framesMerge":"10","rapidShapeDeterminationModelId":142884,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_003_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21","i0stdev":"0.1097822","sampleMeasurementId":25265,"measurementComments":"[1] M21 NDSB C8 10mM EDTA","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:11:35 AM","proposalNumber":"1540","rgGnom":"3.64290688294","volume":"149.315","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.570332450197","bufferBeforeMeasurementId":25278,"sampleMergeId":14305,"averagedModelId":144052,"I0":"142.462727273","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14306,"framesCount":"10","bufferBeforeMergeId":14304,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_014_ave.dat","bufferAfterMeasurementId":25281,"rgGuinier":"4.52582","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_014_sub.dat","firstPointUsed":"16","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":968,"macromoleculeId":5940,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:23:43.712266","bufferAcronym":"classic","quality":"0.884538","shapeDeterminationModelId":144054,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"15.84037","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_013_ave.dat","exposureTemperature":"20.0","subtractionId":5963,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"55","modelListId":968,"framesMerge":"7","rapidShapeDeterminationModelId":144053,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_015_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21_P135_237","i0stdev":"0.281008181818","sampleMeasurementId":25280,"measurementComments":"[6] M21 P135-237 complex C5","priorityLevelId":14,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:25:38 AM","proposalNumber":"1540","rgGnom":"4.59917432662","volume":"304.13","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.883453603749","bufferBeforeMeasurementId":25267,"sampleMergeId":14296,"averagedModelId":143384,"I0":"35.023","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14297,"framesCount":"10","bufferBeforeMergeId":14295,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_005_ave.dat","bufferAfterMeasurementId":25269,"rgGuinier":"3.94676","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_005_sub.dat","firstPointUsed":"17","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":964,"macromoleculeId":5939,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:13:10.722709","bufferAcronym":"NDSB","quality":"0.846226","shapeDeterminationModelId":143386,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":814,"isagregated":"False","dmax":"11.445604","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_004_ave.dat","exposureTemperature":"20.0","subtractionId":5959,"conc":"0.29999999999999999","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"70","modelListId":964,"framesMerge":"10","rapidShapeDeterminationModelId":143385,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_006_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21","i0stdev":"0.211229","sampleMeasurementId":25268,"measurementComments":"[2] M21 NDSB C12","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:15:04 AM","proposalNumber":"1540","rgGnom":"3.85769349341","volume":"283.569","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.649371833596","bufferBeforeMeasurementId":25281,"sampleMergeId":14307,"averagedModelId":144221,"I0":"137.955454545","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14308,"framesCount":"10","bufferBeforeMergeId":14306,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_016_ave.dat","bufferAfterMeasurementId":25284,"rgGuinier":"4.5069","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_016_sub.dat","firstPointUsed":"26","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":969,"macromoleculeId":5940,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:26:04.153895","bufferAcronym":"classic","quality":"0.810693","shapeDeterminationModelId":144223,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"15.77415","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_015_ave.dat","exposureTemperature":"20.0","subtractionId":5964,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"60","modelListId":969,"framesMerge":"10","rapidShapeDeterminationModelId":144222,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_017_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21_P135_237","i0stdev":"0.400011363636","sampleMeasurementId":25283,"measurementComments":"[7] M21 P135-237 complex C6","priorityLevelId":16,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:27:59 AM","proposalNumber":"1540","rgGnom":"4.60287171992","volume":"318.874","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.637387501791","bufferBeforeMeasurementId":25269,"sampleMergeId":14298,"averagedModelId":143219,"I0":"74.8292","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14299,"framesCount":"10","bufferBeforeMergeId":14297,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_007_ave.dat","bufferAfterMeasurementId":25272,"rgGuinier":"3.63811","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_007_sub.dat","firstPointUsed":"21","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":963,"macromoleculeId":5939,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:15:30.558342","bufferAcronym":"NDSB","quality":"0.874257","shapeDeterminationModelId":143221,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":814,"isagregated":"False","dmax":"12.733385","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_006_ave.dat","exposureTemperature":"20.0","subtractionId":5960,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"76","modelListId":963,"framesMerge":"10","rapidShapeDeterminationModelId":143220,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_008_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21","i0stdev":"0.1406498","sampleMeasurementId":25271,"measurementComments":"[3] M21 NDSB C7","priorityLevelId":7,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:17:24 AM","proposalNumber":"1540","rgGnom":"3.74919867241","volume":"161.933","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.652023578466","bufferBeforeMeasurementId":25272,"sampleMergeId":14300,"averagedModelId":143052,"I0":"40.4633333333","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1397/1d/damaver.pdb","bufferAfterMergeId":14301,"framesCount":"10","bufferBeforeMergeId":14299,"averageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_009_ave.dat","bufferAfterMeasurementId":25275,"rgGuinier":"3.95491","subtractedFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_009_sub.dat","firstPointUsed":"13","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1397/1d/chi2_R.png","abInitioModelId":962,"macromoleculeId":5939,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 11:17:50.167228","bufferAcronym":"NDSB","quality":"0.889629","shapeDeterminationModelId":143054,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":814,"isagregated":"False","dmax":"13.842185","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_008_ave.dat","exposureTemperature":"20.0","subtractionId":5961,"conc":"0.29999999999999999","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:07:56 AM","lastPointUsed":"70","modelListId":962,"framesMerge":"9","rapidShapeDeterminationModelId":143053,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1397/1d/CedMax_run1_010_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1397/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1397,"macromoleculeAcronym":"M21","i0stdev":"0.233176333333","sampleMeasurementId":25274,"measurementComments":"[4] M21 NDSB pool","priorityLevelId":9,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:19:45 AM","proposalNumber":"1540","rgGnom":"4.01686141863","volume":"233.277","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1397/1d/dammin.pdb","comments":null},{"total":"0.645033454178","bufferBeforeMeasurementId":25312,"sampleMergeId":14331,"averagedModelId":null,"I0":"52.3670833333","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14332,"framesCount":"10","bufferBeforeMergeId":14330,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_016_ave.dat","bufferAfterMeasurementId":25314,"rgGuinier":"3.34962","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_016_sub.dat","firstPointUsed":"12","chi2RgFilePath":null,"abInitioModelId":976,"macromoleculeId":5944,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:33:29.076777","bufferAcronym":"bmc91","quality":"0.936903","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":817,"isagregated":"False","dmax":"11.4724485","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_015_ave.dat","exposureTemperature":"20.0","subtractionId":5974,"conc":"0.95999999999999996","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"57","modelListId":976,"framesMerge":"9","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_017_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC91","i0stdev":"0.05730375","sampleMeasurementId":25313,"measurementComments":"[7] MC91","priorityLevelId":16,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:35:21 PM","proposalNumber":"1540","rgGnom":"3.32830798887","volume":"92.0212","shapeDeterminationModel":null,"comments":null},{"total":"0.373399063725","bufferBeforeMeasurementId":25324,"sampleMergeId":14341,"averagedModelId":144893,"I0":"29.3941423948","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1398/1d/damaver.pdb","bufferAfterMergeId":14342,"framesCount":"10","bufferBeforeMergeId":14340,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_026_ave.dat","bufferAfterMeasurementId":25326,"rgGuinier":"3.82683","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_026_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1398/1d/chi2_R.png","abInitioModelId":979,"macromoleculeId":5945,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:44:59.374768","bufferAcronym":"bmc91","quality":"0.920699","shapeDeterminationModelId":144895,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":817,"isagregated":"False","dmax":"13.10689275","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_025_ave.dat","exposureTemperature":"20.0","subtractionId":5978,"conc":"3.0899999999999999","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"44","modelListId":979,"framesMerge":"9","rapidShapeDeterminationModelId":144894,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_027_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1398/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC64","i0stdev":"0.0306497734628","sampleMeasurementId":25325,"measurementComments":"[11] MC64","priorityLevelId":26,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:46:52 PM","proposalNumber":"1540","rgGnom":"3.63812590134","volume":"37.3911","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/dammin.pdb","comments":null},{"total":"0.582754601162","bufferBeforeMeasurementId":25321,"sampleMergeId":14338,"averagedModelId":145231,"I0":"24.8599056604","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1398/1d/damaver.pdb","bufferAfterMergeId":14339,"framesCount":"10","bufferBeforeMergeId":14337,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_023_ave.dat","bufferAfterMeasurementId":25323,"rgGuinier":"2.99463","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_023_sub.dat","firstPointUsed":"34","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1398/1d/chi2_R.png","abInitioModelId":981,"macromoleculeId":5945,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:41:32.515512","bufferAcronym":"bmc64","quality":"0.872917","shapeDeterminationModelId":145233,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":819,"isagregated":"False","dmax":"10.25660775","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_022_ave.dat","exposureTemperature":"20.0","subtractionId":5977,"conc":"1.0600000000000001","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"90","modelListId":981,"framesMerge":"9","rapidShapeDeterminationModelId":145232,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_024_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1398/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC64","i0stdev":"0.0575470754717","sampleMeasurementId":25322,"measurementComments":"[10] MC64","priorityLevelId":23,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:43:25 PM","proposalNumber":"1540","rgGnom":"3.10732259358","volume":"35.4964","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/dammin.pdb","comments":null},{"total":"0.477931874201","bufferBeforeMeasurementId":25317,"sampleMergeId":14335,"averagedModelId":null,"I0":"64.1841240876","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14336,"framesCount":"10","bufferBeforeMergeId":14334,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_020_ave.dat","bufferAfterMeasurementId":25320,"rgGuinier":"3.59853","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_020_sub.dat","firstPointUsed":"56","chi2RgFilePath":null,"abInitioModelId":978,"macromoleculeId":5944,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:38:05.389043","bufferAcronym":"bmc91","quality":"0.634021","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":817,"isagregated":"False","dmax":"12.594855","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_019_ave.dat","exposureTemperature":"20.0","subtractionId":5976,"conc":"5.4800000000000004","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"77","modelListId":978,"framesMerge":"5","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_021_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC91","i0stdev":"0.140021167883","sampleMeasurementId":25319,"measurementComments":"[9] MC91","priorityLevelId":20,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:39:56 PM","proposalNumber":"1540","rgGnom":"3.68670442328","volume":"108.241","shapeDeterminationModel":null,"comments":null},{"total":"0.46753603356","bufferBeforeMeasurementId":25314,"sampleMergeId":14333,"averagedModelId":null,"I0":"58.4114379085","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14334,"framesCount":"10","bufferBeforeMergeId":14332,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_018_ave.dat","bufferAfterMeasurementId":25317,"rgGuinier":"3.73556","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_018_sub.dat","firstPointUsed":"12","chi2RgFilePath":null,"abInitioModelId":977,"macromoleculeId":5944,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:35:48.831598","bufferAcronym":"bmc91","quality":"0.918808","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":817,"isagregated":"False","dmax":"13.07446","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_017_ave.dat","exposureTemperature":"20.0","subtractionId":5975,"conc":"3.0600000000000001","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"43","modelListId":977,"framesMerge":"8","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_019_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC91","i0stdev":"0.0440081699346","sampleMeasurementId":25316,"measurementComments":"[8] MC91","priorityLevelId":18,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:37:40 PM","proposalNumber":"1540","rgGnom":"3.62696670759","volume":"99.2182","shapeDeterminationModel":null,"comments":null},{"total":"0.450615199162","bufferBeforeMeasurementId":25327,"sampleMergeId":14344,"averagedModelId":145400,"I0":"26.2597165992","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1398/1d/damaver.pdb","bufferAfterMergeId":14345,"framesCount":"10","bufferBeforeMergeId":14343,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_029_ave.dat","bufferAfterMeasurementId":25329,"rgGuinier":"3.07941","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_029_sub.dat","firstPointUsed":"49","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1398/1d/chi2_R.png","abInitioModelId":982,"macromoleculeId":5945,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:48:28.231843","bufferAcronym":"bmc64","quality":"0.824694","shapeDeterminationModelId":145402,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":819,"isagregated":"False","dmax":"10.777935","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_028_ave.dat","exposureTemperature":"20.0","subtractionId":5979,"conc":"4.9400000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"85","modelListId":982,"framesMerge":"9","rapidShapeDeterminationModelId":145401,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_030_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1398/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC64","i0stdev":"0.0336078947368","sampleMeasurementId":25328,"measurementComments":"[12] MC64","priorityLevelId":29,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:50:20 PM","proposalNumber":"1540","rgGnom":"3.16120781893","volume":"37.6081","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/dammin.pdb","comments":null},{"total":"0.42061046792","bufferBeforeMeasurementId":25294,"sampleMergeId":14317,"averagedModelId":144557,"I0":"122.519354839","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1398/1d/damaver.pdb","bufferAfterMergeId":14318,"framesCount":"10","bufferBeforeMergeId":14316,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_002_ave.dat","bufferAfterMeasurementId":25296,"rgGuinier":"6.71365","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_002_sub.dat","firstPointUsed":"28","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1398/1d/chi2_R.png","abInitioModelId":971,"macromoleculeId":5942,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:17:28.170465","bufferAcronym":"bbmp2","quality":"0.0","shapeDeterminationModelId":144559,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":818,"isagregated":"True","dmax":"23.497775","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_001_ave.dat","exposureTemperature":"20.0","subtractionId":5968,"conc":"0.93000000000000005","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"38","modelListId":971,"framesMerge":"1","rapidShapeDeterminationModelId":144558,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_003_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1398/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"BMP2","i0stdev":"1.36532258065","sampleMeasurementId":25295,"measurementComments":"[1] BMP2","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:19:20 PM","proposalNumber":"1540","rgGnom":"6.9072600093","volume":"204.556","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/dammin.pdb","comments":null},{"total":"0.542212227903","bufferBeforeMeasurementId":25296,"sampleMergeId":14319,"averagedModelId":144726,"I0":"51.5163888889","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1398/1d/damaver.pdb","bufferAfterMergeId":14320,"framesCount":"10","bufferBeforeMergeId":14318,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_004_ave.dat","bufferAfterMeasurementId":25299,"rgGuinier":"3.32459","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_004_sub.dat","firstPointUsed":"38","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1398/1d/chi2_R.png","abInitioModelId":974,"macromoleculeId":5942,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:19:45.780821","bufferAcronym":"bbmp2","quality":"0.651719","shapeDeterminationModelId":144728,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":818,"isagregated":"True","dmax":"11.38672075","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_003_ave.dat","exposureTemperature":"20.0","subtractionId":5969,"conc":"3.6000000000000001","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"84","modelListId":974,"framesMerge":"3","rapidShapeDeterminationModelId":144727,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_005_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1398/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"BMP2","i0stdev":"0.0670477777778","sampleMeasurementId":25298,"measurementComments":"[2] BMP2","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:21:38 PM","proposalNumber":"1540","rgGnom":"3.47500063899","volume":"77.4244","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/dammin.pdb","comments":null},{"total":"0.211889821007","bufferBeforeMeasurementId":25299,"sampleMergeId":14321,"averagedModelId":null,"I0":"43.6324055666","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14322,"framesCount":"10","bufferBeforeMergeId":14320,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_006_ave.dat","bufferAfterMeasurementId":25302,"rgGuinier":"0.867411","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_006_sub.dat","firstPointUsed":"22","chi2RgFilePath":null,"abInitioModelId":975,"macromoleculeId":5942,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:22:02.874242","bufferAcronym":"bbmp2","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":818,"isagregated":"False","dmax":"7.524790425","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_005_ave.dat","exposureTemperature":"20.0","subtractionId":5970,"conc":"5.0300000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"42","modelListId":975,"framesMerge":"8","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_007_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"BMP2","i0stdev":"0.0411226640159","sampleMeasurementId":25301,"measurementComments":"[3] BMP2","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:24:00 PM","proposalNumber":"1540","rgGnom":"3.36652328131","volume":"26.1804","shapeDeterminationModel":null,"comments":null},{"total":"0.683124057271","bufferBeforeMeasurementId":25303,"sampleMergeId":14324,"averagedModelId":null,"I0":"25.320106383","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14325,"framesCount":"10","bufferBeforeMergeId":14323,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_009_ave.dat","bufferAfterMeasurementId":25305,"rgGuinier":"2.40056","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_009_sub.dat","firstPointUsed":"40","chi2RgFilePath":null,"abInitioModelId":972,"macromoleculeId":5943,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:25:29.967560","bufferAcronym":"bmc158","quality":"0.866632","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":816,"isagregated":"False","dmax":"8.40196","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_008_ave.dat","exposureTemperature":"20.0","subtractionId":5971,"conc":"0.93999999999999995","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"105","modelListId":972,"framesMerge":"9","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_010_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC158","i0stdev":"0.0462135106383","sampleMeasurementId":25304,"measurementComments":"[4] MC158","priorityLevelId":9,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:27:20 PM","proposalNumber":"1540","rgGnom":"2.40187471203","volume":"27.1338","shapeDeterminationModel":null,"comments":null},{"total":"0.552356183031","bufferBeforeMeasurementId":25305,"sampleMergeId":14326,"averagedModelId":null,"I0":"22.4203244838","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14327,"framesCount":"10","bufferBeforeMergeId":14325,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_011_ave.dat","bufferAfterMeasurementId":25308,"rgGuinier":"2.23216","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_011_sub.dat","firstPointUsed":"41","chi2RgFilePath":null,"abInitioModelId":973,"macromoleculeId":5943,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:27:46.067994","bufferAcronym":"bmc158","quality":"0.875619","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":816,"isagregated":"False","dmax":"7.81256","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_010_ave.dat","exposureTemperature":"20.0","subtractionId":5972,"conc":"3.3900000000000001","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"108","modelListId":973,"framesMerge":"9","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_012_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC158","i0stdev":"0.0206876106195","sampleMeasurementId":25307,"measurementComments":"[5] MC158","priorityLevelId":11,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:29:37 PM","proposalNumber":"1540","rgGnom":"2.25186027647","volume":"23.7162","shapeDeterminationModel":null,"comments":null},{"total":"0.551943703477","bufferBeforeMeasurementId":25308,"sampleMergeId":14328,"averagedModelId":145066,"I0":"22.8916527546","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1398/1d/damaver.pdb","bufferAfterMergeId":14329,"framesCount":"10","bufferBeforeMergeId":14327,"averageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_013_ave.dat","bufferAfterMeasurementId":25311,"rgGuinier":"2.21865","subtractedFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_013_sub.dat","firstPointUsed":"91","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1398/1d/chi2_R.png","abInitioModelId":980,"macromoleculeId":5943,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 12:30:03.126997","bufferAcronym":"bmc158","quality":"0.693724","shapeDeterminationModelId":145068,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":816,"isagregated":"False","dmax":"7.765275","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_012_ave.dat","exposureTemperature":"20.0","subtractionId":5973,"conc":"5.9900000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 12:15:46 PM","lastPointUsed":"130","modelListId":980,"framesMerge":"5","rapidShapeDeterminationModelId":145067,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1398/1d/ELLIE_run1_014_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1398/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1398,"macromoleculeAcronym":"MC158","i0stdev":"0.0395809682805","sampleMeasurementId":25310,"measurementComments":"[6] MC158","priorityLevelId":13,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 12:31:55 PM","proposalNumber":"1540","rgGnom":"2.28589882191","volume":"26.2516","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1398/1d/dammin.pdb","comments":null},{"total":"0.406160561259","bufferBeforeMeasurementId":25330,"sampleMergeId":14347,"averagedModelId":145569,"I0":"28.284617737","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1399/1d/damaver.pdb","bufferAfterMergeId":14348,"framesCount":"10","bufferBeforeMergeId":14346,"averageFilePath":" /data/pyarch/bm29/mx1540/1399/1d/ELLIE_run1_032_ave.dat","bufferAfterMeasurementId":25332,"rgGuinier":"3.48041","subtractedFilePath":" /data/pyarch/bm29/mx1540/1399/1d/ELLIE_run1_032_sub.dat","firstPointUsed":"31","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1399/1d/chi2_R.png","abInitioModelId":983,"macromoleculeId":5945,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 13:18:48.399475","bufferAcronym":"bmc64","quality":"0.866075","shapeDeterminationModelId":145571,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":819,"isagregated":"False","dmax":"12.181435","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1399/1d/ELLIE_run1_031_ave.dat","exposureTemperature":"20.0","subtractionId":5980,"conc":"3.27","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1399/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 1:17:07 PM","lastPointUsed":"60","modelListId":983,"framesMerge":"8","rapidShapeDeterminationModelId":145570,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1399/1d/ELLIE_run1_033_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1399/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1399,"macromoleculeAcronym":"MC64","i0stdev":"0.0471639143731","sampleMeasurementId":25331,"measurementComments":"[1] MC64","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 1:20:41 PM","proposalNumber":"1540","rgGnom":"3.41585158405","volume":"35.5749","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1399/1d/dammin.pdb","comments":null},{"total":"0.617921641477","bufferBeforeMeasurementId":25333,"sampleMergeId":14350,"averagedModelId":145742,"I0":"152.398484848","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1400/1d/damaver.pdb","bufferAfterMergeId":14351,"framesCount":"10","bufferBeforeMergeId":14349,"averageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_035_ave.dat","bufferAfterMeasurementId":25335,"rgGuinier":"4.8006","subtractedFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_035_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1400/1d/chi2_R.png","abInitioModelId":984,"macromoleculeId":5940,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 14:33:08.971377","bufferAcronym":"classic","quality":"0.906432","shapeDeterminationModelId":145744,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"16.8021","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_034_ave.dat","exposureTemperature":"20.0","subtractionId":5981,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 2:31:25 PM","lastPointUsed":"39","modelListId":984,"framesMerge":"7","rapidShapeDeterminationModelId":145743,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_036_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1400/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1400,"macromoleculeAcronym":"M21_P135_237","i0stdev":"0.298510909091","sampleMeasurementId":25334,"measurementComments":"[1] M21 P135-237 25mM Tris 150mM  NaCl noRNA","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 2:35:02 PM","proposalNumber":"1540","rgGnom":"4.76421312024","volume":"350.9","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/dammin.pdb","comments":null},{"total":"0.480146583698","bufferBeforeMeasurementId":25335,"sampleMergeId":14352,"averagedModelId":145913,"I0":"197.140909091","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1400/1d/damaver.pdb","bufferAfterMergeId":14353,"framesCount":"10","bufferBeforeMergeId":14351,"averageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_037_ave.dat","bufferAfterMeasurementId":25338,"rgGuinier":"5.71663","subtractedFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_037_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1400/1d/chi2_R.png","abInitioModelId":985,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 14:35:27.052968","bufferAcronym":"classic","quality":"0.894235","shapeDeterminationModelId":145915,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"20.008205","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_036_ave.dat","exposureTemperature":"20.0","subtractionId":5982,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 2:31:25 PM","lastPointUsed":"37","modelListId":985,"framesMerge":"6","rapidShapeDeterminationModelId":145914,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_038_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1400/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1400,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.457881818182","sampleMeasurementId":25337,"measurementComments":"[2] M21 P135-237 25mM Tris 150mM  NaCl 1uM RNA","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 2:37:17 PM","proposalNumber":"1540","rgGnom":"5.70416943099","volume":"412.362","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/dammin.pdb","comments":null},{"total":"0.652833962512","bufferBeforeMeasurementId":25338,"sampleMergeId":14354,"averagedModelId":146080,"I0":"487.912121212","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1400/1d/damaver.pdb","bufferAfterMergeId":14355,"framesCount":"10","bufferBeforeMergeId":14353,"averageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_039_ave.dat","bufferAfterMeasurementId":25341,"rgGuinier":"7.44528","subtractedFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_039_sub.dat","firstPointUsed":"14","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1400/1d/chi2_R.png","abInitioModelId":986,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 14:37:44.174377","bufferAcronym":"classic","quality":"0.820172","shapeDeterminationModelId":146082,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"26.05848","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_038_ave.dat","exposureTemperature":"20.0","subtractionId":5983,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 2:31:25 PM","lastPointUsed":"33","modelListId":986,"framesMerge":"7","rapidShapeDeterminationModelId":146081,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_040_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1400/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1400,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"1.29985757576","sampleMeasurementId":25340,"measurementComments":"[3] M21 P135-237 25mM Tris 150mM  NaCl 5uM RNA","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 2:39:36 PM","proposalNumber":"1540","rgGnom":"7.52834411218","volume":"1180.38","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/dammin.pdb","comments":null},{"total":"0.719329945902","bufferBeforeMeasurementId":25341,"sampleMergeId":14356,"averagedModelId":146422,"I0":"601.921212121","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1400/1d/damaver.pdb","bufferAfterMergeId":14357,"framesCount":"10","bufferBeforeMergeId":14355,"averageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_041_ave.dat","bufferAfterMeasurementId":25344,"rgGuinier":"7.63302","subtractedFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_041_sub.dat","firstPointUsed":"7","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1400/1d/chi2_R.png","abInitioModelId":988,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 14:40:02.813843","bufferAcronym":"classic","quality":"0.898309","shapeDeterminationModelId":146424,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"26.71557","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_040_ave.dat","exposureTemperature":"20.0","subtractionId":5984,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 2:31:25 PM","lastPointUsed":"33","modelListId":988,"framesMerge":"3","rapidShapeDeterminationModelId":146423,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_042_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1400/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1400,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"1.31705151515","sampleMeasurementId":25343,"measurementComments":"[4] M21 P135-237 25mM Tris 150mM  NaCl 10uM RNA","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 2:41:56 PM","proposalNumber":"1540","rgGnom":"7.64646376984","volume":"1497.85","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/dammin.pdb","comments":null},{"total":"0.795079121653","bufferBeforeMeasurementId":25344,"sampleMergeId":14358,"averagedModelId":146251,"I0":"705.787878788","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1400/1d/damaver.pdb","bufferAfterMergeId":14359,"framesCount":"10","bufferBeforeMergeId":14357,"averageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_043_ave.dat","bufferAfterMeasurementId":25347,"rgGuinier":"7.45829","subtractedFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_043_sub.dat","firstPointUsed":"18","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1400/1d/chi2_R.png","abInitioModelId":987,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 14:42:22.579880","bufferAcronym":"classic","quality":"0.760498","shapeDeterminationModelId":146253,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"26.104015","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_042_ave.dat","exposureTemperature":"20.0","subtractionId":5985,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 2:31:25 PM","lastPointUsed":"34","modelListId":987,"framesMerge":"10","rapidShapeDeterminationModelId":146252,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1400/1d/CedMax_run2_044_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1400/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1400,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.869775757576","sampleMeasurementId":25346,"measurementComments":"[5] M21 P135-237 25mM Tris 150mM  NaCl 20uM RNA","priorityLevelId":10,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 2:44:14 PM","proposalNumber":"1540","rgGnom":"7.52085442749","volume":"1636.07","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1400/1d/dammin.pdb","comments":null},{"total":"0.641170002774","bufferBeforeMeasurementId":25348,"sampleMergeId":14361,"averagedModelId":146927,"I0":"104.5256","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1401/1d/damaver.pdb","bufferAfterMergeId":14362,"framesCount":"10","bufferBeforeMergeId":14360,"averageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_046_ave.dat","bufferAfterMeasurementId":25350,"rgGuinier":"4.26577","subtractedFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_046_sub.dat","firstPointUsed":"38","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1401/1d/chi2_R.png","abInitioModelId":991,"macromoleculeId":5949,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 15:47:21.499246","bufferAcronym":"classic","quality":"0.66203","shapeDeterminationModelId":146929,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"14.930195","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_045_ave.dat","exposureTemperature":"20.0","subtractionId":5986,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 3:45:37 PM","lastPointUsed":"62","modelListId":991,"framesMerge":"10","rapidShapeDeterminationModelId":146928,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_047_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1401/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1401,"macromoleculeAcronym":"P135_237_0GdmCl","i0stdev":"0.421048","sampleMeasurementId":25349,"measurementComments":"[1] P135-237 25mM Tris 150mM  NaCl","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 3:49:13 PM","proposalNumber":"1540","rgGnom":"4.36594687792","volume":"198.093","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/dammin.pdb","comments":null},{"total":"0.535561678998","bufferBeforeMeasurementId":25351,"sampleMergeId":14364,"averagedModelId":146758,"I0":"97.5762","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1401/1d/damaver.pdb","bufferAfterMergeId":14365,"framesCount":"10","bufferBeforeMergeId":14363,"averageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_049_ave.dat","bufferAfterMeasurementId":25353,"rgGuinier":"5.00271","subtractedFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_049_sub.dat","firstPointUsed":"20","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1401/1d/chi2_R.png","abInitioModelId":990,"macromoleculeId":5948,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 15:50:50.796972","bufferAcronym":"classic_1MGdmCl","quality":"0.788203","shapeDeterminationModelId":146760,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":820,"isagregated":"False","dmax":"16.008672","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_048_ave.dat","exposureTemperature":"20.0","subtractionId":5987,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 3:45:37 PM","lastPointUsed":"43","modelListId":990,"framesMerge":"10","rapidShapeDeterminationModelId":146759,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_050_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1401/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1401,"macromoleculeAcronym":"P135_237_1MGdmCl","i0stdev":"0.366176","sampleMeasurementId":25352,"measurementComments":"[2] P135-237 25mM Tris 125mM  NaCl 1M GdmCl","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 3:52:42 PM","proposalNumber":"1540","rgGnom":"4.70799472405","volume":"240.748","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/dammin.pdb","comments":null},{"total":"0.561546306486","bufferBeforeMeasurementId":25354,"sampleMergeId":14367,"averagedModelId":146589,"I0":"82.2548","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1401/1d/damaver.pdb","bufferAfterMergeId":14368,"framesCount":"10","bufferBeforeMergeId":14366,"averageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_052_ave.dat","bufferAfterMeasurementId":25356,"rgGuinier":"4.6612","subtractedFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_052_sub.dat","firstPointUsed":"31","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1401/1d/chi2_R.png","abInitioModelId":989,"macromoleculeId":5947,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 15:54:19.710003","bufferAcronym":"classic_2MGdmCl","quality":"0.707402","shapeDeterminationModelId":146591,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":822,"isagregated":"False","dmax":"16.3142","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_051_ave.dat","exposureTemperature":"20.0","subtractionId":5988,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 3:45:37 PM","lastPointUsed":"58","modelListId":989,"framesMerge":"10","rapidShapeDeterminationModelId":146590,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_053_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1401/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1401,"macromoleculeAcronym":"P135_237_2MGdmCl","i0stdev":"0.248082","sampleMeasurementId":25355,"measurementComments":"[3] P135-237 25mM Tris 100mM  NaCl 2M GdmCl","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 3:56:12 PM","proposalNumber":"1540","rgGnom":"4.82384430371","volume":"256.913","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/dammin.pdb","comments":null},{"total":"0.65086567154","bufferBeforeMeasurementId":25357,"sampleMergeId":14370,"averagedModelId":147096,"I0":"72.7972","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1401/1d/damaver.pdb","bufferAfterMergeId":14371,"framesCount":"10","bufferBeforeMergeId":14369,"averageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_055_ave.dat","bufferAfterMeasurementId":25359,"rgGuinier":"4.83826","subtractedFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_055_sub.dat","firstPointUsed":"26","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1401/1d/chi2_R.png","abInitioModelId":992,"macromoleculeId":5950,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 15:57:47.946191","bufferAcronym":"classic_3MGdmCl","quality":"0.759691","shapeDeterminationModelId":147098,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":821,"isagregated":"False","dmax":"16.208171","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_054_ave.dat","exposureTemperature":"20.0","subtractionId":5989,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 3:45:37 PM","lastPointUsed":"56","modelListId":992,"framesMerge":"10","rapidShapeDeterminationModelId":147097,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1401/1d/CedMax_run3_056_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1401/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1401,"macromoleculeAcronym":"P135_237_3MGdmCl","i0stdev":"0.283296","sampleMeasurementId":25358,"measurementComments":"[4] P135-237 25mM Tris 75mM  NaCl 3M GdmCl","priorityLevelId":11,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 3:59:41 PM","proposalNumber":"1540","rgGnom":"4.90292479295","volume":"302.752","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1401/1d/dammin.pdb","comments":null},{"total":"0.538935515604","bufferBeforeMeasurementId":25360,"sampleMergeId":14373,"averagedModelId":147267,"I0":"146.18019802","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1402/25361/damaver_%s.pdb","bufferAfterMergeId":14374,"framesCount":"10","bufferBeforeMergeId":14372,"averageFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_035_ave.dat","bufferAfterMeasurementId":25362,"rgGuinier":"3.75297","subtractedFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_035_sub.dat","firstPointUsed":"52","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1402/25361/chi2_R.png","abInitioModelId":993,"macromoleculeId":5952,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 16:53:47.699933","bufferAcronym":"brgmbmp","quality":"0.367667","shapeDeterminationModelId":147269,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":823,"isagregated":"True","dmax":"13.135395","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_034_ave.dat","exposureTemperature":"20.0","subtractionId":5990,"conc":"1.01","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1402/25361/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 4:52:07 PM","lastPointUsed":"74","modelListId":993,"framesMerge":"1","rapidShapeDeterminationModelId":147268,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_036_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1402/25361/nsd.png","bufferAfterFramesMerged":"10","experimentId":1402,"macromoleculeAcronym":"RGMBMP","i0stdev":"0.741320792079","sampleMeasurementId":25361,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 4:55:39 PM","proposalNumber":"1540","rgGnom":"3.86411412231","volume":"121.137","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1402/25361/dammin.pdb","comments":null},{"total":"0.497881748335","bufferBeforeMeasurementId":25363,"sampleMergeId":14376,"averagedModelId":147438,"I0":"187.934653465","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1402/25364/damaver_%s.pdb","bufferAfterMergeId":14377,"framesCount":"10","bufferBeforeMergeId":14375,"averageFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_038_ave.dat","bufferAfterMeasurementId":25365,"rgGuinier":"4.14298","subtractedFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_038_sub.dat","firstPointUsed":"17","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1402/25364/chi2_R.png","abInitioModelId":994,"macromoleculeId":5951,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 16:57:14.402462","bufferAcronym":"brgmneo","quality":"0.882527","shapeDeterminationModelId":147440,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":824,"isagregated":"False","dmax":"14.50043","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_037_ave.dat","exposureTemperature":"20.0","subtractionId":5991,"conc":"1.01","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1402/25364/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 4:52:07 PM","lastPointUsed":"43","modelListId":994,"framesMerge":"6","rapidShapeDeterminationModelId":147439,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1402/1d/ELLIE_run2_039_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1402/25364/nsd.png","bufferAfterFramesMerged":"10","experimentId":1402,"macromoleculeAcronym":"RGMNEO","i0stdev":"0.246616831683","sampleMeasurementId":25364,"measurementComments":"[2]","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 4:59:06 PM","proposalNumber":"1540","rgGnom":"4.02084084912","volume":"147.48","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1402/25364/dammin.pdb","comments":null},{"total":"0.657245102682","bufferBeforeMeasurementId":25368,"sampleMergeId":14381,"averagedModelId":148114,"I0":"907.228358209","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25370/damaver_%s.pdb","bufferAfterMergeId":14382,"framesCount":"10","bufferBeforeMergeId":14380,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_043_ave.dat","bufferAfterMeasurementId":25371,"rgGuinier":"7.86781","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_043_sub.dat","firstPointUsed":"18","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25370/chi2_R.png","abInitioModelId":998,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:17:22.014031","bufferAcronym":"classic","quality":"0.738596","shapeDeterminationModelId":148116,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"27.537335","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_042_ave.dat","exposureTemperature":"20.0","subtractionId":5993,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25370/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"32","modelListId":998,"framesMerge":"9","rapidShapeDeterminationModelId":148115,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_044_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25370/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"1.06715671642","sampleMeasurementId":25370,"measurementComments":"[2] M21 P135-237 25mM Tris 150mM  NaCl 20uM RNA","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:19:15 PM","proposalNumber":"1540","rgGnom":"7.93209674016","volume":"1919.19","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25370/dammin.pdb","comments":null},{"total":"0.527632131737","bufferBeforeMeasurementId":25366,"sampleMergeId":14379,"averagedModelId":147605,"I0":"216.534328358","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25367/damaver_%s.pdb","bufferAfterMergeId":14380,"framesCount":"10","bufferBeforeMergeId":14378,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_041_ave.dat","bufferAfterMeasurementId":25368,"rgGuinier":"4.99142","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_041_sub.dat","firstPointUsed":"31","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25367/chi2_R.png","abInitioModelId":995,"macromoleculeId":5940,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:15:00.172645","bufferAcronym":"classic","quality":"0.73465","shapeDeterminationModelId":147607,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"17.46997","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_040_ave.dat","exposureTemperature":"20.0","subtractionId":5992,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25367/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"54","modelListId":995,"framesMerge":"9","rapidShapeDeterminationModelId":147606,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_042_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25367/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_P135_237","i0stdev":"0.56988358209","sampleMeasurementId":25367,"measurementComments":"[1] M21 P135-237 25mM Tris 150mM  NaCl noRNA","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:16:54 PM","proposalNumber":"1540","rgGnom":"5.12500550494","volume":"391.217","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25367/dammin.pdb","comments":null},{"total":"0.756524675637","bufferBeforeMeasurementId":25374,"sampleMergeId":14385,"averagedModelId":147945,"I0":"814.114925373","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25376/damaver_%s.pdb","bufferAfterMergeId":14386,"framesCount":"10","bufferBeforeMergeId":14384,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_047_ave.dat","bufferAfterMeasurementId":25377,"rgGuinier":"7.45487","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_047_sub.dat","firstPointUsed":"18","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25376/chi2_R.png","abInitioModelId":997,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:22:04.661889","bufferAcronym":"classic","quality":"0.7641","shapeDeterminationModelId":147947,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"26.092045","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_046_ave.dat","exposureTemperature":"20.0","subtractionId":5995,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25376/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"34","modelListId":997,"framesMerge":"9","rapidShapeDeterminationModelId":147946,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_048_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25376/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.951173134328","sampleMeasurementId":25376,"measurementComments":"[4] M21 P135-237 25mM Tris 150mM  NaCl 80uM RNA","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:24:01 PM","proposalNumber":"1540","rgGnom":"7.47883502528","volume":"1584.11","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25376/dammin.pdb","comments":null},{"total":"0.676305699484","bufferBeforeMeasurementId":25371,"sampleMergeId":14383,"averagedModelId":147774,"I0":"899.443283582","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25373/damaver_%s.pdb","bufferAfterMergeId":14384,"framesCount":"10","bufferBeforeMergeId":14382,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_045_ave.dat","bufferAfterMeasurementId":25374,"rgGuinier":"7.71595","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_045_sub.dat","firstPointUsed":"13","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25373/chi2_R.png","abInitioModelId":996,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:19:43.632503","bufferAcronym":"classic","quality":"0.817891","shapeDeterminationModelId":147776,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"27.005825","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_044_ave.dat","exposureTemperature":"20.0","subtractionId":5994,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25373/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"32","modelListId":996,"framesMerge":"10","rapidShapeDeterminationModelId":147775,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_046_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25373/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.837419402985","sampleMeasurementId":25373,"measurementComments":"[3] M21 P135-237 25mM Tris 150mM  NaCl 40uM RNA","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:21:35 PM","proposalNumber":"1540","rgGnom":"7.74202657764","volume":"1872.74","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25373/dammin.pdb","comments":null},{"total":"0.420559675568","bufferBeforeMeasurementId":25380,"sampleMergeId":14390,"averagedModelId":148283,"I0":"172.28358209","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25382/damaver_%s.pdb","bufferAfterMergeId":14391,"framesCount":"10","bufferBeforeMergeId":14389,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_052_ave.dat","bufferAfterMeasurementId":25383,"rgGuinier":"5.1428","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_052_sub.dat","firstPointUsed":"14","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25382/chi2_R.png","abInitioModelId":999,"macromoleculeId":5953,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:28:14.746742","bufferAcronym":"half_NDSB","quality":"0.890053","shapeDeterminationModelId":148285,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"17.9998","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_051_ave.dat","exposureTemperature":"20.0","subtractionId":5997,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25382/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"44","modelListId":999,"framesMerge":"9","rapidShapeDeterminationModelId":148284,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_053_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25382/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_1RNA","i0stdev":"0.224335820896","sampleMeasurementId":25382,"measurementComments":"[6] M21 25mM Tris 150mM  NaCl 1uM RNA","priorityLevelId":13,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:30:08 PM","proposalNumber":"1540","rgGnom":"5.22093704252","volume":"285.847","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25382/dammin.pdb","comments":null},{"total":"0.646639179514","bufferBeforeMeasurementId":25383,"sampleMergeId":14392,"averagedModelId":148619,"I0":"745.192537313","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25385/damaver_%s.pdb","bufferAfterMergeId":14393,"framesCount":"10","bufferBeforeMergeId":14391,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_054_ave.dat","bufferAfterMeasurementId":25386,"rgGuinier":"7.9624","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_054_sub.dat","firstPointUsed":"8","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25385/chi2_R.png","abInitioModelId":1001,"macromoleculeId":5959,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:30:36.475897","bufferAcronym":"half_NDSB","quality":"0.881615","shapeDeterminationModelId":148621,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"27.8684","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_053_ave.dat","exposureTemperature":"20.0","subtractionId":5998,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25385/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"28","modelListId":1001,"framesMerge":"9","rapidShapeDeterminationModelId":148620,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_055_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25385/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_5RNA","i0stdev":"0.804667164179","sampleMeasurementId":25385,"measurementComments":"[7] M21 25mM Tris 150mM  NaCl 5uM RNA","priorityLevelId":15,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:32:30 PM","proposalNumber":"1540","rgGnom":"8.01348844312","volume":"1505.78","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25385/dammin.pdb","comments":null},{"total":"0.658729235526","bufferBeforeMeasurementId":25386,"sampleMergeId":14394,"averagedModelId":148788,"I0":"1109.40149254","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25388/damaver_%s.pdb","bufferAfterMergeId":14395,"framesCount":"10","bufferBeforeMergeId":14393,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_056_ave.dat","bufferAfterMeasurementId":25389,"rgGuinier":"7.99587","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_056_sub.dat","firstPointUsed":"8","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25388/chi2_R.png","abInitioModelId":1002,"macromoleculeId":5958,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:32:58.656536","bufferAcronym":"half_NDSB","quality":"0.880718","shapeDeterminationModelId":148790,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"27.985545","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_055_ave.dat","exposureTemperature":"20.0","subtractionId":5999,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25388/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"28","modelListId":1002,"framesMerge":"9","rapidShapeDeterminationModelId":148789,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_057_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25388/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_10RNA","i0stdev":"0.849147761194","sampleMeasurementId":25388,"measurementComments":"[8] M21 25mM Tris 150mM  NaCl 10uM RNA","priorityLevelId":17,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:34:55 PM","proposalNumber":"1540","rgGnom":"8.05079803445","volume":"2151.39","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25388/dammin.pdb","comments":null},{"total":"0.698248289858","bufferBeforeMeasurementId":25389,"sampleMergeId":14396,"averagedModelId":148957,"I0":"1470.65074627","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25391/damaver_%s.pdb","bufferAfterMergeId":14397,"framesCount":"10","bufferBeforeMergeId":14395,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_058_ave.dat","bufferAfterMeasurementId":25392,"rgGuinier":"7.88705","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_058_sub.dat","firstPointUsed":"7","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25391/chi2_R.png","abInitioModelId":1003,"macromoleculeId":5955,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:35:21.773437","bufferAcronym":"half_NDSB","quality":"0.893308","shapeDeterminationModelId":148959,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"27.604675","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_057_ave.dat","exposureTemperature":"20.0","subtractionId":6000,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25391/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"31","modelListId":1003,"framesMerge":"10","rapidShapeDeterminationModelId":148958,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_059_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25391/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_20RNA","i0stdev":"0.887368656716","sampleMeasurementId":25391,"measurementComments":"[9] M21 25mM Tris 150mM  NaCl 20uM RNA","priorityLevelId":19,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:37:17 PM","proposalNumber":"1540","rgGnom":"7.88263739485","volume":"2699.94","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25391/dammin.pdb","comments":null},{"total":"0.747410235735","bufferBeforeMeasurementId":25392,"sampleMergeId":14398,"averagedModelId":149295,"I0":"1286.68955224","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25394/damaver_%s.pdb","bufferAfterMergeId":14399,"framesCount":"10","bufferBeforeMergeId":14397,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_060_ave.dat","bufferAfterMeasurementId":25395,"rgGuinier":"7.36616","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_060_sub.dat","firstPointUsed":"9","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25394/chi2_R.png","abInitioModelId":1005,"macromoleculeId":5954,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:37:44.868022","bufferAcronym":"half_NDSB","quality":"0.876378","shapeDeterminationModelId":149297,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"25.78156","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_059_ave.dat","exposureTemperature":"20.0","subtractionId":6001,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25394/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"31","modelListId":1005,"framesMerge":"10","rapidShapeDeterminationModelId":149296,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_061_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25394/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_40RNA","i0stdev":"0.723094029851","sampleMeasurementId":25394,"measurementComments":"[10] M21 25mM Tris 150mM  NaCl 40uM RNA","priorityLevelId":21,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:39:40 PM","proposalNumber":"1540","rgGnom":"7.38193457384","volume":"2193.74","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25394/dammin.pdb","comments":null},{"total":"0.764328912872","bufferBeforeMeasurementId":25395,"sampleMergeId":14400,"averagedModelId":149124,"I0":"1094.74925373","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25397/damaver_%s.pdb","bufferAfterMergeId":14401,"framesCount":"10","bufferBeforeMergeId":14399,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_062_ave.dat","bufferAfterMeasurementId":25398,"rgGuinier":"7.1499","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_062_sub.dat","firstPointUsed":"10","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25397/chi2_R.png","abInitioModelId":1004,"macromoleculeId":5956,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:40:07.580058","bufferAcronym":"half_NDSB","quality":"0.865288","shapeDeterminationModelId":149126,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"23.952165","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_061_ave.dat","exposureTemperature":"20.0","subtractionId":6002,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25397/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"34","modelListId":1004,"framesMerge":"9","rapidShapeDeterminationModelId":149125,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_063_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25397/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_80RNA","i0stdev":"0.685871641791","sampleMeasurementId":25397,"measurementComments":"[11] M21 25mM Tris 150mM  NaCl 80uM RNA","priorityLevelId":23,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:42:03 PM","proposalNumber":"1540","rgGnom":"7.11293955115","volume":"1733.46","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25397/dammin.pdb","comments":null},{"total":"0.510394883812","bufferBeforeMeasurementId":25378,"sampleMergeId":14388,"averagedModelId":148450,"I0":"122.339552239","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1403/25379/damaver_%s.pdb","bufferAfterMergeId":14389,"framesCount":"10","bufferBeforeMergeId":14387,"averageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_050_ave.dat","bufferAfterMeasurementId":25380,"rgGuinier":"4.26111","subtractedFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_050_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1403/25379/chi2_R.png","abInitioModelId":1000,"macromoleculeId":5957,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 17:25:38.583345","bufferAcronym":"half_NDSB","quality":"0.91891","shapeDeterminationModelId":148452,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"14.913885","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_049_ave.dat","exposureTemperature":"20.0","subtractionId":5996,"conc":"0.67000000000000004","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25379/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 5:13:14 PM","lastPointUsed":"44","modelListId":1000,"framesMerge":"10","rapidShapeDeterminationModelId":148451,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1403/1d/CedMax_run4_051_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1403/25379/nsd.png","bufferAfterFramesMerged":"10","experimentId":1403,"macromoleculeAcronym":"M21_noRNA","i0stdev":"0.194829850746","sampleMeasurementId":25379,"measurementComments":"[5] M21 25mM Tris 150mM  NaCl noRNA","priorityLevelId":11,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 5:27:47 PM","proposalNumber":"1540","rgGnom":"4.16645880146","volume":"237.265","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1403/25379/dammin.pdb","comments":null},{"total":"0.401001459048","bufferBeforeMeasurementId":25399,"sampleMergeId":14403,"averagedModelId":149464,"I0":"265.186111111","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1404/25400/damaver_%s.pdb","bufferAfterMergeId":14404,"framesCount":"10","bufferBeforeMergeId":14402,"averageFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_041_ave.dat","bufferAfterMeasurementId":25401,"rgGuinier":"5.30241","subtractedFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_041_sub.dat","firstPointUsed":"12","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1404/25400/chi2_R.png","abInitioModelId":1006,"macromoleculeId":5951,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 18:11:48.652348","bufferAcronym":"brgmneo","quality":"0.871552","shapeDeterminationModelId":149466,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":824,"isagregated":"False","dmax":"18.558435","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_040_ave.dat","exposureTemperature":"20.0","subtractionId":6003,"conc":"2.52","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1404/25400/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 6:10:01 PM","lastPointUsed":"32","modelListId":1006,"framesMerge":"2","rapidShapeDeterminationModelId":149465,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_042_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1404/25400/nsd.png","bufferAfterFramesMerged":"10","experimentId":1404,"macromoleculeAcronym":"RGMNEO","i0stdev":"0.348932539683","sampleMeasurementId":25400,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 6:13:46 PM","proposalNumber":"1540","rgGnom":"5.06415643964","volume":"216.864","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1404/25400/dammin.pdb","comments":null},{"total":"0.664568368406","bufferBeforeMeasurementId":25402,"sampleMergeId":14406,"averagedModelId":149633,"I0":"45.0806382979","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1404/25403/damaver_%s.pdb","bufferAfterMergeId":14407,"framesCount":"10","bufferBeforeMergeId":14405,"averageFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_044_ave.dat","bufferAfterMeasurementId":25404,"rgGuinier":"3.16502","subtractedFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_044_sub.dat","firstPointUsed":"43","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1404/25403/chi2_R.png","abInitioModelId":1007,"macromoleculeId":5942,"code":"20.0","transmission":"10.0","timeStart":"2013-09-25 18:15:29.016027","bufferAcronym":"bbmp2","quality":"0.679216","shapeDeterminationModelId":149635,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":818,"isagregated":"True","dmax":"11.07757","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_043_ave.dat","exposureTemperature":"20.0","subtractionId":6004,"conc":"1.4099999999999999","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1404/25403/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 6:10:01 PM","lastPointUsed":"78","modelListId":1007,"framesMerge":"10","rapidShapeDeterminationModelId":149634,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1404/1d/ELLIE_run3_045_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1404/25403/nsd.png","bufferAfterFramesMerged":"10","experimentId":1404,"macromoleculeAcronym":"BMP2","i0stdev":"0.0884404255319","sampleMeasurementId":25403,"measurementComments":"[2]","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 6:17:33 PM","proposalNumber":"1540","rgGnom":"3.24594318342","volume":"68.7754","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1404/25403/dammin.pdb","comments":null},{"total":"0.51635579947","bufferBeforeMeasurementId":25408,"sampleMergeId":14412,"averagedModelId":149971,"I0":"145.810526316","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1405/25409/damaver_%s.pdb","bufferAfterMergeId":14413,"framesCount":"10","bufferBeforeMergeId":14411,"averageFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_050_ave.dat","bufferAfterMeasurementId":25410,"rgGuinier":"3.7777","subtractedFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_050_sub.dat","firstPointUsed":"34","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1405/25409/chi2_R.png","abInitioModelId":1009,"macromoleculeId":5960,"code":"20.0","transmission":"10.0","timeStart":"2013-09-25 18:57:57.085523","bufferAcronym":"brgmbmp","quality":"0.739073","shapeDeterminationModelId":149973,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":823,"isagregated":"True","dmax":"12.3719675","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_049_ave.dat","exposureTemperature":"20.0","subtractionId":6006,"conc":"1.1399999999999999","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1405/25409/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 6:52:31 PM","lastPointUsed":"69","modelListId":1009,"framesMerge":"1","rapidShapeDeterminationModelId":149972,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_051_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1405/25409/nsd.png","bufferAfterFramesMerged":"10","experimentId":1405,"macromoleculeAcronym":"FGMBMP","i0stdev":"0.435313157895","sampleMeasurementId":25409,"measurementComments":"[2]","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 6:59:57 PM","proposalNumber":"1540","rgGnom":"3.75335062312","volume":"115.273","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1405/25409/dammin.pdb","comments":null},{"total":"0.404734829489","bufferBeforeMeasurementId":25405,"sampleMergeId":14409,"averagedModelId":149800,"I0":"705.567647059","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1405/25406/damaver_%s.pdb","bufferAfterMergeId":14410,"framesCount":"10","bufferBeforeMergeId":14408,"averageFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_047_ave.dat","bufferAfterMeasurementId":25407,"rgGuinier":"6.46329","subtractedFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_047_sub.dat","firstPointUsed":"19","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1405/25406/chi2_R.png","abInitioModelId":1008,"macromoleculeId":5961,"code":"20.0","transmission":"50.0","timeStart":"2013-09-25 18:54:17.332797","bufferAcronym":"brgmneobmp","quality":"0.74763","shapeDeterminationModelId":149802,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":826,"isagregated":"False","dmax":"22.621515","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_046_ave.dat","exposureTemperature":"20.0","subtractionId":6005,"conc":"0.68000000000000005","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1405/25406/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 6:52:31 PM","lastPointUsed":"34","modelListId":1008,"framesMerge":"7","rapidShapeDeterminationModelId":149801,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1405/1d/ELLIE_run4_048_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1405/25406/nsd.png","bufferAfterFramesMerged":"10","experimentId":1405,"macromoleculeAcronym":"RGMNEOBMP","i0stdev":"1.62479411765","sampleMeasurementId":25406,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 6:56:11 PM","proposalNumber":"1540","rgGnom":"6.38151133929","volume":"418.538","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1405/25406/dammin.pdb","comments":null},{"total":"0.641627090715","bufferBeforeMeasurementId":25413,"sampleMergeId":14417,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14418,"framesCount":"10","bufferBeforeMergeId":14416,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_055_ave.dat","bufferAfterMeasurementId":25416,"rgGuinier":"47.1331244758","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_055_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":1010,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:28:59.729784","bufferAcronym":"half_classic","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":827,"isagregated":"False","dmax":"239.200606715","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_054_ave.dat","exposureTemperature":"20.0","subtractionId":6008,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":1010,"framesMerge":"1","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_056_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.0","sampleMeasurementId":25415,"measurementComments":"[2] M21 P135-237 25mM Tris 75mM  NaCl 20uM RNA","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:30:54 PM","proposalNumber":"1540","rgGnom":"84.3770012851","volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.531365802895","bufferBeforeMeasurementId":25411,"sampleMergeId":14415,"averagedModelId":150140,"I0":"431.384848485","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1406/25412/damaver_%s.pdb","bufferAfterMergeId":14416,"framesCount":"10","bufferBeforeMergeId":14414,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_053_ave.dat","bufferAfterMeasurementId":25413,"rgGuinier":"6.30355","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_053_sub.dat","firstPointUsed":"21","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1406/25412/chi2_R.png","abInitioModelId":1014,"macromoleculeId":5940,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:26:35.149112","bufferAcronym":"half_classic","quality":"0.744415","shapeDeterminationModelId":150142,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":827,"isagregated":"False","dmax":"20.17136","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_052_ave.dat","exposureTemperature":"20.0","subtractionId":6007,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1406/25412/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"37","modelListId":1014,"framesMerge":"2","rapidShapeDeterminationModelId":150141,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_054_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1406/25412/nsd.png","bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_P135_237","i0stdev":"2.1669030303","sampleMeasurementId":25412,"measurementComments":"[1] M21 P135-237 25mM Tris 75mM  NaCl noRNA","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:28:31 PM","proposalNumber":"1540","rgGnom":"6.02314278585","volume":"604.074","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1406/25412/dammin.pdb","comments":null},{"total":"0.634444143204","bufferBeforeMeasurementId":25419,"sampleMergeId":14421,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14422,"framesCount":"10","bufferBeforeMergeId":14420,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_059_ave.dat","bufferAfterMeasurementId":25422,"rgGuinier":"46.7987833926","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_059_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":1012,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:33:48.955756","bufferAcronym":"half_classic","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":827,"isagregated":"False","dmax":"237.503825718","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_058_ave.dat","exposureTemperature":"20.0","subtractionId":6010,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":1012,"framesMerge":"2","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_060_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.0","sampleMeasurementId":25421,"measurementComments":"[4] M21 P135-237 25mM Tris 75mM  NaCl 80uM RNA","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:35:44 PM","proposalNumber":"1540","rgGnom":"83.5701687235","volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.640357440999","bufferBeforeMeasurementId":25416,"sampleMergeId":14419,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14420,"framesCount":"10","bufferBeforeMergeId":14418,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_057_ave.dat","bufferAfterMeasurementId":25419,"rgGuinier":"47.1145349177","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_057_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":1011,"macromoleculeId":5946,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:31:24.273779","bufferAcronym":"half_classic","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":827,"isagregated":"False","dmax":"239.106264707","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_056_ave.dat","exposureTemperature":"20.0","subtractionId":6009,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":1011,"framesMerge":"1","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_058_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_P135_237RNA","i0stdev":"0.0","sampleMeasurementId":25418,"measurementComments":"[3] M21 P135-237 25mM Tris 75mM  NaCl 40uM RNA","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:33:20 PM","proposalNumber":"1540","rgGnom":"84.4156395859","volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.531582698532","bufferBeforeMeasurementId":25425,"sampleMergeId":14426,"averagedModelId":150309,"I0":"0.0","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1406/25427/damaver_%s.pdb","bufferAfterMergeId":14427,"framesCount":"10","bufferBeforeMergeId":14425,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_064_ave.dat","bufferAfterMeasurementId":25428,"rgGuinier":"51.1800518464","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_064_sub.dat","firstPointUsed":"0","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1406/25427/chi2_R.png","abInitioModelId":1015,"macromoleculeId":5953,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:40:04.990271","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":150311,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":"179.130181463","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_063_ave.dat","exposureTemperature":"20.0","subtractionId":6012,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1406/25427/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":1015,"framesMerge":"1","rapidShapeDeterminationModelId":150310,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_065_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1406/25427/nsd.png","bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_1RNA","i0stdev":"0.0","sampleMeasurementId":25427,"measurementComments":"[6] M21 25mM Tris 75mM  NaCl 1uM RNA 250NDSB","priorityLevelId":13,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:42:11 PM","proposalNumber":"1540","rgGnom":"58.3535527097","volume":"1135350.0","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1406/25427/dammin.pdb","comments":null},{"total":"0.566318758094","bufferBeforeMeasurementId":25428,"sampleMergeId":14428,"averagedModelId":150474,"I0":"0.0","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1406/25430/damaver_%s.pdb","bufferAfterMergeId":14429,"framesCount":"10","bufferBeforeMergeId":14427,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_066_ave.dat","bufferAfterMeasurementId":25431,"rgGuinier":"49.0574816505","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_066_sub.dat","firstPointUsed":"0","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1406/25430/chi2_R.png","abInitioModelId":1016,"macromoleculeId":5959,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:42:40.835768","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":150476,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":"142.266696787","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_065_ave.dat","exposureTemperature":"20.0","subtractionId":6013,"conc":"0.33000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1406/25430/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":1016,"framesMerge":"1","rapidShapeDeterminationModelId":150475,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_067_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1406/25430/nsd.png","bufferAfterFramesMerged":"4","experimentId":1406,"macromoleculeAcronym":"M21_5RNA","i0stdev":"0.0","sampleMeasurementId":25430,"measurementComments":"[7] M21 25mM Tris 75mM  NaCl 5uM RNA 250NDSB","priorityLevelId":15,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:44:47 PM","proposalNumber":"1540","rgGnom":"3.97925559535","volume":"397433.0","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1406/25430/dammin.pdb","comments":null},{"total":null,"bufferBeforeMeasurementId":25431,"sampleMergeId":14430,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14431,"framesCount":"10","bufferBeforeMergeId":14429,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_068_ave.dat","bufferAfterMeasurementId":25434,"rgGuinier":null,"subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_068_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5958,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:45:18.038654","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":null,"bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_067_ave.dat","exposureTemperature":"20.0","subtractionId":6014,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":null,"framesMerge":"4","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_069_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_10RNA","i0stdev":"0.0","sampleMeasurementId":25433,"measurementComments":"[8] M21 25mM Tris 75mM  NaCl 10uM RNA 250NDSB","priorityLevelId":17,"bufferBeforeFramesMerged":"4","substractionCreationTime":"Sep 25, 2013 7:47:25 PM","proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":null,"bufferBeforeMeasurementId":25434,"sampleMergeId":14432,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14433,"framesCount":"10","bufferBeforeMergeId":14431,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_070_ave.dat","bufferAfterMeasurementId":25437,"rgGuinier":null,"subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_070_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5955,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:47:55.404093","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":null,"bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_069_ave.dat","exposureTemperature":"20.0","subtractionId":6015,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":null,"framesMerge":"1","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_071_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_20RNA","i0stdev":"0.0","sampleMeasurementId":25436,"measurementComments":"[9] M21 25mM Tris 75mM  NaCl 20uM RNA 250NDSB","priorityLevelId":19,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:50:00 PM","proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":null,"bufferBeforeMeasurementId":25437,"sampleMergeId":14434,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14435,"framesCount":"10","bufferBeforeMergeId":14433,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_072_ave.dat","bufferAfterMeasurementId":25440,"rgGuinier":null,"subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_072_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5954,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:50:32.957562","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":null,"bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_071_ave.dat","exposureTemperature":"20.0","subtractionId":6016,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":null,"framesMerge":"1","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_073_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_40RNA","i0stdev":"0.0","sampleMeasurementId":25439,"measurementComments":"[10] M21 25mM Tris 75mM  NaCl 40uM RNA 250NDSB","priorityLevelId":21,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:52:37 PM","proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":null,"bufferBeforeMeasurementId":25440,"sampleMergeId":14436,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14437,"framesCount":"10","bufferBeforeMergeId":14435,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_074_ave.dat","bufferAfterMeasurementId":25443,"rgGuinier":null,"subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_074_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5956,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:53:10.818213","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":null,"bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_073_ave.dat","exposureTemperature":"20.0","subtractionId":6017,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":null,"framesMerge":"1","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_075_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_80RNA","i0stdev":"0.0","sampleMeasurementId":25442,"measurementComments":"[11] M21 25mM Tris 75mM  NaCl 80uM RNA 250NDSB","priorityLevelId":23,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:55:17 PM","proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.706570414146","bufferBeforeMeasurementId":25423,"sampleMergeId":14424,"averagedModelId":null,"I0":"0.0","proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":14425,"framesCount":"10","bufferBeforeMergeId":14423,"averageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_062_ave.dat","bufferAfterMeasurementId":25425,"rgGuinier":"45.291303332","subtractedFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_062_sub.dat","firstPointUsed":"0","chi2RgFilePath":null,"abInitioModelId":1013,"macromoleculeId":5957,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 19:37:28.341210","bufferAcronym":"quarter_NDSB","quality":"0.0","shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":828,"isagregated":"False","dmax":"226.45651666","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_061_ave.dat","exposureTemperature":"20.0","subtractionId":6011,"conc":"0.33000000000000002","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 25, 2013 7:24:47 PM","lastPointUsed":"0","modelListId":1013,"framesMerge":"1","rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1406/1d/CedMax_run5_063_ave.dat","nsdFilePath":null,"bufferAfterFramesMerged":"10","experimentId":1406,"macromoleculeAcronym":"M21_noRNA","i0stdev":"0.0","sampleMeasurementId":25424,"measurementComments":"[5] M21 25mM Tris 75mM  NaCl noRNA 250NDSB","priorityLevelId":11,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 7:39:35 PM","proposalNumber":"1540","rgGnom":"81.0830255089","volume":"3750140.0","shapeDeterminationModel":null,"comments":null},{"total":"0.497404412355","bufferBeforeMeasurementId":25444,"sampleMergeId":14439,"averagedModelId":150812,"I0":"488.876190476","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1407/25445/damaver_%s.pdb","bufferAfterMergeId":14440,"framesCount":"10","bufferBeforeMergeId":14438,"averageFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_050_ave.dat","bufferAfterMeasurementId":25446,"rgGuinier":"5.13502","subtractedFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_050_sub.dat","firstPointUsed":"19","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1407/25445/chi2_R.png","abInitioModelId":1018,"macromoleculeId":5961,"code":"20.0","transmission":"50.0","timeStart":"2013-09-25 21:54:58.451197","bufferAcronym":"brgmneobmp","quality":"0.8311","shapeDeterminationModelId":150814,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":826,"isagregated":"False","dmax":"17.97257","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_049_ave.dat","exposureTemperature":"20.0","subtractionId":6018,"conc":"0.20999999999999999","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1407/25445/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 9:53:11 PM","lastPointUsed":"42","modelListId":1018,"framesMerge":"7","rapidShapeDeterminationModelId":150813,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_051_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1407/25445/nsd.png","bufferAfterFramesMerged":"10","experimentId":1407,"macromoleculeAcronym":"RGMNEOBMP","i0stdev":"1.09759047619","sampleMeasurementId":25445,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 9:56:53 PM","proposalNumber":"1540","rgGnom":"5.11790091158","volume":"265.311","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1407/25445/dammin.pdb","comments":null},{"total":"0.500795823254","bufferBeforeMeasurementId":25446,"sampleMergeId":14441,"averagedModelId":150645,"I0":"496.424324324","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1407/25448/damaver_%s.pdb","bufferAfterMergeId":14442,"framesCount":"10","bufferBeforeMergeId":14440,"averageFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_052_ave.dat","bufferAfterMeasurementId":25449,"rgGuinier":"5.06184","subtractedFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_052_sub.dat","firstPointUsed":"35","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1407/25448/chi2_R.png","abInitioModelId":1017,"macromoleculeId":5961,"code":"20.0","transmission":"50.0","timeStart":"2013-09-25 21:57:23.852764","bufferAcronym":"brgmneobmp","quality":"0.671378","shapeDeterminationModelId":150647,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":826,"isagregated":"False","dmax":"17.71644","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_051_ave.dat","exposureTemperature":"20.0","subtractionId":6019,"conc":"0.37","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1407/25448/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 9:53:11 PM","lastPointUsed":"53","modelListId":1017,"framesMerge":"9","rapidShapeDeterminationModelId":150646,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1407/1d/ELLIE_run5_053_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1407/25448/nsd.png","bufferAfterFramesMerged":"10","experimentId":1407,"macromoleculeAcronym":"RGMNEOBMP","i0stdev":"1.1338972973","sampleMeasurementId":25448,"measurementComments":"[2]","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 9:59:18 PM","proposalNumber":"1540","rgGnom":"5.2089407402","volume":"287.11","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1407/25448/dammin.pdb","comments":null},{"total":"0.512964420814","bufferBeforeMeasurementId":25470,"sampleMergeId":14460,"averagedModelId":152331,"I0":"134.041818182","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25472/damaver_%s.pdb","bufferAfterMergeId":14461,"framesCount":"10","bufferBeforeMergeId":14459,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_071_ave.dat","bufferAfterMeasurementId":25473,"rgGuinier":"4.1929","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_071_sub.dat","firstPointUsed":"22","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25472/chi2_R.png","abInitioModelId":1027,"macromoleculeId":5964,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:56:40.214527","bufferAcronym":"classic_EDTA","quality":"0.86072","shapeDeterminationModelId":152333,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":829,"isagregated":"False","dmax":"14.3606825","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_070_ave.dat","exposureTemperature":"20.0","subtractionId":6027,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25472/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"64","modelListId":1027,"framesMerge":"10","rapidShapeDeterminationModelId":152332,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_072_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25472/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_P135_237_1RNA_5EDTA","i0stdev":"0.319429545455","sampleMeasurementId":25472,"measurementComments":"[8] M21 P135-237 25mM Tris 150mM  NaCl 5mM EDTA 1uM RNA","priorityLevelId":18,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:58:36 PM","proposalNumber":"1540","rgGnom":"4.30394402088","volume":"180.436","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25472/dammin.pdb","comments":null},{"total":"0.511498115574","bufferBeforeMeasurementId":25468,"sampleMergeId":14458,"averagedModelId":152164,"I0":"132.345909091","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25469/damaver_%s.pdb","bufferAfterMergeId":14459,"framesCount":"10","bufferBeforeMergeId":14457,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_069_ave.dat","bufferAfterMeasurementId":25470,"rgGuinier":"4.20204","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_069_sub.dat","firstPointUsed":"15","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25469/chi2_R.png","abInitioModelId":1026,"macromoleculeId":5967,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:54:17.538860","bufferAcronym":"classic_EDTA","quality":"0.905019","shapeDeterminationModelId":152166,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":829,"isagregated":"False","dmax":"14.70714","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_068_ave.dat","exposureTemperature":"20.0","subtractionId":6026,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25469/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"55","modelListId":1026,"framesMerge":"10","rapidShapeDeterminationModelId":152165,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_070_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25469/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_P135_237_noRNA_5EDTA","i0stdev":"0.269409090909","sampleMeasurementId":25469,"measurementComments":"[7] M21 P135-237 25mM Tris 150mM  NaCl 5mM EDTA","priorityLevelId":16,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:56:13 PM","proposalNumber":"1540","rgGnom":"4.24667381963","volume":"168.427","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25469/dammin.pdb","comments":null},{"total":"0.572497607523","bufferBeforeMeasurementId":25450,"sampleMergeId":14444,"averagedModelId":150981,"I0":"102.9996","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25451/damaver_%s.pdb","bufferAfterMergeId":14445,"framesCount":"10","bufferBeforeMergeId":14443,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_055_ave.dat","bufferAfterMeasurementId":25452,"rgGuinier":"3.78939","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_055_sub.dat","firstPointUsed":"25","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25451/chi2_R.png","abInitioModelId":1019,"macromoleculeId":5972,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:37:33.489212","bufferAcronym":"half_NDSB_EDTA","quality":"0.856833","shapeDeterminationModelId":150983,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"13.262865","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_054_ave.dat","exposureTemperature":"20.0","subtractionId":6020,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25451/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"67","modelListId":1019,"framesMerge":"10","rapidShapeDeterminationModelId":150982,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_056_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25451/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_noRNA_EDTA","i0stdev":"0.28036","sampleMeasurementId":25451,"measurementComments":"[1] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:39:28 PM","proposalNumber":"1540","rgGnom":"3.87791168685","volume":"133.796","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25451/dammin.pdb","comments":null},{"total":"0.873921238561","bufferBeforeMeasurementId":25465,"sampleMergeId":14455,"averagedModelId":151830,"I0":"156.603181818","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25466/damaver_%s.pdb","bufferAfterMergeId":14456,"framesCount":"10","bufferBeforeMergeId":14454,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_066_ave.dat","bufferAfterMeasurementId":25467,"rgGuinier":"4.5987","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_066_sub.dat","firstPointUsed":"25","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25466/chi2_R.png","abInitioModelId":1024,"macromoleculeId":5965,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:50:41.167553","bufferAcronym":"classic","quality":"0.801111","shapeDeterminationModelId":151832,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":815,"isagregated":"False","dmax":"16.09545","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_065_ave.dat","exposureTemperature":"20.0","subtractionId":6025,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25466/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"59","modelListId":1024,"framesMerge":"9","rapidShapeDeterminationModelId":151831,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_067_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25466/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_P135_237_noRNA","i0stdev":"0.454109545455","sampleMeasurementId":25466,"measurementComments":"[6] M21 P135-237 25mM Tris 150mM  NaCl","priorityLevelId":13,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:52:37 PM","proposalNumber":"1540","rgGnom":"4.70968048213","volume":"468.967","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25466/dammin.pdb","comments":null},{"total":"0.586349175916","bufferBeforeMeasurementId":25458,"sampleMergeId":14450,"averagedModelId":151659,"I0":"275.8276","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25460/damaver_%s.pdb","bufferAfterMergeId":14451,"framesCount":"10","bufferBeforeMergeId":14449,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_061_ave.dat","bufferAfterMeasurementId":25461,"rgGuinier":"5.71919","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_061_sub.dat","firstPointUsed":"13","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25460/chi2_R.png","abInitioModelId":1023,"macromoleculeId":5962,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:44:42.114738","bufferAcronym":"half_NDSB_EDTA","quality":"0.883771","shapeDeterminationModelId":151661,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"20.017165","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_060_ave.dat","exposureTemperature":"20.0","subtractionId":6023,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25460/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"39","modelListId":1023,"framesMerge":"10","rapidShapeDeterminationModelId":151660,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_062_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25460/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_5RNA_EDTA","i0stdev":"0.520376","sampleMeasurementId":25460,"measurementComments":"[4] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 5uM RNA","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:46:38 PM","proposalNumber":"1540","rgGnom":"5.86469688439","volume":"464.194","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25460/dammin.pdb","comments":null},{"total":"0.689428379016","bufferBeforeMeasurementId":25479,"sampleMergeId":14466,"averagedModelId":152665,"I0":"441.409545455","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25481/damaver_%s.pdb","bufferAfterMergeId":14467,"framesCount":"10","bufferBeforeMergeId":14465,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_077_ave.dat","bufferAfterMeasurementId":25482,"rgGuinier":"6.88744","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_077_sub.dat","firstPointUsed":"17","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25481/chi2_R.png","abInitioModelId":1029,"macromoleculeId":5970,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 23:03:54.097050","bufferAcronym":"classic_EDTA","quality":"0.806351","shapeDeterminationModelId":152667,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":829,"isagregated":"False","dmax":"24.10604","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_076_ave.dat","exposureTemperature":"20.0","subtractionId":6030,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25481/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"37","modelListId":1029,"framesMerge":"10","rapidShapeDeterminationModelId":152666,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_078_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25481/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_P135_237_5RNA_10EDTA","i0stdev":"0.882104545455","sampleMeasurementId":25481,"measurementComments":"[11] M21 P135-237 25mM Tris 150mM  NaCl 5mM EDTA 10uM RNA","priorityLevelId":24,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:05:48 PM","proposalNumber":"1540","rgGnom":"6.99315391026","volume":"981.064","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25481/dammin.pdb","comments":null},{"total":"0.571109480231","bufferBeforeMeasurementId":25461,"sampleMergeId":14452,"averagedModelId":151488,"I0":"254.9108","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25463/damaver_%s.pdb","bufferAfterMergeId":14453,"framesCount":"10","bufferBeforeMergeId":14451,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_063_ave.dat","bufferAfterMeasurementId":25464,"rgGuinier":"5.45019","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_063_sub.dat","firstPointUsed":"18","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25463/chi2_R.png","abInitioModelId":1022,"macromoleculeId":5968,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:47:04.741515","bufferAcronym":"half_NDSB_EDTA","quality":"0.843103","shapeDeterminationModelId":151490,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"19.075665","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_062_ave.dat","exposureTemperature":"20.0","subtractionId":6024,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25463/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"47","modelListId":1022,"framesMerge":"10","rapidShapeDeterminationModelId":151489,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_064_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25463/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_10RNA_EDTA","i0stdev":"0.423004","sampleMeasurementId":25463,"measurementComments":"[5] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 10uM RNA","priorityLevelId":10,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:49:01 PM","proposalNumber":"1540","rgGnom":"5.57320779139","volume":"395.096","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25463/dammin.pdb","comments":null},{"total":"0.549616720423","bufferBeforeMeasurementId":25452,"sampleMergeId":14446,"averagedModelId":151146,"I0":"126.2144","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25454/damaver_%s.pdb","bufferAfterMergeId":14447,"framesCount":"10","bufferBeforeMergeId":14445,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_057_ave.dat","bufferAfterMeasurementId":25455,"rgGuinier":"4.26333","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_057_sub.dat","firstPointUsed":"16","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25454/chi2_R.png","abInitioModelId":1020,"macromoleculeId":5966,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:39:56.343441","bufferAcronym":"half_NDSB_EDTA","quality":"0.893359","shapeDeterminationModelId":151148,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"14.921655","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_056_ave.dat","exposureTemperature":"20.0","subtractionId":6021,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25454/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"60","modelListId":1020,"framesMerge":"9","rapidShapeDeterminationModelId":151147,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_058_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25454/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_1RNA_EDTA","i0stdev":"0.2902372","sampleMeasurementId":25454,"measurementComments":"[2] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 1uM RNA","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:41:52 PM","proposalNumber":"1540","rgGnom":"4.37627282719","volume":"173.855","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25454/dammin.pdb","comments":null},{"total":"0.64347882871","bufferBeforeMeasurementId":25476,"sampleMergeId":14464,"averagedModelId":152498,"I0":"381.652727273","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25478/damaver_%s.pdb","bufferAfterMergeId":14465,"framesCount":"10","bufferBeforeMergeId":14463,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_075_ave.dat","bufferAfterMeasurementId":25479,"rgGuinier":"6.97553","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_075_sub.dat","firstPointUsed":"10","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25478/chi2_R.png","abInitioModelId":1028,"macromoleculeId":5963,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 23:01:27.753618","bufferAcronym":"classic_EDTA","quality":"0.88686","shapeDeterminationModelId":152500,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":829,"isagregated":"False","dmax":"24.414355","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_074_ave.dat","exposureTemperature":"20.0","subtractionId":6029,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25478/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"32","modelListId":1028,"framesMerge":"10","rapidShapeDeterminationModelId":152499,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_076_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25478/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_P135_237_5RNA_5EDTA","i0stdev":"0.7471","sampleMeasurementId":25478,"measurementComments":"[10] M21 P135-237 25mM Tris 150mM  NaCl 5mM EDTA 5uM RNA","priorityLevelId":22,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:03:27 PM","proposalNumber":"1540","rgGnom":"7.01852320633","volume":"863.409","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25478/dammin.pdb","comments":null},{"total":"0.64770155542","bufferBeforeMeasurementId":25455,"sampleMergeId":14448,"averagedModelId":151317,"I0":"194.2612","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25457/damaver_%s.pdb","bufferAfterMergeId":14449,"framesCount":"10","bufferBeforeMergeId":14447,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_059_ave.dat","bufferAfterMeasurementId":25458,"rgGuinier":"5.44304","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_059_sub.dat","firstPointUsed":"18","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25457/chi2_R.png","abInitioModelId":1021,"macromoleculeId":5971,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:42:19.604452","bufferAcronym":"half_NDSB_EDTA","quality":"0.854641","shapeDeterminationModelId":151319,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"19.05064","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_058_ave.dat","exposureTemperature":"20.0","subtractionId":6022,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25457/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"43","modelListId":1021,"framesMerge":"10","rapidShapeDeterminationModelId":151318,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_060_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25457/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_2p5RNA_EDTA","i0stdev":"0.586676","sampleMeasurementId":25457,"measurementComments":"[3] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 2.5uM RNA","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 10:44:15 PM","proposalNumber":"1540","rgGnom":"5.52267659151","volume":"369.628","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25457/dammin.pdb","comments":null},{"total":"0.480798704988","bufferBeforeMeasurementId":25473,"sampleMergeId":14462,"averagedModelId":151999,"I0":"160.208181818","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1408/25475/damaver_%s.pdb","bufferAfterMergeId":14463,"framesCount":"10","bufferBeforeMergeId":14461,"averageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_073_ave.dat","bufferAfterMeasurementId":25476,"rgGuinier":"4.97991","subtractedFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_073_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1408/25475/chi2_R.png","abInitioModelId":1025,"macromoleculeId":5969,"code":"20.0","transmission":"100.0","timeStart":"2013-09-25 22:59:03.867340","bufferAcronym":"classic_EDTA","quality":"0.914005","shapeDeterminationModelId":152001,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":829,"isagregated":"False","dmax":"17.429685","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_072_ave.dat","exposureTemperature":"20.0","subtractionId":6028,"conc":"0.22","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25475/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 10:35:47 PM","lastPointUsed":"44","modelListId":1025,"framesMerge":"9","rapidShapeDeterminationModelId":152000,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1408/1d/CedMax_run6_074_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1408/25475/nsd.png","bufferAfterFramesMerged":"10","experimentId":1408,"macromoleculeAcronym":"M21_P135_237_2p5RNA_5EDTA","i0stdev":"0.400198636364","sampleMeasurementId":25475,"measurementComments":"[9] M21 P135-237 25mM Tris 150mM  NaCl 5mM EDTA 2.5uM RNA","priorityLevelId":20,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:01:00 PM","proposalNumber":"1540","rgGnom":"4.99420961829","volume":"226.273","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1408/25475/dammin.pdb","comments":null},{"total":"0.457504331128","bufferBeforeMeasurementId":25486,"sampleMergeId":14472,"averagedModelId":152834,"I0":"585.596428571","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1409/25487/damaver_%s.pdb","bufferAfterMergeId":14473,"framesCount":"10","bufferBeforeMergeId":14471,"averageFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_057_ave.dat","bufferAfterMeasurementId":25488,"rgGuinier":"6.10014","subtractedFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_057_sub.dat","firstPointUsed":"21","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1409/25487/chi2_R.png","abInitioModelId":1030,"macromoleculeId":5961,"code":"20.0","transmission":"50.0","timeStart":"2013-09-25 23:23:39.481348","bufferAcronym":"brgmneobmp2","quality":"0.772685","shapeDeterminationModelId":152836,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":832,"isagregated":"False","dmax":"21.35049","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_056_ave.dat","exposureTemperature":"20.0","subtractionId":6032,"conc":"0.83999999999999997","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1409/25487/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:18:10 PM","lastPointUsed":"41","modelListId":1030,"framesMerge":"1","rapidShapeDeterminationModelId":152835,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_058_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1409/25487/nsd.png","bufferAfterFramesMerged":"10","experimentId":1409,"macromoleculeAcronym":"RGMNEOBMP","i0stdev":"1.5169047619","sampleMeasurementId":25487,"measurementComments":"[2]","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:25:38 PM","proposalNumber":"1540","rgGnom":"6.20836798091","volume":"346.591","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1409/25487/dammin.pdb","comments":null},{"total":"0.565557262645","bufferBeforeMeasurementId":25483,"sampleMergeId":14469,"averagedModelId":153001,"I0":"410.7625","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1409/25484/damaver_%s.pdb","bufferAfterMergeId":14470,"framesCount":"10","bufferBeforeMergeId":14468,"averageFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_054_ave.dat","bufferAfterMeasurementId":25485,"rgGuinier":"4.58065","subtractedFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_054_sub.dat","firstPointUsed":"32","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1409/25484/chi2_R.png","abInitioModelId":1031,"macromoleculeId":5961,"code":"20.0","transmission":"50.0","timeStart":"2013-09-25 23:19:57.653646","bufferAcronym":"brgmneobmp1","quality":"0.77119","shapeDeterminationModelId":153003,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":831,"isagregated":"False","dmax":"15.68872625","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_053_ave.dat","exposureTemperature":"20.0","subtractionId":6031,"conc":"0.16","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1409/25484/damfilt.pdb","experimentCreationDate":"Sep 25, 2013 11:18:10 PM","lastPointUsed":"58","modelListId":1031,"framesMerge":"10","rapidShapeDeterminationModelId":153002,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1409/1d/ELLIE_run6_055_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1409/25484/nsd.png","bufferAfterFramesMerged":"10","experimentId":1409,"macromoleculeAcronym":"RGMNEOBMP","i0stdev":"1.16879375","sampleMeasurementId":25484,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 25, 2013 11:21:53 PM","proposalNumber":"1540","rgGnom":"4.6464679793","volume":"222.115","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1409/25484/dammin.pdb","comments":null},{"total":"0.625310299736","bufferBeforeMeasurementId":25503,"sampleMergeId":14485,"averagedModelId":154017,"I0":"369.94","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1410/25505/damaver_%s.pdb","bufferAfterMergeId":14486,"framesCount":"10","bufferBeforeMergeId":14484,"averageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_070_ave.dat","bufferAfterMeasurementId":25506,"rgGuinier":"6.13595","subtractedFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_070_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1410/25505/chi2_R.png","abInitioModelId":1037,"macromoleculeId":5978,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 00:21:13.166966","bufferAcronym":"half_NDSB_EDTA","quality":"0.889305","shapeDeterminationModelId":154019,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"21.475825","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_069_ave.dat","exposureTemperature":"20.0","subtractionId":6038,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25505/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:07:34 AM","lastPointUsed":"42","modelListId":1037,"framesMerge":"9","rapidShapeDeterminationModelId":154018,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_071_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1410/25505/nsd.png","bufferAfterFramesMerged":"10","experimentId":1410,"macromoleculeAcronym":"M21_20LRNA_EDTA","i0stdev":"0.781264","sampleMeasurementId":25505,"measurementComments":"[6] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 20uM LRNA","priorityLevelId":12,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:23:08 AM","proposalNumber":"1540","rgGnom":"6.21697669929","volume":"679.218","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25505/dammin.pdb","comments":null},{"total":"0.608504350916","bufferBeforeMeasurementId":25489,"sampleMergeId":14475,"averagedModelId":153170,"I0":"96.9168","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1410/25490/damaver_%s.pdb","bufferAfterMergeId":14476,"framesCount":"10","bufferBeforeMergeId":14474,"averageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_060_ave.dat","bufferAfterMeasurementId":25491,"rgGuinier":"3.73643","subtractedFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_060_sub.dat","firstPointUsed":"30","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1410/25490/chi2_R.png","abInitioModelId":1032,"macromoleculeId":5975,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 00:09:18.774220","bufferAcronym":"half_NDSB_EDTA","quality":"0.805817","shapeDeterminationModelId":153172,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"12.79727275","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_059_ave.dat","exposureTemperature":"20.0","subtractionId":6033,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25490/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:07:34 AM","lastPointUsed":"74","modelListId":1032,"framesMerge":"10","rapidShapeDeterminationModelId":153171,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_061_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1410/25490/nsd.png","bufferAfterFramesMerged":"10","experimentId":1410,"macromoleculeAcronym":"M21_noLRNA_EDTA","i0stdev":"0.222812","sampleMeasurementId":25490,"measurementComments":"[1] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:11:14 AM","proposalNumber":"1540","rgGnom":"3.81076305008","volume":"155.125","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25490/dammin.pdb","comments":null},{"total":"0.571475090427","bufferBeforeMeasurementId":25497,"sampleMergeId":14481,"averagedModelId":153677,"I0":"268.2232","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1410/25499/damaver_%s.pdb","bufferAfterMergeId":14482,"framesCount":"10","bufferBeforeMergeId":14480,"averageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_066_ave.dat","bufferAfterMeasurementId":25500,"rgGuinier":"5.93935","subtractedFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_066_sub.dat","firstPointUsed":"17","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1410/25499/chi2_R.png","abInitioModelId":1035,"macromoleculeId":5973,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 00:16:27.039239","bufferAcronym":"half_NDSB_EDTA","quality":"0.847285","shapeDeterminationModelId":153679,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"20.787725","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_065_ave.dat","exposureTemperature":"20.0","subtractionId":6036,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25499/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:07:34 AM","lastPointUsed":"44","modelListId":1035,"framesMerge":"10","rapidShapeDeterminationModelId":153678,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_067_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1410/25499/nsd.png","bufferAfterFramesMerged":"10","experimentId":1410,"macromoleculeAcronym":"M21_5LRNA_EDTA","i0stdev":"0.695948","sampleMeasurementId":25499,"measurementComments":"[4] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 5uM LRNA","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:18:24 AM","proposalNumber":"1540","rgGnom":"6.09058481707","volume":"535.103","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25499/dammin.pdb","comments":null},{"total":"0.737190058573","bufferBeforeMeasurementId":25500,"sampleMergeId":14483,"averagedModelId":153848,"I0":"328.4724","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1410/25502/damaver_%s.pdb","bufferAfterMergeId":14484,"framesCount":"10","bufferBeforeMergeId":14482,"averageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_068_ave.dat","bufferAfterMeasurementId":25503,"rgGuinier":"6.12176","subtractedFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_068_sub.dat","firstPointUsed":"17","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1410/25502/chi2_R.png","abInitioModelId":1036,"macromoleculeId":5974,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 00:18:50.352352","bufferAcronym":"half_NDSB_EDTA","quality":"0.837983","shapeDeterminationModelId":153850,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"20.967028","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_067_ave.dat","exposureTemperature":"20.0","subtractionId":6037,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25502/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:07:34 AM","lastPointUsed":"41","modelListId":1036,"framesMerge":"9","rapidShapeDeterminationModelId":153849,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_069_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1410/25502/nsd.png","bufferAfterFramesMerged":"10","experimentId":1410,"macromoleculeAcronym":"M21_10LRNA_EDTA","i0stdev":"0.644824","sampleMeasurementId":25502,"measurementComments":"[5] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 10uM LRNA","priorityLevelId":10,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:20:48 AM","proposalNumber":"1540","rgGnom":"6.21613572887","volume":"639.745","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25502/dammin.pdb","comments":null},{"total":"0.677964303511","bufferBeforeMeasurementId":25491,"sampleMergeId":14477,"averagedModelId":153339,"I0":"107.5872","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1410/25493/damaver_%s.pdb","bufferAfterMergeId":14478,"framesCount":"10","bufferBeforeMergeId":14476,"averageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_062_ave.dat","bufferAfterMeasurementId":25494,"rgGuinier":"4.09503","subtractedFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_062_sub.dat","firstPointUsed":"17","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1410/25493/chi2_R.png","abInitioModelId":1033,"macromoleculeId":5976,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 00:11:41.935608","bufferAcronym":"half_NDSB_EDTA","quality":"0.885237","shapeDeterminationModelId":153341,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"14.332605","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_061_ave.dat","exposureTemperature":"20.0","subtractionId":6034,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25493/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:07:34 AM","lastPointUsed":"60","modelListId":1033,"framesMerge":"10","rapidShapeDeterminationModelId":153340,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_063_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1410/25493/nsd.png","bufferAfterFramesMerged":"10","experimentId":1410,"macromoleculeAcronym":"M21_1LRNA_EDTA","i0stdev":"0.2915032","sampleMeasurementId":25493,"measurementComments":"[2] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 1uM LRNA","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:13:39 AM","proposalNumber":"1540","rgGnom":"4.10787920771","volume":"185.575","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25493/dammin.pdb","comments":null},{"total":"0.594959854393","bufferBeforeMeasurementId":25494,"sampleMergeId":14479,"averagedModelId":153508,"I0":"172.6416","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1410/25496/damaver_%s.pdb","bufferAfterMergeId":14480,"framesCount":"10","bufferBeforeMergeId":14478,"averageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_064_ave.dat","bufferAfterMeasurementId":25497,"rgGuinier":"5.16409","subtractedFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_064_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1410/25496/chi2_R.png","abInitioModelId":1034,"macromoleculeId":5977,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 00:14:04.546150","bufferAcronym":"half_NDSB_EDTA","quality":"0.911089","shapeDeterminationModelId":153510,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":830,"isagregated":"False","dmax":"18.074315","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_063_ave.dat","exposureTemperature":"20.0","subtractionId":6035,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25496/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:07:34 AM","lastPointUsed":"42","modelListId":1034,"framesMerge":"10","rapidShapeDeterminationModelId":153509,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1410/1d/CedMax_run7_065_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1410/25496/nsd.png","bufferAfterFramesMerged":"10","experimentId":1410,"macromoleculeAcronym":"M21_2p5LRNA_EDTA","i0stdev":"0.461288","sampleMeasurementId":25496,"measurementComments":"[3] M21 25mM Tris 150mM  NaCl 500mM NDSB 5mM EDTA 2.5uM LRNA","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:15:58 AM","proposalNumber":"1540","rgGnom":"5.23927433334","volume":"328.343","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1410/25496/dammin.pdb","comments":null},{"total":null,"bufferBeforeMeasurementId":25507,"sampleMergeId":null,"averagedModelId":null,"I0":null,"proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":null,"framesCount":null,"bufferBeforeMergeId":null,"averageFilePath":null,"bufferAfterMeasurementId":25509,"rgGuinier":null,"subtractedFilePath":null,"firstPointUsed":null,"chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5952,"code":"20.0","transmission":"50.0","timeStart":null,"bufferAcronym":"hepes","quality":null,"shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":833,"isagregated":null,"dmax":null,"bufferBeforeAverageFilePath":null,"exposureTemperature":"20.0","subtractionId":null,"conc":"0.46999999999999997","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 26, 2013 12:39:01 AM","lastPointUsed":null,"modelListId":null,"framesMerge":null,"rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":null,"nsdFilePath":null,"bufferAfterFramesMerged":null,"experimentId":1411,"macromoleculeAcronym":"RGMBMP","i0stdev":null,"sampleMeasurementId":25508,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":null,"substractionCreationTime":null,"proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":null,"bufferBeforeMeasurementId":25509,"sampleMergeId":null,"averagedModelId":null,"I0":null,"proposalCode":"MX","averagedModel":null,"bufferAfterMergeId":null,"framesCount":null,"bufferBeforeMergeId":null,"averageFilePath":null,"bufferAfterMeasurementId":25512,"rgGuinier":null,"subtractedFilePath":null,"firstPointUsed":null,"chi2RgFilePath":null,"abInitioModelId":null,"macromoleculeId":5951,"code":"20.0","transmission":"50.0","timeStart":null,"bufferAcronym":"hepes","quality":null,"shapeDeterminationModelId":null,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":833,"isagregated":null,"dmax":null,"bufferBeforeAverageFilePath":null,"exposureTemperature":"20.0","subtractionId":null,"conc":"0.51000000000000001","rapidShapeDeterminationModel":null,"experimentCreationDate":"Sep 26, 2013 12:39:01 AM","lastPointUsed":null,"modelListId":null,"framesMerge":null,"rapidShapeDeterminationModelId":null,"bufferAfterAverageFilePath":null,"nsdFilePath":null,"bufferAfterFramesMerged":null,"experimentId":1411,"macromoleculeAcronym":"RGMNEO","i0stdev":null,"sampleMeasurementId":25511,"measurementComments":"[2]","priorityLevelId":4,"bufferBeforeFramesMerged":null,"substractionCreationTime":null,"proposalNumber":"1540","rgGnom":null,"volume":null,"shapeDeterminationModel":null,"comments":null},{"total":"0.513614749069","bufferBeforeMeasurementId":25515,"sampleMergeId":14490,"averagedModelId":154186,"I0":"254.721568627","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1412/25517/damaver_%s.pdb","bufferAfterMergeId":14491,"framesCount":"10","bufferBeforeMergeId":14489,"averageFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_061_ave.dat","bufferAfterMeasurementId":25518,"rgGuinier":"4.16788","subtractedFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_061_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1412/25517/chi2_R.png","abInitioModelId":1038,"macromoleculeId":5951,"code":"20.0","transmission":"50.0","timeStart":"2013-09-26 00:43:57.430983","bufferAcronym":"hepes","quality":"0.911838","shapeDeterminationModelId":154188,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":833,"isagregated":"False","dmax":"14.58758","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_060_ave.dat","exposureTemperature":"20.0","subtractionId":6040,"conc":"0.51000000000000001","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1412/25517/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:39:46 AM","lastPointUsed":"35","modelListId":1038,"framesMerge":"9","rapidShapeDeterminationModelId":154187,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_062_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1412/25517/nsd.png","bufferAfterFramesMerged":"10","experimentId":1412,"macromoleculeAcronym":"RGMNEO","i0stdev":"0.306394117647","sampleMeasurementId":25517,"measurementComments":"[2]","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:45:54 AM","proposalNumber":"1540","rgGnom":"4.04667995108","volume":"149.047","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1412/25517/dammin.pdb","comments":null},{"total":"0.484616467892","bufferBeforeMeasurementId":25513,"sampleMergeId":14488,"averagedModelId":154355,"I0":"174.143191489","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1412/25514/damaver_%s.pdb","bufferAfterMergeId":14489,"framesCount":"10","bufferBeforeMergeId":14487,"averageFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_059_ave.dat","bufferAfterMeasurementId":25515,"rgGuinier":"4.31913","subtractedFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_059_sub.dat","firstPointUsed":"36","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1412/25514/chi2_R.png","abInitioModelId":1039,"macromoleculeId":5952,"code":"20.0","transmission":"50.0","timeStart":"2013-09-26 00:41:32.701027","bufferAcronym":"hepes","quality":"0.335829","shapeDeterminationModelId":154357,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":833,"isagregated":"True","dmax":"12.525477","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_058_ave.dat","exposureTemperature":"20.0","subtractionId":6039,"conc":"0.46999999999999997","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1412/25514/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 12:39:46 AM","lastPointUsed":"59","modelListId":1039,"framesMerge":"1","rapidShapeDeterminationModelId":154356,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1412/1d/ELLIE_run7_060_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1412/25514/nsd.png","bufferAfterFramesMerged":"10","experimentId":1412,"macromoleculeAcronym":"RGMBMP","i0stdev":"1.18357234043","sampleMeasurementId":25514,"measurementComments":"[1]","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 12:43:28 AM","proposalNumber":"1540","rgGnom":"3.9056364146","volume":"119.457","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1412/25514/dammin.pdb","comments":null},{"total":"0.647251032954","bufferBeforeMeasurementId":25533,"sampleMergeId":14503,"averagedModelId":155029,"I0":"2889.04","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1413/25535/damaver_%s.pdb","bufferAfterMergeId":14504,"framesCount":"10","bufferBeforeMergeId":14502,"averageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_074_ave.dat","bufferAfterMeasurementId":25536,"rgGuinier":"7.71434","subtractedFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_074_sub.dat","firstPointUsed":"12","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1413/25535/chi2_R.png","abInitioModelId":1043,"macromoleculeId":5984,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 01:13:41.797497","bufferAcronym":"half_NDSB","quality":"0.830434","shapeDeterminationModelId":155031,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"27.00019","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_073_ave.dat","exposureTemperature":"20.0","subtractionId":6046,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25535/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 1:00:05 AM","lastPointUsed":"32","modelListId":1043,"framesMerge":"9","rapidShapeDeterminationModelId":155030,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_075_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1413/25535/nsd.png","bufferAfterFramesMerged":"10","experimentId":1413,"macromoleculeAcronym":"M21_20LRNA","i0stdev":"1.614848","sampleMeasurementId":25535,"measurementComments":"[6] M21 25mM Tris 150mM  NaCl 500mM NDSB 20uM LRNA","priorityLevelId":12,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 1:15:38 AM","proposalNumber":"1540","rgGnom":"7.74716559377","volume":"2617.77","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25535/dammin.pdb","comments":null},{"total":"0.524440229375","bufferBeforeMeasurementId":25519,"sampleMergeId":14493,"averagedModelId":154691,"I0":"269.9612","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1413/25520/damaver_%s.pdb","bufferAfterMergeId":14494,"framesCount":"10","bufferBeforeMergeId":14492,"averageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_064_ave.dat","bufferAfterMeasurementId":25521,"rgGuinier":"4.0413","subtractedFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_064_sub.dat","firstPointUsed":"29","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1413/25520/chi2_R.png","abInitioModelId":1041,"macromoleculeId":5979,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 01:01:50.776766","bufferAcronym":"half_NDSB","quality":"0.796148","shapeDeterminationModelId":154693,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"14.14455","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_063_ave.dat","exposureTemperature":"20.0","subtractionId":6041,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25520/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 1:00:05 AM","lastPointUsed":"61","modelListId":1041,"framesMerge":"9","rapidShapeDeterminationModelId":154692,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_065_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1413/25520/nsd.png","bufferAfterFramesMerged":"10","experimentId":1413,"macromoleculeAcronym":"M21_noLRNA","i0stdev":"0.594996","sampleMeasurementId":25520,"measurementComments":"[1] M21 25mM Tris 150mM  NaCl 500mM NDSB","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 1:03:46 AM","proposalNumber":"1540","rgGnom":"4.08660560851","volume":"224.86","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25520/dammin.pdb","comments":null},{"total":"0.614543687765","bufferBeforeMeasurementId":25527,"sampleMergeId":14499,"averagedModelId":155365,"I0":"1389.66","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1413/25529/damaver_%s.pdb","bufferAfterMergeId":14500,"framesCount":"10","bufferBeforeMergeId":14498,"averageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_070_ave.dat","bufferAfterMeasurementId":25530,"rgGuinier":"7.68133","subtractedFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_070_sub.dat","firstPointUsed":"10","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1413/25529/chi2_R.png","abInitioModelId":1045,"macromoleculeId":5980,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 01:08:57.232858","bufferAcronym":"half_NDSB","quality":"0.862657","shapeDeterminationModelId":155367,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"26.884655","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_069_ave.dat","exposureTemperature":"20.0","subtractionId":6044,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25529/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 1:00:05 AM","lastPointUsed":"32","modelListId":1045,"framesMerge":"7","rapidShapeDeterminationModelId":155366,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_071_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1413/25529/nsd.png","bufferAfterFramesMerged":"10","experimentId":1413,"macromoleculeAcronym":"M21_5LRNA","i0stdev":"2.044368","sampleMeasurementId":25529,"measurementComments":"[4] M21 25mM Tris 150mM  NaCl 500mM NDSB 5uM LRNA","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 1:10:54 AM","proposalNumber":"1540","rgGnom":"7.79219637462","volume":"1217.78","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25529/dammin.pdb","comments":null},{"total":"0.645305179563","bufferBeforeMeasurementId":25530,"sampleMergeId":14501,"averagedModelId":155198,"I0":"2406.064","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1413/25532/damaver_%s.pdb","bufferAfterMergeId":14502,"framesCount":"10","bufferBeforeMergeId":14500,"averageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_072_ave.dat","bufferAfterMeasurementId":25533,"rgGuinier":"8.01533","subtractedFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_072_sub.dat","firstPointUsed":"14","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1413/25532/chi2_R.png","abInitioModelId":1044,"macromoleculeId":5982,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 01:11:19.211337","bufferAcronym":"half_NDSB","quality":"0.800191","shapeDeterminationModelId":155200,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"28.053655","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_071_ave.dat","exposureTemperature":"20.0","subtractionId":6045,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25532/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 1:00:05 AM","lastPointUsed":"30","modelListId":1044,"framesMerge":"8","rapidShapeDeterminationModelId":155199,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_073_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1413/25532/nsd.png","bufferAfterFramesMerged":"10","experimentId":1413,"macromoleculeAcronym":"M21_10LRNA","i0stdev":"2.4056","sampleMeasurementId":25532,"measurementComments":"[5] M21 25mM Tris 150mM  NaCl 500mM NDSB 10uM LRNA","priorityLevelId":10,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 1:13:15 AM","proposalNumber":"1540","rgGnom":"8.04696743866","volume":"2131.31","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25532/dammin.pdb","comments":null},{"total":"0.442100868108","bufferBeforeMeasurementId":25521,"sampleMergeId":14495,"averagedModelId":154862,"I0":"419.024","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1413/25523/damaver_%s.pdb","bufferAfterMergeId":14496,"framesCount":"10","bufferBeforeMergeId":14494,"averageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_066_ave.dat","bufferAfterMeasurementId":25524,"rgGuinier":"5.57941","subtractedFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_066_sub.dat","firstPointUsed":"26","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1413/25523/chi2_R.png","abInitioModelId":1042,"macromoleculeId":5983,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 01:04:12.335806","bufferAcronym":"half_NDSB","quality":"0.751017","shapeDeterminationModelId":154864,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"19.527935","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_065_ave.dat","exposureTemperature":"20.0","subtractionId":6042,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25523/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 1:00:05 AM","lastPointUsed":"43","modelListId":1042,"framesMerge":"8","rapidShapeDeterminationModelId":154863,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_067_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1413/25523/nsd.png","bufferAfterFramesMerged":"10","experimentId":1413,"macromoleculeAcronym":"M21_1LRNA","i0stdev":"0.763992","sampleMeasurementId":25523,"measurementComments":"[2] M21 25mM Tris 150mM  NaCl 500mM NDSB 1uM LRNA","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 1:06:09 AM","proposalNumber":"1540","rgGnom":"5.72356934917","volume":"388.873","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25523/dammin.pdb","comments":null},{"total":"0.623652286007","bufferBeforeMeasurementId":25524,"sampleMergeId":14497,"averagedModelId":154522,"I0":"931.404","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1413/25526/damaver_%s.pdb","bufferAfterMergeId":14498,"framesCount":"10","bufferBeforeMergeId":14496,"averageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_068_ave.dat","bufferAfterMeasurementId":25527,"rgGuinier":"7.32976","subtractedFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_068_sub.dat","firstPointUsed":"11","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1413/25526/chi2_R.png","abInitioModelId":1040,"macromoleculeId":5981,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 01:06:34.671741","bufferAcronym":"half_NDSB","quality":"0.867342","shapeDeterminationModelId":154524,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"25.65416","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_067_ave.dat","exposureTemperature":"20.0","subtractionId":6043,"conc":"0.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25526/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 1:00:05 AM","lastPointUsed":"30","modelListId":1040,"framesMerge":"7","rapidShapeDeterminationModelId":154523,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1413/1d/CedMax_run8_069_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1413/25526/nsd.png","bufferAfterFramesMerged":"10","experimentId":1413,"macromoleculeAcronym":"M21_2p5LRNA","i0stdev":"1.454008","sampleMeasurementId":25526,"measurementComments":"[3] M21 25mM Tris 150mM  NaCl 500mM NDSB 2.5uM LRNA","priorityLevelId":6,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 1:08:30 AM","proposalNumber":"1540","rgGnom":"7.39969813144","volume":"814.528","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1413/25526/dammin.pdb","comments":null},{"total":"0.582644648017","bufferBeforeMeasurementId":25549,"sampleMergeId":14518,"averagedModelId":156037,"I0":"48.4458","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25550/damaver_%s.pdb","bufferAfterMergeId":14519,"framesCount":"10","bufferBeforeMergeId":14517,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_089_ave.dat","bufferAfterMeasurementId":25551,"rgGuinier":"1.29783","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_089_sub.dat","firstPointUsed":"153","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25550/chi2_R.png","abInitioModelId":1049,"macromoleculeId":5992,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:26:29.815350","bufferAcronym":"H2O","quality":"0.548756","shapeDeterminationModelId":156039,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":837,"isagregated":"False","dmax":"4.542405","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_088_ave.dat","exposureTemperature":"20.0","subtractionId":6051,"conc":"1.0","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25550/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"198","modelListId":1049,"framesMerge":"3","rapidShapeDeterminationModelId":156038,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_090_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25550/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"GE_RNA_1mM","i0stdev":"0.246099","sampleMeasurementId":25550,"measurementComments":"[5] GeneEnd RNA 1mM","priorityLevelId":14,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:28:26 AM","proposalNumber":"1540","rgGnom":"1.39841341236","volume":"5.2757","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25550/dammin.pdb","comments":null},{"total":"0.617263288362","bufferBeforeMeasurementId":25551,"sampleMergeId":14520,"averagedModelId":156711,"I0":"17.7377","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25553/damaver_%s.pdb","bufferAfterMergeId":14521,"framesCount":"10","bufferBeforeMergeId":14519,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_091_ave.dat","bufferAfterMeasurementId":25554,"rgGuinier":"1.2155","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_091_sub.dat","firstPointUsed":"129","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25553/chi2_R.png","abInitioModelId":1053,"macromoleculeId":5989,"code":"20.0","transmission":"30.0","timeStart":"2013-09-26 02:28:52.469277","bufferAcronym":"H2O","quality":"0.652704","shapeDeterminationModelId":156713,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":837,"isagregated":"False","dmax":"3.8896","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_090_ave.dat","exposureTemperature":"20.0","subtractionId":6052,"conc":"1.0","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25553/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"231","modelListId":1053,"framesMerge":"3","rapidShapeDeterminationModelId":156712,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_092_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25553/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"L_RNA_0p33mM","i0stdev":"0.0532618","sampleMeasurementId":25553,"measurementComments":"[6] Leader RNA 0.33mM","priorityLevelId":16,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:30:50 AM","proposalNumber":"1540","rgGnom":"1.19763474567","volume":"4.99025","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25553/dammin.pdb","comments":null},{"total":"0.667601032866","bufferBeforeMeasurementId":25555,"sampleMergeId":14523,"averagedModelId":156373,"I0":"90.12625","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25556/damaver_%s.pdb","bufferAfterMergeId":14524,"framesCount":"10","bufferBeforeMergeId":14522,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_094_ave.dat","bufferAfterMeasurementId":25557,"rgGuinier":"4.37786","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_094_sub.dat","firstPointUsed":"16","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25556/chi2_R.png","abInitioModelId":1051,"macromoleculeId":5988,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:32:28.755160","bufferAcronym":"half_NDSB_225NaCl","quality":"0.874513","shapeDeterminationModelId":156375,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":838,"isagregated":"False","dmax":"15.32251","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_093_ave.dat","exposureTemperature":"20.0","subtractionId":6053,"conc":"0.16","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25556/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"59","modelListId":1051,"framesMerge":"10","rapidShapeDeterminationModelId":156374,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_095_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25556/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"M21_P135_237_500NDSB_225NaCl","i0stdev":"0.42205875","sampleMeasurementId":25556,"measurementComments":"[7] M21 P135-237 25mM Tris 225mM NaCl 500mM NDSB","priorityLevelId":19,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:34:26 AM","proposalNumber":"1540","rgGnom":"4.395596963","volume":"262.966","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25556/dammin.pdb","comments":null},{"total":"0.538518258804","bufferBeforeMeasurementId":25537,"sampleMergeId":14506,"averagedModelId":155536,"I0":"140.282","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25538/damaver_%s.pdb","bufferAfterMergeId":14507,"framesCount":"10","bufferBeforeMergeId":14505,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_077_ave.dat","bufferAfterMeasurementId":25539,"rgGuinier":"4.08445","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_077_sub.dat","firstPointUsed":"26","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25538/chi2_R.png","abInitioModelId":1046,"macromoleculeId":5986,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:12:15.801854","bufferAcronym":"half_NDSB","quality":"0.82101","shapeDeterminationModelId":155538,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":825,"isagregated":"False","dmax":"14.295575","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_076_ave.dat","exposureTemperature":"20.0","subtractionId":6047,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25538/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"55","modelListId":1046,"framesMerge":"9","rapidShapeDeterminationModelId":155537,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_078_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25538/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"M21_0GdmCl","i0stdev":"0.276266","sampleMeasurementId":25538,"measurementComments":"[1] M21 25mM Tris 150mM  NaCl 500mM NDSB","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:14:12 AM","proposalNumber":"1540","rgGnom":"4.09286074078","volume":"221.704","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25538/dammin.pdb","comments":null},{"total":"0.505881906826","bufferBeforeMeasurementId":25558,"sampleMergeId":14526,"averagedModelId":156544,"I0":"118.46","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25559/damaver_%s.pdb","bufferAfterMergeId":14527,"framesCount":"10","bufferBeforeMergeId":14525,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_097_ave.dat","bufferAfterMeasurementId":25560,"rgGuinier":"5.13356","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_097_sub.dat","firstPointUsed":"30","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25559/chi2_R.png","abInitioModelId":1052,"macromoleculeId":5991,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:36:04.259866","bufferAcronym":"half_NDSB_lowTris","quality":"0.661457","shapeDeterminationModelId":156546,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":836,"isagregated":"False","dmax":"13.732273","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_096_ave.dat","exposureTemperature":"20.0","subtractionId":6054,"conc":"0.16","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25559/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"51","modelListId":1052,"framesMerge":"4","rapidShapeDeterminationModelId":156545,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_098_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25559/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"M21_P135_237_500NDSB_lowTris","i0stdev":"1.387325","sampleMeasurementId":25559,"measurementComments":"[8] M21 P135-237 12.5mM Tris 150mM NaCl 500mM NDSB","priorityLevelId":22,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:38:00 AM","proposalNumber":"1540","rgGnom":"4.39555030315","volume":"231.147","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25559/dammin.pdb","comments":null},{"total":"0.767363786424","bufferBeforeMeasurementId":25540,"sampleMergeId":14509,"averagedModelId":155868,"I0":"68.8392","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25541/damaver_%s.pdb","bufferAfterMergeId":14510,"framesCount":"10","bufferBeforeMergeId":14508,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_080_ave.dat","bufferAfterMeasurementId":25542,"rgGuinier":"4.24247","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_080_sub.dat","firstPointUsed":"15","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25541/chi2_R.png","abInitioModelId":1048,"macromoleculeId":5985,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:15:50.719923","bufferAcronym":"half_NDSB_1MGdmCl","quality":"0.887246","shapeDeterminationModelId":155870,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":835,"isagregated":"False","dmax":"14.53045975","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_079_ave.dat","exposureTemperature":"20.0","subtractionId":6048,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25541/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"57","modelListId":1048,"framesMerge":"9","rapidShapeDeterminationModelId":155869,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_081_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25541/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"M21_1MGdmCl","i0stdev":"0.158881","sampleMeasurementId":25541,"measurementComments":"[2] M21 25mM Tris 150mM  NaCl 500mM NDSB 1M GdmCl","priorityLevelId":5,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:17:47 AM","proposalNumber":"1540","rgGnom":"4.23188145275","volume":"294.936","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25541/dammin.pdb","comments":null},{"total":"0.66771338089","bufferBeforeMeasurementId":25543,"sampleMergeId":14512,"averagedModelId":155703,"I0":"57.0182","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25544/damaver_%s.pdb","bufferAfterMergeId":14513,"framesCount":"10","bufferBeforeMergeId":14511,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_083_ave.dat","bufferAfterMeasurementId":25545,"rgGuinier":"4.79362","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_083_sub.dat","firstPointUsed":"9","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25544/chi2_R.png","abInitioModelId":1047,"macromoleculeId":5987,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:19:23.671670","bufferAcronym":"half_NDSB_2MGdmCl","quality":"0.909169","shapeDeterminationModelId":155705,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":834,"isagregated":"False","dmax":"15.339584","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_082_ave.dat","exposureTemperature":"20.0","subtractionId":6049,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25544/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"52","modelListId":1047,"framesMerge":"8","rapidShapeDeterminationModelId":155704,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_084_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25544/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"M21_2MGdmCl","i0stdev":"0.211262","sampleMeasurementId":25544,"measurementComments":"[3] M21 25mM Tris 150mM  NaCl 500mM NDSB 2M GdmCl","priorityLevelId":8,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:21:19 AM","proposalNumber":"1540","rgGnom":"4.61876070737","volume":"316.252","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25544/dammin.pdb","comments":null},{"total":"0.550869080029","bufferBeforeMeasurementId":25546,"sampleMergeId":14515,"averagedModelId":156206,"I0":"46.8738","proposalCode":"MX","averagedModel":"/data/pyarch/bm29/mx1540/1414/25547/damaver_%s.pdb","bufferAfterMergeId":14516,"framesCount":"10","bufferBeforeMergeId":14514,"averageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_086_ave.dat","bufferAfterMeasurementId":25548,"rgGuinier":"5.24247","subtractedFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_086_sub.dat","firstPointUsed":"19","chi2RgFilePath":"/data/pyarch/bm29/mx1540/1414/25547/chi2_R.png","abInitioModelId":1050,"macromoleculeId":5990,"code":"20.0","transmission":"100.0","timeStart":"2013-09-26 02:22:55.160731","bufferAcronym":"half_NDSB_3MGdmCl","quality":"0.784014","shapeDeterminationModelId":156208,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":839,"isagregated":"False","dmax":"18.348645","bufferBeforeAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_085_ave.dat","exposureTemperature":"20.0","subtractionId":6050,"conc":"0.5","rapidShapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25547/damfilt.pdb","experimentCreationDate":"Sep 26, 2013 2:10:31 AM","lastPointUsed":"51","modelListId":1050,"framesMerge":"10","rapidShapeDeterminationModelId":156207,"bufferAfterAverageFilePath":" /data/pyarch/bm29/mx1540/1414/1d/CedMax_run9_087_ave.dat","nsdFilePath":"/data/pyarch/bm29/mx1540/1414/25547/nsd.png","bufferAfterFramesMerged":"10","experimentId":1414,"macromoleculeAcronym":"M21_3MGdmCl","i0stdev":"0.265726","sampleMeasurementId":25547,"measurementComments":"[4] M21 25mM Tris 150mM  NaCl 500mM NDSB 3M GdmCl","priorityLevelId":11,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 26, 2013 2:24:50 AM","proposalNumber":"1540","rgGnom":"5.36972147841","volume":"293.946","shapeDeterminationModel":"/data/pyarch/bm29/mx1540/1414/25547/dammin.pdb","comments":null}];
		},
		getMacromolecule_10 : function(){
			return {"macromoleculeId":647,"safetylevelId":null,"proposalId":10,"name":"C2","acronym":"C2","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"macromoleculeregion3VOs":[],"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]};
		},
		getPDBData : function(){
			return {"total":"0.590057832135","bufferBeforeMeasurementId":25219,"sampleMergeId":14276,"averagedModelId":141871,"I0":"64.3041333333","proposalCode":"OPD","averagedModel":"/data/pyarch/bm29/opd29/1391/1d/damaver.pdb","bufferAfterMergeId":14277,"framesCount":"10","bufferBeforeMergeId":14275,"averageFilePath":" /data/pyarch/bm29/opd29/1391/1d/core_002_ave.dat","bufferAfterMeasurementId":25221,"rgGuinier":"3.69836","subtractedFilePath":" /data/pyarch/bm29/opd29/1391/1d/core_002_sub.dat","firstPointUsed":"29","chi2RgFilePath":"/data/pyarch/bm29/opd29/1391/1d/chi2_R.png","abInitioModelId":954,"macromoleculeId":5377,"code":"20.0","transmission":"100.0","timeStart":"2013-09-19 12:31:36.694925","bufferAcronym":"buffer","quality":"0.81275","shapeDeterminationModelId":141873,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":13,"isagregated":"False","dmax":"12.389506","bufferBeforeAverageFilePath":" /data/pyarch/bm29/opd29/1391/1d/core_001_ave.dat","exposureTemperature":"20.0","subtractionId":5951,"conc":"0.75","rapidShapeDeterminationModel":"/data/pyarch/bm29/opd29/1391/1d/damfilt.pdb","experimentCreationDate":"Sep 19, 2013 12:29:13 PM","lastPointUsed":"60","modelListId":954,"framesMerge":"10","rapidShapeDeterminationModelId":141872,"bufferAfterAverageFilePath":" /data/pyarch/bm29/opd29/1391/1d/core_003_ave.dat","nsdFilePath":"/data/pyarch/bm29/opd29/1391/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1391,"macromoleculeAcronym":"coredesacet","i0stdev":"0.156765333333","sampleMeasurementId":25220,"measurementComments":"[1] desacetilated","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Sep 19, 2013 12:34:52 PM","proposalNumber":"29","rgGnom":"3.62246357855","volume":"136.109","shapeDeterminationModel":"/data/pyarch/bm29/opd29/1391/1d/dammin.pdb","comments":null}
		},
		getBoxWhikerData : function(){
			return {"clusters":[{"name":"10mg/ml","concentration":10,"x":10,"classes":[{"name":"Guinier","color":"#9A2EFE","values":["0.583411","0.56135","0.564159","0.535737","0.620498","0.578213","0.593488","0.601936","0.583421","0.566174","0.559672","0.546995"]},{"name":"P(r)","color":"#2E64FE","values":["0.602510681101","0.589871917074","0.590451916508","0.568945912564","0.608797978119","0.55870188116","0.584198197858","0.585863926109","0.573164311302","0.563126431384","0.585018185041","0.576100908766"]}]},{"name":"20mg/ml","concentration":20,"x":20,"classes":[{"name":"Guinier","color":"#9A2EFE","values":["0.61901","0.612442","0.639516","0.607532","0.602515","0.581529","0.549105","0.575301","0.544148"]},{"name":"P(r)","color":"#2E64FE","values":["0.617754683109","0.623163881121","0.632477173195","0.600811891098","0.598350965511","0.538835174021","0.535832949682","0.536803946787","0.523288957289"]}]},{"name":"50mg/ml","concentration":50,"x":50,"classes":[{"name":"Guinier","color":"#9A2EFE","values":["0.887391","0.722752","0.638552","0.632388","0.561992","0.560785"]},{"name":"P(r)","color":"#2E64FE","values":["0.87547281575","0.735961321397","0.639522668598","0.64452093486","0.568882801737","0.571271209342"]}]}]};
		},
		getHPLCData : function(){
			return [{"param":"I0","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.503658,0.481897,0.487385,1.55743,0,3.88759,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,183.055,0,0,0,0,0,0,0,110.647,153.8,0,106.255,112.402,110.997,100.608,115.551,100.304,96.3957,98.4721,93.9646,92.1549,93.5815,87.3627,90.7249,83.462,81.8583,75.4397,78.0593,78.2693,63.2129,71.1551,68.7378,55.2106,63.5053,65.0522,66.0286,49.9507,57.3002,55.0474,58.6034,29.3581,53.3098,42.7955,37.8395,52.0146,57.3051,49.169,41.8331,43.4371,19.4632,41.7432,36.8637,40.8622,41.0271,27.6206,29.691,40.2952,36.1033,37.8601,28.7464,31.2352,30.08,24.9648,28.3214,29.3924,32.252,28.7029,11.5458,28.3193,26.2162,27.9457,26.4899,25.9899,23.6035,25.1699,24.4521,22.927,21.9321,22.1109,17.2364,19.0011,21.8494,24.9348,19.9824,8.29144,18.0064,16.7701,18.1807,8.57386,12.4511,17.2565,7.65653,16.0869,15.52,9.28455,15.8352,15.2155,15.0965,16.0884,10.204,13.0092,14.0982,14.072,13.4919,13.3097,9.78799,12.3851,11.2024,9.605,12.587,11.8592,10.8914,11.1444,10.9877,10.2065,9.14899,8.44029,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"std":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0160135,0.0202937,0.0431271,0.909534,0,2.12003,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.59306,0,0,0,0,0,0,0,0.764689,2.46637,0,2.85595,2.30445,1.9046,1.34271,1.75504,1.35533,1.15525,1.4555,1.41108,0.958006,1.82621,0.75933,1.02244,0.872509,0.97953,1.12443,0.853554,1.14793,0.949788,1.00009,0.992641,0.752601,1.02355,0.833504,1.17033,0.789956,0.920217,0.679642,0.842123,1.3496,0.98214,1.16285,1.11957,0.845278,0.772984,1.03892,1.16679,0.864352,1.0506,1.16667,0.989987,0.623184,0.810236,0.84281,0.896965,1.00423,0.748308,0.992007,0.537322,0.740125,0.646664,0.798129,0.707534,0.704623,0.710242,0.873513,0.808947,0.457183,0.658374,0.644,0.783122,0.825679,0.589488,0.756421,0.86801,0.684918,0.658805,0.637611,0.977123,0.463665,0.899917,0.849521,0.649764,0.69347,0.7013,0.50253,0.788617,0.441019,0.628665,0.547342,0.564402,0.575814,0.354953,0.699543,0.465423,0.597049,0.496936,0.576073,0.45601,0.482708,0.449703,0.466757,0.569477,0.431046,0.463907,0.495364,0.375508,0.438224,0.394916,0.487742,0.48776,0.523954,0.441464,0.706302,0.372841,0.519095,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"color":"#0066CC","label":"I0"},{"param":"Rg","label":"Rg","color":"#21610B","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.431559,0.464036,0.388316,2.71873,0,3.16442,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16.8829,0,0,0,0,0,0,0,10.9391,16.715,0,10.8009,11.8046,11.8312,10.5832,12.8346,10.7148,10.5319,10.9142,10.5777,10.4882,10.8599,10.2656,10.9237,10.0443,10.2084,9.31807,9.92068,10.2568,8.20777,9.73072,9.49412,7.57197,9.00349,9.5101,10.2099,7.56242,8.94578,8.77536,9.79275,4.9436,9.26229,7.43509,6.80073,9.94206,11.7527,9.8607,8.38826,8.97572,4.13343,9.02816,7.8697,9.50229,9.83109,6.3548,7.00939,10.4848,9.28119,10.0686,7.37398,8.45262,8.27855,6.92554,8.29679,8.87678,9.84967,8.95693,3.88273,9.15016,8.48891,9.92451,9.31728,9.25456,8.01761,9.24188,9.2615,8.56001,8.25333,8.8709,6.60016,7.32051,9.32405,10.8968,8.48676,3.56954,7.84665,7.45152,8.08931,4.21608,5.99618,8.48689,3.99347,8.06987,8.21215,4.59104,8.67834,8.13762,8.41056,9.54734,5.71853,7.45492,8.64126,8.48457,8.36354,8.7441,6.11467,8.14351,7.36074,6.27537,8.89954,8.52136,7.86448,7.74549,7.89975,7.91069,6.55188,6.64093,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"std":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0857991,0.107115,0.185903,4.03099,0,3.24618,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16.8829,0,0,0,0,0,0,0,0.401803,0.425474,0,0.680475,0.800044,11.8312,0.602419,0.28263,2.70677,0.958122,0.950922,1.19562,0.575582,3.7393,0.768079,1.27923,1.06402,1.89714,0.2219,0.708015,4.48646,0.588471,1.7294,3.59748,1.05698,2.34932,0.97804,1.84473,6.16166,1.53251,2.27566,3.68775,20.3355,5.44555,13.7004,5.2737,0.463776,6.6455,4.17805,1.56723,2.09761,18.1101,6.98576,3.10613,1.96987,3.78548,8.07678,1.90061,4.73073,10.4417,6.03596,2.77391,3.35611,4.56527,2.85529,9.93495,4.6955,4.47566,3.20025,23.5126,5.29707,5.81297,6.28387,24.0039,9.21204,4.84633,10.7004,9.2761,6.11773,1.78982,2.52749,8.24116,1.33684,10.1934,26.2466,11.5512,21.8908,6.12081,3.06831,3.41009,6.31009,6.30288,4.73832,6.54137,0.654771,2.50456,4.94808,10.2007,6.57537,5.41489,23.7891,1.45662,1.62069,9.6335,7.318,7.90282,8.2346,5.10943,5.61142,0.749644,2.16352,3.05725,3.10463,4.23797,2.96354,4.42035,6.97231,0.951753,1.64244,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"param":"Mass","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.001171513,0.0010861281,0.0021893946,0.0017737554,0,0.00936559,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.399467,0,0,0,0,0,0,0,1.9120679,2.3868432,0,1.7756902,1.8112096,1.7615758,1.6182847,1.7474892,1.5813655,1.488199,1.4945809,1.4075974,1.3623366,1.3547907,1.2535927,1.2680683,1.1716934,1.1119666,1.0336235,1.0435871,1.0157148,0.8328846,0.88983285,0.8514475,0.69448036,0.7696679,0.76622903,0.7364329,0.57574326,0.6369286,0.6010187,0.6109569,0.3115978,0.5378799,0.43515223,0.37381437,0.47909784,0.49207336,0.43445086,0.3710307,0.37388915,0.16848448,0.34443855,0.31009626,0.31393838,0.30754328,0.21804678,0.22778594,0.27884686,0.2535878,0.2569129,0.2040528,0.20950699,0.19836058,0.16483648,0.17646453,0.17742263,0.19189823,0.16795002,0.06512342,0.16012588,0.14852506,0.14415886,0.13815103,0.13418183,0.12791821,0.12578115,0.1187549,0.11303509,0.10748529,0.10188064,0.08360162,0.09136487,0.09457134,0.104961894,0.08703563,0.03675354,0.07678625,0.07017373,0.07575227,0.033319987,0.048589066,0.06516828,0.027998803,0.059742,0.054703,0.035529617,0.053951297,0.0530395,0.05067702,0.0505037,0.03436983,0.042517442,0.04303954,0.043599743,0.040774345,0.037955705,0.029637245,0.035358783,0.03199014,0.027746536,0.033452503,0.030973805,0.028342688,0.030092767,0.02865431,0.024852384,0.02418684,0.020345923,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"std":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00032799647,0.00036115825,0.0014752999,0.0047349343,0,0.02000764,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.5570729,0,0,0,0,0,0,0,0.1300762,0.1790491,0,0.23863102,0.22878788,1.855819,0.16362382,0.12204194,0.47021034,0.19713461,0.20054175,0.2261096,0.12683311,0.54347944,0.1374907,0.19924533,0.16913156,0.25287914,0.07344358,0.11553798,0.4923919,0.099347256,0.19887157,0.36240435,0.12815976,0.23931943,0.11188745,0.17215274,0.49861422,0.14080232,0.18136716,0.25854555,1.3219202,0.34579217,0.8351846,0.31942958,0.046343036,0.30027878,0.21022561,0.09662432,0.108901426,0.76224464,0.29207268,0.14464846,0.08020725,0.13606611,0.29489988,0.07963004,0.14469601,0.30047932,0.17209597,0.08807647,0.096866004,0.12147485,0.08149307,0.22349292,0.105538145,0.09906128,0.073227815,0.40587708,0.10073616,0.11182839,0.10050743,0.36668506,0.14453262,0.08600525,0.15544902,0.12952192,0.08956403,0.031676468,0.036720235,0.115415074,0.022766039,0.112885,0.26185498,0.12569205,0.23247495,0.06727387,0.034355342,0.03985493,0.053973157,0.05688796,0.041681558,0.050538857,0.01018571,0.020160118,0.04429899,0.06755859,0.04796861,0.036870297,0.1303681,0.012440447,0.01315486,0.051500864,0.041275073,0.042701244,0.03888134,0.028109042,0.027824398,0.0059713093,0.012592746,0.014187358,0.014384369,0.018317258,0.014879562,0.018846758,0.025789859,0.0059152534,0.007897918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"color":"#FF9900","label":"Mass"},{"param":"Vc","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.007889013,0.007876719,0.010230189,0.024364581,0,0.060400933,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2.6580184,0,0,0,0,0,0,0,1.6046174,2.2161245,0,1.5365355,1.6223292,1.6017476,1.4519945,1.6616037,1.4442327,1.389034,1.4170485,1.3538293,1.3262388,1.3457923,1.258634,1.3058257,1.203638,1.1820987,1.0888629,1.1289223,1.1324548,0.91734785,1.0324184,0.9975515,0.8045693,0.9236047,0.947111,0.96206933,0.7321058,0.8374975,0.8057596,0.8581963,0.4354596,0.7831246,0.63109213,0.5594159,0.76573646,0.84374803,0.726195,0.6189704,0.64273965,0.29279542,0.6187063,0.5480957,0.6059899,0.61007464,0.41300452,0.4433356,0.5999181,0.5382636,0.5642954,0.4303792,0.46690008,0.4496078,0.37487158,0.4245343,0.44031274,0.4823645,0.43032706,0.17642747,0.42469206,0.39396247,0.41966644,0.39806193,0.3909793,0.35531837,0.3782831,0.36795565,0.34512213,0.33045942,0.33354828,0.2606235,0.28693882,0.32946637,0.37522724,0.3015425,0.1270822,0.27234092,0.2537107,0.2746519,0.13150306,0.18938066,0.26092845,0.11732052,0.24361396,0.23515977,0.14170326,0.24007575,0.23050345,0.22905882,0.24363059,0.15554638,0.19753046,0.21396926,0.21339582,0.20488851,0.20212737,0.14936005,0.18827103,0.1702542,0.14640404,0.19143754,0.18025227,0.16564737,0.16938874,0.16692857,0.15556799,0.1396695,0.12896806,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"std":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00032015512,0.0004004747,0.0009979433,0.014457532,0,0.033536267,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.06161548,0,0,0,0,0,0,0,0.025110792,0.05491602,0,0.054843612,0.047488675,0.042846218,0.0320798,0.039726872,0.032296486,0.028816827,0.033337634,0.03222316,0.025344875,0.038242064,0.021935888,0.026129022,0.023119021,0.024572913,0.025719233,0.022208592,0.02681685,0.021825591,0.02362554,0.023301106,0.01808244,0.023092054,0.020448724,0.025535809,0.018764647,0.02083425,0.017099185,0.019996699,0.028063692,0.021517487,0.024178745,0.022111755,0.019174775,0.01889456,0.021851521,0.022773549,0.018500738,0.020898322,0.022951828,0.019667925,0.0145990485,0.017502194,0.016827542,0.017385578,0.020310111,0.016113851,0.019856902,0.0119344685,0.015244862,0.013698746,0.015389091,0.014658833,0.01450303,0.01491009,0.016936898,0.01559103,0.010660076,0.013425022,0.013436112,0.015515604,0.015978264,0.01206039,0.014762988,0.01639048,0.013402609,0.012862275,0.012592254,0.017188909,0.009549536,0.016541148,0.016155438,0.012523051,0.012236303,0.01308118,0.009870086,0.01435973,0.008098675,0.011329537,0.01060522,0.009797418,0.0108843325,0.007472842,0.011977455,0.009218142,0.01110714,0.009590027,0.010921732,0.008340321,0.009086443,0.008747956,0.0089812605,0.010484589,0.0083534345,0.008426484,0.009211129,0.007220257,0.007985284,0.0077125933,0.009018862,0.008895536,0.009472345,0.008193923,0.012161021,0.006934649,0.009083289,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"color":"#990099","label":"Vc"},{"param":"Qr","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00014421325,0.00013370236,0.00026951445,0.00021834929,0,0.0011529041,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.41847438,0,0,0,0,0,0,0,0.23537555,0.29382038,0,0.21858746,0.22295989,0.21684998,0.19921085,0.21511592,0.19466609,0.18319729,0.18398291,0.17327525,0.16770364,0.16677473,0.15431727,0.1560992,0.14423546,0.1368831,0.12723905,0.12846556,0.12503448,0.102528095,0.10953842,0.10481319,0.08549053,0.09474612,0.09432279,0.09065489,0.070874,0.07840591,0.073985405,0.0752088,0.03835769,0.06621302,0.053567242,0.04601655,0.058976945,0.060574234,0.0534809,0.045673877,0.046025753,0.02074044,0.042400386,0.038172852,0.038645815,0.037858576,0.026841559,0.02804045,0.03432605,0.031216659,0.031625975,0.0251189,0.02579031,0.024418186,0.02029137,0.021722782,0.021840727,0.023622673,0.020674648,0.0080166925,0.019711496,0.018283434,0.017745955,0.017006392,0.016517783,0.015746731,0.01548366,0.014618728,0.01391462,0.013231439,0.012541506,0.010291359,0.011247016,0.0116417315,0.012920809,0.010714087,0.0045243604,0.009452388,0.008638387,0.009325105,0.004101691,0.005981314,0.008022215,0.0034466528,0.0073542404,0.0067339395,0.004373696,0.0066414047,0.006529162,0.0062383413,0.0062170057,0.0042309263,0.005233897,0.0052981675,0.005367128,0.005019322,0.004672347,0.003648345,0.004352666,0.003937986,0.0034155985,0.004118003,0.0038128754,0.003488985,0.0037044196,0.0035273458,0.0030593283,0.0029774,0.0025045832,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"std":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"color":"#FF0066","label":"Qr"},{"param":"quality","label":"quality","color":"#FF00FF","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.735394,0.63546,0.246643,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.285028,0,0.46121,0,0.39363,0.304027,0.56728,0.490755,0.400827,0.363371,0.592965,0.614323,0.6074,0.508974,0.706322,0.683485,0.328949,0.547226,0.548204,0.434983,0.581251,0.526838,0.642158,0.634694,0,0.63645,0.49198,0.406369,0,0.20515,0,0,0.721773,0.277591,0.370086,0.540021,0.549379,0,0,0.3758,0.631319,0.403736,0,0.409562,0.346761,0,0.213593,0.352095,0.401874,0.273868,0.289626,0,0.272505,0.41521,0.458944,0,0.23681,0.157915,0.210537,0,0,0.208392,0,0,0.0730065,0.604943,0.510465,0,0.613219,0,0,0,0,0,0.362829,0.419071,0,0,0.254326,0,0.740934,0.49327,0,0,0.0175886,0.157049,0,0.385185,0.504219,0,0.01852,0,0,0,0.148315,0.655871,0.384776,0.447681,0.409892,0.277732,0.454963,0.348257,0,0.587345,0.345601,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"std":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}];
		},
		getFrameTreeData : function(){
			return {
				dataCollections : [{"dataCollectionId":8881,"measurementtodatacollection3VOs":[{"measurementToDataCollectionId":26642,"measurementId":26642,"dataCollectionOrder":2},{"measurementToDataCollectionId":26643,"measurementId":26643,"dataCollectionOrder":3},{"measurementToDataCollectionId":26641,"measurementId":26641,"dataCollectionOrder":1}],"experimentId":1500,"substraction3VOs":[{"subtractionId":6334,"dataCollectionId":8881,"rg":"0.0","rgStdev":"0.0","i0":"0.0","i0stdev":"0.0","firstPointUsed":"0","lastPointUsed":"0","quality":"0.0","isagregated":"False","concentration":null,"rgGuinier":"36.9118505398","rgGnom":"50.4187381199","dmax":"187.327641489","total":"0.320274667468","volume":"156647.0","creationTime":"Oct 7, 2013 1:48:53 PM","gnomFilePath":"","kratkyFilePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_sub-Kratky.png","scatteringFilePath":"","guinierFilePath":"","substractedFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_132_sub.dat","gnomFilePathOutput":" /data/pyarch/bm29/opd29/1500/1d/ryo_132_sub.out"}],"comments":null}],
				merges			: [{"mergeId":15183,"framelist3VO":{"comments":null,"frametolist3VOs":[{"frameToListId":394194,"frame3VO":{"frameId":394194,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00001.dat","comments":null}},{"frameToListId":394196,"frame3VO":{"frameId":394196,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00003.dat","comments":null}},{"frameToListId":394202,"frame3VO":{"frameId":394202,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00009.dat","comments":null}},{"frameToListId":394197,"frame3VO":{"frameId":394197,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00004.dat","comments":null}},{"frameToListId":394201,"frame3VO":{"frameId":394201,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00008.dat","comments":null}},{"frameToListId":394200,"frame3VO":{"frameId":394200,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00007.dat","comments":null}},{"frameToListId":394199,"frame3VO":{"frameId":394199,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00006.dat","comments":null}},{"frameToListId":394204,"frame3VO":{"frameId":394204,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_ave.dat","comments":null}},{"frameToListId":394203,"frame3VO":{"frameId":394203,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00010.dat","comments":null}},{"frameToListId":394198,"frame3VO":{"frameId":394198,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00005.dat","comments":null}},{"frameToListId":394195,"frame3VO":{"frameId":394195,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_131_00002.dat","comments":null}}]},"measurementId":26641,"discardedFrameNameList":null,"averageFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_131_ave.dat","framesCount":"10","framesMerge":"10"},{"mergeId":15184,"framelist3VO":{"comments":null,"frametolist3VOs":[{"frameToListId":394208,"frame3VO":{"frameId":394208,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00004.dat","comments":null}},{"frameToListId":394209,"frame3VO":{"frameId":394209,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00005.dat","comments":null}},{"frameToListId":394211,"frame3VO":{"frameId":394211,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00007.dat","comments":null}},{"frameToListId":394214,"frame3VO":{"frameId":394214,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00010.dat","comments":null}},{"frameToListId":394207,"frame3VO":{"frameId":394207,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00003.dat","comments":null}},{"frameToListId":394212,"frame3VO":{"frameId":394212,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00008.dat","comments":null}},{"frameToListId":394210,"frame3VO":{"frameId":394210,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00006.dat","comments":null}},{"frameToListId":394205,"frame3VO":{"frameId":394205,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00001.dat","comments":null}},{"frameToListId":394206,"frame3VO":{"frameId":394206,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00002.dat","comments":null}},{"frameToListId":394213,"frame3VO":{"frameId":394213,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_00009.dat","comments":null}},{"frameToListId":394215,"frame3VO":{"frameId":394215,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_ave.dat","comments":null}}]},"measurementId":26642,"discardedFrameNameList":null,"averageFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_132_ave.dat","framesCount":"10","framesMerge":"3"},{"mergeId":15185,"framelist3VO":{"comments":null,"frametolist3VOs":[{"frameToListId":394224,"frame3VO":{"frameId":394224,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00009.dat","comments":null}},{"frameToListId":394228,"frame3VO":{"frameId":394228,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_sub.out","comments":null}},{"frameToListId":394229,"frame3VO":{"frameId":394229,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_ave_averbuffer.dat","comments":null}},{"frameToListId":394218,"frame3VO":{"frameId":394218,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00003.dat","comments":null}},{"frameToListId":394217,"frame3VO":{"frameId":394217,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00002.dat","comments":null}},{"frameToListId":394222,"frame3VO":{"frameId":394222,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00007.dat","comments":null}},{"frameToListId":394221,"frame3VO":{"frameId":394221,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00006.dat","comments":null}},{"frameToListId":394219,"frame3VO":{"frameId":394219,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00004.dat","comments":null}},{"frameToListId":394227,"frame3VO":{"frameId":394227,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_sub.dat","comments":null}},{"frameToListId":394216,"frame3VO":{"frameId":394216,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00001.dat","comments":null}},{"frameToListId":394225,"frame3VO":{"frameId":394225,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00010.dat","comments":null}},{"frameToListId":394223,"frame3VO":{"frameId":394223,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00008.dat","comments":null}},{"frameToListId":394220,"frame3VO":{"frameId":394220,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_00005.dat","comments":null}},{"frameToListId":394226,"frame3VO":{"frameId":394226,"filePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_133_ave.dat","comments":null}}]},"measurementId":26643,"discardedFrameNameList":null,"averageFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_133_ave.dat","framesCount":"10","framesMerge":"10"}],
				experiment		: {"experimentId":1500,"name":"group4.xml","creationDate":"Oct 7, 2013 1:43:57 PM","sourceFilePath":"/data/pyarch/bm29/opd29/1500/group4.xml","type":"STATIC","comments":"[BsxCube] Generated from BsxCube","dataAcquisitionFilePath":"/data/pyarch/bm29/opd29/1500/1500.zip","status":"FINISHED","proposalId":10,"samplePlate3VOs":[{"samplePlateId":4498,"platetype3VO":{"plateTypeId":4,"name":"96 Well plate","description":null,"rowCount":8,"columnCount":12,"shape":"REC"},"instructionSet3VO":null,"plategroup3VO":{"plateGroupId":1500,"storageTemperature":"20.0","name":"BsxCube Group 1"},"boxId":null,"name":"96 Well plate","slotPositionRow":"1","slotPositionColumn":"3","storageTemperature":"20.0","sampleplateposition3VOs":[],"experimentId":1500},{"samplePlateId":4500,"platetype3VO":{"plateTypeId":1,"name":"Deep Well","description":null,"rowCount":8,"columnCount":12,"shape":"REC"},"instructionSet3VO":null,"plategroup3VO":{"plateGroupId":1500,"storageTemperature":"20.0","name":"BsxCube Group 1"},"boxId":null,"name":"Deep Well","slotPositionRow":"1","slotPositionColumn":"1","storageTemperature":"20.0","sampleplateposition3VOs":[],"experimentId":1500},{"samplePlateId":4499,"platetype3VO":{"plateTypeId":2,"name":" 4 x ( 8 + 3 ) Block","description":null,"rowCount":4,"columnCount":11,"shape":"REC"},"instructionSet3VO":null,"plategroup3VO":{"plateGroupId":1500,"storageTemperature":"20.0","name":"BsxCube Group 1"},"boxId":null,"name":" 4 x ( 8 + 3 ) Block","slotPositionRow":"1","slotPositionColumn":"2","storageTemperature":"20.0","sampleplateposition3VOs":[{"samplePlatePositionId":10445,"samplePlateId":4499,"rowNumber":1,"columnNumber":2,"volume":null},{"samplePlatePositionId":10446,"samplePlateId":4499,"rowNumber":1,"columnNumber":1,"volume":null}],"experimentId":1500}],"platetype3VOs":[{"plateTypeId":4,"name":"96 Well plate","description":null,"rowCount":8,"columnCount":12,"shape":"REC"},{"plateTypeId":3,"name":"Disk Well plate","description":null,"rowCount":8,"columnCount":2,"shape":"CIR"},{"plateTypeId":2,"name":" 4 x ( 8 + 3 ) Block","description":null,"rowCount":4,"columnCount":11,"shape":"REC"},{"plateTypeId":1,"name":"Deep Well","description":null,"rowCount":8,"columnCount":12,"shape":"REC"}],"samples3VOs":[{"specimenId":10421,"macromolecule3VO":{"macromoleculeId":5995,"safetylevelId":null,"proposalId":10,"name":"DB921","acronym":"DB921","molecularMass":null,"extintionCoefficient":null,"sequence":null,"creationDate":null,"comments":null,"stoichiometry3VOsForHostMacromoleculeId":[],"structure3VOs":[]},"sampleplateposition3VO":{"samplePlatePositionId":10446,"samplePlateId":4499,"rowNumber":1,"columnNumber":1,"volume":null},"bufferId":13,"stockSolutionId":null,"experimentId":1500,"safetyLevelId":null,"concentration":"1.1299999999999999","code":"","volume":"35","comments":null,"measurements":[{"measurementId":26642,"specimenId":10421,"flow":true,"priority":2,"exposureTemperature":"20.0","viscosity":"High","extraFlowTime":"10","volumeToLoad":"35","comments":"[1] 2mMDB921","code":"20.0","transmission":"100.0","waitTime":"0.0","run3VO":{"runId":15432,"timePerFrame":"1.0","timeStart":"2013-10-07 13:46:11.571866","timeEnd":"2013-10-07 13:48:06.212969","storageTemperature":"20.0","exposureTemperature":"19.99","spectrophotometer":"spectrophotometer","energy":"12.4996471418","transmission":"100.0","beamCenterX":"763","beamCenterY":"136","pixelSizeX":"172.0","pixelSizeY":"172.0","radiationRelative":"0","radiationAbsolute":"1e-50","normalization":null},"merge3VOs":[{"mergeId":15184,"framelist3VO":{"_filter_signature":[-13,121,4],"serialVersionUID":-1,"comments":null,"frametolist3VOs":[]},"measurementId":26642,"discardedFrameNameList":null,"averageFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_132_ave.dat","framesCount":"10","framesMerge":"3"}],"dataCollectionOrder":null}],"macromoleculeId":null},{"specimenId":10420,"macromolecule3VO":null,"sampleplateposition3VO":{"samplePlatePositionId":10445,"samplePlateId":4499,"rowNumber":1,"columnNumber":2,"volume":null},"bufferId":13,"stockSolutionId":null,"experimentId":1500,"safetyLevelId":null,"concentration":"0.0","code":"","volume":"35","comments":null,"measurements":[{"measurementId":26641,"specimenId":10420,"flow":false,"priority":1,"exposureTemperature":"20.0","viscosity":"Low","extraFlowTime":"10","volumeToLoad":"35","comments":"46mM.NaCl","code":"","transmission":"100.0","waitTime":"0.0","run3VO":{"runId":15431,"timePerFrame":"1.0","timeStart":"2013-10-07 13:44:44.429814","timeEnd":"2013-10-07 13:46:11.310312","storageTemperature":"20.0","exposureTemperature":"19.99","spectrophotometer":"spectrophotometer","energy":"12.4996471418","transmission":"100.0","beamCenterX":"763","beamCenterY":"136","pixelSizeX":"172.0","pixelSizeY":"172.0","radiationRelative":"0","radiationAbsolute":"1e-50","normalization":null},"merge3VOs":[{"mergeId":15183,"framelist3VO":{"_filter_signature":[-13,121,4],"serialVersionUID":-1,"comments":null,"frametolist3VOs":[]},"measurementId":26641,"discardedFrameNameList":null,"averageFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_131_ave.dat","framesCount":"10","framesMerge":"10"}],"dataCollectionOrder":null},{"measurementId":26643,"specimenId":10420,"flow":false,"priority":3,"exposureTemperature":"20.0","viscosity":"Low","extraFlowTime":"10","volumeToLoad":"35","comments":"46mM.NaCl","code":"","transmission":"100.0","waitTime":"0.0","run3VO":{"runId":15433,"timePerFrame":"1.0","timeStart":"2013-10-07 13:48:06.323928","timeEnd":"2013-10-07 13:49:34.161531","storageTemperature":"20.0","exposureTemperature":"19.99","spectrophotometer":"spectrophotometer","energy":"12.4996471418","transmission":"100.0","beamCenterX":"763","beamCenterY":"136","pixelSizeX":"172.0","pixelSizeY":"172.0","radiationRelative":"0","radiationAbsolute":"1e-50","normalization":null},"merge3VOs":[{"mergeId":15185,"framelist3VO":{"_filter_signature":[-13,121,4],"serialVersionUID":-1,"comments":null,"frametolist3VOs":[]},"measurementId":26643,"discardedFrameNameList":null,"averageFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_133_ave.dat","framesCount":"10","framesMerge":"10"}],"dataCollectionOrder":null}],"macromoleculeId":null}],"dataCollections":[{"dataCollectionId":8881,"measurementtodatacollection3VOs":[{"measurementToDataCollectionId":26641,"measurementId":26641,"dataCollectionOrder":1},{"measurementToDataCollectionId":26643,"measurementId":26643,"dataCollectionOrder":3},{"measurementToDataCollectionId":26642,"measurementId":26642,"dataCollectionOrder":2}],"experimentId":1500,"substraction3VOs":[{"subtractionId":6334,"dataCollectionId":8881,"rg":"0.0","rgStdev":"0.0","i0":"0.0","i0stdev":"0.0","firstPointUsed":"0","lastPointUsed":"0","quality":"0.0","isagregated":"False","concentration":null,"rgGuinier":"36.9118505398","rgGnom":"50.4187381199","dmax":"187.327641489","total":"0.320274667468","volume":"156647.0","creationTime":"Oct 7, 2013 1:48:53 PM","gnomFilePath":"","kratkyFilePath":"/data/pyarch/bm29/opd29/1500/1d/ryo_132_sub-Kratky.png","scatteringFilePath":"","guinierFilePath":"","substractedFilePath":" /data/pyarch/bm29/opd29/1500/1d/ryo_132_sub.dat","gnomFilePathOutput":" /data/pyarch/bm29/opd29/1500/1d/ryo_132_sub.out"}],"comments":null}]},
				proposal		: DATADOC.getProposal_10()
			};
		},
		getScatteringHPLCFrameData : function(){
			return [{"param":"q","data":["0.03204772","0.03678418","0.04152063","0.04625709","0.05099355","0.05573","0.06046646","0.06520292","0.06993937","0.07467583","0.07941229","0.08414874","0.0888852","0.09362166","0.09835811","0.1030946","0.107831","0.1125675","0.1173039","0.1220404","0.1267769","0.1315133","0.1362498","0.1409862","0.1457227","0.1504591","0.1551956","0.159932","0.1646685","0.169405","0.1741414","0.1788779","0.1836143","0.1883508","0.1930872","0.1978237","0.2025602","0.2072966","0.2120331","0.2167695","0.221506","0.2262424","0.2309789","0.2357154","0.2404518","0.2451883","0.2499247","0.2546612","0.2593976","0.2641341","0.2688706","0.273607","0.2783435","0.2830799","0.2878164","0.2925528","0.2972893","0.3020257","0.3067622","0.3114987","0.3162351","0.3209716","0.325708","0.3304445","0.3351809","0.3399174","0.3446539","0.3493903","0.3541268","0.3588632","0.3635997","0.3683361","0.3730726","0.3778091","0.3825455","0.387282","0.3920184","0.3967549","0.4014913","0.4062278","0.4109643","0.4157007","0.4204372","0.4251736","0.4299101","0.4346465","0.439383","0.4441195","0.4488559","0.4535924","0.4583288","0.4630653","0.4678017","0.4725382","0.4772746","0.4820111","0.4867476","0.491484","0.4962205","0.5009569","0.5056934","0.5104298","0.5151663","0.5199028","0.5246392","0.5293757","0.5341121","0.5388486","0.543585","0.5483215","0.553058","0.5577944","0.5625309","0.5672673","0.5720038","0.5767402","0.5814767","0.5862132","0.5909496","0.5956861","0.6004225","0.605159","0.6098954","0.6146319","0.6193683","0.6241048","0.6288413","0.6335777","0.6383142","0.6430506","0.6477871","0.6525235","0.65726","0.6619965","0.6667329","0.6714694","0.6762058","0.6809423","0.6856787","0.6904152","0.6951517","0.6998881","0.7046246","0.709361","0.7140975","0.7188339","0.7235704","0.7283069","0.7330433","0.7377798","0.7425162","0.7472527","0.7519891","0.7567256","0.761462","0.7661985","0.770935","0.7756714","0.7804079","0.7851443","0.7898808","0.7946172","0.7993537","0.8040902","0.8088266","0.8135631","0.8182995","0.823036","0.8277724","0.8325089","0.8372454","0.8419818","0.8467183","0.8514547","0.8561912","0.8609276","0.8656641","0.8704006","0.875137","0.8798735","0.8846099","0.8893464","0.8940828","0.8988193","0.9035557","0.9082922","0.9130287","0.9177651","0.9225016","0.927238","0.9319745","0.9367109","0.9414474","0.9461839","0.9509203","0.9556568","0.9603932","0.9651297","0.9698661","0.9746026","0.9793391","0.9840755","0.988812","0.9935484","0.9982849","1.003021","1.007758","1.012494","1.017231","1.021967","1.026704","1.03144","1.036177","1.040913","1.045649","1.050386","1.055122","1.059859","1.064595","1.069332","1.074068","1.078805","1.083541","1.088278","1.093014","1.09775","1.102487","1.107223","1.11196","1.116696","1.121433","1.126169","1.130906","1.135642","1.140379","1.145115","1.149851","1.154588","1.159324","1.164061","1.168797","1.173534","1.17827","1.183007","1.187743","1.19248","1.197216","1.201953","1.206689","1.211425","1.216162","1.220898","1.225635","1.230371","1.235108","1.239844","1.244581","1.249317","1.254054","1.25879","1.263526","1.268263","1.272999","1.277736","1.282472","1.287209","1.291945","1.296682","1.301418","1.306155","1.310891","1.315627","1.320364","1.3251","1.329837","1.334573","1.33931","1.344046","1.348783","1.353519","1.358256","1.362992","1.367729","1.372465","1.377201","1.381938","1.386674","1.391411","1.396147","1.400884","1.40562","1.410357","1.415093","1.41983","1.424566","1.429302","1.434039","1.438775","1.443512","1.448248","1.452985","1.457721","1.462458","1.467194","1.471931","1.476667","1.481403","1.48614","1.490876","1.495613","1.500349","1.505086","1.509822","1.514559","1.519295","1.524032","1.528768","1.533504","1.538241","1.542977","1.547714","1.55245","1.557187","1.561923","1.56666","1.571396","1.576133","1.580869","1.585606","1.590342","1.595078","1.599815","1.604551","1.609288","1.614024","1.618761","1.623497","1.628234","1.63297","1.637707","1.642443","1.647179","1.651916","1.656652","1.661389","1.666125","1.670862","1.675598","1.680335","1.685071","1.689808","1.694544","1.69928","1.704017","1.708753","1.71349","1.718226","1.722963","1.727699","1.732436","1.737172","1.741909","1.746645","1.751381","1.756118","1.760854","1.765591","1.770327","1.775064","1.7798","1.784537","1.789273","1.79401","1.798746","1.803483","1.808219","1.812955","1.817692","1.822428","1.827165","1.831901","1.836638","1.841374","1.846111","1.850847","1.855584","1.86032","1.865056","1.869793","1.874529","1.879266","1.884002","1.888739","1.893475","1.898212","1.902948","1.907685","1.912421","1.917157","1.921894","1.92663","1.931367","1.936103","1.94084","1.945576","1.950313","1.955049","1.959786","1.964522","1.969259","1.973995","1.978731","1.983468","1.988204","1.992941","1.997677","2.002414","2.00715","2.011887","2.016623","2.02136","2.026096","2.030832","2.035569","2.040305","2.045042","2.049778","2.054515","2.059251","2.063988","2.068724","2.073461","2.078197","2.082933","2.08767","2.092406","2.097143","2.101879","2.106616","2.111352","2.116089","2.120825","2.125562","2.130298","2.135034","2.139771","2.144507","2.149244","2.15398","2.158717","2.163453","2.16819","2.172926","2.177663","2.182399","2.187136","2.191872","2.196608","2.201345","2.206081","2.210818","2.215554","2.220291","2.225027","2.229764","2.2345","2.239237","2.243973","2.248709","2.253446","2.258182","2.262919","2.267655","2.272392","2.277128","2.281865","2.286601","2.291338","2.296074","2.30081","2.305547","2.310283","2.31502","2.319756","2.324493","2.329229","2.333966","2.338702","2.343439","2.348175","2.352911","2.357648","2.362384","2.367121","2.371857","2.376594","2.38133","2.386067","2.390803","2.39554","2.400276","2.405013","2.409749","2.414485","2.419222","2.423958","2.428695","2.433431","2.438168","2.442904","2.447641","2.452377","2.457114","2.46185","2.466586","2.471323","2.476059","2.480796","2.485532","2.490269","2.495005","2.499742","2.504478","2.509215","2.513951","2.518687","2.523424","2.52816","2.532897","2.537633","2.54237","2.547106","2.551843","2.556579","2.561316","2.566052","2.570789","2.575525","2.580261","2.584998","2.589734","2.594471","2.599207","2.603944","2.60868","2.613417","2.618153","2.62289","2.627626","2.632362","2.637099","2.641835","2.646572","2.651308","2.656045","2.660781","2.665518","2.670254","2.674991","2.679727","2.684463","2.6892","2.693936","2.698673","2.703409","2.708146","2.712882","2.717619","2.722355","2.727092","2.731828","2.736564","2.741301","2.746037","2.750774","2.75551","2.760247","2.764983","2.76972","2.774456","2.779193","2.783929","2.788666","2.793402","2.798138","2.802875","2.807611","2.812348","2.817084","2.821821","2.826557","2.831294","2.83603","2.840767","2.845503","2.850239","2.854976","2.859712","2.864449","2.869185","2.873922","2.878658","2.883395","2.888131","2.892868","2.897604","2.90234","2.907077","2.911813","2.91655","2.921286","2.926023","2.930759","2.935496","2.940232","2.944969","2.949705","2.954441","2.959178","2.963914","2.968651","2.973387","2.978124","2.98286","2.987597","2.992333","2.99707","3.001806","3.006543","3.011279","3.016015","3.020752","3.025488","3.030225","3.034961","3.039698","3.044434","3.049171","3.053907","3.058644","3.06338","3.068116","3.072853","3.077589","3.082326","3.087062","3.091799","3.096535","3.101272","3.106008","3.110745","3.115481","3.120217","3.124954","3.12969","3.134427","3.139163","3.1439","3.148636","3.153373","3.158109","3.162846","3.167582","3.172318","3.177055","3.181791","3.186528","3.191264","3.196001","3.200737","3.205474","3.21021","3.214947","3.219683","3.22442","3.229156","3.233892","3.238629","3.243365","3.248102","3.252838","3.257575","3.262311","3.267048","3.271784","3.276521","3.281257","3.285993","3.29073","3.295466","3.300203","3.304939","3.309676","3.314412","3.319149","3.323885","3.328622","3.333358","3.338094","3.342831","3.347567","3.352304","3.35704","3.361777","3.366513","3.37125","3.375986","3.380723","3.385459","3.390196","3.394932","3.399668","3.404405","3.409141","3.413878","3.418614","3.423351","3.428087","3.432824","3.43756","3.442297","3.447033","3.451769","3.456506","3.461242","3.465979","3.470715","3.475452","3.480188","3.484925","3.489661","3.494398","3.499134","3.50387","3.508607","3.513343","3.51808","3.522816","3.527553","3.532289","3.537026","3.541762","3.546499","3.551235","3.555971","3.560708","3.565444","3.570181","3.574917","3.579654","3.58439","3.589127","3.593863","3.5986","3.603336","3.608073","3.612809","3.617545","3.622282","3.627018","3.631755","3.636491","3.641228","3.645964","3.650701","3.655437","3.660174","3.66491","3.669646","3.674383","3.679119","3.683856","3.688592","3.693329","3.698065","3.702802","3.707538","3.712275","3.717011","3.721747","3.726484","3.73122","3.735957","3.740693","3.74543","3.750166","3.754903","3.759639","3.764376","3.769112","3.773848","3.778585","3.783321","3.788058","3.792794","3.797531","3.802267","3.807004","3.81174","3.816477","3.821213","3.82595","3.830686","3.835422","3.840159","3.844895","3.849632","3.854368","3.859105","3.863841","3.868578","3.873314","3.878051","3.882787","3.887523","3.89226","3.896996","3.901733","3.906469","3.911206","3.915942","3.920679","3.925415","3.930152","3.934888","3.939624","3.944361","3.949097","3.953834","3.95857","3.963307","3.968043","3.97278","3.977516","3.982253","3.986989","3.991726","3.996462","4.001198","4.005935","4.010671","4.015408","4.020144","4.024881","4.029617","4.034354","4.03909","4.043827","4.048563","4.053299","4.058036","4.062772","4.067509","4.072245","4.076982","4.081718","4.086455","4.091191","4.095928","4.100664","4.1054","4.110137","4.114873","4.11961","4.124346","4.129083","4.133819","4.138556","4.143292","4.148029","4.152765","4.157501","4.162238","4.166974","4.171711","4.176447","4.181184","4.18592","4.190657","4.195393","4.20013","4.204866","4.209603","4.214339","4.219075","4.223812","4.228548","4.233285","4.238021","4.242758","4.247494","4.252231","4.256967","4.261704","4.26644","4.271176","4.275913","4.280649","4.285386","4.290122","4.294859","4.299595","4.304332","4.309068","4.313805","4.318541","4.323277","4.328014","4.33275","4.337487","4.342223","4.34696","4.351696","4.356433","4.361169","4.365906","4.370642","4.375378","4.380115","4.384851","4.389588","4.394324","4.399061","4.403797","4.408534","4.41327","4.418007","4.422743","4.42748","4.432216","4.436952","4.441689","4.446425","4.451162","4.455898","4.460635","4.465371","4.470108","4.474844","4.479581","4.484317","4.489053","4.49379","4.498526","4.503263","4.507999","4.512736","4.517472","4.522209","4.526945","4.531682","4.536418","4.541154","4.545891","4.550627","4.555364","4.5601","4.564837","4.569573","4.57431","4.579046","4.583783","4.588519","4.593256","4.597992","4.602728","4.607465","4.612201","4.616938","4.621674","4.626411","4.631147","4.635884","4.64062","4.645357","4.650093","4.654829","4.659566","4.664302","4.669039","4.673775","4.678512","4.683248","4.687985","4.692721","4.697458","4.702194","4.70693","4.711667","4.716403","4.72114","4.725876","4.730613","4.735349","4.740086","4.744822","4.749559","4.754295","4.759031","4.763768","4.768504","4.773241","4.777977","4.782714","4.78745","4.792187","4.796923","4.80166","4.806396","4.811133","4.815869","4.820605","4.825342","4.830078","4.834815","4.839551","4.844288","4.849024","4.853761","4.858497","4.863234","4.86797","4.872706","4.877443","4.882179","4.886916","4.891652","4.896389","4.901125","4.905862","4.910598","4.915335","4.920071","4.924807","4.929544","4.93428","4.939017","4.943753","4.94849","4.953226","4.957963","4.962699","4.967436"],"std":["0.03204772","0.03678418","0.04152063","0.04625709","0.05099355","0.05573","0.06046646","0.06520292","0.06993937","0.07467583","0.07941229","0.08414874","0.0888852","0.09362166","0.09835811","0.1030946","0.107831","0.1125675","0.1173039","0.1220404","0.1267769","0.1315133","0.1362498","0.1409862","0.1457227","0.1504591","0.1551956","0.159932","0.1646685","0.169405","0.1741414","0.1788779","0.1836143","0.1883508","0.1930872","0.1978237","0.2025602","0.2072966","0.2120331","0.2167695","0.221506","0.2262424","0.2309789","0.2357154","0.2404518","0.2451883","0.2499247","0.2546612","0.2593976","0.2641341","0.2688706","0.273607","0.2783435","0.2830799","0.2878164","0.2925528","0.2972893","0.3020257","0.3067622","0.3114987","0.3162351","0.3209716","0.325708","0.3304445","0.3351809","0.3399174","0.3446539","0.3493903","0.3541268","0.3588632","0.3635997","0.3683361","0.3730726","0.3778091","0.3825455","0.387282","0.3920184","0.3967549","0.4014913","0.4062278","0.4109643","0.4157007","0.4204372","0.4251736","0.4299101","0.4346465","0.439383","0.4441195","0.4488559","0.4535924","0.4583288","0.4630653","0.4678017","0.4725382","0.4772746","0.4820111","0.4867476","0.491484","0.4962205","0.5009569","0.5056934","0.5104298","0.5151663","0.5199028","0.5246392","0.5293757","0.5341121","0.5388486","0.543585","0.5483215","0.553058","0.5577944","0.5625309","0.5672673","0.5720038","0.5767402","0.5814767","0.5862132","0.5909496","0.5956861","0.6004225","0.605159","0.6098954","0.6146319","0.6193683","0.6241048","0.6288413","0.6335777","0.6383142","0.6430506","0.6477871","0.6525235","0.65726","0.6619965","0.6667329","0.6714694","0.6762058","0.6809423","0.6856787","0.6904152","0.6951517","0.6998881","0.7046246","0.709361","0.7140975","0.7188339","0.7235704","0.7283069","0.7330433","0.7377798","0.7425162","0.7472527","0.7519891","0.7567256","0.761462","0.7661985","0.770935","0.7756714","0.7804079","0.7851443","0.7898808","0.7946172","0.7993537","0.8040902","0.8088266","0.8135631","0.8182995","0.823036","0.8277724","0.8325089","0.8372454","0.8419818","0.8467183","0.8514547","0.8561912","0.8609276","0.8656641","0.8704006","0.875137","0.8798735","0.8846099","0.8893464","0.8940828","0.8988193","0.9035557","0.9082922","0.9130287","0.9177651","0.9225016","0.927238","0.9319745","0.9367109","0.9414474","0.9461839","0.9509203","0.9556568","0.9603932","0.9651297","0.9698661","0.9746026","0.9793391","0.9840755","0.988812","0.9935484","0.9982849","1.003021","1.007758","1.012494","1.017231","1.021967","1.026704","1.03144","1.036177","1.040913","1.045649","1.050386","1.055122","1.059859","1.064595","1.069332","1.074068","1.078805","1.083541","1.088278","1.093014","1.09775","1.102487","1.107223","1.11196","1.116696","1.121433","1.126169","1.130906","1.135642","1.140379","1.145115","1.149851","1.154588","1.159324","1.164061","1.168797","1.173534","1.17827","1.183007","1.187743","1.19248","1.197216","1.201953","1.206689","1.211425","1.216162","1.220898","1.225635","1.230371","1.235108","1.239844","1.244581","1.249317","1.254054","1.25879","1.263526","1.268263","1.272999","1.277736","1.282472","1.287209","1.291945","1.296682","1.301418","1.306155","1.310891","1.315627","1.320364","1.3251","1.329837","1.334573","1.33931","1.344046","1.348783","1.353519","1.358256","1.362992","1.367729","1.372465","1.377201","1.381938","1.386674","1.391411","1.396147","1.400884","1.40562","1.410357","1.415093","1.41983","1.424566","1.429302","1.434039","1.438775","1.443512","1.448248","1.452985","1.457721","1.462458","1.467194","1.471931","1.476667","1.481403","1.48614","1.490876","1.495613","1.500349","1.505086","1.509822","1.514559","1.519295","1.524032","1.528768","1.533504","1.538241","1.542977","1.547714","1.55245","1.557187","1.561923","1.56666","1.571396","1.576133","1.580869","1.585606","1.590342","1.595078","1.599815","1.604551","1.609288","1.614024","1.618761","1.623497","1.628234","1.63297","1.637707","1.642443","1.647179","1.651916","1.656652","1.661389","1.666125","1.670862","1.675598","1.680335","1.685071","1.689808","1.694544","1.69928","1.704017","1.708753","1.71349","1.718226","1.722963","1.727699","1.732436","1.737172","1.741909","1.746645","1.751381","1.756118","1.760854","1.765591","1.770327","1.775064","1.7798","1.784537","1.789273","1.79401","1.798746","1.803483","1.808219","1.812955","1.817692","1.822428","1.827165","1.831901","1.836638","1.841374","1.846111","1.850847","1.855584","1.86032","1.865056","1.869793","1.874529","1.879266","1.884002","1.888739","1.893475","1.898212","1.902948","1.907685","1.912421","1.917157","1.921894","1.92663","1.931367","1.936103","1.94084","1.945576","1.950313","1.955049","1.959786","1.964522","1.969259","1.973995","1.978731","1.983468","1.988204","1.992941","1.997677","2.002414","2.00715","2.011887","2.016623","2.02136","2.026096","2.030832","2.035569","2.040305","2.045042","2.049778","2.054515","2.059251","2.063988","2.068724","2.073461","2.078197","2.082933","2.08767","2.092406","2.097143","2.101879","2.106616","2.111352","2.116089","2.120825","2.125562","2.130298","2.135034","2.139771","2.144507","2.149244","2.15398","2.158717","2.163453","2.16819","2.172926","2.177663","2.182399","2.187136","2.191872","2.196608","2.201345","2.206081","2.210818","2.215554","2.220291","2.225027","2.229764","2.2345","2.239237","2.243973","2.248709","2.253446","2.258182","2.262919","2.267655","2.272392","2.277128","2.281865","2.286601","2.291338","2.296074","2.30081","2.305547","2.310283","2.31502","2.319756","2.324493","2.329229","2.333966","2.338702","2.343439","2.348175","2.352911","2.357648","2.362384","2.367121","2.371857","2.376594","2.38133","2.386067","2.390803","2.39554","2.400276","2.405013","2.409749","2.414485","2.419222","2.423958","2.428695","2.433431","2.438168","2.442904","2.447641","2.452377","2.457114","2.46185","2.466586","2.471323","2.476059","2.480796","2.485532","2.490269","2.495005","2.499742","2.504478","2.509215","2.513951","2.518687","2.523424","2.52816","2.532897","2.537633","2.54237","2.547106","2.551843","2.556579","2.561316","2.566052","2.570789","2.575525","2.580261","2.584998","2.589734","2.594471","2.599207","2.603944","2.60868","2.613417","2.618153","2.62289","2.627626","2.632362","2.637099","2.641835","2.646572","2.651308","2.656045","2.660781","2.665518","2.670254","2.674991","2.679727","2.684463","2.6892","2.693936","2.698673","2.703409","2.708146","2.712882","2.717619","2.722355","2.727092","2.731828","2.736564","2.741301","2.746037","2.750774","2.75551","2.760247","2.764983","2.76972","2.774456","2.779193","2.783929","2.788666","2.793402","2.798138","2.802875","2.807611","2.812348","2.817084","2.821821","2.826557","2.831294","2.83603","2.840767","2.845503","2.850239","2.854976","2.859712","2.864449","2.869185","2.873922","2.878658","2.883395","2.888131","2.892868","2.897604","2.90234","2.907077","2.911813","2.91655","2.921286","2.926023","2.930759","2.935496","2.940232","2.944969","2.949705","2.954441","2.959178","2.963914","2.968651","2.973387","2.978124","2.98286","2.987597","2.992333","2.99707","3.001806","3.006543","3.011279","3.016015","3.020752","3.025488","3.030225","3.034961","3.039698","3.044434","3.049171","3.053907","3.058644","3.06338","3.068116","3.072853","3.077589","3.082326","3.087062","3.091799","3.096535","3.101272","3.106008","3.110745","3.115481","3.120217","3.124954","3.12969","3.134427","3.139163","3.1439","3.148636","3.153373","3.158109","3.162846","3.167582","3.172318","3.177055","3.181791","3.186528","3.191264","3.196001","3.200737","3.205474","3.21021","3.214947","3.219683","3.22442","3.229156","3.233892","3.238629","3.243365","3.248102","3.252838","3.257575","3.262311","3.267048","3.271784","3.276521","3.281257","3.285993","3.29073","3.295466","3.300203","3.304939","3.309676","3.314412","3.319149","3.323885","3.328622","3.333358","3.338094","3.342831","3.347567","3.352304","3.35704","3.361777","3.366513","3.37125","3.375986","3.380723","3.385459","3.390196","3.394932","3.399668","3.404405","3.409141","3.413878","3.418614","3.423351","3.428087","3.432824","3.43756","3.442297","3.447033","3.451769","3.456506","3.461242","3.465979","3.470715","3.475452","3.480188","3.484925","3.489661","3.494398","3.499134","3.50387","3.508607","3.513343","3.51808","3.522816","3.527553","3.532289","3.537026","3.541762","3.546499","3.551235","3.555971","3.560708","3.565444","3.570181","3.574917","3.579654","3.58439","3.589127","3.593863","3.5986","3.603336","3.608073","3.612809","3.617545","3.622282","3.627018","3.631755","3.636491","3.641228","3.645964","3.650701","3.655437","3.660174","3.66491","3.669646","3.674383","3.679119","3.683856","3.688592","3.693329","3.698065","3.702802","3.707538","3.712275","3.717011","3.721747","3.726484","3.73122","3.735957","3.740693","3.74543","3.750166","3.754903","3.759639","3.764376","3.769112","3.773848","3.778585","3.783321","3.788058","3.792794","3.797531","3.802267","3.807004","3.81174","3.816477","3.821213","3.82595","3.830686","3.835422","3.840159","3.844895","3.849632","3.854368","3.859105","3.863841","3.868578","3.873314","3.878051","3.882787","3.887523","3.89226","3.896996","3.901733","3.906469","3.911206","3.915942","3.920679","3.925415","3.930152","3.934888","3.939624","3.944361","3.949097","3.953834","3.95857","3.963307","3.968043","3.97278","3.977516","3.982253","3.986989","3.991726","3.996462","4.001198","4.005935","4.010671","4.015408","4.020144","4.024881","4.029617","4.034354","4.03909","4.043827","4.048563","4.053299","4.058036","4.062772","4.067509","4.072245","4.076982","4.081718","4.086455","4.091191","4.095928","4.100664","4.1054","4.110137","4.114873","4.11961","4.124346","4.129083","4.133819","4.138556","4.143292","4.148029","4.152765","4.157501","4.162238","4.166974","4.171711","4.176447","4.181184","4.18592","4.190657","4.195393","4.20013","4.204866","4.209603","4.214339","4.219075","4.223812","4.228548","4.233285","4.238021","4.242758","4.247494","4.252231","4.256967","4.261704","4.26644","4.271176","4.275913","4.280649","4.285386","4.290122","4.294859","4.299595","4.304332","4.309068","4.313805","4.318541","4.323277","4.328014","4.33275","4.337487","4.342223","4.34696","4.351696","4.356433","4.361169","4.365906","4.370642","4.375378","4.380115","4.384851","4.389588","4.394324","4.399061","4.403797","4.408534","4.41327","4.418007","4.422743","4.42748","4.432216","4.436952","4.441689","4.446425","4.451162","4.455898","4.460635","4.465371","4.470108","4.474844","4.479581","4.484317","4.489053","4.49379","4.498526","4.503263","4.507999","4.512736","4.517472","4.522209","4.526945","4.531682","4.536418","4.541154","4.545891","4.550627","4.555364","4.5601","4.564837","4.569573","4.57431","4.579046","4.583783","4.588519","4.593256","4.597992","4.602728","4.607465","4.612201","4.616938","4.621674","4.626411","4.631147","4.635884","4.64062","4.645357","4.650093","4.654829","4.659566","4.664302","4.669039","4.673775","4.678512","4.683248","4.687985","4.692721","4.697458","4.702194","4.70693","4.711667","4.716403","4.72114","4.725876","4.730613","4.735349","4.740086","4.744822","4.749559","4.754295","4.759031","4.763768","4.768504","4.773241","4.777977","4.782714","4.78745","4.792187","4.796923","4.80166","4.806396","4.811133","4.815869","4.820605","4.825342","4.830078","4.834815","4.839551","4.844288","4.849024","4.853761","4.858497","4.863234","4.86797","4.872706","4.877443","4.882179","4.886916","4.891652","4.896389","4.901125","4.905862","4.910598","4.915335","4.920071","4.924807","4.929544","4.93428","4.939017","4.943753","4.94849","4.953226","4.957963","4.962699","4.967436"],"color":"#green","label":"q","showOnMenu":false},{"param":"scattering_I","data":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"std":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"color":"green","label":"Log(I) Sample"},{"param":"buffer_I","data":["1238.239","1145.279","714.4715","727.0478","557.4354","431.3092","336.8743","266.2886","216.3915","180.6043","153.5644","132.9441","116.2266","102.693","91.97858","83.32679","76.39951","70.48346","65.7489","61.44088","58.24181","55.32645","52.66333","50.3727","48.46687","46.58036","45.16116","43.82572","42.56981","41.62896","40.63721","39.7902","39.06607","38.43219","37.86906","37.34619","36.83723","36.36881","36.00442","35.60367","35.21657","34.92931","34.66363","34.39702","34.1677","33.95259","33.76233","33.60961","33.47443","33.28774","33.11182","32.99065","32.86982","32.73691","32.65132","32.6845","32.49476","32.39029","32.22879","32.17249","32.09994","31.97184","31.90967","31.86489","31.86526","31.77161","31.66843","31.64616","31.62952","31.71211","31.6655","31.57245","31.51005","31.49125","31.40551","31.36692","31.38344","31.31901","31.28128","31.26831","31.27417","31.24748","31.17211","31.12332","31.10533","31.09064","31.08645","31.14285","31.26291","31.16114","31.16197","31.15324","31.12775","31.06549","31.05131","31.04208","31.03123","30.96662","30.97325","30.96154","30.97854","30.93943","31.17185","31.11164","31.08458","31.07934","31.03052","31.03897","30.99742","30.94454","30.94485","30.94456","30.95783","30.99376","30.93751","30.88971","30.89021","30.83486","30.84425","30.86287","30.80427","30.83245","30.85034","30.84504","30.82791","30.8307","30.84549","30.84611","30.79323","30.8177","30.81828","30.78352","30.78398","30.80184","30.76238","30.80319","30.75796","30.75156","30.73329","30.74784","30.78296","30.7612","30.75231","30.77037","30.75824","30.73619","30.75789","30.72507","30.73744","30.7082","30.70365","30.74199","30.72377","30.75096","30.72912","30.71499","30.73117","30.75155","30.71697","30.68345","30.65756","30.68633","30.70938","30.71012","30.7119","30.68113","30.69426","30.65725","30.65643","30.68242","30.70131","30.67762","30.66527","30.66158","30.64905","30.67063","30.673","30.67767","30.64493","30.65555","30.70474","30.65844","30.64734","30.63092","30.66306","30.64316","30.6526","30.66697","30.65574","30.6349","30.62695","30.6353","30.61833","30.60066","30.6071","30.60684","30.6125","30.59701","30.58772","30.56608","30.5996","30.60878","30.61786","30.61696","30.59865","30.61814","30.57728","30.55561","30.55813","30.54114","30.59863","30.58276","30.54502","30.58028","30.57079","30.55372","30.55666","30.57565","30.56096","30.53769","30.55906","30.55082","30.56755","30.56184","30.57581","30.58948","30.56964","30.52755","30.52405","30.55091","30.54564","30.51331","30.52264","30.52645","30.54852","30.55391","30.52504","30.5552","30.51887","30.5058","30.52461","30.51508","30.53153","30.53148","30.54072","30.50284","30.54342","30.5183","30.48399","30.4887","30.50435","30.52196","30.49695","30.50719","30.49799","30.47525","30.52854","30.56099","30.73614","30.68366","30.64002","30.60711","30.59012","30.58102","30.54707","30.56477","30.50358","30.50834","30.46714","30.45045","30.42541","30.43474","30.73607","30.73274","30.68872","30.65689","30.60016","30.60016","30.61113","30.58978","30.6038","30.60031","30.56497","30.54368","30.53453","30.56108","30.57046","30.56408","30.56826","30.55537","30.55009","30.54273","30.54588","30.54269","30.54144","30.55474","30.5458","30.54382","30.56097","30.54257","30.54254","30.51926","30.53353","30.52743","30.54063","30.54366","30.57557","30.66452","30.7448","30.64057","30.59037","30.60295","30.57434","30.5538","30.77558","30.70839","30.68768","30.64513","30.62589","30.60695","30.59134","30.58668","30.56783","30.55168","30.54793","30.55626","30.58581","30.57914","30.56228","30.54351","30.54331","30.54784","30.56968","30.5591","30.58811","30.5558","30.52453","30.53935","30.59285","30.508","30.5207","30.55669","30.54143","30.52403","30.55033","30.55211","30.54755","30.53298","30.54016","30.58135","30.5827","30.56502","30.58685","30.5784","30.53808","30.53946","30.52539","30.51103","30.54041","30.52405","30.51776","30.54087","30.56134","30.56412","30.50357","30.52524","30.53336","30.51324","30.4989","30.50706","30.52068","30.51403","30.49885","30.5081","30.48224","30.47352","30.45975","30.48968","30.50082","30.51201","30.50215","30.51154","30.50817","30.48677","30.48276","30.4766","30.45813","30.46281","30.46632","30.45902","30.46458","30.49036","30.44639","30.43422","30.44355","30.42655","30.44451","30.4747","30.44516","30.43081","30.43487","30.44528","30.45616","30.4212","30.40048","30.39519","30.42171","30.43492","30.40157","30.36689","30.37889","30.41596","30.41354","30.37289","30.36018","30.3796","30.35379","30.39255","30.36132","30.39376","30.37598","30.3714","30.36604","30.38979","30.37055","30.37227","30.36269","30.43855","30.60234","30.46036","30.40922","30.39743","30.36763","30.34414","30.32841","30.27065","30.27861","30.25253","30.25834","30.26728","30.25521","30.24925","30.5139","30.48719","30.44895","30.40418","30.40655","30.38846","30.37694","30.35942","30.39288","30.34947","30.32256","30.3508","30.33473","30.34162","30.3382","30.33227","30.30104","30.34879","30.35685","30.34695","30.30949","30.28969","30.30935","30.29932","30.30576","30.3069","30.3092","30.28655","30.29274","30.28805","30.28016","30.29063","30.27341","30.26956","30.27252","30.2693","30.25883","30.28934","30.25356","30.25522","30.25015","30.2646","30.26821","30.27779","30.27533","30.2654","30.25175","30.24702","30.25706","30.23353","30.23751","30.23634","30.2428","30.24278","30.2326","30.23026","30.21519","30.24175","30.24611","30.23338","30.25585","30.24535","30.22974","30.22492","30.21981","30.23568","30.26896","30.25619","30.24846","30.2059","30.19166","30.21365","30.20996","30.19466","30.20656","30.19305","30.18588","30.20381","30.2545","30.25719","30.21709","30.18873","30.19367","30.20619","30.19338","30.18979","30.19375","30.20034","30.17049","30.15974","30.17183","30.18189","30.17674","30.15468","30.16671","30.16269","30.14653","30.16261","30.16483","30.15188","30.13767","30.16255","30.16467","30.16618","30.16984","30.14728","30.14391","30.16322","30.16689","30.15202","30.1582","30.13248","30.14285","30.13112","30.13937","30.18232","30.16094","30.17139","30.14588","30.14153","30.13284","30.12493","30.10951","30.10632","30.11798","30.11318","30.12035","30.10878","30.0968","30.10489","30.13112","30.13215","30.10906","30.10867","30.12326","30.13294","30.12472","30.13905","30.13835","30.13002","30.10358","30.12117","30.09733","30.1271","30.13758","30.13282","30.10493","30.11126","30.1028","30.11953","30.11617","30.13024","30.12483","30.11877","30.10846","30.25338","30.29371","30.18588","30.15436","30.14078","30.09004","30.0411","30.02278","30.0342","30.07481","30.09161","30.06106","30.01465","30.03099","30.05858","30.26936","30.19888","30.15117","30.15873","30.15069","30.13742","30.13275","30.1144","30.11886","30.10961","30.07903","30.1139","30.1042","30.11243","30.11993","30.08859","30.06868","30.0812","30.1045","30.09734","30.07359","30.05607","30.07844","30.08253","30.08433","30.09027","30.0822","30.10814","30.10508","30.10515","30.09161","30.08472","30.08755","30.08803","30.08815","30.07977","30.07349","30.08015","30.06767","30.07066","30.07612","30.05561","30.05825","30.1041","30.10618","30.07325","30.074","30.08937","30.06918","30.07668","30.08128","30.06826","30.06318","30.074","30.08235","30.0621","30.08408","30.08839","30.07368","30.07638","30.07204","30.09702","30.09077","30.07322","30.06602","30.06512","30.09395","30.07639","30.08614","30.06609","30.05966","30.06832","30.08127","30.09262","30.08376","30.08287","30.06064","30.09073","30.11252","30.10999","30.0868","30.10211","30.10413","30.11037","30.10713","30.08639","30.0898","30.10833","30.10481","30.10821","30.12463","30.25809","30.2021","30.15174","30.09126","30.07497","30.08124","30.0695","30.0365","30.05309","30.06662","30.0628","30.04879","30.05332","30.05072","30.04821","30.05423","30.04854","30.06029","30.04306","30.06796","30.06773","30.04598","30.05918","30.06289","30.06225","30.0503","30.04114","30.0365","30.0561","30.06123","30.05933","30.06108","30.04869","30.06237","30.07562","30.0618","30.05776","30.06358","30.08103","30.09711","30.08978","30.09094","30.06141","30.06872","30.06363","30.05334","30.05289","30.07584","30.05199","30.07484","30.06812","30.0703","30.07574","30.09521","30.07634","30.053","30.04822","30.04386","30.06381","30.05433","30.08042","30.06509","30.07924","30.11521","30.31683","30.24987","30.12257","30.09155","30.02643","30.04805","30.02524","29.99934","29.98885","29.99755","30.01437","30.00284","30.01985","29.99374","29.97795","29.99951","29.99478","30.02471","30.01357","30.01688","30.01988","29.98251","29.98819","29.99459","30.02382","30.01377","30.01718","30.00502","30.00542","29.9829","30.02749","30.00785","30.00534","30.00117","29.97821","30.00568","30.01782","30.00133","30.02246","30.01098","30.0208","30.02748","29.99966","30.03644","30.01551","29.99766","30.01274","30.00152","30.03795","30.04859","30.04601","30.00707","30.02049","30.0305","29.99511","29.97557","29.99071","30.0326","30.00936","29.99884","29.99931","29.99864","29.99031","29.99186","29.98794","29.99622","29.97847","29.97801","29.98051","30.00562","30.00185","29.99093","29.99355","30.00864","29.98396","30.01779","30.01649","30.02401","30.03488","30.02795","30.01058","30.01417","30.02574","30.04456","30.0482","30.03944","30.0579","30.05015","30.04213","30.05591","30.06244","30.02568","30.07296","30.07686","30.08437","30.08732","30.08021","30.07937","30.03765","30.07182","30.07599","30.07088","30.07537","30.05153","30.05586","30.07067","30.08771","30.06501","30.05542","30.08552","30.10789","30.09141","30.05527","30.10587","30.07646","30.09985","30.07406","30.12166","30.11022","30.11516","30.08817","30.09852","30.09696","30.09492","30.09632","30.11427","30.13027","30.12672","30.11648","30.10616","30.08869","30.22712","30.1425","30.13783","30.12507","30.1538","30.12295","30.11662","30.18107","30.1401","30.09229","30.08852","30.15985","30.14672","30.14985","30.14161","30.15089","30.13996","30.1598","30.1254","30.15116","30.14242","30.14111","30.21828","30.16144","30.12336","30.18132","30.20144","30.11803","30.13154","30.16347","30.15686","30.13864","30.11275","30.16518","30.17447","30.19722","30.1564","30.17461","30.16762","30.20004","30.23197","30.21394","30.18186","30.21765","30.20404","30.20203","30.21628","30.19205","30.23277","30.21143","30.21143","30.21487","30.18659","30.22639","30.20208","30.20304","30.24041","30.27878","30.25778","30.30046","30.29759","30.31615","30.30117","30.2726","30.27464","30.26175","30.27617","30.27721","30.29264","30.31711","30.30531","30.30204","30.27678","30.31503","30.29686","30.31121","30.34072","30.34202","30.29462","30.37701","30.30658","30.33074","30.35672","30.39616","30.40044","30.41283","30.3658","30.37642","30.38126","30.41259","30.37002","30.34774","30.41059","30.36612","30.4443","30.41176","30.37423","30.43193","30.42908","30.43893","30.39299","30.3716","30.43492","30.42638","30.43071","30.45692","30.44117","30.45582","30.48592","30.48644","30.45882","30.49885","30.54276","30.54858","30.47997","30.48207","30.51774","30.48191","30.55813","30.46474","30.48995","30.48651","30.52077","30.6154","30.60059","30.56735","30.5027","30.62407","30.57457","30.54668","30.57859","30.74331","30.8698","30.76823","30.67816","30.84676","30.87287","30.79467","30.89461","30.9529","31.32838","31.30882","31.82668","33.20966","36.33874"],"std":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"color":"#0000FF","label":"Log(I) Avg Buf."},{"param":"subtracted_I","data":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"std":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"color":"red","label":"Log(I) Sub."}]
			
		}
		
};

var tabs;
Ext.Loader.setConfig({
	enabled : true
});
Ext.Loader.setPath('Ext.ux', '../js/external/ux');
Ext.QuickTips.init();

var BIOSAXS = {
	updateCount : 0,
	proposal : new Proposal(),
	getBeans : function() {
		return BIOSAXS_BEANS;
	},
	welcome : function(targetId) {
		this.fetchWelcome();
	},
	start : function(targetId) {
		/** For IE * */
		var console = console || {
			"log" : function() {
			}
		};

		this.targetId = targetId;
		var _this = this;
		Ext.require([ 'Ext.grid.*', 'Ext.data.*', 'Ext.util.*', 'Ext.state.*', 'Ext.form.*', 'Ext.tab.*', 'Ext.ux.CheckColumn', 'Ext.ux.RowExpander',
				'Ext.selection.CheckboxModel', 'Ext.layout.container.Column', 'Ext.ux.grid.FiltersFeature', 'Ext.selection.CellModel', 'Ext.util.*', 'Ext.form.*',
				'Ext.ux.form.MultiSelect', 'Ext.ux.form.ItemSelector', 'Ext.chart.*', 'Ext.Window', 'Ext.fx.target.Sprite', 'Ext.layout.container.Fit', 'Ext.window.MessageBox',
				'Ext.ux.data.PagingMemoryProxy', 'Ext.toolbar.Paging', 'Ext.ux.SlidingPager', 'Ext.form.Panel', 'Ext.ux.form.MultiSelect', 'Ext.ux.form.ItemSelector',
				'Ext.ux.ajax.JsonSimlet', 'Ext.ux.ajax.SimManager', 'Ext.tip.QuickTipManager', 'Ext.layout.*', 'Ext.form.Label', 'Ext.selection.*', 'Ext.tab.Panel', 'Ext.tree.*',
				'Ext.ux.LiveSearchGridPanel' ]);

		BIOSAXS.proposal.onInitialized = new Event();

		if (Ext.urlDecode(window.location.href).menu) {
			if (Ext.urlDecode(window.location.href).menu == "stocksolutions") {
				this.showStockSolutionsGrid(targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "results") {
				this.showResults(targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "macromolecule") {
				if ((Ext.urlDecode(window.location.href).macromoleculeId != null) || (Ext.urlDecode(window.location.href).search)) {
					this.showMacromolecule(targetId, Ext.urlDecode(window.location.href).macromoleculeId);
				}
			}
			if (Ext.urlDecode(window.location.href).menu == "prepareexperiment") {
				new PrepareExperimentWidget().draw(this.targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "macromolecules") {
				this.showMacromoleculesGrid(targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "buffers") {
				this.showBuffersGrid(targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "templates") {
				this.showTemplateGrid(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "platescheme") {
				this.showPlateScheme(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "plates") {
				this.showPlatesGrid(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "datacollection") {
				this.showDataCollection(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "PDBVisualizer") {
				if (Ext.urlDecode(window.location.href).modelId != null) {
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, data) {
						if (data != null) {
							for (var i = 0; i < data.length; i++) {
								if (data[i].subtractionId == Ext.urlDecode(window.location.href).subtractionId) {
									var modelId = Ext.urlDecode(window.location.href).modelId;
									var dataCollectionPDBWidget = new DataCollectionPDBWidget({
										width : Ext.getBody().getWidth() - 200,
										height : 600,
										title : "Damaver"
									});
									dataCollectionPDBWidget.draw(data[i], targetId);
								}
							}
						}
					});
					adapter.getAnalysisInformationByExperimentId(Ext.urlDecode(window.location.href).experimentId);
				}
			}
			/** Wizard for creating a new experiment **/
			if (Ext.urlDecode(window.location.href).menu == "design") {
				var wizardWidget = new WizardWidget({
					windowMode : true
				});

				wizardWidget.onFinished.attach(function(sender, result) {
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, data) {
						var experiment = new Experiment(data);
						_this.openExperimentByExperiment(experiment);
					});
					adapter.createTemplate(result.name, "comments", result.data);
				});

				wizardWidget.draw(this.targetId, new ExperimentTypeWizardForm());
			}

			if (Ext.urlDecode(window.location.href).menu == "list_shipment") {
				new ShippingWidget().draw(this.targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "shipments") {
				this.openShipments(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "shipment") {
				this.openShipmentById(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "show_datacollection") {
				this.showCreateDataCollectionList(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "runs") {
				this.showRuns(targetId);
			}
			if (Ext.urlDecode(window.location.href).menu == "samplechanger") {
				this.showExperiments(targetId, "STATIC");
			}
			if (Ext.urlDecode(window.location.href).menu == "hplc") {
				this.showExperiments(targetId, "HPLC");
			}
			if (Ext.urlDecode(window.location.href).menu == "queue") {
				this.showQueue(targetId);
			}

			if (Ext.urlDecode(window.location.href).menu == "calibration") {
				this.showExperiments(targetId, "CALIBRATION");
			}
		} else {
			if (Ext.urlDecode(window.location.href).experimentId != null) {
				this.openExperiment(Ext.urlDecode(window.location.href).experimentId);
			} else {
				this.showExperiments(targetId);
			}

		}
	},

	showDataCollection : function(targetId) {

		var panel = Ext.create('Ext.panel.Panel', {
			plain : true,
			frame : false,
			width : 1000,
			border : 0,
			renderTo : targetId,
			style : {
				padding : 10
			},
			items : []
		});

		BIOSAXS.proposal.onInitialized.attach(function() {
			var adapter = new BiosaxsDataAdapter();
			adapter.onSuccess.attach(function(sender, data) {
				var dataCollectionWidget = new DataCollectionWidget();
				/** Removing event **/
				BIOSAXS.proposal.onInitialized = new Event(BIOSAXS.proposal);
				panel.add(dataCollectionWidget.getPanel(data));
			});

			var subtractionId = Ext.urlDecode(window.location.href).subtractionId;
			adapter.getCompactAnalysisBySubtractionId(subtractionId);
		});
		BIOSAXS.proposal.init();
	},
	showQueue : function(targetId) {
		var _this = this;

		var i = 0;
		var key = {};
		var grid = new QueueGrid({
			          isGrouped : false
			
		});
		grid.getPanel().render(targetId);
		BIOSAXS.proposal.onInitialized.attach(function() {
			grid.refresh();
		});

		BIOSAXS.proposal.init();
	},

	showPlateScheme : function(targetId) {
		var _this = this;
		new SchemeReport().draw(targetId, Ext.urlDecode(window.location.href).experimentId);
	},

	fetchWelcome : function() {
		BIOSAXS.proposal.onInitialized.attach(function() {
			if (BIOSAXS.proposal != null) {
				document.getElementById("macromolecule_panel").innerHTML = "NA";
				document.getElementById("buffer_panel").innerHTML = "NA";
				document.getElementById("stocksolution_panel").innerHTML = "NA";
				document.getElementById("shipment_panel").innerHTML = "NA";
				if (BIOSAXS.proposal.getMacromolecules() != null) {
					document.getElementById("macromolecule_panel").innerHTML = BIOSAXS.proposal.getMacromolecules().length;
				}
				if (BIOSAXS.proposal.getBuffers() != null) {
					document.getElementById("buffer_panel").innerHTML = BIOSAXS.proposal.getBuffers().length;
				}

				if (BIOSAXS.proposal.getStockSolutions() != null) {
					document.getElementById("stocksolution_panel").innerHTML = BIOSAXS.proposal.getStockSolutions().length;
				}

				if (BIOSAXS.proposal.getShipments() != null) {
					document.getElementById("shipment_panel").innerHTML = BIOSAXS.proposal.getShipments().length;
				}
			}
		});
		BIOSAXS.proposal.init();

		var adapter2 = new BiosaxsDataAdapter();
		adapter2.onSuccess.attach(function(sender, data) {
			var templateCount = 0;
			if (data != null) {
				for (var i = 0; i < data.length; i++) {
					if (data[i].experimentType != null) {
						if (data[i].experimentType == 'TEMPLATE') {
							templateCount++;
						}
					}
				}
			}
			document.getElementById("experiment_panel").innerHTML = templateCount;
		});
		adapter2.getExperimentInformationByProposalId();
	},

	/**
	 * PREPARE EXPERIMENT
	 * MACROMOLECULES
	 **/
	showMacromoleculesGrid : function(targetId) {
		BIOSAXS.proposal.onInitialized.attach(function() {
			var grid = new MacromoleculeGrid({
				width : 900,
				collapsed : false,
				searchBar : true,
				tbar : true,
				height : 700

			}).getPanel(BIOSAXS.proposal.getMacromolecules());
			var panel = Ext.create('Ext.panel.Panel', {
				plain : true,
				frame : false,
				border : 0,
				height : 710,
				width : 900,
				renderTo : targetId,
				style : {
					padding : 0
				},
				items : [ grid ]
			});
		});
		BIOSAXS.proposal.init();
	},

	/**
	 * PREPARE EXPERIMENT
	 * BUFFERS
	 **/
	showBuffersGrid : function(targetId) {
		BIOSAXS.proposal.onInitialized.attach(function(sender) {
			var grid = new BufferGrid({
				height : 700,
				searchBar : true,
				tbar : true
			});
			this.panel = Ext.create('Ext.panel.Panel', {
				plain : true,
				frame : false,
				height : 725,
				border : 0,
				renderTo : targetId,
				style : {
					padding : 10
				},
				items : [ grid.getPanel(BIOSAXS.proposal.getBuffers()) ]
			});

		});
		BIOSAXS.proposal.init();
	},

	showTemplateGrid : function(targetId) {
		BIOSAXS.proposal.onInitialized.attach(function(sender) {
			var _this = this;
			var grid = new TemplateGrid({
				height : 700,
				gridType : 'Ext.grid.Panel',
				title : 'Experiments',
				grouping : false,
				tbar : true
			});

			this.panel = Ext.create('Ext.panel.Panel', {
				plain : true,
				frame : false,
				height : 725,
				border : 0,
				renderTo : targetId,
				style : {
					padding : 10
				},
				items : [ grid.getPanel([]) ]
			});

			var adapter = new BiosaxsDataAdapter();

			adapter.onSuccess.attach(function(sender, data) {
				grid.refresh(data);
				_this.panel.setLoading(false);
			});

			this.panel.setLoading("ISPyB: Retrieving Templates");
			adapter.getExperimentInformationByProposalId();
		});
		BIOSAXS.proposal.init();
	},

	showMacromolecule : function(targetId, macromoleculeId) {
		BIOSAXS.proposal.onInitialized.attach(function() {
			var adapter = null;
			if (Ext.urlDecode(window.location.href).search != null) {
				adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, data) {
					new ResultTabs().draw(targetId, data, macromoleculeId);
				});
				adapter._getInformationByMacromoleculeId(JSON.parse(Ext.urlDecode(window.location.href).search.replace(new RegExp("'", 'g'), "\"")));
			} else {
				adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, data) {
					new ResultTabs().draw(targetId, data, macromoleculeId);
				});
				adapter.getInformationByMacromoleculeId(macromoleculeId, Ext.urlDecode(window.location.href).bufferId);
			}
		});
		BIOSAXS.proposal.init();
	},

	showResults : function(targetId) {
		var _this = this;
		
		var macromoleculeGrid = new MacromoleculeGrid({
			width : 900,
			height : 250,
			collapsed : false,
			tbar : false,
			multiselect : false
		});
		
		var grid = new QueueGrid({
	          isGrouped : false,
	          margin : "10 0 0 0",
	          height : 600,
	          tbar : false,
	          bbar : false
		});
		
		var panel = Ext.create('Ext.panel.Panel', {
			plain : true,
			frame : false,
			height : 900,
			width : Ext.getBody().getWidth() - 200,
			border : 0,
			renderTo : targetId,
			padding : 10,
			items : [
			         macromoleculeGrid.getPanel(),
			         grid.getPanel()]
		});
		
		macromoleculeGrid.grid.setLoading("ISPyB: Retrieving proposal info");
		
		macromoleculeGrid.onSelected.attach(function(sender, macromolecules){
			var adapter = new BiosaxsDataAdapter();
			adapter.onSuccess.attach(function(sender, data){
				grid.refresh(data);
			});
			adapter.getCompactAnalysisByMacromoleculeId(macromolecules[0].macromoleculeId);
		});
		
		BIOSAXS.proposal.onInitialized.attach(function(sender) {
			macromoleculeGrid.refresh(BIOSAXS.proposal.macromolecules);
			
			var adapter2 = new BiosaxsDataAdapter();
			adapter2.onSuccess.attach(function(sender, data) {
				console.log(data)
				macromoleculeGrid.grid.setLoading(false);
				
			});
			adapter2.onError.attach(function(sender, data) {
				macromoleculeGrid.grid.setLoading(false);
			});
			macromoleculeGrid.grid.setLoading("ISPyB:  Retrieving data collections info");
			adapter2.getAnalysisByProposalId();
			
		});
		BIOSAXS.proposal.init();
		
//		var _this = this;
//		var args = {
//			height : 600,
//			searchBar : false,
//			tbar : false,
//			btnResultVisible : true,
//			width : Ext.getBody().getWidth() - 250
//		};
//
//		var panel = Ext.create('Ext.panel.Panel', {
//			plain : true,
//			frame : false,
//			height : 725,
//			width : Ext.getBody().getWidth() - 200,
//			border : 0,
//			renderTo : targetId,
//			padding : 10,
//			items : []
//		});
//		panel.setLoading("ISPyB: Getting information");
//		BIOSAXS.proposal.onInitialized.attach(function(sender) {
//			var adapter = new BiosaxsDataAdapter();
//			adapter.onSuccess.attach(function(sender, data) {
//				debugger
////				var grid = new ResultsAssemblyGrid(args);
////				panel.insert(0, grid.getPanel(data));
////				panel.setLoading(false);
//			});
//			adapter.onError.attach(function(sender, data) {
//				alert("There was an error");
//				panel.setLoading(false);
//			});
//			adapter.getAnalysisByProposalId();
//		});
//		BIOSAXS.proposal.init();
	},

	showRuns : function(targetId) {
		var items = [];
		var framesetGrid = new FramesetGrid({
			height : 400
		});

		var grid = framesetGrid.getGrid([]);
		var panel = Ext.create('Ext.panel.Panel', {
			plain : true,
			frame : false,
			border : 0,
			height : 565,
			renderTo : targetId,
			style : {
				padding : 0
			},
			items : [ grid ]
		});

		grid.setLoading("ISPyB: getting RUNS");

		var dataAdapter = new BiosaxsDataAdapter();
		dataAdapter.onRunsRetrieved.attach(function(evt, runs) {
			framesetGrid.refresh(runs);
			grid.setLoading(false);
		});
		dataAdapter.getAllRuns();
	},

	openShipmentById : function(targetId) {
		var _this = this;
		BIOSAXS.proposal.onInitialized = new Event();
		BIOSAXS.proposal.onInitialized.attach(function(sender) {
			var shippingId = Ext.urlDecode(window.location.href).shippingId;
			for (var i = 0; i < BIOSAXS.proposal.getShipments().length; i++) {
				if (BIOSAXS.proposal.getShipments()[i].shippingId == shippingId) {
					_this.showShipmentTabs(BIOSAXS.proposal.getShipments()[i], targetId);
				}
			}

		});
		BIOSAXS.proposal.init();
	},
	openShipments : function(targetId) {
		var _this = this;
		var grid = new ShipmentGrid({
			height : 700,
			title : 'Shipments',
			minHeight : 700
		});

		this.panel = Ext.create('Ext.panel.Panel', {
			plain : true,
			frame : false,
			height : 725,
			border : 0,
			renderTo : targetId,
			style : {
				padding : 10
			},
			items : [ grid.getPanel([]) ]
		});

		BIOSAXS.proposal.onInitialized = new Event();
		BIOSAXS.proposal.onInitialized.attach(function(sender) {
			grid.refresh(BIOSAXS.proposal.getShipments());
			_this.panel.setLoading(false);
		});

		this.panel.setLoading("ISPyB: Retrieving shipments");
		BIOSAXS.proposal.init();
	},

	showShipmentTabs : function(shipment, targetId) {
		BIOSAXS.proposal.onInitialized = new Event();
		document.getElementById(targetId).innerHTML = "";
		var tabs = new ShipmentTabs(targetId);

		var tabsPanel = tabs.getPanel(new Shipment(shipment));
		var panel = Ext.create('Ext.panel.Panel', {
			plain : true,
			frame : false,
			border : 0,
			height : 900,
			renderTo : targetId,
			style : {
				padding : 0
			},
			items : tabsPanel
		});

	},

	/**
	 * DATA ACQUISITION
	 * MAIN MENU / ALL
	 **/
	showExperiments : function(targetId, filtered) {
		var _this = this;
		var items = [];
		this.experimentGrid = new ExperimentGrid({
			width : '96%',
			tbar : true,
			filtered : filtered,
			sessionId : Ext.urlDecode(window.location.href).sessionId
		});
		var grid = this.experimentGrid.getPanel([]);
		this.panel = Ext.create('Ext.panel.Panel', {
			plain : true,
			frame : false,
			resizable : true,
			border : 0,
			renderTo : targetId,
			style : {
				padding : 0
			},
			items : [ grid ]
		});

		grid.setLoading("ISPyB: Retrieving Experiments");

		this.proposal.onInitialized.attach(function(sender) {
			var adapter = new BiosaxsDataAdapter();
			adapter.onSuccess.attach(function(sender, data) {
				if (data.length === 0) {
					_this.panel.insert(0, {
						border : 0,
						padding : 0,
						html : BUI.getWarningHTML("No experiments found for this proposal. Go to menu Prepare Experiment -> Experiment -> Create") + "<br/>"
					});
				}
				_this.experimentGrid.refresh(data);
				grid.setLoading(false);

				function updateExperiments() {
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, data) {
						grid.setLoading("Updating");
						_this.experimentGrid.refresh(data);
						grid.setLoading(false);

						BIOSAXS.updateCount = BIOSAXS.updateCount + 1;
						window.clearInterval(inter);
						inter = setInterval(function() {
							updateExperiments();
						}, BUI.getUpdateInterval());
					});
					adapter.getExperimentInformationByProposalId(Ext.urlDecode(window.location.href).sessionId);

				}
				var inter = setInterval(function() {
					updateExperiments();
				}, BUI.getUpdateInterval());

			});

			adapter.getExperimentInformationByProposalId(Ext.urlDecode(window.location.href).sessionId);
		});

		this.proposal.init(Ext.urlDecode(window.location.href).sessionId);
	},

	/** Prepare Experiment --> View --> Plates * */
	showPlatesGrid : function(targetId) {
		var dataAdapter = new BiosaxsDataAdapter();
		dataAdapter.onExperimentByProposalRetrieved.attach(function(evt, data) {
			var experiments = [];
			var i = null;
			for (i = 0; i < data.length; i++) {
				experiments.push(new Experiment(data[i]));
			}

			data = [];
			for (i = 0; i < experiments.length; i++) {
				var samplePlates = experiments[i].getSamplePlates();
				for (var j = 0; j < samplePlates.length; j++) {
					data.push(samplePlates[j]);
				}
			}

			var items = [];
			if (data.length === 0) {
				items.push({
					border : 0,
					html : BUI.getWarningHTML("No plates found. Go into the experiment and go to tab Plates and click on add to create a new one")
				});
			}

			items.push(new PlatesMacromoleculesGrid({
				height : 400
			}).getGrid(experiments));

			this.panel = Ext.create('Ext.panel.Panel', {
				plain : true,
				frame : false,
				border : 0,
				height : 550,
				renderTo : targetId,
				style : {
					padding : 10
				},
				items : items
			});
		});
		dataAdapter.getExperimentsByProposalId();
	},

	showStockSolutionsGrid : function(targetId) {
		var _this = this;

		BIOSAXS.proposal.onInitialized.attach(function(sender) {
			var grid = new StockSolutionGrid({
				height : 700,
				searchBar : false,
				tbar : true
			});
			_this.test = grid;
			var items = [];
			items.push(grid.getPanel(BIOSAXS.proposal.getStockSolutions()));

			this.panel = Ext.create('Ext.panel.Panel', {
				plain : true,
				frame : false,
				height : 725,
				border : 0,
				renderTo : targetId,
				style : {
					padding : 10
				},
				items : items
			});

		});
		BIOSAXS.proposal.init();
	},
	openExperiment : function(experimentId) {
		var _this = this;
		if (this.panel == null) {
			this.panel = Ext.create('Ext.panel.Panel', {
				plain : true,
				frame : false,
				height : 725,
				border : 0,
				renderTo : this.targetId,
				style : {
					padding : 10
				},
				items : []
			});
		}

		this.panel.setLoading("Retrieving Experiment");

		if (BIOSAXS.proposal.macromolecules == null) {

			BIOSAXS.proposal.onInitialized.attach(function(sender) {
				if (experimentId == null) {
					experimentId = Ext.urlDecode(window.location.href).experimentId;
				}
				var dataAdapter = new BiosaxsDataAdapter();
				dataAdapter.onSuccess.attach(function(evt, data) {
					_this.panel.setLoading(false);
					_this.openExperimentByExperiment(new Experiment(data));
				});
				dataAdapter.getExperimentById(experimentId, "MEDIUM");

			});
			BIOSAXS.proposal.init(Ext.urlDecode(window.location.href).sessionId);
		} else {
			var dataAdapter = new BiosaxsDataAdapter();
			dataAdapter.onSuccess.attach(function(evt, data) {
				_this.panel.setLoading(false);
				_this.openExperimentByExperiment(new Experiment(data));
			});
			dataAdapter.getExperimentById(experimentId, "MEDIUM");
		}
	},
	openExperimentByExperiment : function(experimentEntry) {
		document.getElementById("mainPanel").innerHTML = "";
		if ((experimentEntry.json.type == "STATIC") || (experimentEntry.json.type == "CALIBRATION")) {
			tabs = new ExperimentTabs("mainPanel");
		} else {
			if (experimentEntry.json.type == "HPLC") {
				tabs = new HPLCTabs("mainPanel");
			} else {
				tabs = new TemplateTabs("mainPanel");
			}
		}
		tabs.draw(experimentEntry);
	}
};

/** DEPRECATED * */
function openExperiment(experimentId) {
	BIOSAXS.openExperiment(experimentId);
}

var SITE_CONF = {
		SAMPLE_CHANGER_CONFIGURATION : {
										"3":{
											"platetype3VO":	{"plateTypeId":4,"name":"96 Well plate","rowCount":8,"columnCount":12,"shape":"REC"},
											"name":"96 Well plate",
											"slotPositionRow":"1",
											"slotPositionColumn":"3",
											"storageTemperature":"0",
											"sampleplateposition3VOs":[],
											"experimentId":0
										},
										"2":{
											"platetype3VO":{"plateTypeId":2,"name":" 4 x ( 8 + 3 ) Block","rowCount":4,"columnCount":11,"shape":"REC"},
											"name":" 4 x ( 8 + 3 ) Block",
											"slotPositionRow":"1",
											"slotPositionColumn":"2",
											"storageTemperature":"0",
											"sampleplateposition3VOs":[],"experimentId":0
											},
										"1":{
											"platetype3VO":{"plateTypeId":1,"name":"Deep Well","rowCount":8,"columnCount":12,"shape":"REC"},
											"name":"Deep Well",
											"slotPositionRow":"1",
											"slotPositionColumn":"1",
											"storageTemperature":"0",
											"sampleplateposition3VOs":[],
											"experimentId":0
											}
		}
};

var ISPYB_CONF = {
		load : function(config) {
			for (var key in config) {
				ISPYB_CONF[key] = config[key];
			}
		},
		SAMPLE_CHANGER_CONFIGURATION : {									
			"1": {
				"platetype3VO": {"plateTypeId": 1, "name": "Deep Well", "rowCount": 8, "columnCount": 12, "shape": "REC"},
				"name": "Deep Well",
				"slotPositionRow": "1",
				"slotPositionColumn": "1",
				"storageTemperature": "0",
				"sampleplateposition3VOs": [],
				"experimentId": 0
			}
		}
	};
var SITE_CONF = {
	
};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function AbinitioForm(args) {
	this.id = BUI.id();
	this.width = null;
	this.height = null;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;
	/** Widgets **/
	this.abinitioGrid = new AbinitioGrid({
		width : null,
		height : 200
	});

	this.abinitioGrid.onSelected.attach(function(sender, models) {
		var modelsIdList = [];
		for ( var i in models) {
			modelsIdList.push(models[i].modelId);
		}
		_this._renderPlot(_this.subtractions[0].subtractionId, modelsIdList);
		_this._renderPDB(modelsIdList);
	});

	/** Dygraph Widget that plots fir files**/
	this.plotWidget = new PlotWidget({
		width : 745 / 2,
		height : 300,
		margin : "10 0 5 10"
	});

	/** PDB viewer **/
	this.viewer = new PDBViewer({
		width : 745 / 2,
		height : 300
	});

}

AbinitioForm.prototype._renderPlot = function(subtractionId, modelsIdList) {
	/** Trying to plot tje subtraction and the models **/
	try {
		var colors = [ "#669900", "#0000FF" ];
		this.plotWidget.refresh([], [  ], modelsIdList, [], [], colors);
	} catch (e) {
		console.log(e);
	}
};

AbinitioForm.prototype._renderPDB = function(modelsIdList) {
	/** Trying to plot the PDB file **/
	try {
		var viz = [];
		for (var i = 0; i < modelsIdList.length; i++) {
			viz.push({
				modelId : modelsIdList[i],
				color : "0xFF6600",
				opacity : 0.8
			});
		}
		this.viewer.refresh(viz);
	} catch (e) {
		console.log(e);
	}
};

AbinitioForm.prototype._getItems = function() {
	var _this = this;
	return [ {
		xtype : 'label',
		forId : 'myFieldId',
		text : 'INLINE HELP: To be updated',
		margin : '15 0 20 10',
		cls : "inline-help"
	}, this.abinitioGrid.getPanel(), {
		xtype : 'container',
		layout : 'hbox',
		items : [ this.plotWidget.getPanel(), this.viewer.getPanel() ]
	} ]
};

AbinitioForm.prototype._getButtons = function() {
	return [];
};

AbinitioForm.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons(),
		listeners : {
			afterrender : function() {
				_this._populate();

			}
		}
	});
	return this.panel;
};

/** Populates could be call when the DOM is not filled yet **/
AbinitioForm.prototype._populate = function() {
};

/** It populates the form * */
AbinitioForm.prototype.refresh = function(subtractions) {
	this.subtractions = subtractions;
	this.abinitioGrid.refresh(subtractions);
};

AbinitioForm.prototype.input = function() {
	return {};
};

/** It populates the form **/
AbinitioForm.prototype.test = function(targetId) {
	var macromoleculeForm = new AbinitioForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function DataReductionForm(args) {
	this.id = BUI.id();
	this.width = null;
	this.height = null;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;

	/** Widgets **/
	this.plotWidget = new PlotWidget({
		width : 650,
		height : 490
	});

	/** Selected frames to be displayed **/
	this.selectedItems = {
		frames : [],
		averages : [],
		subtractions : []
	};

}

DataReductionForm.prototype._parseSelectedItemsToIds = function(selectedArray) {
	var ids = [];
	if (selectedArray != null) {
		for (var i = 0; i < selectedArray.length; i++) {
			ids.push(selectedArray[i].id);
		}
	}
	return ids;
};

DataReductionForm.prototype.onSelectionChanged = function(columnName, selected) {
	if (selected != null) {
		if (columnName == "Frames") {
			this.selectedItems.frames = selected;
			this.selectedItems.subtractions = [];
		}
		if (columnName == "Averages") {
			this.selectedItems.averages = selected;
		}
		if (columnName == "Subtractions") {
			this.selectedItems.frames = [];
			this.selectedItems.subtractions = selected;
		}
	}
	this.plotWidget.refresh(this._parseSelectedItemsToIds(this.selectedItems.frames), this._parseSelectedItemsToIds(this.selectedItems.subtractions));
};

DataReductionForm.prototype._getFramesExtPanel = function(store, columnName, height) {
	var _this = this;

	var selModel = Ext.create('Ext.selection.RowModel', {
		allowDeselect : true,
		mode : 'MULTI',
		listeners : {
			selectionchange : function(sm, selections) {
				var selected = [];
				for (var i = 0; i < selections.length; i++) {
					selected.push(selections[i].raw);
				}
				_this.onSelectionChanged(columnName, selected);
			}
		}
	});

	return Ext.create('Ext.grid.Panel', {
		store : store,
		margin : 10,
		height : height,
		width : 200,
		selModel : selModel,
		columns : [ {
			text : columnName,
			dataIndex : 'fileName',
			flex : 1
		} ],
		viewConfig : {
		}
	});
};

DataReductionForm.prototype._getFramesPanel = function() {
	var fields = [ 'fileName', 'type', 'id' ];

	this.framesStore = Ext.create('Ext.data.Store', {
		fields : fields,
		sorters : 'fileName'
	});

	this.averagesStore = Ext.create('Ext.data.Store', {
		fields : fields
	});

	this.subtractionStore = Ext.create('Ext.data.Store', {
		fields : fields
	});

	var gridFrames = this._getFramesExtPanel(this.framesStore, "Frames", 375);
	var gridAvgs = this._getFramesExtPanel(this.averagesStore, "Averages", 125);
	var subtractionAvgs = this._getFramesExtPanel(this.subtractionStore, "Subtractions", 75);

	return {
		xtype : 'container',
		layout : 'vbox',
		items : [ gridFrames,  subtractionAvgs ]
	};
};

DataReductionForm.prototype._getImageContainer = function(name, help) {
	var html = "<div id='" + this.id + "_" + name + "'>" + name + "</div>"
	return {
		xtype : 'container',
		layout : 'vbox',
		items : [ {
			html : html,
			margin : "5 0 0 0",
			height : 95,
			width : 100
		}, {
			xtype : 'label',
			forId : 'myFieldId',
			text : help,
			margin : '5 0 0 0',
			cls : "inline-help"
		} ]
	}
};

DataReductionForm.prototype._getItems = function() {
	var _this = this;
	return [ {
		xtype : 'container',
		layout : 'hbox',
		items : [
				this._getFramesPanel(),
				this.plotWidget.getPanel(),
				{
					xtype : 'panel',
					width : 110,
					frame : true,
					margin : "10 5 5 5",
					border : 0,
					layout : 'vbox',
					items : [ this._getImageContainer("scattering", "Scattering"), this._getImageContainer("guinier", "Guinier Region"),
							this._getImageContainer("kratky", "Kratky Plot"), this._getImageContainer("gnom", "P(r) distribution") ]
				} ]
	} ]
};

DataReductionForm.prototype._getButtons = function() {
	return [];
};

DataReductionForm.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		border : 0,
		items : this._getItems(),
		buttons : this._getButtons(),
		listeners : {
			afterrender : function() {
				_this._populate();
			}
		}
	});
	return this.panel;
};

/** Populates could be call when the DOM is not filled yet **/
DataReductionForm.prototype._populate = function() {
};

/** It populates the form * */
DataReductionForm.prototype.refresh = function(subtractions) {
	if (subtractions != null) {
		for (var i = 0; i < subtractions.length; i++) {
			/** Loading frame grids **/
			var subtraction = subtractions[i];
			var averages = [ {
				fileName : BUI.getFileName(subtraction.bufferAverageFilePath),
				type : 'bufferAvg',
				id : subtraction.subtractionId
			}, {
				fileName : BUI.getFileName(subtraction.sampleAverageFilePath),
				type : 'sampleAvg',
				id : subtraction.subtractionId
			}

			];
			this.averagesStore.loadData(averages, true);
			this.subtractionStore.loadData([ {
				fileName : BUI.getFileName(subtraction.substractedFilePath),
				type : 'SUBTRACTION',
				id : subtraction.subtractionId
			} ], true);

			var frames = [];
			/** Buffers **/
			if (subtraction.bufferOneDimensionalFiles != null) {
				if (subtraction.bufferOneDimensionalFiles.frametolist3VOs != null) {
					for (var j = 0; j < subtraction.bufferOneDimensionalFiles.frametolist3VOs.length; j++) {
						var frametolist3VO = subtraction.bufferOneDimensionalFiles.frametolist3VOs[j];
						if (frametolist3VO.frame3VO != null) {
							frames.push({
								fileName : BUI.getFileName(frametolist3VO.frame3VO.filePath),
								type : 'BUFFER',
								id : frametolist3VO.frame3VO.frameId
							});
						}
					}
				}
			}
			/** Samples **/
			if (subtraction.sampleOneDimensionalFiles != null) {
				if (subtraction.sampleOneDimensionalFiles.frametolist3VOs != null) {
					for (var j = 0; j < subtraction.sampleOneDimensionalFiles.frametolist3VOs.length; j++) {
						var frametolist3VO = subtraction.sampleOneDimensionalFiles.frametolist3VOs[j];
						if (frametolist3VO.frame3VO != null) {
							frames.push({
								fileName : BUI.getFileName(frametolist3VO.frame3VO.filePath),
								type : 'SAMPLE',
								id : frametolist3VO.frame3VO.frameId
							});
						}
					}
				}
			}

			this.framesStore.loadData(frames, true);

			/** Loading images **/
			this._displayImage("scattering", subtraction.subtractionId);
			this._displayImage("kratky", subtraction.subtractionId);
			this._displayImage("guinier", subtraction.subtractionId);
			this._displayImage("gnom", subtraction.subtractionId);
		}
	}
};

DataReductionForm.prototype._displayImage = function(name, subtractionId) {
	var url = BUI.getURL() + '&type=' + name + '&subtractionId=' + subtractionId;
	var event = "OnClick= window.open('" + url + "')";
	document.getElementById(this.id + "_" + name).innerHTML = '<img src=' + url + '   height="90" width="90" ' + event + '>';
};

DataReductionForm.prototype.input = function() {
	return {};
};

/** It populates the form **/
DataReductionForm.prototype.test = function(targetId) {
	var macromoleculeForm = new DataReductionForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};

function PlotWidget(args) {
	this.width = 600;
	this.height = 600;
	this.id = BUI.id();

	this.linear = false;

	this.margin =  "10 0 0 0";
	/** for each stat the max and minimum value when it is scaled in order to show correctly in the legend **/
	this.ranges = {};
	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.margin != null) {
			this.margin = args.margin;
		}
	}

}

PlotWidget.prototype.getMenu = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];
	actions.push("->");
	actions.push({
		text : "Export as Image",
		scope : this,
		icon : '../images/save.gif',
		handler : function(item, pressed) {
			var largeImage = document.createElement("img");
			largeImage.style.display = 'block';
			largeImage.style.width = 200 + "px";
			largeImage.style.height = 200 + "px";
			largeImage.setAttribute('src', Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL());
			window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(), 'Image', '');
		}
	});

	return actions;
};

/** Looks for the maximum value and then divide everything but that value **/
PlotWidget.prototype.scaledData = function(data) {
	for (var i = 0; i < data.length; i++) {
		var values = this.getMaxAndMinValue(data[i]);
		data[i] = this.divideValuesByMax(data[i], values.max);
		this.ranges[data[i].label] = values;
	}
	return data;
};

/** Given a stat float[] and a max number it will divide each value by max **/
PlotWidget.prototype.divideValuesByMax = function(stat, max) {
	for (var j = 0; j < stat.data.length; j++) {
		if (max != 0) {
			stat.data[j] = Number(stat.data[j]) / max;
			stat.std[j] = Number(stat.std[j]) / max;
		}
	}
	return stat;
};

/** returns max value of a stat **/
PlotWidget.prototype.getMaxAndMinValue = function(stat) {
	var max = 0;
	var min = stat.data[0];
	for (var j = 0; j < stat.data.length; j++) {
		if (Number(stat.data[j]) > max) {
			max = Number(stat.data[j]);
		}
		if (Number(stat.std[j]) > max) {
			max = Number(stat.std[j]);
		}
		if (Number(stat.data[j]) < min) {
			min = Number(stat.data[j]);
		}
	}
	return {
		max : Number(max),
		min : Number(min)
	};
};

PlotWidget.prototype._renderDygraph = function(parsed, colors, labels) {
	this.dygraphObject = new StdDevDyGraph(this.id, {
		width : this.width - 20,
		height : this.height - 40,
		xlabel : "",
	});

	this.dygraphObject.draw(parsed, colors, labels);

};

PlotWidget.prototype.getPanel = function() {
	this.panel = Ext.create('Ext.panel.Panel', {
		width : this.width,
		height : this.height,
		margin : this.margin,
		tbar : this.getMenu(),
		items : [ {
			html : "",
			id : this.id,
			width : this.width,
			height : this.height,
			padding : 10,
			margin : "0 0 0 -30",
			border : 0
		} ]
	});

	return this.panel;
};

PlotWidget.prototype.getPoint = function(y, error) {
	var minus = y - error;
	var max = y + error;

	if (this.linear) {
		return [ Math.abs(minus), y, Math.abs(max) ];
	}
	if ((minus != 0) && (max != 0)) {
		return [ Math.log(Math.abs(minus)), Math.log(y), Math.log(Math.abs(max)) ];
	} else {
		return [ Math.log(y), Math.log(y), Math.log(y) ];
	}

};

PlotWidget.prototype.getDataPlot = function(frames, subtractions, models, fits, rbms) {
	var files = [];
	var labels = [ "Intensity" ];
	if (frames != null) {
		for (var i = 0; i < frames.length; i++) {
			files.push(frames[i].data);
			labels.push(frames[i].fileName);
		}
	}
	 function splitData(data, column, errorColumn, name){
		 var result = []
		 for (var j = 0; j < data.length; j++) {
			 console.log(data[j][column]);
			result.push([j,data[j][column],data[j][errorColumn]]);//[0, data[i][column],0]]);
		}
		 files.push(result);
		 labels.push(name);
	 }
	 
	if (subtractions != null) {
		for (var i = 0; i < subtractions.length; i++) {
			/** For subtraction **/
			files.push(subtractions[i].subtraction.data);
			labels.push(subtractions[i].subtraction.fileName);
			/** For sample average **/
//			files.push(subtractions[i].sampleAvg.data);
//			labels.push(subtractions[i].sampleAvg.fileName);
			/** For buffer average **/
//			files.push(subtractions[i].bufferAvg.data);
//			labels.push(subtractions[i].bufferAvg.fileName);
		}
	}
	
	if (models != null) {
		for (var i = 0; i < models.length; i++) {
			for ( var key in models[i]) {
				 splitData(models[i][key].fir.data, 1, 2, "Intensity");
				 splitData(models[i][key].fir.data, 3, 3, "Fit");
			}
		}
	}
	
	if (fits != null) {
		for (var i = 0; i < fits.length; i++) {
			for ( var key in fits[i]) {
				
				/** adding fit file to be plotted **/
						 if (fits[i][key].fit.data[0].length == 3){
							 splitData(fits[i][key].fit.data, 1, 1, "Intensity");
							 splitData(fits[i][key].fit.data, 2, 2, "Fit");
						 }
						 
						 /** s, Iexp(s), err, Ifit(s). **/
						 if (fits[i][key].fit.data[0].length == 4){
							 splitData(fits[i][key].fit.data, 1, 2, "Intensity");
							 splitData(fits[i][key].fit.data, 3, 3, "Fit");
						 }
						 
						 if (fits[i][key].fit.data[0].length == 5){
							 /** X Intensity Fit Error Residues **/
							
							 splitData(fits[i][key].fit.data, 1, 3, "Intensity");
							 splitData(fits[i][key].fit.data, 2, 2, "Fit");
						 }
			}
		}
	}
	
	var dataPoints = [];
	if (files.length > 0) {
		for (var i = 0; i < files[0].length; i++) {
			dataPoints.push([ files[0][i][0], this.getPoint(files[0][i][1], files[0][i][2]) ]);
		}
		if (files.length > 1) {
			for (var i = 1; i < files.length; i++) {
				for (var j = 0; j < dataPoints.length; j++) {
					if (files[i][j] != null){
						dataPoints[j].push(this.getPoint(files[i][j][1], files[i][j][2]));
					}
					else{
						dataPoints[j].push([0,0,0]);
					}
				}
			}
		}
	}

	return {
		dataPoints : dataPoints,
		labels : labels
	}
};

PlotWidget.prototype.refresh = function(frames, subtractions, models, fits, rbms, colors) {
	
	var _this = this;
	this.panel.setLoading("Reading Files");
	
	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, data) {
			_this.panel.setLoading("Rendering");
			var parsed = _this.getDataPlot(data.frames, data.subtractions, data.models, data.fits, rbms);
			_this._renderDygraph(parsed.dataPoints, colors, parsed.labels);
		_this.panel.setLoading(false);
	});
	dataAdapter.onError.attach(function(sender, data) {
		_this.panel.setLoading(false);
	});
	dataAdapter.getDataPlot(frames, subtractions, models, fits, rbms);
};

PlotWidget.prototype.input = function() {
	return DATADOC.getHPLCData();
};


/**
 * Fit form
 * 
 * @witdh
 * @height
 */
function FitForm(args) {
	this.id = BUI.id();
	this.width = null;
	this.height = null;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;
	
	/** Widgets **/
	this.fitGrid = new FitStructureToExperimentDataGrid({
		width : null,
		height : 200
	});

	this.fitGrid.onSelected.attach(function(sender, fits) {
		var modelsIdList = [];
		for ( var i in fits) {
			modelsIdList.push(fits[i].fitStructureToExperimentalDataId);
		}
		_this._renderPlot(_this.subtractions[0].subtractionId, modelsIdList);
//		var adapter = new BiosaxsDataAdapter();
//		adapter.onSuccess.attach(function(sender, data) {
//
//		});
//		adapter.getScatteringCurveByFrameIdsList([], [], [], ids);
	});
	
	
	/** Dygraph Widget that plots fir files**/
	this.plotWidget = new PlotWidget({
		width : 745,
		height : 300,
		margin : "10 0 10 10"
	});
}

FitForm.prototype._renderPlot = function(subtractionId, modelsIdList) {
	/** Trying to plot tje subtraction and the models **/
	try {
		var colors = [ "#669900", "#0000FF" ];
		
		this.plotWidget.refresh([], [ ], [], modelsIdList, [], colors);
	} catch (e) {
		console.log(e);
	}
};

FitForm.prototype._getItems = function() {
	var _this = this;
	return [ {
		xtype : 'label',
		forId : 'myFieldId',
		text : 'INLINE HELP: To be updated',
		margin : '15 0 20 10',
		cls : "inline-help"
	}, this.fitGrid.getPanel(), this.plotWidget.getPanel() ]

};

FitForm.prototype._getButtons = function() {
	return [];
};

FitForm.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons(),
		listeners : {
			afterrender : function() {
				_this._populate();

			}
		}
	});
	return this.panel;
};

/** Populates could be call when the DOM is not filled yet **/
FitForm.prototype._populate = function() {
};

/** It populates the form * */
FitForm.prototype.refresh = function(subtractions) {
	this.subtractions = subtractions;
	this.fitGrid.refresh(subtractions);
};

FitForm.prototype.input = function() {
	return {};
};

/** It populates the form **/
FitForm.prototype.test = function(targetId) {
	var macromoleculeForm = new FitForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function RigidBodyModelingResultForm(args) {
	this.id = BUI.id();
	this.width = null;
	this.height = null;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;
	/** Widgets **/
	this.rigidModelGrid = new RigidModelGrid({
		width : null,
		height : 200
	});
	
	this.rigidModelGrid.onSelected.attach(function(sender, fits){
		var ids = [];
		for ( var i in fits) {
			ids.push(fits[i].fitStructureToExperimentalDataId);
		}
		var adapter = new BiosaxsDataAdapter();
		adapter.onSuccess.attach(function(sender, data){
//			debugger
			
		});
		
		adapter.getScatteringCurveByFrameIdsList([], [], [], ids);
	});

}

RigidBodyModelingResultForm.prototype._getItems = function() {
	var _this = this;
	return [ {
		xtype : 'label',
		forId : 'myFieldId',
		text : 'INLINE HELP: To be updated',
		margin : '15 0 20 10',
		cls : "inline-help"
	}, this.rigidModelGrid.getPanel() ]

};

RigidBodyModelingResultForm.prototype._getButtons = function() {
	return [];
};

RigidBodyModelingResultForm.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons(),
		listeners : {
			afterrender : function() {
				_this._populate();

			}
		}
	});
	return this.panel;
};

/** Populates could be call when the DOM is not filled yet **/
RigidBodyModelingResultForm.prototype._populate = function() {
};

/** It populates the form * */
RigidBodyModelingResultForm.prototype.refresh = function(subtractions) {
	this.rigidModelGrid.refresh(subtractions);
};

RigidBodyModelingResultForm.prototype.input = function() {
	return {};
};

/** It populates the form **/
RigidBodyModelingResultForm.prototype.test = function(targetId) {
	var macromoleculeForm = new RigidBodyModelingResultForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function SuperpositionForm(args) {
	this.id = BUI.id();
	this.width = null;
	this.height = null;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;

	/** Widgets **/
	this.superpositionGrid = new SuperpositionGrid({
		width : null,
		height : 200
	});

	this.superpositionGrid.onSelected.attach(function(sender, superpositions) {
		var ids = [];
		for ( var i in superpositions) {
			ids.push(superpositions[i].superpositionId);
		}
//		_this._renderAbinitio(ids);
//		_this.aprioriPDBViewer.refresh();
		_this._renderAligned(ids);
		//		getAlignedPDBContentBySuperpositionList
	});

	/** PDB viewer **/
//	this.abinitioPDBViewer = new PDBViewer({
//		width : 860 / 2,
//		height : 300 / 2,
//		margin : 0
//	});
//
//	/** PDB viewer **/
//	this.aprioriPDBViewer = new StructurePDBViewer({
//		width : 860 / 2,
//		height : 300 / 2,
//		margin : 0
//	});

	this.alignedPDBViewer = new AlignedSuperpositionPDBViewer({
		width : 860 ,
		height : 300
	});

}

SuperpositionForm.prototype._renderAligned = function(modelsIdList) {
	/** Trying to plot the PDB file **/
	try {
		this.alignedPDBViewer.refresh(modelsIdList);
	} catch (e) {
		console.log(e);
	}
};

SuperpositionForm.prototype._renderAbinitio = function(modelsIdList) {
	/** Trying to plot the PDB file **/
	try {
		var viz = [];
		for (var i = 0; i < modelsIdList.length; i++) {
			viz.push({
				modelId : modelsIdList[i],
				color : "0xFF6600",
				opacity : 0.8
			});
		}
		this.abinitioPDBViewer.refresh(viz);
	} catch (e) {
		console.log(e);
	}
};

SuperpositionForm.prototype._getItems = function() {
	var _this = this;
	return [ {
		xtype : 'label',
		forId : 'myFieldId',
		text : 'INLINE HELP: To be updated',
		margin : '15 0 20 10',
		cls : "inline-help"
	}, this.superpositionGrid.getPanel(), {
		xtype : 'container',
		layout : 'hbox',
		items : [
//		         {
//			xtype : 'container',
//			layout : 'vbox',
//			items : [ this.abinitioPDBViewer.getPanel(), this.aprioriPDBViewer.getPanel()
//
//			]
//		},

		this.alignedPDBViewer.getPanel() ]
	} ]

};

SuperpositionForm.prototype._getButtons = function() {
	return [];
};

SuperpositionForm.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons(),
		listeners : {
			afterrender : function() {
				_this._populate();

			}
		}
	});
	return this.panel;
};

/** Populates could be call when the DOM is not filled yet **/
SuperpositionForm.prototype._populate = function() {
};

/** It populates the form * */
SuperpositionForm.prototype.refresh = function(subtractions) {
	this.subtractions = subtractions;
	this.superpositionGrid.refresh(subtractions);
};

SuperpositionForm.prototype.input = function() {
	return {};
};

/** It populates the form **/
SuperpositionForm.prototype.test = function(targetId) {
	var macromoleculeForm = new SuperpositionForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function AssemblyForm(args) {
	this.id = BUI.id();
	this.width = 700;
	this.height = 500;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	this.molarityGrid = new MolarityGrid({height : this.height - 50});
}

AssemblyForm.prototype._getItems = function() {
	return [ {
		xtype : 'label',
		forId : 'myFieldId',
		text : 'List of previously defined macromolecules present in the assembly. This information will be used for additional cross-checks where possible',
		margin : '15 0 20 10',
		cls : "inline-help"
	}, this.molarityGrid.getPanel() ];
};

AssemblyForm.prototype._getButtons = function() {
	return [];
};

AssemblyForm.prototype.getPanel = function() {
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 0,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons()
	});
	return this.panel;
};


/** It populates the form **/
AssemblyForm.prototype.refresh = function(macromolecule) {
	this.macromolecule = macromolecule;
	this.molarityGrid.refresh(macromolecule);
};

AssemblyForm.prototype.input = function() {
	return {};
};


AssemblyForm.prototype.test = function(targetId) {
	var assemblyForm = new AssemblyForm();
	
	var panel = assemblyForm.getPanel();
	panel.render(targetId);
};
/**
 * Edit the information of a buffer
 * 
 * #onSaved
 * #onRemoveAdditive
 */
function BufferForm() {
	var _this = this;

	this.additiveGrid = new AdditiveGrid();
	this.additiveGrid.onRemoveButtonClicked.attach(function(sender, args) {
		_this.onRemoveAdditive.notify(args);
	});

	this.onSaved = new Event(this);
	this.onRemoveAdditive = new Event(this);
}

BufferForm.prototype.getBuffer = function() {
	this.buffer.name = Ext.getCmp("buffer_name").getValue();
	this.buffer.acronym = Ext.getCmp("buffer_acronym").getValue();
	this.buffer.comments = Ext.getCmp("buffer_comments").getValue();
	this.buffer.ph = Ext.getCmp("buffer_ph").getValue();
	this.buffer.composition = Ext.getCmp("buffer_composition").getValue();
	this.buffer.bufferhasadditive3VOs = this.additiveGrid.getAdditives();
	return this.buffer;
};

BufferForm.prototype._getTopPanel = function() {
	return {
		xtype : 'container',
		layout : 'hbox',
		border : 0,
		frame : true,
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			items : [ {
				xtype : 'container',
				flex : 1,
				border : false,
				layout : 'anchor',
				defaultType : 'textfield',
				items : [ {
					xtype : 'requiredtext',
					id : 'buffer_name',
					fieldLabel : 'Name',
					name : 'name',
					width : '200px',
					value : this.buffer.name
				}, {
					xtype : 'requiredtext',
					id : 'buffer_acronym',
					fieldLabel : 'Acronym',
					name : 'acronym',
					width : '200px',
					value : this.buffer.acronym
				} ]
			} ]
		}, {
			xtype : 'container',
			flex : 1,
			layout : 'anchor',
			defaultType : 'textfield',
			margin : '0 0 0 10',
			items : [ {
				id : 'buffer_ph',
				fieldLabel : 'pH',
				name : 'ph',
				value : this.buffer.ph,
				xtype : 'numberfield',
				width : 200,
				minValue : 0,
				maxValue : 15
			}, {
				xtype : 'requiredtext',
				id : 'buffer_composition',
				fieldLabel : 'Composition',
				name : 'composition',
				width : 200,
				value : this.buffer.composition
			} ]
		} ]
	};
};

BufferForm.prototype.getPanel = function(buffer) {
	this.buffer = buffer;
	this.panel = Ext.createWidget({
		xtype : 'container',
		layout : 'vbox',
		style : {
			padding : '10px'
		},
		fieldDefaults : {
			labelAlign : 'left',
			labelWidth : 50

		},
		items : [ this._getTopPanel(), {
			id : 'buffer_comments',
			xtype : 'textareafield',
			name : 'comments',
			fieldLabel : 'Comments',
			width : '100%',
			value : buffer.comments
		}, this.additiveGrid.getPanel(buffer) ]
	});
	return this.panel;
};

BufferForm.prototype.input = function() {
	return {
		buffer : {
			"bufferId" : 422,
			"proposalId" : 10,
			"safetyLevelId" : null,
			"name" : "B1",
			"acronym" : "B1",
			"ph" : null,
			"composition" : null,
			"bufferhasadditive3VOs" : [],
			"comments" : null
		}
	};
};

BufferForm.prototype.test = function(targetId) {
	var bufferForm = new BufferForm();
	var panel = bufferForm.getPanel(bufferForm.input().buffer);
	panel.render(targetId);
};

/**
 * @showTitle
 *
 * #onSaved
 * #onAddPlates
 * #onRemovePlates
 **/
function CaseForm(args) {
	this.width = 700;
	this.showTitle = true;
	if (args != null) {
		if (args.showTitle != null) {
			this.showTitle = args.showTitle;
		}
	}

	var _this = this;
	this.stockSolutionGrid = new StockSolutionGrid({
		width : this.width - 10,
		minHeight : 300,
		height : 300,
		tbar : true,
		showTitle : true,
		isPackedVisible : false,
		btnAddExisting : true,
		btnRemoveVisible : false,
		btnUnpackVisible : true
	});

	/** When selecting existing stock solutions **/
	this.stockSolutionGrid.onStockSolutionSelected.attach(function(sender, stockSolutions) {
		if (stockSolutions != null) {
			for ( var i = 0; i < stockSolutions.length; i++) {
				_this.saveStockSolution(stockSolutions[i]);
			}
		}
	});

	/** it can be because it has been added a new one or removed **/
	this.stockSolutionGrid.onProposalChanged.attach(function(sender, stockSolution) {
		if (stockSolution != null) {
			_this.saveStockSolution(stockSolution);
		} else {
			BIOSAXS.proposal.onInitialized.attach(function() {
				_this.stockSolutionGrid.refresh(BIOSAXS.proposal.getStockSolutionsByDewarId(_this.dewar.dewarId));

				_this.stockSolutionGrid.grid.setLoading(false);
			});
			BIOSAXS.proposal.init();

		}

	});

	this.onSaved = new Event(this);
	this.onAddPlates = new Event(this);
	this.onRemovePlates = new Event(this);
}

CaseForm.prototype.saveStockSolution = function(stockSolution) {
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	this.stockSolutionGrid.grid.setLoading("ISPyB: setting case to Stock solution");
	adapter.onSuccess.attach(function(sender, stockSolution) {
		BIOSAXS.proposal.onInitialized.attach(function() {
			_this.stockSolutionGrid.refresh(BIOSAXS.proposal.getStockSolutionsByDewarId(_this.dewar.dewarId));
			_this.stockSolutionGrid.grid.setLoading(false);
		});
		BIOSAXS.proposal.init();
	});
	adapter.onError.attach(function(sender, data) {
		_this.stockSolutionGrid.grid.setLoading(false);
		BUI.showError(data);
	});
	stockSolution.boxId = _this.dewar.dewarId;
	adapter.saveStockSolution(stockSolution);
};

CaseForm.prototype.fillStores = function() {
	var _this = this;
	this.panel.setLoading("Loading Labcontacts from database");

	var proposal = BUI.getProposal();
	proposal.onDataRetrieved.attach(function(sender, data) {
		_this.labContactForSendingStore.loadData(data, false);
		_this.labContactForReturnStore.loadData(data, false);
		_this.panel.setLoading(false);
	});
	proposal.getLabContactsByProposalId();

};

CaseForm.prototype.refresh = function(dewar) {
	this.setDewar(dewar);
	this.stockSolutionGrid.refresh(BIOSAXS.proposal.getStockSolutionsByDewarId(dewar.dewarId));
};

CaseForm.prototype.getDewar = function() {
	this.dewar.code = Ext.getCmp("dewar_code").getValue();
	this.dewar.comments = Ext.getCmp("dewar_comments").getValue();
	this.dewar.trackingNumberFromSynchrotron = Ext.getCmp("dewar_trackingNumberFromSynchrotron").getValue();
	this.dewar.trackingNumberToSynchrotron = Ext.getCmp("dewar_trackingNumberToSynchrotron").getValue();
	this.dewar.transportValue = Ext.getCmp("dewar_transportValue").getValue();
	this.dewar.storageLocation = Ext.getCmp("dewar_storageLocation").getValue();
	this.dewar.firstExperimentId = this.macromoleculeCombo.getValue();
	return this.dewar;
};

CaseForm.prototype.setDewar = function(dewar) {
	this.dewar = dewar;
	Ext.getCmp("dewar_code").setValue(this.dewar.code);
	Ext.getCmp("dewar_dewarStatus").setText(new String(this.dewar.dewarStatus).toUpperCase());
	Ext.getCmp("dewar_comments").setValue(this.dewar.comments);
	Ext.getCmp("dewar_trackingNumberFromSynchrotron").setValue(this.dewar.trackingNumberFromSynchrotron);
	Ext.getCmp("dewar_trackingNumberToSynchrotron").setValue(this.dewar.trackingNumberToSynchrotron);
	Ext.getCmp("dewar_transportValue").setValue(this.dewar.transportValue);
	Ext.getCmp("dewar_storageLocation").setValue(this.dewar.storageLocation);
	if (dewar.sessionVO != null) {
		this.macromoleculeCombo.setValue(dewar.sessionVO.sessionId);
	}
};

CaseForm.prototype.getSessionCombo = function() {
	this.macromoleculeCombo = BIOSAXS_COMBOMANAGER.getComboSessions(BIOSAXS.proposal.getSessions(), {
		labelWidth : 100,
		margin : '5 0 00 0',
		width : 250
	});
	return this.macromoleculeCombo;
};

CaseForm.prototype.getInformationPanel = function() {
	if (this.panel == null) {
		this.informationPanel = Ext.create('Ext.form.Panel', {
			width : this.width - 10,
			border : 0,
			items : [ {
				xtype : 'container',
				margin : "2 2 2 2",
				collapsible : false,
				defaultType : 'textfield',
				layout : 'anchor',
				items : [ {
					xtype : 'container',
					layout : 'hbox',
					items : [ {
						xtype : 'requiredtext',
						fieldLabel : 'Code',
						allowBlank : false,
						name : 'code',
						id : 'dewar_code',
						anchor : '50%'
					}, {
						xtype : 'label',
						margin : '0 0 0 20',
						readOnly : true,
						id : 'dewar_dewarStatus',
						anchor : '50%'
					} ]
				}, this.getSessionCombo(), {
					margin : '5 0 0 0',
					xtype : 'textareafield',
					name : 'comments',
					id : 'dewar_comments',
					width : this.width - 50,
					fieldLabel : 'Comments'
				} ]
			}, {
				xtype : 'fieldset',
				title : 'Courier Accounts Details for Return',
				collapsible : false,
				layout : 'anchor',
				defaults : {
					anchor : '100%'
				},
				items : [ {
					xtype : 'container',
					layout : 'hbox',
					items : [ {
						xtype : 'textfield',
						labelWidth : 200,
						width : 280,
						fieldLabel : 'Track Number From Synchrotron',
						id : 'dewar_trackingNumberFromSynchrotron'
					}, {
						xtype : 'numberfield',
						width : 190,
						labelWidth : 110,
						margin : '0 0 0 30',
						fieldLabel : 'Transport Value',
						id : 'dewar_transportValue'
					}

					]
				}, {
					xtype : 'container',
					layout : 'hbox',
					margin : '10 0 0 0',
					items : [

					{
						xtype : 'textfield',
						labelWidth : 200,
						width : 280,
						fieldLabel : 'Track Number To Synchrotron',
						id : 'dewar_trackingNumberToSynchrotron'
					}, {
						xtype : 'textfield',
						margin : '0 0 0 30',
						width : 190,
						labelWidth : 110,
						fieldLabel : 'Storage Location',
						id : 'dewar_storageLocation'
					}

					]
				} ]
			} ]
		});
	}

	return this.informationPanel;
};

CaseForm.prototype.getPanel = function(dewar) {
	this.dewar = dewar;
	this.panel = Ext.createWidget({
		xtype : 'container',
		layout : 'vbox',
		width : this.width,
		border : 0,
		items : [ {
			items : {
				xtype : "container",
				layout : "vbox",
				margin : "5 5 5 5",
				items : [ this.getInformationPanel(dewar), this.stockSolutionGrid.getPanel() ]

			}
		} ]
	});

	this.refresh(dewar);
	return this.panel;

};

CaseForm.prototype.input = function() {
	return {
		dewar : {
			"dewarId" : 305861,
			"code" : "ESRF-TEST",
			"comments" : "comments",
			"storageLocation" : "FRIDGE",
			"dewarStatus" : "opened",
			"timeStamp" : null,
			"isStorageDewar" : null,
			"barCode" : "ESRF305861",
			"customsValue" : null,
			"transportValue" : null,
			"trackingNumberToSynchrotron" : "3333",
			"trackingNumberFromSynchrotron" : "224466",
			"type" : "Dewar",
			"sessionVO" : {
				"sessionId" : 31697,
				"expSessionPk" : null,
				"projectCode" : null,
				"startDate" : "2012 07 21",
				"endDate" : "2012 07 23",
				"beamlineName" : "BM29",
				"scheduled" : 1,
				"nbShifts" : 2,
				"comments" : null,
				"beamlineOperator" : "PERNOT  P",
				"usedFlag" : null,
				"sessionTitle" : null,
				"structureDeterminations" : null,
				"dewarTransport" : null,
				"databackupFrance" : null,
				"databackupEurope" : null,
				"visit_number" : null,
				"operatorSiteNumber" : "14061",
				"timeStamp" : "2012 04 25"
			}
		},
		proposal : {
			"assemblies" : [],
			"sessions" : [ {
				"sessionId" : 31697,
				"expSessionPk" : null,
				"projectCode" : null,
				"startDate" : "2012 07 21",
				"endDate" : "2012 07 23",
				"beamlineName" : "BM29",
				"scheduled" : 1,
				"nbShifts" : 2,
				"comments" : null,
				"beamlineOperator" : "PERNOT  P",
				"usedFlag" : null,
				"sessionTitle" : null,
				"structureDeterminations" : null,
				"dewarTransport" : null,
				"databackupFrance" : null,
				"databackupEurope" : null,
				"visit_number" : null,
				"operatorSiteNumber" : "14061",
				"timeStamp" : "2012 04 25"
			} ],
			"labcontacts" : [ {
				"labContactId" : 787,
				"personVO" : {
					"personId" : 304252,
					"personUUID" : null,
					"familyName" : "KIM",
					"givenName" : "Henry",
					"title" : null,
					"emailAddress" : "henry-sung.kim@ibs.fr",
					"phoneNumber" : "",
					"login" : "",
					"passwd" : "",
					"faxNumber" : ""
				},
				"cardName" : "KIM-Institut de Bio",
				"defaultCourrierCompany" : "22",
				"courierAccount" : "",
				"billingReference" : "",
				"dewarAvgCustomsValue" : 0,
				"dewarAvgTransportValue" : 0
			} ],
			"buffers" : [ {
				"bufferId" : 811,
				"proposalId" : 3124,
				"safetyLevelId" : null,
				"name" : "EDTA",
				"acronym" : "EDTA",
				"ph" : null,
				"composition" : "",
				"bufferhasadditive3VOs" : [],
				"comments" : ""
			}, {
				"bufferId" : 810,
				"proposalId" : 3124,
				"safetyLevelId" : null,
				"name" : "HEPES",
				"acronym" : "HEPES",
				"ph" : null,
				"composition" : "",
				"bufferhasadditive3VOs" : [],
				"comments" : ""
			} ],
			"shippings" : [ {
				"shippingId" : 304107,
				"shippingName" : "TEST",
				"deliveryAgentAgentName" : null,
				"deliveryAgentShippingDate" : null,
				"deliveryAgentDeliveryDate" : null,
				"deliveryAgentAgentCode" : null,
				"deliveryAgentFlightCode" : null,
				"shippingStatus" : "opened",
				"timeStamp" : "2013 09 25",
				"laboratoryId" : null,
				"isStorageShipping" : null,
				"creationDate" : "2013 09 25",
				"comments" : "test",
				"sendingLabContactVO" : {
					"labContactId" : 787,
					"personVO" : {
						"personId" : 304252,
						"personUUID" : null,
						"familyName" : "KIM",
						"givenName" : "Henry",
						"title" : null,
						"emailAddress" : "henry-sung.kim@ibs.fr",
						"phoneNumber" : "",
						"login" : "",
						"passwd" : "",
						"faxNumber" : ""
					},
					"cardName" : "KIM-Institut de Bio",
					"defaultCourrierCompany" : "22",
					"courierAccount" : "",
					"billingReference" : "",
					"dewarAvgCustomsValue" : 0,
					"dewarAvgTransportValue" : 0
				},
				"returnLabContactVO" : {
					"labContactId" : 787,
					"personVO" : {
						"personId" : 304252,
						"personUUID" : null,
						"familyName" : "KIM",
						"givenName" : "Henry",
						"title" : null,
						"emailAddress" : "henry-sung.kim@ibs.fr",
						"phoneNumber" : "",
						"login" : "",
						"passwd" : "",
						"faxNumber" : ""
					},
					"cardName" : "KIM-Institut de Bio",
					"defaultCourrierCompany" : "22",
					"courierAccount" : "",
					"billingReference" : "",
					"dewarAvgCustomsValue" : 0,
					"dewarAvgTransportValue" : 0
				},
				"returnCourier" : null,
				"dateOfShippingToUser" : null,
				"shippingType" : "DewarTracking",
				"dewarVOs" : [ {
					"dewarId" : 305861,
					"code" : "ESRF-TEST",
					"comments" : "comments",
					"storageLocation" : "FRIDGE",
					"dewarStatus" : "opened",
					"timeStamp" : null,
					"isStorageDewar" : null,
					"barCode" : "ESRF305861",
					"customsValue" : null,
					"transportValue" : null,
					"trackingNumberToSynchrotron" : "3333",
					"trackingNumberFromSynchrotron" : "224466",
					"type" : "Dewar",
					"sessionVO" : {
						"sessionId" : 31697,
						"expSessionPk" : null,
						"projectCode" : null,
						"startDate" : "2012 07 21",
						"endDate" : "2012 07 23",
						"beamlineName" : "BM29",
						"scheduled" : 1,
						"nbShifts" : 2,
						"comments" : null,
						"beamlineOperator" : "PERNOT  P",
						"usedFlag" : null,
						"sessionTitle" : null,
						"structureDeterminations" : null,
						"dewarTransport" : null,
						"databackupFrance" : null,
						"databackupEurope" : null,
						"visit_number" : null,
						"operatorSiteNumber" : "14061",
						"timeStamp" : "2012 04 25"
					}
				} ]
			} ],
			"macromolecules" : [ {
				"macromoleculeId" : 5933,
				"safetylevelId" : null,
				"proposalId" : 3124,
				"name" : "A",
				"acronym" : "A",
				"molecularMass" : "",
				"extintionCoefficient" : "",
				"sequence" : null,
				"creationDate" : null,
				"comments" : "",
				"macromoleculeregion3VOs" : [],
				"stoichiometry3VOsForHostMacromoleculeId" : [],
				"structure3VOs" : []
			} ],
			"stockSolutions" : [ {
				"stockSolutionId" : 6,
				"proposalId" : 3124,
				"macromoleculeId" : 5933,
				"bufferId" : 811,
				"instructionSet3VO" : null,
				"boxId" : 305861,
				"storageTemperature" : "20",
				"volume" : "300",
				"concentration" : "1.2",
				"comments" : "Buffer EDTA with A",
				"name" : "A_EDTA_1.2",
				"samples" : []
			} ]
		}

	};
};

CaseForm.prototype.test = function(targetId) {
	var caseForm = new CaseForm();
	BIOSAXS.proposal = new Proposal(caseForm.input().proposal);
	var panel = caseForm.getPanel(caseForm.input().dewar);
	panel.render(targetId);
};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function ExampleForm(args) {
	this.id = BUI.id();
	this.width = 700;
	this.height = 500;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}
}

ExampleForm.prototype._getItems = function() {
	return [{
		fieldLabel : 'First Name',
		name : 'first',
		allowBlank : false
	}, {
		fieldLabel : 'Last Name',
		name : 'last',
		allowBlank : false
	} ];
};

ExampleForm.prototype._getItems = function() {
	return [ ];
};

ExampleForm.prototype._getButtons = function() {
	return [ ];
};

ExampleForm.prototype.getPanel = function() {
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons()
	});
	return this.panel;
};

/** It populates the form **/
ExampleForm.prototype.refresh = function(macromolecule) {
};

function ExperimentForm(args) {
	this.id = BUI.id();

	if (args != null) {
	}

	this.onSaved = new Event(this);
}

ExperimentForm.prototype._getItems = function(experiment) {
	this.experiment = experiment;
	var typeCombo = Ext.create('Ext.form.ComboBox', {
		id : this.id + 'type',
		fieldLabel : 'Type',
		store : [ "STATIC", "CALIBRATION", "HPLC" ],
		queryMode : 'local',
		labelWidth : 120,
		displayField : 'name',
		valueField : 'name',
		value : experiment.json.type,
		disabled : (experiment.json.type == 'TEMPLATE')
	});
	
	var items = [];
	
	
	if (experiment.json.type == "HPLC" ){
		var typeMacromolecule = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(BIOSAXS.proposal.getMacromolecules(), {labelWidth : 120, width: "120px"});
		if (experiment.getHPLCMacromolecule() != null){
			typeMacromolecule.setValue(experiment.getHPLCMacromolecule().macromoleculeId);
			items.push(typeMacromolecule);
		}
	}
	
	
	items.push(typeCombo, {
		id : this.id + 'name',
		xtype : 'textfield',
		fieldLabel : 'Name',
		labelWidth : 120,
		width : '100%',
		value : experiment.json.name
	}, {
		id : this.id + 'comments',
		xtype : 'textareafield',
		name : 'comments',
		fieldLabel : 'Comments',
		labelWidth : 120,
		height : 120,
		width : '100%',
		value : experiment.json.comments
	});
	return items;
};
ExperimentForm.prototype.getPanel = function(experiment) {
	var _this = this;
	
	this.panel = Ext.createWidget({
		xtype : 'container',
		layout : 'vbox',
		border : 0,
		style : {
			padding : '10px'
		},
		fieldDefaults : {
			labelAlign : 'left',
			labelWidth : 50
		},
		items : this._getItems(experiment)
	});
	return this.panel;
};

ExperimentForm.prototype.input = function() {
	return new ExperimentHeaderForm().input();
};

ExperimentForm.prototype.test = function(targetId) {
	var experimentForm = new ExperimentForm();
	var panel = experimentForm.getPanel(new Experiment(experimentForm.input().experiment));
	panel.render(targetId);
};

/**
 * Shows the header for the experiments changing the color and parameters depending on experiment type
 * 
 */
function ExperimentHeaderForm(args) {
	this.id = BUI.id();
	this.backgroundColor = '#FFFFFF';
}

ExperimentHeaderForm.prototype.getHTMLSource = function(experiment) {
	var html = BUI.createFormLabel("Name :", experiment.json.name, 75, 400, this.backgroundColor);
	if (experiment.json.type == "HPLC") {
		if (experiment.getHPLCMacromolecule() != null){
			html = html + BUI.createFormLabel("Molecule :", experiment.getHPLCMacromolecule().acronym, 75, 400, this.backgroundColor);
		}
	}
	else{
		html = html + BUI.createFormLabel("Type :", experiment.json.type, 75, 400, this.backgroundColor);
	}
	
	html = html + BUI.createFormLabel("Date :", experiment.json.creationDate, 75, 400, this.backgroundColor);
	return html;
};

ExperimentHeaderForm.prototype.getHTMLDownload = function(experiment) {
	var bgcolor = "background-color:" + this.backgroundColor + ";";
	var html = "<div  style='height:25px;" + bgcolor + "'>";
	if ((experiment.json.type == "CALIBATION") || (experiment.json.type == "STATIC")) {
		html = html + "<img src='/ispyb/images/Edit_16x16_01.png' /><a style='" + bgcolor
				+ "'color:blue;' href='/ispyb/user/dataadapter.do?reqCode=getSourceFile&type=scattering&experimentId=" + experiment.experimentId
				+ "' title='File used by the BM control software'>  Download Source File</a></div>";
		html = html
				+ "<div style='"
				+ bgcolor
				+ "'height:25px;'>"
				+ "<img style='width:16px;height:16px' src='/ispyb/images/pdf.png' /><a style='color:blue;' href='/ispyb/user/dataadapter.do?reqCode=getReport&experimentId="
				+ experiment.experimentId + "&format=PDF&filename=" + experiment.name
				+ "&type=DATA_ACQUISITION'   title='Download report'>  Download Report</a></div>";
	}
	if (experiment.json.type == "TEMPLATE") {
		html = html
				+ "<img src='/ispyb/images/Edit_16x16_01.png' /><a ' href='/ispyb/user/dataadapter.do?reqCode=getTemplateSourceFile&experimentId="
				+ experiment.experimentId + "' style='color:blue;color:blue;cursor: hand; cursor: pointer;' >  Download Source File</a></div>";
	}

	if (experiment.json.type == "HPLC") {
		html = html + "<img src='/ispyb/images/Edit_16x16_01.png' /><a ' href='/ispyb/user/dataadapter.do?reqCode=getH5File&experimentId="
				+ experiment.experimentId + "' style='color:blue;color:blue;cursor: hand; cursor: pointer;' >  Download h5 File</a></div>";
	}

	return html;
};

ExperimentHeaderForm.prototype.getTopPanel = function(experiment) {
	return {
		xtype : 'container',
		layout : 'hbox',
		items : [ {
			margin : "0 0 0 0",
			width : 475,
			border : 0,
			html : this.getHTMLSource(experiment)
		}, {
			margin : "0 0 0 0",
			width : 475,
			border : 0,
			html : this.getHTMLDownload(experiment)
		} ]
	};
};

ExperimentHeaderForm.prototype.getButton = function(experiment) {
	var _this = this;
	return Ext.create('Ext.Button', {
		text : 'EDIT',
		minWidth : '100',
		margin : '10 0 0 30',
		handler : function() {
			var experimentWindow = new ExperimentWindow();
			experimentWindow.onSaved.attach(function(sender, data) {
				_this.experiment.json.name = data.name;
				_this.experiment.json.type = data.type;
				_this.experiment.json.comments = data.comments;
				_this.panel.remove(_this.panel.items.items[0]);
				_this.panel.remove(_this.panel.items.items[0]);
				_this.panel.insert(_this.getTopPanel(_this.experiment));
				_this.panel.insert(_this.getBottomPanel(_this.experiment));
			});
			experimentWindow.show(experiment);
		}
	});
};

ExperimentHeaderForm.prototype.getBottomPanel = function(experiment) {
	return {
		xtype : 'container',
		layout : 'hbox',
		margin : '10 0 0 0',
		items : [ this.getComments(experiment), this.getButton(experiment) ]
	};
};

ExperimentHeaderForm.prototype.getComments = function(experiment) {
	return {
		xtype : 'textareafield',
		labelStyle : 'font-weight: bold;',
		name : 'comments',
		fieldLabel : 'Comments',
		labelWidth : 70,
		height : 40,
		minWidth : '450',
		readOnly : true,
		value : experiment.json.comments
	};
};

ExperimentHeaderForm.prototype.getPanel = function(experiment) {
	this.experiment = experiment;

	if (experiment.json.type == 'CALIBRATION') {
		this.backgroundColor = '#EFFBFB';
	}
	if (experiment.json.type == 'TEMPLATE') {
		this.backgroundColor = '#E0F8E6';
	}

	this.panel = Ext.create('Ext.container.Container', {
		frame : false,
		layout : 'vbox',
		padding : 5,
		bodyPadding : '5 5 0 0',
		width : 890,
		margin : '0 0 10 0',
		height : 120,
		style : {
			borderColor : '#99bce8',
			borderStyle : 'solid',
			borderWidth : '1px',
			'background-color' : this.backgroundColor
		},
		fieldDefaults : {
			msgTarget : 'side',
			labelWidth : 100
		},
		items : [ this.getTopPanel(experiment), this.getBottomPanel(experiment) ]
	});
	return this.panel;
};

ExperimentHeaderForm.prototype.input = function() {
	return {
		experiment : DATADOC.getExperiment_10()
	};
};

ExperimentHeaderForm.prototype.test = function(targetId) {
	var experimentHeaderForm = new ExperimentHeaderForm();
	var panel = experimentHeaderForm.getPanel(new Experiment(experimentHeaderForm.input().experiment));
	panel.render(targetId);

};

/**
 * Macromolecule form with the general parameters of a macromolecule
 * 
 * @witdh
 * @height
 * 
 * #onSave button save has been clicked
 * #onClose button close has been clicked
 */
function MacromoleculeForm(args) {
	this.id = BUI.id();
	this.width = 700;
	this.height = 500;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}
	
	/** Events **/
	this.onSave = new Event(this);
	this.onClose = new Event(this);
}

/** Type : is the Ext type then requiredtext or textfield * */
MacromoleculeForm.prototype._getFieldTextWithHelp = function(type, fieldLabel, fieldName, help) {
	return Ext.create('Ext.container.Container', {
		margin : "10 0 0 10",
		items : [ {
			xtype : type,
			fieldLabel : fieldLabel,
			name : fieldName,
			id : this.id + fieldName
		}, {
			xtype : 'label',
			forId : 'myFieldId',
			text : help,
			margin : "5 0 0 105",
			cls : "inline-help"
		} ]
	});
};

MacromoleculeForm.prototype._getNumericWithHelp = function(type, fieldLabel, fieldName, help) {
	return Ext.create('Ext.container.Container', {
		margin : "0 0 0 10",
		items : [ {
			xtype : type,
			fieldLabel : fieldLabel,
			name : fieldName,
			id : this.id + fieldName,
			decimalPrecision : 6,
			width : 220
		}, {
			xtype : 'label',
			forId : 'myFieldId',
			text : help,
			margin : "5 0 0 10",
			cls : "inline-help"
		} ]
	});
};

MacromoleculeForm.prototype._getButtons = function() {
	var _this = this;
	return [ {
		text : 'Save',
		handler : function() {
			_this._save();
		}
	},{
		text : 'Close',
		handler : function() {
			_this.onClose.notify();
			
		}
	} ];
};

/** It persits the macromolecule in the database **/
MacromoleculeForm.prototype._persist = function(macromoleculeId, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity) {
	
	/** Checking not duplicated acronym **/
	if (((macromoleculeId == null) && (BIOSAXS.proposal.getMacromoleculeByAcronym(acronym) != null))== true){
		BUI.showError("Duplicated acronym");
		return;
	}
	
	
	if (macromoleculeId == null){
		/** new macromolecule **/
		this.macromolecule = {};
		this.macromolecule.macromoleculeId = null;
	}
	else{
		this.macromolecule.macromoleculeId = macromoleculeId;
	}
	
	this.macromolecule["acronym"] = acronym;
	this.macromolecule["name"] = name;
	this.macromolecule["molecularMass"] = molecularMass;
	this.macromolecule["extintionCoefficient"] = extintionCoefficient;
	this.macromolecule["comments"] = comments;
	this.macromolecule["symmetry"] =  Ext.getCmp(this.id + 'comboSym').getValue();
	this.macromolecule["refractiveIndex"] =  refractiveIndex;
	this.macromolecule["solventViscosity"] =  solventViscosity;
	
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, proposal) {
		/** Updating the proposal global object **/
		BIOSAXS.proposal.setItems(proposal);
		_this.panel.setLoading(false);
		
		var saved = BIOSAXS.proposal.getMacromoleculeByAcronym(acronym);
		/** Refreshing to check that everything is ok **/
		_this.refresh(saved);
		_this.onSave.notify(saved);
	});
	
	this.panel.setLoading("Saving Macromolecule")
	adapter.saveMacromolecule(this.macromolecule);
};

/** Save the macromolecule in the DB **/
MacromoleculeForm.prototype._save = function() {
	
	var _this = this;
	
	var acronym = this._getField("acronym");
	var name = this._getField("name");
	var molecularMass = this._getField("molecularMass");
	var extintionCoefficient = this._getField("extintionCoefficient");
	var comments = this._getField("comments");
	
	var refractiveIndex = this._getField("refractiveIndex");
	var solventViscosity = this._getField("solventViscosity");
	
	/** Checking required fields **/
	if (name == "") {
		BUI.showError("Name field is mandatory");
		return;
	}
	if (acronym == "") {
		BUI.showError("Acroynm field is mandatory");
		return;
	}

	if (this.macromolecule != null){
		/** Checking if it is a new macromolecule **/
		if (this.macromolecule.macromoleculeId == null){
			/** Check if the acronym exists already **/
			this._persist(null, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity);
		}
		else{
			/** It is an update **/
			this._persist(this.macromolecule.macromoleculeId, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity);
		}
	}
	else{
		/** It is a new macromolecule **/
		this._persist(null, acronym, name, molecularMass, extintionCoefficient, comments, refractiveIndex, solventViscosity);
	}
};



MacromoleculeForm.prototype._getItems = function() {
	var _this = this;
	/** Symmetry combo box **/
	var symmetry = Ext.create('Ext.data.Store', {
		fields : [ 's' ],
		data : this._getSymmetries()
	});

	this.symmetryComboBox = Ext.create('Ext.form.ComboBox', {
		fieldLabel : 'Symmetry',
		store : symmetry,
		id : this.id + 'comboSym',
		queryMode : 'local',
		displayField : 's',
		valueField : 's',
		value : "P1", 
		margin : "0 0 0 30",
		width : 220
	});
	
	return [this._getFieldTextWithHelp("requiredtext", "Name", "name", "Long name. i.e: Bovine serum albumin"),
			this._getFieldTextWithHelp("requiredtext", "Acronym", "acronym", "Acronym will be used in the files and analisys. i.e: BSA"),
			this._getFieldTextWithHelp("textfield", "Mol. Mass (Da)", "molecularMass", "Atomic mass estimation measured in Da"),
			{
				xtype : 'container',
				layout : 'hbox',
				margin : "10 0 0 0",
				items :[
				        	this._getNumericWithHelp("numberfield", "Extinction coef.", "extintionCoefficient", ""),
							this.symmetryComboBox
				        ]
			},
			{
				xtype : 'container',
				layout : 'hbox',
				margin : "5 0 0 0",
				items :[
				        	this._getNumericWithHelp("numberfield", "Refractive Index", "refractiveIndex", "How radiation propagates through the medium"),
							this._getNumericWithHelp("numberfield", "Solvent Viscosity", "solventViscosity", "")
				]
			},
			{
				id : this.id + "comments",
				xtype : 'textareafield',
				name : 'comments',
				margin : '35 0 0 10',
				fieldLabel : 'Comments',
				width : this.width - 100
			} ];
};

MacromoleculeForm.prototype._getSymmetries = function() {
	return  [ {
		"s" : "P1"
	}, {
		"s" : "P2"
	}, {
		"s" : "P3"
	}, {
		"s" : "P4"
	}, {
		"s" : "P5"
	}, {
		"s" : "P6"
	}, {
		"s" : "P32"
	}, {
		"s" : "P42"
	}, {
		"s" : "P52"
	}, {
		"s" : "P62"
	}, {
		"s" : "P222"
	} ]
};

MacromoleculeForm.prototype.getPanel = function() {
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons()
	});
	return this.panel;
};


/** Populates each text field by field name and value **/
MacromoleculeForm.prototype._populateField = function(fieldName, value) {
	if (value != null){
		Ext.getCmp(this.id + fieldName).setValue(value);
	}
};

/** Gets the value of a textfield **/
MacromoleculeForm.prototype._getField = function(fieldName) {
	return Ext.getCmp(this.id + fieldName).getValue();
};


/** It populates the form **/
MacromoleculeForm.prototype.refresh = function(macromolecule) {
	this.macromolecule = macromolecule;
	if (macromolecule != null){
		this._populateField("name", macromolecule.name);
		this._populateField("acronym", macromolecule.acronym);
		this._populateField("extintionCoefficient", macromolecule.extintionCoefficient);
		this._populateField("molecularMass", macromolecule.molecularMass);
		this._populateField("comments", macromolecule.comments);
		this._populateField("refractiveIndex", macromolecule.refractiveIndex);
		this._populateField("solventViscosity", macromolecule.solventViscosity);
		if (macromolecule.symmetry != null){
			Ext.getCmp(this.id + 'comboSym').setValue(macromolecule.symmetry);
		}
	}
};


MacromoleculeForm.prototype.input = function() {
	return {};
};


/** It populates the form **/
MacromoleculeForm.prototype.test = function(targetId) {
	var macromoleculeForm = new MacromoleculeForm();
	macromoleculeForm.onClose.attach(function(sender){
		alert("Click on close");
	});
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};





function ModelVisualizerForm(args){
	this.id =BUI.id();
	this.width = 600;
	this.height = 400;
	if (args!= null){
		if (args.width != null){
			this.width = args.width;
		}
		if (args.height != null){
			this.height = args.height;
		}
	}
};

ModelVisualizerForm.prototype._getFirHTML = function(modelId, width, height, type, desc) {
	var html = "<table>";
	html = html + '<tr style="text-align: center;"><td><a style="color:blue;font-weight:bold;" target="_blank" href="' + BUI.getModelFile("FIT", modelId, "txt") + '" >dammin.' + type + '</a></td></tr>';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td>' + desc + '</td></tr>';
	html = html + '<tr><td><div background-color="red" id="' + (this.id + type + modelId) + '" width="' + width + '" height="' + height + '"></div></td></tr>';
	html = html + '</table>';
	return html;
};

ModelVisualizerForm.prototype.getItems = function(modelPanel){
	_this = this;
	var height = _this.height/2 - 60;
	var width = _this.width/2 - 10;
	
	return  Ext.create('Ext.container.Container', {
	    layout: {
	        type: 'vbox',       // Arrange child items vertically
	    },
	    items: [
	            	modelPanel,
	            	{
	            		 xtype : 'container',
	            		 layout: {
	            		        type: 'hbox',       // Arrange child items vertically
	            		    },
			            	items : [{
			            		html :  this._getFirHTML("id", width, height, "fir", "Fit of the simulated scattering curve versus a smoothed experimental data (spline interpolation)"),
			            		height :height,
			            		width : width,
			            		padding: 2
			            	},
			            	{
			            		html :  this._getFirHTML("id", width, height, "fit", "Fit of the simulated scattering curve versus the experimental data."),
			            		height : height,
			            		width :  width,
			            		padding: 2
			            	}]
	            	}
	            	
	    ]
	});
};

ModelVisualizerForm.prototype.refresh = function(models){
	var input = [];
//	var colors = ["008000", "F0A804",  "0000FF", "800080", "C0C0C0"];
	for (var i = 0; i < models.length; i++) {
		console.log(BUI.rainbow(models.length, i).replace("#", "0x"));
		input.push({
			color: BUI.rainbow(models.length, i).replace("#", "0x"),
			modelId: models[i].modelId,
			opacity: 0.8,
			radius: 3,
			title: BUI.getFileNameByPath(models[i].pdbFile),
			type: "SHAPEDETERMINATIONMODEL"
			
		});
	}
	
	this.panel.removeAll();
	this.panel.add(
			_this.getItems(
								new PDBViewer({
									width : this.width - 10,
									height : (this.height/2) - 10,
									title : ""
								}).draw(input)
			)
	);
	
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		var splitted = data.toString().split("\n");
		var array = [];
		for ( var i = 0; i < splitted.length; i++) {
			var line = splitted[i].trim();
			var line_splited = line.split(/\s*[\s,]\s*/);
			if (line_splited.length == 4) {
				array.push([ Number(line_splited[0]), BUI.getStvArray(line_splited[1], line_splited[2]), BUI.getStvArray(line_splited[3], 0) ]);
			}
		}
		
		var id = (_this.id + "firid");
		var dygraphWidget = new StdDevDyGraph(id, {
			width : (_this.width/2) - 10,
			height :(_this.height/2) -110,
			xlabel : 'q(nm<sup>-1</sup>)'
		});
		dygraphWidget.draw(array, [ "#FF0000", "#0000FF", "#FF00FF" ], [ 's', 'I(exp)', 'I(sim)' ]);
	});
	
	adapter.getModelFile("FIR", models[0].modelId);
	
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		var splitted = data.toString().split("\n");
		var array = [];
		for ( var i = 0; i < splitted.length; i++) {
			var line = splitted[i].trim();
			var line_splited = line.split(/\s*[\s,]\s*/);
			if (line_splited.length == 3) {
				array.push([ Number(line_splited[0]), BUI.getStvArray(line_splited[1], 0), BUI.getStvArray(line_splited[2], 0) ]);
			}
		}
		
		var id = (_this.id + "fitid");
		
		var dygraphWidget = new StdDevDyGraph(id, {
			width : (_this.width/2) - 10,
			height : (_this.height/2) - 110,
			xlabel : 'q(nm<sup>-1</sup>)'
		});
		dygraphWidget.draw(array, [ "#FF0000", "#0000FF" ], [ "s", "I(exp)", "I(sim)" ]);
	});
	adapter.getModelFile("FIT", models[0].modelId);
};

ModelVisualizerForm.prototype.getPanel = function(modelList){
	_this = this;
	this.modelList = modelList;
	this.panel =  Ext.create('Ext.Panel', {
	    title: 'Results',
	    width: this.width,
	    height: this.height,
	    layout: {
	        type: 'vbox',       // Arrange child items vertically
//	        align: 'stretch'    // Each takes up full width
	    },
	    items: [
		          
	    ],
		listeners : {
			afterrender : function(grid, eOpts) {
//				alert(_this.modelList)
			}
		}
	});
	
	return this.panel;

};


/**
 * Example form
 * 
 * @witdh
 * @height
 */
function MolarityForm(args) {
	this.id = BUI.id();
	this.width = 700;
	this.height = 500;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}
	
	this.onSave = new Event(this);
	this.onClose = new Event(this);
}


MolarityForm.prototype._getNumericWithHelp = function(type, fieldLabel, fieldName, help) {
	return Ext.create('Ext.container.Container', {
		margin : "10 0 0 10",
		items : [ {
			xtype : type,
			fieldLabel : fieldLabel,
			name : fieldName,
			id : this.id + fieldName,
			decimalPrecision : 6
		}, {
			xtype : 'label',
			forId : 'myFieldId',
			text : help,
			margin : "5 0 0 105",
			cls : "inline-help"
		} ]
	});
};


MolarityForm.prototype._getItems = function() {
	this.macromoleculeCombo = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.getMacromuleculesCandidates(this.macromolecule), {
		width : 250,
		labelWidth : 100,
		margin : 10
	});
	
	return [ {
		xtype : 'container',
		flex : 1,
		margin : '10 0 0 10',
		border : 0,
		layout : 'anchor',
		defaultType : 'requiredtext',
		items : [ this.macromoleculeCombo,
		this._getNumericWithHelp("textfield", "Ratio", "ratio", "Number in assymmetric units")
		]
	} ];
};

MolarityForm.prototype._persist = function() {
	var _this = this;
	var macromoleculeId = this.macromoleculeCombo.getValue();
	var ratio = Ext.getCmp(this.id + "ratio").getValue();
	var comments = "Not used yet";
	var dataAdapter = new BiosaxsDataAdapter();
	this.panel.setLoading("Saving");
	dataAdapter.onSuccess.attach(function(sender, args) {
		_this.onSave.notify();
	});
	dataAdapter.saveStoichiometry(this.macromolecule.macromoleculeId, macromoleculeId, ratio, comments);
};

MolarityForm.prototype._getButtons = function() {
	var _this = this;
	
	function onClose() {
		_this.onClose.notify();
	}
	
	return [ {
		text : 'Save',
		handler : function() {
			_this._persist();
		}
	}, {
		text : 'Cancel',
		handler : function() {
			onClose();
		}
	} ];
};

MolarityForm.prototype.getPanel = function() {
	this.panel = Ext.create('Ext.form.Panel', {
//		width : null,
		height : this.height,
		margin : 2,
		border : 1,
		defaultType : 'requiredtext',
		items : this._getItems(),
		buttons : this._getButtons()
	});
	return this.panel;
};

/** macromolecules contains all macromolecules except this one **/
MolarityForm.prototype.getMacromuleculesCandidates = function(macromolecule) {
	var macromolecules = [];
	if ( BIOSAXS.proposal.macromolecules){
		for (var i = 0; i < BIOSAXS.proposal.macromolecules.length; i++) {
			var m = BIOSAXS.proposal.macromolecules[i];
			if (this.macromolecule != null){
				if (m.macromoleculeId != this.macromolecule.macromoleculeId) {
					macromolecules.push(m);
				}
			}
		}
	}
	return macromolecules;
};


/** It populates the form **/
MolarityForm.prototype.refresh = function(macromolecule) {
	this.macromolecule = macromolecule;
	
};


MolarityForm.prototype.input = function() {
	return {};
};


/** It populates the form **/
MolarityForm.prototype.test = function(targetId) {
	var macromoleculeForm = new MolarityForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};

///**
// * 
// * @witdh
// * @height
// */
//function MacromoleculeForm(args) {
//	this.id = BUI.id();
//	this.width = 700;
//	this.height = 500;
//
//	if (args != null) {
//		if (args.width != null) {
//			this.width = args.width;
//		}
//		if (args.height != null) {
//			this.height = args.height;
//		}
//	}
//
//	this.onClose = new Event(this);
//}
//
//MacromoleculeForm.prototype.getMacromolecule = function() {
//	this.macromolecule.name = Ext.getCmp(this.panel.getItemId()).getValues().name;
//	this.macromolecule.acronym = Ext.getCmp(this.panel.getItemId()).getValues().acronym;
//	this.macromolecule.comments = Ext.getCmp(this.panel.getItemId()).getValues().comments;
//	this.macromolecule.extintionCoefficient = Ext.getCmp(this.panel.getItemId()).getValues().extintionCoefficient;
//	this.macromolecule.molecularMass = Ext.getCmp(this.panel.getItemId()).getValues().molecularMass;
//	return this.macromolecule;
//};
//
//MacromoleculeForm.prototype.setMacromolecule = function(macromolecule) {
//	this.pdbStore.loadData(macromolecule.structure3VOs);
//
//};
//
//MacromoleculeForm.prototype.getForm = function(macromolecule) {
//	this.panel = Ext.createWidget('form', {
//		frame : false,
//		border : 0,
//		padding : 15,
//		width : 550,
//		height : 350,
//		items : [ {
//			xtype : 'container',
//			layout : 'hbox',
//			items : [ {
//				xtype : 'container',
//				flex : 1,
//				border : false,
//				layout : 'anchor',
//				defaultType : 'requiredtext',
//				items : [ {
//					fieldLabel : 'Name',
//					name : 'name',
//					anchor : '95%',
//					tooltip : "Name of the macromolecule",
//					value : macromolecule.name
//				}, {
//					fieldLabel : 'Acronym',
//					name : 'acronym',
//					anchor : '95%',
//					value : macromolecule.acronym
//				} ]
//			}, {
//				xtype : 'container',
//				flex : 1,
//				layout : 'anchor',
//				defaultType : 'textfield',
//				items : [ {
//					xtype : 'numberfield',
//					fieldLabel : 'Mol. Mass (Da)',
//					name : 'molecularMass',
//					value : macromolecule.molecularMass,
//					decimalPrecision : 6
//				}, {
//					xtype : 'numberfield',
//					fieldLabel : 'Extinction coef.',
//					name : 'extintionCoefficient',
//					value : macromolecule.extintionCoefficient,
//					decimalPrecision : 6
//				} ]
//			} ]
//		}, {
//			xtype : 'textareafield',
//			name : 'comments',
//			fieldLabel : 'Comments',
//			value : macromolecule.comments,
//			width : this.width - 10
//		},
//
//		{
//			html : BUI.getWarningHTML("The macromolecule is unsaved. Save the macromolecule to get access to other tabs"),
//			margin : "150 10 10 10",
//			id : this.id + "unsavedWarning",
//			hidden : !(!macromolecule.macromoleculeId)
//		}
//
//		]
//	});
//	return this.panel;
//};
//
//MacromoleculeForm.prototype.save = function() {
//	var _this = this;
//
//	var adapter = new BiosaxsDataAdapter();
//	adapter.onSuccess.attach(function(sender, proposal) {
//		BIOSAXS.proposal.setItems(proposal);
//		_this.panel.setLoading(false);
//
//		Ext.getCmp(_this.id + "assembly").enable()
//		Ext.getCmp(_this.id + "advanced").enable();
//		Ext.getCmp(_this.id + "unsavedWarning").hide();
//	});
//
//	if (this.getMacromolecule().name == "") {
//		BUI.showError("Name field is mandatory");
//		return;
//	}
//	if (this.getMacromolecule().acronym == "") {
//		BUI.showError("Acroynm field is mandatory");
//		return;
//	}
//
//	/** Check if acronym is unique * */
//	if (this.getMacromolecule().macromoleculeId == null) {
//		if (BIOSAXS.proposal.getMacromoleculeByAcronym(this.getMacromolecule().acronym) == null) {
//			this.panel.setLoading("ISPyB: Saving Macromolecule")
//			adapter.saveMacromolecule(this.getMacromolecule());
//		} else {
//			alert("There is already an existing macromolecule with the same acronym");
//
//		}
//	} else {
//		this.panel.setLoading("ISPyB: Saving Macromolecule")
//		adapter.saveMacromolecule(this.getMacromolecule());
//	}
//
//};
//
//MacromoleculeForm.prototype.getPanel = function(macromolecule) {
//	var _this = this;
//	this.macromolecule = macromolecule;
//	return Ext.createWidget('tabpanel', {
//		height : this.height,
//		margin : 5,
//		plain : true,
//		style : {
//			padding : 5
//		},
//		items : [ {
//			tabConfig : {
//				title : "General",
//				disabled : false
//			},
//			items : [ this.getForm(macromolecule) ],
//			bbar : [ "->", {
//				text : 'Save',
//				cls : 'btn-with-border',
//				style : {
//
//					border : 1
//				},
//				handler : function() {
//					_this.save();
//				}
//			}, {
//				text : 'Close',
//				cls : 'btn-with-border',
//				handler : function() {
//					_this.onClose.notify();
//				}
//			} ]
//		}, {
//			tabConfig : {
//				id : this.id + "assembly",
//				title : "Assembly",
//				tooltip : 'Description of subunits present in the macromolecule',
//				// hidden : (!macromolecule.macromoleculeId),
//				disabled : (!macromolecule.macromoleculeId)
//			},
//			items : [ this.getMolarityGrid(macromolecule) ]
//		}, {
//			tabConfig : {
//				id : this.id + "advanced",
//				title : "Advanced Modeling",
//				// hidden : (!macromolecule.macromoleculeId),
//				tooltip : 'Definition of the description contacts and symetries',
//				disabled : (!macromolecule.macromoleculeId)
//			},
//			items : [ this.getRigidBodyForm(macromolecule) ]
//		} ]
//	});
//};
//
//MacromoleculeForm.prototype.getRigidBodyForm = function(macromolecule) {
//	var _this = this;
//
//	// [P1, P2, P3, P4 ,P5 ,P6 ,32, P42, P52, P62] + P222
//	var symmetry = Ext.create('Ext.data.Store', {
//		fields : [ 's' ],
//		data : [ {
//			"s" : "P1"
//		}, {
//			"s" : "P2"
//		}, {
//			"s" : "P3"
//		}, {
//			"s" : "P4"
//		}, {
//			"s" : "P5"
//		}, {
//			"s" : "P6"
//		}, {
//			"s" : "P32"
//		}, {
//			"s" : "P42"
//		}, {
//			"s" : "P52"
//		}, {
//			"s" : "P62"
//		}, {
//			"s" : "P222"
//		} ]
//	});
//
//	if (macromolecule.symmetry == null) {
//		macromolecule.symmetry = "P1";
//	}
//	var comboBox = Ext.create('Ext.form.ComboBox', {
//		fieldLabel : 'Symmetry',
//		store : symmetry,
//		id : 'comboSym',
//		queryMode : 'local',
//		displayField : 's',
//		valueField : 's',
//		value : macromolecule.symmetry,
//		margin : "10 0 0 0",
//		listeners : {
//			change : function(combo, newValue, oldValue, eOpts) {
//				macromolecule.symmetry = newValue;
//			}
//		}
//	});
//
//	this.rigidBodyPanel = Ext.createWidget('form', {
//		frame : false,
//		border : 0,
//		padding : 10,
//		width : 550,
//		height : 400,
//		items : [ {
//			xtype : 'container',
//			layout : 'hbox',
//			items : [ {
//				xtype : 'container',
//				border : false,
//				layout : 'hbox',
//				items : [ {
//					xtype : 'label',
//					forId : 'myFieldId',
//					text : 'Contact Desc:',
//					width : 105,
//					margin : '0 0 0 0'
//				}, {
//					xtype : 'textfield',
//					hideLabel : true,
//					id : "contactsDescriptionFilePath",
//					margin : '0 0 0 0',
//					width : 300,
//					value : macromolecule.contactsDescriptionFilePath
//				}, {
//					text : 'Upload',
//					xtype : 'button',
//					margin : "0 0 0 20",
//					width : 100,
//					handler : function() {
//						_this._openUploadDialog(macromolecule.macromoleculeId, "CONTACTS", "Upload Contact Description File");
//					}
//				} ]
//			} ]
//		},
//
//		comboBox, {
//			xtype : 'checkbox',
//			margin : '10 0 0 5',
//			boxLabel : "<span style='font-weight:bold;'>I want rigid body modeling run on this stuff</span>",
//			checked : true,
//			width : 300
//		}, _this.getPDBGrid(macromolecule) ]
//	});
//	return this.rigidBodyPanel;
//};
//
//MacromoleculeForm.prototype.update = function() {
//	var _this = this;
//	BIOSAXS.proposal.onInitialized.attach(function() {
//		if (BIOSAXS.proposal != null) {
//			var macromolecules = BIOSAXS.proposal.macromolecules;
//			for (var i = 0; i < macromolecules.length; i++) {
//				if (macromolecules[i].macromoleculeId == _this.macromolecule.macromoleculeId) {
//					_this.macromolecule = macromolecules[i];
//					_this.setMacromolecule(_this.macromolecule);
//					_this.molarityStore.loadData(_this.parseMolarityData(_this.macromolecule));
//					_this.pdbGrid.setLoading(false);
//					Ext.getCmp("contactsDescriptionFilePath").setValue(_this.macromolecule.contactsDescriptionFilePath)
//					_this.molarityGrid.setLoading(false);
//
//				}
//			}
//		}
//	});
//	this.molarityGrid.setLoading("Updating");
//	this.pdbGrid.setLoading("Updating");
//	BIOSAXS.proposal.init();
//};
//
///*******************************************************************************
// * MOLARITY GRID
// ******************************************************************************/
//
//MacromoleculeForm.prototype.parseMolarityData = function(macromolecule) {
//	var data = [];
//	if (macromolecule.stoichiometry != null) {
//		for (var i = 0; i < macromolecule.stoichiometry.length; i++) {
//			data.push({
//				ratio : macromolecule.stoichiometry[i].ratio,
//				acronym : macromolecule.stoichiometry[i].macromolecule3VO.acronym,
//				comments : macromolecule.stoichiometry[i].macromolecule3VO.comments,
//				stoichiometryId : macromolecule.stoichiometry[i].stoichiometryId,
//				name : macromolecule.stoichiometry[i].macromolecule3VO.name
//			});
//		}
//	}
//	return data;
//};
//
//MacromoleculeForm.prototype.getMolarityGrid = function(macromolecule) {
//	var _this = this;
//
//	this.molarityStore = Ext.create('Ext.data.Store', {
//		fields : [ 'acronym', 'ratio', 'comments', 'stoichiometryId', 'name' ],
//		data : this.parseMolarityData(macromolecule),
//		sorters : {
//			property : 'ratio',
//			direction : 'DESC'
//		}
//	});
//
//	this.molarityGrid = Ext.create('Ext.grid.Panel', {
//		store : this.molarityStore,
//		height : 350,
//		padding : 5,
//		columns : [
//
//		{
//			text : 'Subunit',
//			columns : [ {
//				text : "Acronym",
//				width : 100,
//				hidden : false,
//				dataIndex : 'acronym',
//				sortable : true
//			}, {
//				text : "Name",
//				width : 100,
//				hidden : false,
//				dataIndex : 'name',
//				sortable : true
//			}, {
//				text : "Comments",
//				width : 100,
//				dataIndex : 'comments',
//				sortable : true
//			} ]
//		}, {
//			text : "Number <br/><span style='font-size:10px'>in assymmetric units</span>",
//			width : 150,
//			dataIndex : 'ratio',
//			tooltip : 'Number of times this subunit is present in the macromolecule',
//			sortable : true
//		}, {
//			id : this.id + 'MOLARITY_REMOVE',
//			flex : 0.1,
//			sortable : false,
//			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
//				return BUI.getRedButton('REMOVE');
//			}
//		} ],
//		listeners : {
//			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
//				if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'MOLARITY_REMOVE') {
//					var dataAdapter = new BiosaxsDataAdapter();
//					dataAdapter.onSuccess.attach(function() {
//						_this.molarityGrid.setLoading(false);
//						_this.update();
//					});
//					dataAdapter.removeStoichiometry(record.data.stoichiometryId);
//					_this.molarityGrid.setLoading("Removing Structure");
//				}
//			}
//		},
//		buttons : [ {
//			text : 'Add molarity',
//			handler : function() {
//
//				function onClose() {
//					w.destroy();
//					_this.update();
//				}
//				var w = Ext.create('Ext.window.Window', {
//					title : 'Molarity',
//					height : 300,
//					width : 500,
//					modal : true,
//					buttons : [ {
//						text : 'Save',
//						handler : function() {
//							var macromoleculeId = (_this.macromoleculeCombo.getValue());
//							var ratio = Ext.getCmp(_this.id + "ratio").getValue();
//							var comments = "";
//							var dataAdapter = new BiosaxsDataAdapter();
//							dataAdapter.onSuccess.attach(function(sender, args) {
//								_this.update();
//								w.destroy();
//							});
//							dataAdapter.saveStoichiometry(_this.macromolecule.macromoleculeId, macromoleculeId, ratio, comments);
//						}
//					}, {
//						text : 'Cancel',
//						handler : function() {
//							onClose();
//						}
//					} ],
//					items : [ _this.getMolarityForm(macromolecule) ],
//					listeners : {
//						onEsc : function() {
//							onClose();
//						},
//						close : function() {
//							onClose();
//						}
//					}
//				}).show();
//			}
//		} ]
//	});
//	return this.molarityGrid;
//};
//
///*******************************************************************************
// * PDB GRID
// ******************************************************************************/
//
//MacromoleculeForm.prototype._openUploadDialog = function(macromoleculeId, type, title) {
//	var _this = this;
//	function onClose() {
//		w.destroy();
//		_this.update();
//	}
//
//	var w = Ext.create('Ext.window.Window', {
//		title : title,
//		height : 200,
//		width : 400,
//		modal : true,
//		buttons : [ {
//			text : 'Close',
//			handler : function() {
//				onClose();
//			}
//		} ],
//		layout : 'fit',
//		items : {
//			html : "<iframe style='width:500px' src='uploadPdbFileSAXS.do?reqCode=display&macromoleculeId=" + macromoleculeId + "&type=" + type + "'></iframe>"
//		},
//		listeners : {
//			onEsc : function() {
//				onClose();
//			},
//			close : function() {
//				onClose();
//			}
//		}
//	}).show();
//};
//
//MacromoleculeForm.prototype._getPlugins = function() {
//	var _this = this;
//	var plugins = [];
//	// if (this.updateRowEnabled) {
//	plugins.push(Ext.create('Ext.grid.plugin.RowEditing', {
//		clicksToEdit : 1,
//		listeners : {
//			validateedit : function(grid, e) {
//				/** Comments are always updatable* */
//				e.record.raw.symmetry = e.newValues.symmetry;
//				e.record.raw.multiplicity = e.newValues.multiplicity;
//
//				var adapter = new BiosaxsDataAdapter();
//				adapter.onSuccess.attach(function(sender, measurement) {
//					// _this.grid.setLoading(false);
//				});
//				adapter.onError.attach(function() {
//					alert("Error");
//					// _this.grid.setLoading(false);
//				});
//
//				// _this.grid.setLoading();
//				adapter.saveStructure(e.record.raw);
//			}
//		}
//	}));
//	// }
//	return plugins;
//};
//
//MacromoleculeForm.prototype.getPDBGrid = function(macromolecule) {
//	var _this = this;
//
//	var data = macromolecule.structure3VOs;
//
//	// /** Getting PDB from subunits **/
//	// if (macromolecule != null){
//	// if (macromolecule.stoichiometry != null){
//	// for (var i =0; i < macromolecule.stoichiometry.length; i++){
//	// var stoichiometry = macromolecule.stoichiometry[i];
//	// if (stoichiometry.macromolecule3VO != null){
//	// if (stoichiometry.macromolecule3VO.structure3VOs != null){
//	// for (var j = 0; j < stoichiometry.macromolecule3VO.structure3VOs.length;
//	// j++) {
//	// var structure = stoichiometry.macromolecule3VO.structure3VOs[j];
//	// structure["isSubunit"] = stoichiometry.macromolecule3VO.acronym;
//	// data.push(structure)
//	// }
//	// }
//	// }
//	// }
//	// }
//	// }
//
//	this.pdbStore = Ext.create('Ext.data.Store', {
//		fields : [ 'filePath', 'structureId', 'structureType', 'symmetry', 'structureId', 'name', 'multiplicity' ],
//		data : macromolecule.structure3VOs,
//		groupField : 'structureType',
//		sorters : {
//			property : 'structureId',
//			direction : 'DESC'
//		}
//	});
//
//	var groupingFeature = Ext.create('Ext.grid.feature.Grouping', {
//		groupHeaderTpl : Ext.create('Ext.XTemplate',
//				"<div style='background:#0ca3d2; color:white; float:left; font-size:10px; margin:6px 8px 0 0; padding:5px 8px;'>{name:this.formatName}</div>", {
//					formatName : function(name) {
//						return name;
//					}
//				}),
//		hideGroupedHeader : true,
//		startCollapsed : false
//	});
//
//	this.pdbGrid = Ext.create('Ext.grid.Panel', {
//		margin : "15 0 0 5",
//		height : 250,
//		store : this.pdbStore,
//		plugins : _this._getPlugins(),
//		buttons : [ {
//			// text : 'Add PDB file',
//			text : 'Add Modeling Option',
//			handler : function() {
//				_this._openUploadDialog(macromolecule.macromoleculeId, "PDB", 'Upload PDB File');
//			}
//		}
//
//		],
//		columns : [
//				{
//					text : "structureId",
//					flex : 0.2,
//					hidden : true,
//					dataIndex : 'structureId',
//					sortable : true
//				},
//				{
//					text : "File",
//					flex : 0.5,
//					dataIndex : 'filePath',
//					sortable : true,
//					hidden : true
//				},
//				{
//					text : "PDB",
//					flex : 0.4,
//					dataIndex : 'name',
//					sortable : true
//				},
//				{
//					text : "Symmetry",
//					flex : 0.4,
//					dataIndex : 'symmetry',
//					sortable : true,
//					editor : {
//						xtype : 'combobox',
//						typeAhead : true,
//						triggerAction : 'all',
//						selectOnTab : true,
//						store : [ [ "P1", "P1" ], [ "P2", "P2" ], [ "P3", "P3" ], [ "P4", "P4" ], [ "P5", "P5" ], [ "P6", "P6" ], [ "P32", "P32" ], [ "P42", "P42" ],
//								[ "P52", "P52" ], [ "P62", "P62" ], [ "P222", "P222" ] ],
//					}
//				}, {
//					text : "Multiplicity",
//					flex : 0.4,
//					dataIndex : 'multiplicity',
//					sortable : true,
//					editor : {
//						xtype : 'textfield'
//					}
//
//				}, {
//					text : "Subunit",
//					flex : 0.2,
//					dataIndex : 'isSubunit',
//					sortable : true,
//					hidden : true
//				}, {
//					text : "Type",
//					flex : 0.2,
//					dataIndex : 'structureType',
//					sortable : true,
//					hidden : true
//				},
//
//				{
//					id : this.id + 'REMOVE',
//					flex : 0.2,
//					hidden : true,
//					sortable : false,
//					renderer : function(value, metaData, record, rowIndex, colIndex, store) {
//						return BUI.getRedButton('REMOVE');
//					}
//				}, ],
//
//		listeners : {
//			itemdblclick : function(dataview, record, item, e) {
//				_this._editExperiment(record.raw.experimentId);
//			},
//			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
//
//				if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'REMOVE') {
//					var dataAdapter = new BiosaxsDataAdapter();
//					dataAdapter.onSuccess.attach(function() {
//						_this.pdbGrid.setLoading(false);
//						_this.update();
//					});
//					dataAdapter.removeStructure(record.data.structureId);
//					_this.pdbGrid.setLoading("Removing PDB file");
//				}
//
//			}
//		},
//		viewConfig : {
//			getRowClass : function(record, rowIdx, params, store) {
//				if (record.raw.isSubunit != null) {
//					return "blue-row";
//				}
//			}
//		}
//	});
//
//	return this.pdbGrid;
//};
//
//MacromoleculeForm.prototype.getMolarityForm = function(macromolecule) {
//	var _this = this;
//	var data = [];
//	for (var i = 0; i < BIOSAXS.proposal.macromolecules.length; i++) {
//		var m = BIOSAXS.proposal.macromolecules[i];
//		if (m.macromoleculeId != macromolecule.macromoleculeId) {
//			data.push(m);
//		}
//
//	}
//	this.macromoleculeCombo = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(data, {
//		width : 250,
//		labelWidth : 100,
//		margin : 10
//	});
//
//	return Ext.createWidget('form', {
//
//		frame : false,
//		border : 0,
//		// padding : 15,
//		width : 550,
//		height : 350,
//		items : [ {
//			xtype : 'container',
//			flex : 1,
//			border : false,
//			layout : 'anchor',
//			defaultType : 'requiredtext',
//			items : [ this.macromoleculeCombo, {
//				xtype : 'numberfield',
//				name : 'Ratio',
//				id : _this.id + "ratio",
//				fieldLabel : 'Number in assymmetric units',
//				value : 1,
//				decimalPrecision : 6,
//				margin : 10
//			}, {
//				xtype : 'textareafield',
//				name : 'comments',
//				fieldLabel : 'Comments',
//				margin : 10,
//				width : 400,
//				value : ""
//
//			} ]
//		} ]
//	});
//
//};
//
///*******************************************************************************
// * JAVASCRIPT DOC
// ******************************************************************************/
//MacromoleculeForm.prototype.input = function() {
//	return {
//		macromolecule : DATADOC.getMacromolecule_10()
//	};
//};
//
//MacromoleculeForm.prototype.test = function(targetId) {
//	var macromoleculeForm = new MacromoleculeForm();
//	var panel = macromoleculeForm.getPanel(macromoleculeForm.input().macromolecule);
//	panel.render(targetId);
//};

function ResultSummaryForm() {
	this.radiationDamageThreshold = BUI.getRadiationDamageThreshold();
	this.qualityThreshold = BUI.getQualityThreshold();

	/** Data clusters with bufers **/
	this.clusterByBuffers = false;

	/** Visualization are groupeb by concenttrations. Ex: 4.5mg/ml and 4.7mg/ml will be clusterized together **/
	this.collapseConcentrations = true;

	this.summaryHeight = 350;
	this.id = BUI.id();

	var _this = this;

	this.qualityControlResultsWidget = new QualityControlResultsWidget({
		qualityThreshold : this.radiationDamageThreshold,
		radiationDamageThreshold : this.qualityThreshold

	});
	this.qualityControlResultsWidget.onQualityChanged.attach(function(sender, value) {
		_this.qualityThreshold = value;
		_this.thresholdsChanged();
	});

	this.qualityControlResultsWidget.onRadiationDatamageChanged.attach(function(sender, value) {
		_this.radiationDamageThreshold = value;
		_this.thresholdsChanged();

	});
	this.concentrationHTMLTableWidget = new ConcentrationHTMLTableWidget({
		height : 250,
		showBufferColumns : this.clusterByBuffers
	});

	this.plot = new BoxWhiskerGraph({
		targetId : _this.id + '_boxPlot',
		height : 350,
		width : 450,
		maxBoxWidth : 25
	});

	this.rangePlot = new RangeWhiskerGraph({
		targetId : _this.id + '_rangePlot',
		height : 350,
		width : 450,
		maxBoxWidth : 25
	});
}

ResultSummaryForm.prototype.thresholdsChanged = function() {
	var parsedData = this.prepareData(this.rawData);

	var filtered = JSON.parse(JSON.stringify(parsedData));
	filtered.concentration.concentrations = [];
	for ( var conc in parsedData.concentration.concentrations) {
		if (parsedData.concentration.concentrations[conc].calculation.rgGnom.validNumber > 0) {
			filtered.concentration.concentrations.push(parsedData.concentration.concentrations[conc]);
		}
	}

	this.plotWhisker(filtered);
	this.plotRange(filtered);

	this.concentrationHTMLTableWidget.refresh(parsedData);
};

/** Given a frame object (object returned by analyzeFrames()) and depending of the threshold indicates if a datacollection has radiation damage **/
ResultSummaryForm.prototype.hasRadiationDamage = function(frameObject) {
	var bb = frameObject.bufferBeforeFramesMerged / frameObject.framesCount;
	var ba = frameObject.bufferAfterFramesMerged / frameObject.framesCount;
	var mol = frameObject.framesMerge / frameObject.framesCount;
	return !((bb >= this.radiationDamageThreshold) && (ba >= this.radiationDamageThreshold) && (mol >= this.radiationDamageThreshold));
};

/** Return (frameObject) an object with the information about the frames for a data collection**/
ResultSummaryForm.prototype.analyzeFrames = function(dataCollectionRow) {
	return {
		bufferAfterFramesMerged : dataCollectionRow.bufferAfterFramesMerged,
		bufferBeforeFramesMerged : dataCollectionRow.bufferBeforeFramesMerged,
		framesCount : dataCollectionRow.framesCount,
		framesMerge : dataCollectionRow.framesMerge
	};
};

ResultSummaryForm.prototype.detectDataCollectionWarnings = function(dataCollectionRow) {
	var frameObject = this.analyzeFrames(dataCollectionRow);
	var warnings = {
		count : 0,
		type : []
	};

	if (this.hasRadiationDamage(frameObject)) {
		warnings.count = warnings.count + 1;
		warnings.type.push("RADIATION DAMAGE");
	}

	if (Number(dataCollectionRow.quality) < this.qualityThreshold) {
		warnings.count = 1;//warnings.count + 1;
		warnings.type.push("Quality <" + this.qualityThreshold);
	}
	return warnings;
};

/** Return array composed by {concentration} objects **/
ResultSummaryForm.prototype.getConcentrations = function(data) {
	var concentrationsId = {};

	for ( var i = 0; i < data.length; i++) {
		var warning = this.detectDataCollectionWarnings(data[i]);
		var id = data[i].conc;// + "_" +  data[i].bufferId;
		if (this.clusterByBuffers) {
			id = data[i].conc + "_" + data[i].bufferId;
		}

		if (concentrationsId[id] == null) {
			concentrationsId[id] = {
				id : id,
				concentration : Number(data[i].conc).toFixed(2),
				bufferId : data[i].bufferId,
				bufferAcronym : data[i].bufferAcronym,
				rgGuinier : [],
				i0Guinier : [],
				rgGnom : [],
				dMax : [],
				quality : [],
				frames : [],
				frames_warning : warning.count
			};
		} else {
			concentrationsId[id].frames_warning = concentrationsId[id].frames_warning + warning.count;
		}

		concentrationsId[id].frames.push(data[i]);

		if (warning.count == 0) {
			concentrationsId[id].rgGuinier.push(data[i].rgGuinier);
			concentrationsId[id].i0Guinier.push(data[i].I0);
			concentrationsId[id].quality.push(data[i].quality);
			concentrationsId[id].rgGnom.push(data[i].rgGnom);
			concentrationsId[id].dMax.push(data[i].dmax);
		}

	}
	var concentrations = [];
	for ( var item in concentrationsId) {
		if (concentrationsId.hasOwnProperty(item)) {
			concentrations.push({
				concentration : concentrationsId[item].concentration,
				id : item,
				bufferId : Number(concentrationsId[item].bufferId).toFixed(2),
				bufferAcronym : concentrationsId[item].bufferAcronym,
				rgGuinier : concentrationsId[item].rgGuinier,
				/** Frames **/
				frames : concentrationsId[item].frames,
				frames_warning : concentrationsId[item].frames_warning,
				/** Calculation **/
				calculation : {
					rgGuinier : BUI.getStandardDeviation(concentrationsId[item].rgGuinier),
					i0Guinier : BUI.getStandardDeviation(concentrationsId[item].i0Guinier),
					quality : BUI.getStandardDeviation(concentrationsId[item].quality),
					rgGnom : BUI.getStandardDeviation(concentrationsId[item].rgGnom),
					dMax : BUI.getStandardDeviation(concentrationsId[item].dMax)

				}
			});
		}
	}

	return {
		concentrations : concentrations
	};
};

ResultSummaryForm.prototype.prepareData = function(data) {
	/** Return array composed by {acronym, bufferId} objects **/
	function getBuffers(data) {
		var buffersId = {};
		for ( var i = 0; i < data.length; i++) {
			buffersId[data[i].bufferId] = data[i].acronym;
		}
		var buffers = [];
		for ( var id in buffersId) {
			if (buffersId.hasOwnProperty(id)) {
				buffers.push({
					acronym : buffersId[id],
					bufferId : id
				});
			}
		}
		return buffers;
	}

	/** Get a string with all the concentrations **/
	function getConcentrationString(parseConcentrations) {
		var concentrations = [];
		for ( var i = 0; i < parseConcentrations.concentrations.length; i++) {
			concentrations.push(parseConcentrations.concentrations[i].concentration + " mg/ml ");
		}
		return concentrations.toString();
	}

	var parseConcentrations = this.getConcentrations(data);

	return {
		dataCollectionCount : data.length,
		buffers : getBuffers(data),
		concentration : parseConcentrations,
		concentrationLabel : getConcentrationString(parseConcentrations)
	};
};

ResultSummaryForm.prototype.getDataForWhisker = function(data) {
	var clusters = [];

	var concentrations = {};
	var i = 0;
	var conc = 0;
	if (this.collapseConcentrations) {
		for (i = 0; i < data.concentration.concentrations.length; i++) {
			conc = data.concentration.concentrations[i];
			var concentration = Number(conc.concentration).toFixed(0);
			if (concentrations[concentration] == null) {
				concentrations[concentration] = {};
				concentrations[concentration].concentration = concentration;
				concentrations[concentration].calculation = {};
				concentrations[concentration].calculation.rgGuinier = {};
				concentrations[concentration].calculation.rgGuinier.values = [];
				concentrations[concentration].calculation.rgGuinier.values = conc.calculation.rgGuinier.values;
				concentrations[concentration].calculation.rgGnom = {};
				concentrations[concentration].calculation.rgGnom.values = [];
				concentrations[concentration].calculation.rgGnom.values = conc.calculation.rgGnom.values;
			} else {
				concentrations[concentration].calculation.rgGuinier.values = concentrations[concentration].calculation.rgGuinier.values
						.concat(conc.calculation.rgGuinier.values);
				concentrations[concentration].calculation.rgGnom.values = concentrations[concentration].calculation.rgGnom.values
						.concat(conc.calculation.rgGnom.values);
			}
		}

		/** From object to array **/
		var array = [];
		for ( var key in concentrations) {
			if (concentrations.hasOwnProperty(key)) {
				array.push(concentrations[key]);
			}
		}
		data.concentration.concentrations = array;
	}

	for (i = 0; i < data.concentration.concentrations.length; i++) {
		conc = data.concentration.concentrations[i];
		clusters.push({
			name : conc.concentration + "mg/ml",
			concentration : Number(conc.concentration),
			x : Number(conc.concentration),
			classes : []
		});
		clusters[clusters.length - 1].classes.push({
			name : "Guinier",
			color : '#9A2EFE',
			values : conc.calculation.rgGuinier.values

		});
		clusters[clusters.length - 1].classes.push({
			name : "P(r)",
			color : '#2E64FE',
			values : conc.calculation.rgGnom.values

		});
	}
	return {
		clusters : clusters.sort(function(a, b) {
			return a.concentration - b.concentration;
		})
	};
};

ResultSummaryForm.prototype.getDataForWhiskerQuality = function(data) {
	var clusters = [];

	for ( var i = 0; i < data.concentration.concentrations.length; i++) {
		var conc = data.concentration.concentrations[i];
		clusters.push({
			name : conc.concentration + "mg/ml",
			classes : []
		});
		clusters[clusters.length - 1].classes.push({
			name : "Quality",
			values : conc.calculation.quality.values

		});
	}

	return {
		clusters : clusters
	};
};

ResultSummaryForm.prototype.plotQualityWhisker = function(parsedData) {
	this.qualityPlot.refresh(this.getDataForWhiskerQuality(parsedData));
};

ResultSummaryForm.prototype.plotWhisker = function(parsedData) {
	this.plot.refresh(this.getDataForWhisker(parsedData));
};

ResultSummaryForm.prototype.plotRange = function(parsedData) {
	this.rangePlot.refresh(this.getDataForWhisker(parsedData));
};

ResultSummaryForm.prototype.getPanel = function(data) {
	var _this = this;
	_this.rawData = data;
	var parsedData = this.prepareData(data);

	this.panel = Ext
			.createWidget(
					'form',
					{
						bodyPadding : 20,
						frame : false,
						border : 0,
						width : this.width,
						height : this.summaryHeight + 1000,
						items : [ {
							xtype : 'container',
							layout : 'hbox',
							items : [ {
								xtype : 'container',
								flex : 1,
								border : false,
								layout : 'anchor',
								defaultType : 'textfield',
								items : [
									_this.qualityControlResultsWidget.getPanel(),
									{
										xtype : 'fieldset',
										width : 950,
										margin : "20, 0 0 0",
										height : this.summaryHeight + 500,
										items : [
											{
												html : "<div align='center' style='background-color:#336699;color:white;border:1px solid black; font-weight:bold'>Concentration Analysis</div>",
												border : 0,
												width : 900

											},
											{
												html : this.concentrationHTMLTableWidget.getPanel(parsedData),
												border : 0,
												width : 900,
												margin : "10, 0 0 10"

											},
											{
												xtype : 'container',
												layout : 'vbox',
												border : 5,
												items : [
													{
														html : "<div align='center' style='background-color:#336699;color:white;border:1px solid black; font-weight:bold'> Rg based on Guinier and Gnom</div>",
														border : 8,
														width : 900,
														margin : "20 0 0 10"

													}, {
														xtype : 'container',
														layout : 'hbox',
														items : [ {
															xtype : 'container',
															layout : 'vbox',
															items : [ {
																html : "<div id='" + _this.id + "_boxPlot'></div>",
																border : 0,
																width : this.plot.width,
																padding : "10 0 0 20",
																listeners : {
																	afterrender : function() {
																		_this.plotWhisker(parsedData);

																	}
																}
															}, {
																html : "<div align='center' style='color:black;'> Concentration (mg/ml)</div>",
																width : 450,
																border : 0,
																margin : "-50 0 0 0"

															} ]
														}, {
															xtype : 'container',
															layout : 'vbox',
															items : [ {
																html : "<div id='" + _this.id + "_rangePlot'></div>",
																border : 0,
																width : this.rangePlot.width,
																padding : "10 0 0 10",
																listeners : {
																	afterrender : function() {
																		_this.plotRange(parsedData);
																	}
																}
															}, {
																html : "<div align='center' style='color:black;'> Concentration (mg/ml)</div>",
																width : 450,
																border : 0,
																margin : "-50 0 0 0"

															} ]
														} ]
													} ]
											} ]
									} ]
							}

							]
						} ]
					});
	return this.panel;

};

ResultSummaryForm.prototype.input = function() {
	return {
		data : DATADOC.getData_3367()
	};
};

ResultSummaryForm.prototype.test = function(targetId) {
	var resultSummaryForm = new ResultSummaryForm();
	var panel = resultSummaryForm.getPanel(resultSummaryForm.input().data);
	panel.render(targetId);

};

/**
 * Example form
 * 
 * @witdh
 * @height
 */
function RigibBodyModelingForm(args) {
	this.id = BUI.id();
	this.width = 700;
	this.height = 500;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;
	this.rigidBodyGrid = new AprioriRigidBodyGrid();
	
	this.rigidBodyGrid.onUploadFile.attach(function(sender, type, title){
		_this._openUploadDialog(_this.macromolecule.macromoleculeId,  type, title);
	});
	
	this.rigidBodyGrid.onRemove.attach(function(sender, type, title){
		_this._update();
	});
	
	this.onSave = new Event(this);
	
}

RigibBodyModelingForm.prototype._getItems = function() {
	var _this = this;
	

	return [ {
		xtype : 'label',
		forId : 'myFieldId',
		text : 'Information for model fit, mixture analysis and rigid body modeling',
		margin : '15 0 20 10',
		cls : "inline-help"
	},
	this.rigidBodyGrid.getPanel(), 
	{
		xtype : 'label',
		forId : 'myFieldId',
		text : 'Distance restraints may be imposed on the model using contacts conditions file (OPTIONAL)',
		margin : '25 0 5 10',
		cls : "inline-help"
	},
	{
		xtype : 'container',
		layout : 'hbox',
		items : [ {
			xtype : 'container',
			border : false,
			layout : 'hbox',
			items : [ {
				xtype : 'label',
				forId : 'myFieldId',
				text : 'Contact Description File: (Optional)',
				width : 150,
				margin : '10 0 0 10'
			}, {
				id : this.id + "contactsDescriptionFilePath",
				xtype : 'textfield',
				hideLabel : true,
				margin : '10 0 0 0',
				width : 200,
				disabled: true
			}, {
				text : 'Upload',
				xtype : 'button',
				margin : "10 0 0 10",
				width : 80,
				handler : function() {
					
					_this._openUploadDialog(_this.macromolecule.macromoleculeId, "CONTACTS", "Upload Contact Description File");
				}
			}, {
				text : 'Remove',
				id : _this.id + "_remove",
				xtype : 'button',
				margin : "10 0 0 10",
				width : 80,
				handler : function() {
					_this.macromolecule.contactsDescriptionFilePath = null;
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, proposal) {
						/** Updating the proposal global object **/
						BIOSAXS.proposal.setItems(proposal);
						_this.panel.setLoading(false);
						
						var saved = BIOSAXS.proposal.getMacromoleculeByAcronym(_this.macromolecule.acronym);
						/** Refreshing to check that everything is ok **/
						_this.refresh(saved);
						_this.onSave.notify(saved);
					});
					
					_this.panel.setLoading("Saving Macromolecule")
					adapter.saveMacromolecule(_this.macromolecule);
				}
			} ]
		} ]
	}, {
		xtype : 'panel',
		html : "<span class='inline-help' >Go to <a target='_blank' href='http://www.embl-hamburg.de/biosaxs/manuals/sasrefcvmx.html#input-format'>SASREF manual</a> for further information</span>",
		margin : "10 0 0 160",
		border : 0
		
	},
	{
		xtype : 'checkbox',
		margin : '10 0 0 5',
		boxLabel : "<span style='font-weight:bold;'>I want rigid body modeling run on this stuff</span>",
		checked : true,
		width : 300
	} ]

};

/** Because update is a jsp page we don't know if the user has uploaded a file or not  then we need to refresh **/
RigibBodyModelingForm.prototype._update = function(macromoleculeId, type, title) {
	var _this = this;
	BIOSAXS.proposal.onInitialized.attach(function() {
		if (BIOSAXS.proposal != null) {
			_this.refresh(BIOSAXS.proposal.getMacromoleculeById(_this.macromolecule.macromoleculeId));
			_this.panel.setLoading(false);
		}
	});
	this.panel.setLoading();
	BIOSAXS.proposal.init();
};

RigibBodyModelingForm.prototype._openUploadDialog = function(macromoleculeId, type, title) {
	var _this = this;
	function onClose() {
		w.destroy();
		_this._update();
		
	}

	var w = Ext.create('Ext.window.Window', {
		title : title,
		height : 200,
		width : 400,
		modal : true,
		buttons : [ {
			text : 'Close',
			handler : function() {
				onClose();
			}
		} ],
		layout : 'fit',
		items : {
			html : "<iframe style='width:500px' src='uploadPdbFileSAXS.do?reqCode=display&macromoleculeId=" + macromoleculeId + "&type=" + type + "'></iframe>"
		},
		listeners : {
			onEsc : function() {
				onClose();
			},
			close : function() {
				onClose();
			}
		}
	}).show();
};

RigibBodyModelingForm.prototype._getButtons = function() {
	return [];
};

RigibBodyModelingForm.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.height,
		margin : 10,
		border : 1,
		defaultType : 'textfield',
		items : this._getItems(),
		buttons : this._getButtons(),
		listeners : {
			afterrender : function(){
				_this._populate();
				
			}
		}
	});
	return this.panel;
};

/** Populates could be call when the DOM is not filled yet **/ 
RigibBodyModelingForm.prototype._populate = function() {
	if (this.macromolecule != null){
		if (Ext.getCmp(this.id + "contactsDescriptionFilePath") != null){
			if (this.macromolecule.contactsDescriptionFilePath != null){
				Ext.getCmp(this.id + "contactsDescriptionFilePath").setValue(this.macromolecule.contactsDescriptionFilePath);
				Ext.getCmp(this.id + "_remove").enable();
			}
			else{
				Ext.getCmp(this.id + "_remove").disable();
				Ext.getCmp(this.id + "contactsDescriptionFilePath").setValue("");
				
			}
		}
	}
};

/** It populates the form * */
RigibBodyModelingForm.prototype.refresh = function(macromolecule) {
	this.macromolecule = macromolecule;
	this.rigidBodyGrid.refresh(macromolecule);
	this._populate();
};

RigibBodyModelingForm.prototype.input = function() {
	return {};
};


/** It populates the form **/
RigibBodyModelingForm.prototype.test = function(targetId) {
	var macromoleculeForm = new RigibBodyModelingForm();
	var panel = macromoleculeForm.getPanel();
	panel.render(targetId);
};


/**
 * Same form as MX part
 * 
 * @creationMode if true a create button appears instead of save
 * @showTitle true or false
 */
function ShipmentForm(args) {
	this.id = BUI.id();

	this.creationMode = false;
	this.showTitle = true;
	if (args != null) {
		if (args.creationMode != null) {
			this.creationMode = args.creationMode;
		}
		if (args.showTitle != null) {
			this.showTitle = args.showTitle;
		}
	}

	this.onSaved = new Event(this);
}

ShipmentForm.prototype.fillStores = function() {
	this.panel.setLoading("Loading Labcontacts from database");
	this.labContactForSendingStore.loadData(BIOSAXS.proposal.getLabcontacts(), false);
	this.labContactForReturnStore.loadData(BIOSAXS.proposal.getLabcontacts(), false);
	this.panel.setLoading(false);
	if (this.shipment != null) {
		this.setShipment(this.shipment);
	}
};

ShipmentForm.prototype.draw = function(targetId) {
	this.getPanel().render(targetId);
};

ShipmentForm.prototype.setShipment = function(shipment) {
	this.shipment = shipment;
	var _this = this;
	Ext.getCmp(_this.id + "shippingName").setValue(shipment.json.shippingName);
	Ext.getCmp(_this.id + "shippingStatus").setValue(shipment.json.shippingStatus);
	Ext.getCmp(_this.id + "comments").setValue(shipment.json.comments);
	if (shipment.json.sendingLabContactVO != null) {
		this.labContactsSendingCombo.setValue(shipment.json.sendingLabContactVO.labContactId);
	}
	if (shipment.json.returnLabContactVO != null) {
		this.labContactsReturnCombo.setValue(shipment.json.returnLabContactVO.labContactId);
	}

};

ShipmentForm.prototype._saveShipment = function() {
	var _this = this;
	var shippingId = null;
	if (this.shipment != null) {
		shippingId = this.shipment.json.shippingId;
	}
	var json = {
		shippingId : shippingId,
		name : Ext.getCmp(_this.id + "shippingName").getValue(),
		status : Ext.getCmp(_this.id + "shippingStatus").getValue(),
		sendingLabContactId : Ext.getCmp(_this.id + "shipmentform_sendingLabContactId").getValue(),
		returnLabContactId : Ext.getCmp(_this.id + "returnLabContactId").getValue(),
		returnCourier : Ext.getCmp(_this.id + "returnCourier").getValue(),
		courierAccount : Ext.getCmp(_this.id + "courierAccount").getValue(),
		BillingReference : Ext.getCmp(_this.id + "BillingReference").getValue(),
		dewarAvgCustomsValue : Ext.getCmp(_this.id + "dewarAvgCustomsValue").getValue(),
		dewarAvgTransportValue : Ext.getCmp(_this.id + "dewarAvgTransportValue").getValue(),
		comments : Ext.getCmp(_this.id + "comments").getValue()
	};

	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, shipment) {
		window.location = BUI.getShippingURL(shipment.shippingId);
	});

	dataAdapter.onError.attach(function(sender, error) {
		_this.onError.notify(error);
	});

	/** Cheking params **/
	if (json.name == "") {
		BUI.showError("Name field is mandatory");
		return;
	}

	if (json.sendingLabContactId == null) {
		BUI.showError("Lab contact for sending field is mandatory");
		return;
	}

	if (json.returnLabContactId == null) {
		BUI.showError("Lab contact for return field is mandatory");
		return;
	}

	dataAdapter.createShipment(json.shippingId, json.name, json.status, json.comments, json.sendingLabContactId, json.returnLabContactId,
			json.returnCourier, json.courierAccount, json.BillingReference, json.dewarAvgCustomsValue, json.dewarAvgTransportValue);

};

ShipmentForm.prototype.getPanel = function(shipment) {
	var _this = this;
	this.shipment = shipment;
	var required = '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>';
	var buttons = [];

	if (_this.creationMode) {
		buttons.push({
			text : 'Create',
			scope : this,
			handler : function() {
				_this._saveShipment();
			}
		});
	} else {
		buttons.push({
			text : 'Save',
			scope : this,
			handler : function() {
				_this._saveShipment();
			}
		});

	}

	this.labContactForSendingStore = Ext.create('Ext.data.Store', {
		fields : [ 'cardName', 'labContactId' ]
	});

	this.labContactForReturnStore = Ext.create('Ext.data.Store', {
		fields : [ 'cardName', 'labContactId' ]
	});

	// Create the combo box, attached to the states data store
	this.labContactsSendingCombo = Ext.create('Ext.form.ComboBox', {
		id : _this.id + "shipmentform_sendingLabContactId",
		fieldLabel : 'Lab contact for sending',
		afterLabelTextTpl : required,
		store : this.labContactForSendingStore,
		queryMode : 'local',
		labelWidth : 200,
		displayField : 'cardName',
		valueField : 'labContactId'
	});

	this.labContactsReturnCombo = Ext.create('Ext.form.ComboBox', {
		id : _this.id + "returnLabContactId",
		fieldLabel : 'If No, Lab-Contact for Return',
		afterLabelTextTpl : required,
		store : this.labContactForReturnStore,
		queryMode : 'local',
		labelWidth : 200,
		displayField : 'cardName',
		valueField : 'labContactId',
		listeners : {
			change : function(x, newValue) {
				for ( var i = 0; i < x.getStore().data.items.length; i++) {
					if (x.getStore().data.items[i].raw.labContactId == newValue) {
						Ext.getCmp(_this.id + "returnCourier").setValue(x.getStore().data.items[i].raw.defaultCourrierCompany);
						Ext.getCmp(_this.id + "courierAccount").setValue(x.getStore().data.items[i].raw.courierAccount);
						Ext.getCmp(_this.id + "BillingReference").setValue(x.getStore().data.items[i].raw.billingReference);
						Ext.getCmp(_this.id + "dewarAvgCustomsValue").setValue(x.getStore().data.items[i].raw.dewarAvgCustomsValue);
						Ext.getCmp(_this.id + "dewarAvgTransportValue").setValue(x.getStore().data.items[i].raw.dewarAvgTransportValue);
					}
				}
			}
		}
	});

	if (this.panel == null) {
		this.panel = Ext.create('Ext.form.Panel', {
			bodyPadding : 5,
			width : 600,
			border : 1,
			items : [ {
				xtype : 'fieldset',
				title : 'Details',
				collapsible : false,
				defaultType : 'textfield',
				layout : 'anchor',
				defaults : {
					anchor : '100%'
				},
				items : [ {
					xtype : 'requiredtext',
					fieldLabel : 'Shipment Label',
					allowBlank : false,
					name : 'shippingName',
					id : _this.id + 'shippingName',
					value : '',
					anchor : '50%'
				}, {

					xtype : 'textareafield',
					name : 'comments',
					id : _this.id + 'comments',
					fieldLabel : 'Comments',
					value : ''
				}, {
					fieldLabel : 'Status',
					readOnly : true,
					id : _this.id + 'shippingStatus',
					value : 'Opened',
					anchor : '50%'
				} ]
			}, {
				xtype : 'fieldset',
				title : 'Lab-Contacts',
				collapsible : false,
				defaultType : 'textfield',
				layout : 'anchor',
				defaults : {
					anchor : '100%'
				},
				items : [ this.labContactsSendingCombo, this.labContactsReturnCombo ]
			}, {
				border : 0,
				html : BUI.getWarningHTML("These informations are relevant for all shipments")
			}, {
				xtype : 'fieldset',
				title : 'Courier accounts details for return',
				collapsible : false,
				layout : 'anchor',
				defaults : {
					anchor : '100%'
				},
				items : [ {
					xtype : 'textfield',
					labelWidth : 400,
					fieldLabel : 'Courier company for return (if ESRF sends a dewar back)',
					id : _this.id + 'returnCourier',
					value : ''
				}, {
					xtype : 'textfield',
					labelWidth : 400,
					fieldLabel : 'Courier account',
					id : _this.id + 'courierAccount',
					value : ''
				}, {
					xtype : 'textfield',
					labelWidth : 400,
					fieldLabel : 'Billing reference',
					id : _this.id + 'BillingReference',
					value : ''
				}, {
					xtype : 'numberfield',
					labelWidth : 400,
					fieldLabel : 'Average Customs value of a dewar (Euro)',
					id : _this.id + 'dewarAvgCustomsValue',
					value : ''
				}, {
					xtype : 'numberfield',
					labelWidth : 400,
					fieldLabel : 'Average Transport value of a dewar (Euro)',
					id : _this.id + 'dewarAvgTransportValue',
					value : ''
				} ]
			} ],
			buttons : buttons
		});
	}
	this.fillStores();
	if (this.showTitle) {
		this.panel.setTitle('Create a new Shipment');
	}
	return this.panel;
};

ShipmentForm.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10()

	};
};

ShipmentForm.prototype.test = function(targetId) {
	var shipmentForm = new ShipmentForm({
		creationMode : true

	});
	BIOSAXS.proposal = new Proposal(shipmentForm.input().proposal);
	shipmentForm.getPanel().render(targetId);
};

/**
 * #onSaved
 */
function StockSolutionForm(args) {
	this.id = BUI.id();
	this.actions = [];

	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}
	this.onSaved = new Event(this);
}

StockSolutionForm.prototype.getStockSolution = function() {
	if (this.stockSolution != null) {
		this.stockSolution.concentration = Ext.getCmp(this.id + "stockSolution_concentration").getValue();
		this.stockSolution.storageTemperature = Ext.getCmp(this.id + "stockSolution_storageTemperature").getValue();
		this.stockSolution.volume = Ext.getCmp(this.id + "stockSolution_volume").getValue();
		this.stockSolution.comments = Ext.getCmp(this.id + "stockSolution_comments").getValue();
		this.stockSolution.name = Ext.getCmp(this.id + "stockSolution_name").getValue();
		this.stockSolution.bufferId = this.bufferCombo.getValue();

		if (this.macromoleculeCombo.getValue() != null) {
			this.stockSolution.macromoleculeId = this.macromoleculeCombo.getValue();
		} else {
			this.stockSolution.macromolecule3VO = null;
		}

	} else {
		return {
			concentration : Ext.getCmp(this.id + "stockSolution_concentration").getValue(),
			storageTemperature : Ext.getCmp(this.id + "stockSolution_storageTemperature").getValue(),
			volume : Ext.getCmp(this.id + "stockSolution_volume").getValue(),
			comments : Ext.getCmp(this.id + "stockSolution_comments").getValue(),
			name : Ext.getCmp(this.id + "stockSolution_name").getValue(),
			bufferId : this.bufferCombo.getValue(),
			macromoleculeId : this.macromoleculeCombo.getValue()
		};
	}
	return this.stockSolution;
};

StockSolutionForm.prototype.setStockSolution = function(stockSolution) {
	if (stockSolution != null) {
		if (stockSolution.macromoleculeId != null) {
			this.macromoleculeCombo.setValue(stockSolution.macromoleculeId);
		}
		this.bufferCombo.setValue(stockSolution.bufferId);
		Ext.getCmp(this.id + "stockSolution_concentration").setValue(this.stockSolution.concentration);
		Ext.getCmp(this.id + "stockSolution_storageTemperature").setValue(this.stockSolution.storageTemperature);
		Ext.getCmp(this.id + "stockSolution_volume").setValue(this.stockSolution.volume);
		Ext.getCmp(this.id + "stockSolution_name").setValue(this.stockSolution.name);
		Ext.getCmp(this.id + "stockSolution_comments").setValue(this.stockSolution.comments);
	}
};

StockSolutionForm.prototype.getBufferCombo = function() {
	this.bufferCombo = BIOSAXS_COMBOMANAGER.getComboBuffers(BIOSAXS.proposal.getBuffers(), {
		labelWidth : 120,
		margin : '0 0 10 0',
		width : 220

	});
	return this.bufferCombo;
};

StockSolutionForm.prototype.getMacromoleculeCombo = function() {
	this.macromoleculeCombo = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(BIOSAXS.proposal.getMacromolecules(), {
		labelWidth : 120,
		margin : '0 0 10 0',
		width : 220

	});
	return this.macromoleculeCombo;
};

StockSolutionForm.prototype.refresh = function() {
};

StockSolutionForm.prototype._getTopPanel = function() {
	return {
		xtype : 'container',
		layout : 'hbox',
		border : 0,
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			items : [ {
				xtype : 'container',
				flex : 1,
				border : false,
				layout : 'anchor',
				defaultType : 'textfield',
				items : [

				this.getMacromoleculeCombo(), {
					xtype : 'requiredtext',
					id : this.id + 'stockSolution_name',
					fieldLabel : 'Acronym',
					labelWidth : 120,
					width : 250
				}, {
					xtype : 'requiredtext',
					id : this.id + 'stockSolution_concentration',
					fieldLabel : 'Conc. (mg/ml)',
					labelWidth : 120,
					width : 250
				},

				{
					id : this.id + 'stockSolution_storageTemperature',
					fieldLabel : 'Storage Temp.(C)',
					labelWidth : 120,
					width : 250
				}, {
					xtype : 'requiredtext',
					id : this.id + 'stockSolution_volume',
					fieldLabel : 'Volume in Well (&#181l)',
					labelWidth : 120,
					width : 250
				} ]
			} ]
		}, {
			xtype : 'container',
			flex : 1,
			layout : 'anchor',
			defaultType : 'textfield',
			margin : '0 0 0 10',
			items : [ this.getBufferCombo() ]
		} ]
	};

};

StockSolutionForm.prototype.getPanel = function(stockSolution) {
	this.stockSolution = stockSolution;
	this.panel = Ext.createWidget({
		xtype : 'container',
		layout : 'vbox',
		border : 0,
		style : {
			padding : '10px'
		},
		fieldDefaults : {
			labelAlign : 'left',
			labelWidth : 50
		},
		items : [ this._getTopPanel(stockSolution), {
			id : this.id + 'stockSolution_comments',
			xtype : 'textareafield',
			name : 'comments',
			fieldLabel : 'Comments',
			labelWidth : 120,
			width : '100%'
		} ]
	});

	this.setStockSolution(stockSolution);
	return this.panel;
};

StockSolutionForm.prototype.input = function() {
	return {
		stock : {
			"stockSolutionId" : 6,
			"proposalId" : 3124,
			"macromoleculeId" : 5933,
			"bufferId" : 811,
			"instructionSet3VO" : null,
			"boxId" : 305861,
			"storageTemperature" : "20",
			"volume" : "300",
			"concentration" : "1.2",
			"comments" : "Buffer EDTA with A",
			"name" : "A_EDTA_1.2",
			"samples" : [],
			"buffer" : "EDTA",
			"macromolecule" : "A"
		},
		proposal : new MeasurementGrid().input().proposal
	};
};

StockSolutionForm.prototype.test = function(targetId) {
	var stockSolutionForm = new StockSolutionForm();
	BIOSAXS.proposal = new Proposal(stockSolutionForm.input().proposal);
	var panel = stockSolutionForm.getPanel(new Shipment(stockSolutionForm.input().stock));
	panel.render(targetId);
};


BoxWhiskerGraph.prototype.cleanArray = GenericGraph.prototype.cleanArray;
BoxWhiskerGraph.prototype.plotAxes = GenericGraph.prototype.plotAxes;
BoxWhiskerGraph.prototype.plotRuler = GenericGraph.prototype.plotRuler;
BoxWhiskerGraph.prototype.drawSVGVerticalText = GenericGraph.prototype.drawSVGVerticalText;
BoxWhiskerGraph.prototype.getClassColor = GenericGraph.prototype.getClassColor;
BoxWhiskerGraph.prototype.getDimensions = GenericGraph.prototype.getDimensions;
BoxWhiskerGraph.prototype.calculate = GenericGraph.prototype.calculate;
BoxWhiskerGraph.prototype.getMedian = GenericGraph.prototype.getMedian;
BoxWhiskerGraph.prototype.pointToPixel = GenericGraph.prototype.pointToPixel;
BoxWhiskerGraph.prototype.maxValueWhisker = GenericGraph.prototype.maxValueWhisker;
BoxWhiskerGraph.prototype.refresh = GenericGraph.prototype.refresh;

/**
 * Subclass of GenericGraph
 * 
 * @maxBoxWidth
 */
function BoxWhiskerGraph(args){
	this.maxBoxWidth = 25;
	
	if (args == null){
		args = new Object();
	}
	args["plotHorizontalByCluster"] = true;
	
	GenericGraph.call(this, args);
	
	if (args.maxBoxWidth != null){
		this.maxBoxWidth = args.maxBoxWidth;
	}
};



/**
There are several different methods for calculating quartiles.[1] This calculator uses a method described by Moore and McCabe to find quartile values. 
The same method also used by The TI-83 to calculate quartile values. 
With this method, the first quartile is the median of the numbers below the median, the third quartile is the median of the numbers above the median.

http://www.miniwebtool.com/quartile-calculator/
http://www.alcula.com/calculators/statistics/box-plot/
**/
BoxWhiskerGraph.prototype.getQ1 = function(array){
		array = array.slice(0, array.length/2);
		return this.getMedian(array);	
};

BoxWhiskerGraph.prototype.getQ3 = function(array){
		array = array.slice((array.length + 1)/2);
		return this.getMedian(array);
			
};

BoxWhiskerGraph.prototype.getQ2 = function(array){
	return  this.getMedian(array);
};

BoxWhiskerGraph.prototype.getBelowOutliers = function(belowLimit, array){
	var points = new Array();
	for (var i = 0; i < array.length; i++){
		if (array[i] <= belowLimit){
			points.push(array[i]);
		}
	}
	return points;
};

BoxWhiskerGraph.prototype.getAboveOutliers = function(aboveLimit, array){
	var points = new Array();
	for (var i = 0; i < array.length; i++){
		if (array[i] >= aboveLimit){
			points.push(array[i]);
		}
	}
	return points;
};


BoxWhiskerGraph.prototype.minValueWhisker = function(belowLimit, q1, array){
	var points = new Array();
	
	for (var i = 0; i < array.length; i++){
		if ((array[i] < q1) && (array[i]) > belowLimit){
			points.push(array[i]);
		}
	}
	
	if (points.length > 0){
		points.sort(function(a, b){return a - b;});
		return points[0];
	}
	return null;
};

BoxWhiskerGraph.prototype.isNumber = function(value){
	if (value=="") return false;

	var d = parseInt(value);
	if (!isNaN(d)) return true; else return false;		

};

BoxWhiskerGraph.prototype.plotBoxWhisker = function(boxProperties){
		if (this.maxBoxWidth != null){
			if (boxProperties.width > this.maxBoxWidth){
				boxProperties.x = boxProperties.x + (boxProperties.width/2) - (this.maxBoxWidth/2);
				boxProperties.width = this.maxBoxWidth;
			}
			
		}

		if (this.plotPoints){
			for(var i = 0; i < boxProperties.values.length; i++){
				var value = boxProperties.values[i];
				var toPixel = this.pointToPixel(value, boxProperties);
				SVG.drawCircle(boxProperties.x +  (boxProperties.width/2) + 2, toPixel, this.pointRadius, this.svg, [["fill", "green"], ["fill-opacity", this.fillOpacityPoint],['stroke-opacity', this.strokeOpacityPoint], ["stroke", "black"]]);	
			}
		}
		

		var boxColor = this.getClassColor(boxProperties.name);
		var result = this.calculate(boxProperties.values);
		/** Q1 **/
		
		if (this.isNumber(result.Q1)){
			SVG.drawLine(boxProperties.x, this.pointToPixel(result.Q1, boxProperties), boxProperties.x + boxProperties.width, this.pointToPixel(result.Q1, boxProperties), this.svg, [["stroke", boxColor]]);
		}
		/** Q2 **/
		if (this.isNumber(result.Q2)){
			SVG.drawLine(boxProperties.x, this.pointToPixel(result.Q2, boxProperties), boxProperties.x + boxProperties.width, this.pointToPixel(result.Q2, boxProperties), this.svg, [["stroke", "blue"], ["stroke-width", "2"]]);
		}
		
		/** Q3 **/
		if (this.isNumber(result.Q3)){
			SVG.drawLine(boxProperties.x, this.pointToPixel(result.Q3, boxProperties), boxProperties.x + boxProperties.width, this.pointToPixel(result.Q3, boxProperties), this.svg, [["stroke", boxColor]]);
		}
		
		/** Concenting Q1 and Q3 **/
		if (this.isNumber(result.Q1)&&this.isNumber(result.Q3)){
			SVG.drawLine(boxProperties.x, this.pointToPixel(result.Q1, boxProperties), boxProperties.x, this.pointToPixel(result.Q3, boxProperties), this.svg, [["stroke", boxColor]]);
			SVG.drawLine(boxProperties.x + boxProperties.width, this.pointToPixel(result.Q1, boxProperties), boxProperties.x + boxProperties.width, this.pointToPixel(result.Q3, boxProperties), this.svg, [["stroke", boxColor]]);
		}
		
		/** min-whisker **/
		if (result["min-whisker"] != null){
			if (this.isNumber(result.Q1)){
				SVG.drawLine(boxProperties.x + (boxProperties.width/2) + 2, this.pointToPixel(result.Q1, boxProperties), boxProperties.x + (boxProperties.width/2) + 2, this.pointToPixel(result["min-whisker"], boxProperties), this.svg, [["stroke", boxColor]]);
			}
			SVG.drawLine(boxProperties.x,this.pointToPixel(result["min-whisker"], boxProperties), boxProperties.x + boxProperties.width, this.pointToPixel(result["min-whisker"], boxProperties) , this.svg, [["stroke", boxColor]]);
			
		}
		
		/** max-whisker **/
		if (result["max-whisker"] != null){
			if (this.isNumber(result.Q3)){
				SVG.drawLine(boxProperties.x + (boxProperties.width/2) + 2, this.pointToPixel(result.Q3, boxProperties), boxProperties.x + (boxProperties.width/2) + 2, this.pointToPixel(result["max-whisker"], boxProperties), this.svg, [["stroke", boxColor]]);
			}
			SVG.drawLine(boxProperties.x  , this.pointToPixel(result["max-whisker"], boxProperties), boxProperties.x + boxProperties.width, this.pointToPixel(result["max-whisker"], boxProperties), this.svg, [["stroke", boxColor]]);
		
		}
		
		/** outliners **/
		if (result["above-outliers"] != null){
			for (var point in result["above-outliers"]){
				SVG.drawCircle(boxProperties.x +  (boxProperties.width/2) + 2, this.pointToPixel(result["above-outliers"][point], boxProperties), this.pointRadius, this.svg, [["fill", "red"], ["fill-opacity", "1"]]);
				//SVG.drawText(boxProperties.x +  (boxProperties.width/2) - 2, this.pointToPixel(result["above-outliers"][point], boxProperties) + 2, "x",this.svg, [["fill", "black"], ["font-size", "x-small"]]);
			}
		}
		if (result["below-outliers"] != null){
			for (var point in result["below-outliers"]){
					SVG.drawCircle(boxProperties.x +  (boxProperties.width/2) + 2, this.pointToPixel(result["below-outliers"][point], boxProperties), this.pointRadius, this.svg, [["fill", "red"], ["fill-opacity", "1"]]);	
					//SVG.drawText(boxProperties.x +  (boxProperties.width/2) - 2, this.pointToPixel(result["below-outliers"][point], boxProperties) + 2, "x",this.svg, [["fill", "black"], ["font-size", "x-small"]]);
			}
		}
};



BoxWhiskerGraph.prototype.plotClusterTitles = function(properties){
		/** Cluster Titles **/
		var posX = this.left + this.rulerWidth;
		var data = this.data;
		for(var i = 0; i < data.clusters.length; i++ ){
			/** title for the clusters **/
			posX = posX + this.interClustersSpace;
			
			/** Drawing title of classes **/
			var cluster = data.clusters[i];
			var posXClasses = posX;
			for(var j = 0; j < cluster.classes.length; j++){
				//SVG.drawRectangle(posXClasses, this.height - (this.bottom + this.clusterTitleHeight + this.rulerHeight), properties.classWidth, this.rulerHeight, this.svg, [["fill", "green"]]);
//				SVG.drawText(posXClasses + 1/6*properties.classWidth, this.height - (this.bottom + this.clusterTitleHeight + (this.rulerHeight*1/4)), cluster.classes[j].name, this.svg, [["style", "font-size:xx-small"]]);
				var color = cluster.classes[j].color;
				this.drawSVGVerticalText(posXClasses + 1/2*(properties.classWidth), this.height - (this.bottom - this.clusterTitleHeight + (this.rulerHeight)), cluster.classes[j].name , [["style", "font-size:x-small;"], ["fill",  color]]);
				
		//		SVG.drawRectangle(posXClasses, this.height - (this.bottom + this.clusterTitleHeight), properties.classWidth, 2, this.svg, [["fill", "black"]]);
				posXClasses = posXClasses + properties.classWidth + this.interClassesSpace;
			}
				
			var clusterTitleSpace = (data.clusters[i].classes.length * properties.classWidth) + ((data.clusters[i].classes.length - 1) * this.interClassesSpace);
			//SVG.drawRectangle(posX, this.height - (this.bottom + this.clusterTitleHeight), clusterTitleSpace, this.clusterTitleHeight, this.svg, [["fill", "pink"]]);
			SVG.drawRectangle(posX, this.height - (this.clusterTitleHeight+this.bottom), clusterTitleSpace, 1, this.svg, []);
			
//			var transform = ["translate", "(" + posX + 1/3*clusterTitleSpace +", " +  this.height - (this.bottom + (this.clusterTitleHeight*1/4)) +")"], ["transform", "rotate(180)"];
//			var transform = ["transform", "translate(" + (posX + 1/3*clusterTitleSpace) +", " + (this.height - (this.bottom + (this.clusterTitleHeight*1/4))) + "), rotate(-90) "];
//			this.drawSVGVerticalText(posX + 1/3*clusterTitleSpace, this.height - (this.bottom + (this.clusterTitleHeight*1/4)),data.clusters[i].name, [["style", "font-size:x-small"]]);
			SVG.drawText(posX , this.height - (this.bottom + (this.clusterTitleHeight*1/4)),data.clusters[i].name ,this.svg, [["style", "font-size:x-small"]]);
			posX = posX + clusterTitleSpace;
		}
};

BoxWhiskerGraph.prototype.plotWhisters = function(data, properties){
	var colors = ["yellow", "orange", "green"];
	var posX = this.left + this.rulerWidth;
	for(var i = 0; i < data.clusters.length; i++ ){
		var cluster = data.clusters[i];
		/** inter cluster space **/
		//SVG.drawRectangle(posX, this.top, this.interClustersSpace, this.height - this.top - this.bottom - this.clusterTitleHeight - this.rulerHeight, this.svg, [["fill", "black"]]);
		posX = posX + this.interClustersSpace;
		
		for (var j = 0; j < cluster.classes.length; j ++){
			
			//SVG.drawRectangle(posX, this.top, properties.classWidth, this.height - this.top - this.bottom - this.clusterTitleHeight - this.rulerHeight, this.svg, [["fill", colors[j]]]);
			this.plotBoxWhisker(
				{
					name	: cluster.classes[j].name,
					values	: cluster.classes[j].values,
					minPoint  : properties.minPoint,
					maxPoint  : properties.maxPoint,
					x		: posX,
					y		: this.top,
					width	: properties.classWidth,
					height	: this.height - this.top - this.bottom - this.clusterTitleHeight - this.rulerHeight
					
					
				}
			);
			posX = posX + properties.classWidth;
			//SVG.drawRectangle(posX, this.top, this.interClassesSpace, this.height - this.top - this.bottom - this.clusterTitleHeight - this.rulerHeight, this.svg, [["fill", "black"]]);
			if (j < cluster.classes.length - 1){
				posX = posX + this.interClassesSpace;
			}
		}
	}
};

BoxWhiskerGraph.prototype.draw = function(targetId, data){
	this.targetId = targetId;
	var properties = (this.getDimensions(data));
	this.svg = SVG.createSVGCanvas(document.getElementById(this.targetId), [["width", this.width], ["height", this.height]]);
	this.plotAxes(properties);
	this.plotClusterTitles(properties);
	this.plotWhisters(data,properties);
};

BoxWhiskerGraph.prototype.input = function(){
	return DATADOC.getBoxWhikerData();
};

BoxWhiskerGraph.prototype.test = function(targetId){
	var plot = new BoxWhiskerGraph(
			{
				targetId 	: targetId,
				height 		: 350,
				width  		: 450,
				maxBoxWidth	: 25
			}
	);
	plot.refresh(this.input());
};







function DataSet(){
	this.json = null;
	
};


DataSet.prototype.loadFromJSON = function(json){
	if(json != null) {
		if(this.validate(json)) {
			this.json = json;
		}
	}
};


DataSet.prototype.toJSON = function(json){
	return this.json;
};


/** Abstract method to be override on childs classes **/
DataSet.prototype.validate = function(json){
	if (true){
		return true;
	}
	/*else{
		throw "Data validation failed";
	}*/
};




Edge.prototype.getName = GraphItem.prototype.getName;
Edge.prototype.setName = GraphItem.prototype.setName;
Edge.prototype.getId = GraphItem.prototype.getId;

function Edge(id, name, nodeSource, nodeTarget, args){
	GraphItem.prototype.constructor.call(this, id, name, args);
	
	this.sourceNode = nodeSource;
	this.targetNode = nodeTarget;
	
};

Edge.prototype.toJSON = function(){
	return {"index": this.id,"sourceIndex":this.sourceNode.getId(),"targetIndex":this.targetNode.getId(),"args":this.args};
};

Edge.prototype.getNodeSource = function(){
	return this.sourceNode;
};

Edge.prototype.getNodeTarget = function(){
	return this.targetNode;
};

Edge.prototype.remove = function(){
	//Remove edge object in the nodes
	this.getNodeSource().removeEdge(this);
	this.getNodeTarget().removeEdge(this);
	
	this.deleted.notify(this);
};


EdgeGraphFormatter.prototype.setProperties = ItemGraphFormatter.prototype.setProperties;
EdgeGraphFormatter.prototype.getDefault = ItemGraphFormatter.prototype.getDefault;
EdgeGraphFormatter.prototype.getSelected = ItemGraphFormatter.prototype.getSelected;
EdgeGraphFormatter.prototype.getOver = ItemGraphFormatter.prototype.getOver;
EdgeGraphFormatter.prototype.getDragging = ItemGraphFormatter.prototype.getDragging; 
EdgeGraphFormatter.prototype.getId = ItemGraphFormatter.prototype.getId; 
EdgeGraphFormatter.prototype.toJSON = ItemGraphFormatter.prototype.toJSON; 
EdgeGraphFormatter.prototype.loadFromJSON = ItemGraphFormatter.prototype.loadFromJSON; 
EdgeGraphFormatter.prototype._setEvents = ItemGraphFormatter.prototype._setEvents; 

function EdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	ItemGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	
	this.getDefault().args.type = "EdgeGraphFormatter";
};




LineEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
LineEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
LineEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
LineEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
LineEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
LineEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
LineEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
LineEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
LineEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function LineEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "LineEdgeGraphFormatter";
};

/** DIRECTED **/
DirectedLineEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
DirectedLineEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
DirectedLineEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
DirectedLineEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
DirectedLineEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
DirectedLineEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
DirectedLineEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
DirectedLineEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
DirectedLineEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function DirectedLineEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "DirectedLineEdgeGraphFormatter";
	this.args.arrowSize = "3";
};
DirectedLineEdgeGraphFormatter.prototype.getArrowSize = function(){
	return this.args.arrowSize;
};

OdirectedLineEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
OdirectedLineEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
OdirectedLineEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
OdirectedLineEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
OdirectedLineEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
OdirectedLineEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
OdirectedLineEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
OdirectedLineEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
OdirectedLineEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function OdirectedLineEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "DirectedLineEdgeGraphFormatter";
	this.args.arrowSize = "3";
};

OdirectedLineEdgeGraphFormatter.prototype.getArrowSize = function(){
	return this.args.arrowSize;
};


/** CUT (inhibition) **/
CutDirectedLineEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
CutDirectedLineEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
CutDirectedLineEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
CutDirectedLineEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
CutDirectedLineEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
CutDirectedLineEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
CutDirectedLineEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
CutDirectedLineEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
CutDirectedLineEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function CutDirectedLineEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "CutDirectedLineEdgeGraphFormatter";
};




BezierEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
BezierEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
BezierEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
BezierEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
BezierEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
BezierEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
BezierEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
BezierEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
BezierEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
BezierEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function BezierEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "BezierEdgeGraphFormatter";
};



DotDirectedLineEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
DotDirectedLineEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
DotDirectedLineEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
DotDirectedLineEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
DotDirectedLineEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
DotDirectedLineEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
DotDirectedLineEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
DotDirectedLineEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
DotDirectedLineEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function DotDirectedLineEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "DotDirectedLineEdgeGraphFormatter";
};


OdotDirectedLineEdgeGraphFormatter.prototype.setProperties = EdgeGraphFormatter.prototype.setProperties;
OdotDirectedLineEdgeGraphFormatter.prototype.getDefault = EdgeGraphFormatter.prototype.getDefault;
OdotDirectedLineEdgeGraphFormatter.prototype.getSelected = EdgeGraphFormatter.prototype.getSelected;
OdotDirectedLineEdgeGraphFormatter.prototype.getOver = EdgeGraphFormatter.prototype.getOver;
OdotDirectedLineEdgeGraphFormatter.prototype.getDragging = EdgeGraphFormatter.prototype.getDragging; 
OdotDirectedLineEdgeGraphFormatter.prototype.getId = EdgeGraphFormatter.prototype.getId; 
OdotDirectedLineEdgeGraphFormatter.prototype.toJSON = EdgeGraphFormatter.prototype.toJSON; 
OdotDirectedLineEdgeGraphFormatter.prototype.loadFromJSON = EdgeGraphFormatter.prototype.loadFromJSON; 
OdotDirectedLineEdgeGraphFormatter.prototype._setEvents = EdgeGraphFormatter.prototype._setEvents; 

function OdotDirectedLineEdgeGraphFormatter(id, defaultFormat, selectedFormat, overFormat, dragginFormat){
	EdgeGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, dragginFormat);
	this.args.type = "OdotDirectedLineEdgeGraphFormatter";
};



function GraphDataset(){
	DataSet.prototype.constructor.call(this);
	this.edges = new Object();
	this.vertices = new Object();
	this.verticesIndex = new Object();
	
	//Events
	this.newVertex = new Event(this);
	this.vertexNameChanged = new Event(this);
	this.vertexDeleted = new Event(this);
	
	this.newEdge = new Event(this);
	this.edgeNameChanged = new Event(this);
	this.edgeDeleted = new Event(this);
	
	this.json = new Object();
	this.json.vertices = new Array();
	this.json.edges  = new Array();
	this.json.relations = new Array();
};

GraphDataset.prototype.loadFromJSON = DataSet.prototype.loadFromJSON;
GraphDataset.prototype.toJSON  = 	    DataSet.prototype.toJSON;
GraphDataset.prototype.validate  = 	DataSet.prototype.validate;

/** Devuelve el numero de edges incidentes sobre el nodo con mas edges **/
GraphDataset.prototype.getMaxClass = function(){
	var maxClassNode = 0;
	for ( var node in this.vertices) {
		if (this.vertices[node].getEdgesCount() > maxClassNode){
			maxClassNode = this.vertices[node].getEdgesCount();
		}
	}
	return maxClassNode;
};

/** Devuelve el numero de edges incidentes sobre el nodo con mas edges **/
GraphDataset.prototype.getMinClass = function(){
	var minClassNode = Math.min();
	for ( var node in this.vertices) {
		if (this.vertices[node].getEdgesCount() < minClassNode){
			minClassNode = this.vertices[node].getEdgesCount();
		}
	}
	return minClassNode;
};

GraphDataset.prototype.getVertexByName = function(nodeName){
		var results = new Array();
		
		for (var vertexId in this.verticesIndex[nodeName]){
			var vertexByid = this.getVertexById(this.verticesIndex[nodeName][vertexId]);
			results.push(vertexByid);
			//* aadido nuevo porque fallaba el anterior codigo
			return vertexByid
		}
	
		if (results <= 1){
			return this.getVertexById(this.verticesIndex[nodeName]);
		}
		else{
			return results;
		}
};

GraphDataset.prototype.getVertexById = function(id){
	return this.vertices[id];
};

GraphDataset.prototype.toSIF = function(){
	var sifDataAdapter = new SifFileDataAdapter();
	return sifDataAdapter.toSIF(this);
};

GraphDataset.prototype.toSIFID = function(){
	var sifDataAdapter = new SifFileDataAdapter();
	return sifDataAdapter.toSIFID(this);
};

GraphDataset.prototype.toDOT = function(){
	var dotFileDataAdapter = new DotFileDataAdapter();
	return dotFileDataAdapter.toDOT(this);
};

GraphDataset.prototype.toDOTID = function(){
	var dotFileDataAdapter = new DotFileDataAdapter();
	return dotFileDataAdapter.toDOTID(this);
};

GraphDataset.prototype._addNode = function(nodeName, args){
	return new Vertex(this._getVerticesCount()-1, nodeName, args);
};

GraphDataset.prototype.addNode = function(nodeName, args){
	this.json.vertices.push(nodeName);
	this._addVerticesIndex(nodeName, this._getVerticesCount() - 1);
	var vertex = this._addNode(nodeName, args);
	this.vertices[this._getVerticesCount()-1] = vertex;
	this._setNodeEvents(vertex);
	this.newVertex.notify(vertex);
};

GraphDataset.prototype._addVerticesIndex = function(nodeName, id){
	if (this.verticesIndex[nodeName] == null){
		this.verticesIndex[nodeName] = new Array();
	}
	this.verticesIndex[nodeName].push(id);
};

GraphDataset.prototype.addEdge = function(edgeName, nodeSourceId, nodeTargetId, args){
	this.json.edges.push(edgeName);
	var nodeSource = this.getVertexById(nodeSourceId);
	var nodeTarget = this.getVertexById(nodeTargetId);
	var index = this.getEdgesCount() - 1;
	this.edges[index] =  new Edge(index, edgeName, nodeSource, nodeTarget, args);
	this.json.relations.push({"index": index, "sourceIndex": nodeSourceId, "targetIndex": nodeTargetId, "args": args });
	
	nodeSource.addEdge(this.edges[index]);
	nodeTarget.addEdge(this.edges[index]);
	this._setEdgeEvents(this.edges[index]);
	this.newEdge.notify(this.edges[index]);
};

GraphDataset.prototype.getVertices = function(){
	return this.vertices;
};

GraphDataset.prototype.getEdges = function(){
	return this.edges;
};

GraphDataset.prototype.getEdgeById = function(edgeId){
	return this.edges[edgeId];
};

GraphDataset.prototype._getVerticesCount = function(){
	return this.json.vertices.length;
};


GraphDataset.prototype.getVerticesCount = function(){
	var count = 0;
	for ( var vertex in this.getVertices()) {
		count ++;
	}
	return count;
};


GraphDataset.prototype.getEdgesCount = function(){
	return this.json.edges.length;
};

GraphDataset.prototype.init = function(){
	this.edges = new Object();
	this.vertices = new Object();
};

GraphDataset.prototype._setNodeEvents = function(node){
	var _this = this;
	//NODE EVENTS
	node.deleted.attach(function (sender, node){
		_this._removeNode(node);
	});
	
	node.nameChanged.attach(function (sender, args){
		var item = args.item;
		var newName = item.name;
		var indexes = _this.verticesIndex[args.previousName];
		for(var i = 0; i < indexes.length; i++){
			if(indexes[i] == item.id)
				indexes.splice(i,1);
		}
		if(indexes.length == 0){
			delete _this.verticesIndex[args.previousName];
		}
		_this._addVerticesIndex(newName, item.id);
		_this.json.vertices[item.id] = newName;
		_this.vertexNameChanged.notify(args);
	});
};

GraphDataset.prototype._setEdgeEvents = function(edge){
	var _this = this;
	//EDGE EVENTS
	edge.nameChanged.attach(function (sender, edge){
		_this.edgeNameChanged.notify(edge);
		
	});
	
	edge.deleted.attach(function (sender, edge){
		_this._removeEdge(edge);
	});
};

GraphDataset.prototype._connectVerticesByName = function(nodeNameSource, nodeNameTarget){
	var source = this.getVertexByName(nodeNameSource);
	var target = this.getVertexByName(nodeNameTarget);
	
	if ((source != null)&&(target!=null)){
		this.addEdge(source.getName() +"_" + target.getName(), source.getId(), target.getId(), {});
	}
	else{
		if (source == null){
			console.log("No encontrado: " + nodeNameSource)
		}
		if (target == null){
			console.log("No encontrado: " + nodeNameTarget)
		}
	}
};

GraphDataset.prototype.loadFromJSON = function(json){
	var json = json;
	this.init();
	this.json = new Object();
	this.json.vertices = new Array();
	this.json.edges = new Array();
	this.json.relations = new Array();

	for ( var i = 0; i < json.nodes.length; i++) {
		if (json.nodes[i] != null){
			var name = json.nodes[i];
			this.addNode(name);
		}
		else{
			this.json.vertices.push(null);
		}
	}
	
	for ( var i = 0; i < json.edges.length; i++) {
		if (json.edges[i] != null){
			if (json.relations[i] != null){
				var name = json.edges[i];
				this.addEdge(name, json.relations[i].sourceIndex, json.relations[i].targetIndex, json.relations[i].args);
			}
		}
		else{
				this.json.edges.push(null);
				this.json.relations.push(null);
		}
	}
};

GraphDataset.prototype.prettyPrint = function(){
	for ( var node in this.vertices) {
		console.log(this.vertices[node].getName() ); 
		for ( var j = 0; j <  this.vertices[node].getEdgesIn().length; j++) {
 			console.log("          --> " + this.vertices[node].getEdgesIn()[j].getNodeTarget().getName() ); 
		}
	}
};

GraphDataset.prototype._removeEdge = function(edge){
	this.json.edges[edge.getId()] = null;
	this.json.relations[edge.getId()] = null;
	
	delete this.edges[edge.getId()];
	this.edgeDeleted.notify(edge);
	

};

GraphDataset.prototype._removeNode = function(node){
	this.json.vertices[node.getId()] = null;
	delete this.vertices[node.getId()];
	this.vertexDeleted.notify(node);
};

GraphDataset.prototype.toJSON = function(){
	var json = new Object();
	var nodes = new Array();
	json.nodes = this.json.vertices; //nodes;
	json.edges = this.json.edges; //edges;
	json.relations = this.json.relations;
	return json;
};

GraphDataset.prototype.clone = function(){
	var dsDataset = new GraphDataset();
	dsDataset.loadFromJSON(this.toJSON());
	return dsDataset;
};
//GraphDataset.prototype.test = function(){
//	this.loadFromJSON(this.toJSON());
//};

function labels(){
	var names = new Array();
	
	var dataset = interactomeViewer.graphEditorWidget.dataset;
	var layout = interactomeViewer.graphEditorWidget.layout;
	
	for ( var vertexId in interactomeViewer.graphEditorWidget.dataset.getVertices()) {
		names.push(interactomeViewer.graphEditorWidget.dataset.getVertexById(vertexId).getName());
	}
	
	var sorted = (names.sort());
	console.log(sorted)
	var distance =  0.01;
	var altura = 0.6;
	for ( var i = 0; i < names.length; i++) {
		var id =dataset.getVertexByName(names[i]).getId();
		
		layout.getNodeById(id).setCoordenates(distance, altura);
		
		
		distance = parseFloat(distance) + parseFloat(0.03);
		
		altura = parseFloat(altura) + parseFloat(0.02);
	
		if (parseFloat(altura) == 0.9800000000000003){
		
			altura = 0.6;
			distance = distance - 0.51;
		}
		
	}
	

};

function GraphItem(id, name, args){
	this.id = id;
	this.name = name;
	this.type = "NONE";
	
	this.args = new Object();
	
	
	if (args!=null){
		this.args = args;
		if (args.type !=null){
			this.type = args.type;
		}
	}
	
	//Events
	this.nameChanged = new Event(this);
	this.deleted = new Event(this);
}

GraphItem.prototype.getName = function(){
	return this.name;
};

GraphItem.prototype.getId = function(){
	return this.id;
};

GraphItem.prototype.setName = function(name){
	var oldName = this.getName();
	this.name = name;
	this.nameChanged.notify({"item": this, "previousName" : oldName});
};





function LayoutDataset(){
	this.dataset = null;
	this.vertices = new Object();
	this.changed = new Event(this);
	
	
	this.args = new Object();
	
	//RANDOM, CIRCLE
	this.args.type = "CIRCLE";
};

LayoutDataset.prototype.loadFromJSON = function(dataset, json){
	var _this = this;
	this.vertices = new Object();
	this.dataset = dataset; //new GraphDataset();
	for ( var vertex in json) {
		this.vertices[vertex] = new NodeLayout(vertex, json[vertex].x, json[vertex].y);
		this.vertices[vertex].changed.attach(function (sender, item){
			_this.changed.notify(item);
		});
	}
	this._attachDatasetEvents();
};


LayoutDataset.prototype.toJSON = function(){
	var serialize = new Object();
	for ( var vertex in this.vertices) {
		serialize[vertex] = new Object();
		serialize[vertex].x = this.vertices[vertex].x;  
		serialize[vertex].y = this.vertices[vertex].y;  
	}
	serialize.dataset = new Object();
	serialize.dataset =this.dataset.toJSON();
	return serialize;
};

LayoutDataset.prototype.dataBind = function(graphDataset){
	this.dataset = graphDataset;
	this._attachDatasetEvents();
	this._calculateLayout();
};

LayoutDataset.prototype._removeVertex = function(vertexId){
	delete this.vertices[vertexId];
};

LayoutDataset.prototype._attachDatasetEvents = function(){
	var _this = this;
	
	this.dataset.vertexDeleted.attach(function (sender, item){
		_this._removeVertex(item.getId());
	});
	
	this.dataset.newVertex.attach(function (sender, item){
		_this.vertices[item.getId()] = new NodeLayout(item.getId(), 0.5, 0.5);
		_this.vertices[item.getId()].changed.attach(function (sender, item){
			_this.changed.notify(item);
		});
	});
};

LayoutDataset.prototype.getType = function(){
	return this.args.type;
};

LayoutDataset.prototype._calculateLayoutVertices = function(type, count){
	
	if (type == "CIRCLE"){
			var radius = 0.4;
			var centerX = 0.5;
			var centerY = 0.5;
			var verticesCoordinates = new Array();
			for(var i = 0; i < count; i++){
				x = centerX + radius * Math.sin(i * 2 * Math.PI/count);
				y = centerY + radius * Math.cos(i * 2 * Math.PI/count);
				verticesCoordinates.push({'x':x,'y':y});
			}
			return verticesCoordinates;
	}
};


LayoutDataset.prototype._calculateLayout = function(){
	var _this = this;
	if (this.getType() == "RANDOM"){
		for ( var vertex in this.dataset.getVertices()) {
			if (this.vertices[vertex] == null){
				this.vertices[vertex] = new NodeLayout(vertex, 0, 0);
			}
			this.vertices[vertex].setCoordinates(Math.random(), Math.random());
			this.vertices[vertex].changed.attach(function (sender, item){
				_this.changed.notify(item);
			});
		}
	}
	
	if ( this.getType() == "CIRCLE"){
		
		var count = this.dataset._getVerticesCount();
		var verticesCoordinates = this._calculateLayoutVertices(this.getType(), count);
		
		var aux = 0;
		for ( var vertex in this.dataset.getVertices()) {
			if (this.vertices[vertex] == null){
				this.vertices[vertex] = new NodeLayout(vertex, 0, 0);
			}
			this.vertices[vertex].setCoordinates(verticesCoordinates[aux].x, verticesCoordinates[aux].y);//{"x":, "y":};
			aux++;
			this.vertices[vertex].changed.attach(function (sender, item){
				_this.changed.notify(item);
			});
		}
	}
	
	
	if (this.getType() == "SQUARE"){
		
		var count = this.dataset._getVerticesCount();
		var xMin = 0.1;
		var xMax = 0.9;
		var yMin = 0.1;
		var yMax = 0.9;
		
		var rows = Math.sqrt(count);
		var step = (xMax - xMin) / rows;
		
		var verticesCoordinates = new Array();
		for(var i = 0; i < rows; i ++){
			for ( var j = 0; j < rows; j++) {
				x = i * step + xMin;
				y = j * step + yMin;
				verticesCoordinates.push({'x':x,'y':y});
			}
		}
		
		var aux = 0;
		for ( var vertex in this.dataset.getVertices()) {
			if (this.vertices[vertex] == null){
				this.vertices[vertex] = new NodeLayout(vertex, 0, 0);
			}
			this.vertices[vertex].setCoordinates(verticesCoordinates[aux].x, verticesCoordinates[aux].y);//{"x":, "y":};
			aux++;
			this.vertices[vertex].changed.attach(function (sender, item){
				_this.changed.notify(item);
			});
		}
	}
	
};

LayoutDataset.prototype.getNodeById = function(id){
	return this.vertices[id];
};

LayoutDataset.prototype.getVerticesByArea = function(x1, y1, x2, y2){
	var vertices = new Array();
	for ( var vertex in this.dataset.getVertices()) {
		if ((this.vertices[vertex].x >= x1)&&(this.vertices[vertex].x <= x2)){
			if ((this.vertices[vertex].y >= y1)&&(this.vertices[vertex].y <= y2)){
				vertices.push(this.vertices[vertex]);
			}
		}
	}
	return vertices;
};




LayoutDataset.prototype.getLayout = function(type){
	
	if (type == "CIRCLE"){
		this.args.type = "CIRCLE";
		this._calculateLayout();
		return;
	}
	
	if (type == "SQUARE"){
		this.args.type = "SQUARE";
		this._calculateLayout();
		return;
	}
	
	if (type == "RANDOM"){
		this.args.type = "RANDOM";
		this._calculateLayout();
		return;
	}
	
	
	var dotText = this.dataset.toDOTID();
	var url = "http://bioinfo.cipf.es/utils/ws/rest/network/layout/"+type+".coords";
	var _this = this;
	
	 $.ajax({
         async: true,
         type: "POST",
         url: url,
         dataType: "text",
         data: {
                 dot :dotText
                 },  
         cache: false,
         success: function(data){ 
                         var response = JSON.parse(data);
                         for ( var vertexId in response) {
                                 _this.vertices[vertexId].setCoordinates(response[vertexId].x, response[vertexId].y);
                         }   
                 }   
	 });
	 
//	$.ajax({
//		async: true,
//		type: "POST",
//		url: url,
//		dataType: "script",
//		data: {
//			dot :dotText
//			},
//		cache: false,
//		success: function(data){ 
//				var response = JSON.parse(data);
//				for ( var vertexId in response) {
//					_this.vertices[vertexId].setCoordinates(response[vertexId].x, response[vertexId].y);
//				}
//			}
//	});
	
};

function NodeLayout(id, x, y, args){
	this.id = id;
	this.x = x;
	this.y = y;
	this.changed = new Event(this);
};

NodeLayout.prototype.getId = function(id){
	return this.id;
};

NodeLayout.prototype.setCoordinates = function(x, y){
	this.x = x;
	this.y = y;
	this.changed.notify(this);
};



function NetworkDataSetFormatter(vertexFormatProperties, defaultEdgeProperties, args){
	DataSet.prototype.constructor.call(this);
	
	this.args = new Object();
	
	this.vertices = new Object();
	this.edges = new Object();
	this.dataset = null;
	this.maxClass = 0;
	this.minClass = 0;
	
	/** Coordenates with default Setting */
	this.args.width = 1100;
	this.args.height = 500;
	
	/** Optional parameters */
	this.args.backgroundColor = "#FFFFFF";
	this.args.backgroundImage = null;
	this.args.backgroundImageHeight = null;
	this.args.backgroundImageWidth = null;
	this.args.backgroundImageX = null;
	this.args.backgroundImageY = null;
	
	
	this.args.balanceNodes = false;
	this.args.nodesMaxSize = 3;
	this.args.nodesMinSize = 0.5;
		
	
	/** Zoom **/
	this.args.zoomScale = 1;
	this.args.zoomScaleStepFactor = 0.4;
	
	if (args != null){
		if (args.backgroundImage != null){
			this.args.backgroundImage = args.backgroundImage;		
		}
		
		if (args.width != null){
			this.args.width = args.width;		
		}
		
		if (args.height != null){
			this.args.height = args.height;	
			this.args.svgHeight = args.height;		
		}
		
		if (args.svgHeight != null){
			this.args.svgHeight = args.svgHeight;		
		}
		
		if (args.backgroundColor != null){
			this.args.backgroundColor = args.backgroundColor;		
		}
		
		if(args.balanceNodes != null){
			this.args.balanceNodes = args.balanceNodes;
		}

		if(args.nodesMaxSize != null){
			this.args.nodesMaxSize = args.nodesMaxSize;
		}
		if(args.nodesMinSize != null){
			this.args.nodesMinSize = args.nodesMinSize;
		}
	}
	
	this.args.defaultEdgeProperties =  {"fill":"#000000", "radius":"1", "stroke":"#000000", "size":1, "title":{"fontSize":10, "fontColor":"#000000"}};
	this.args.vertexFormatProperties = { "fill":"#000000", "stroke":"#000000", "stroke-opacity":"#000000"};
	
	if (vertexFormatProperties!= null){
		this.args.vertexFormatProperties = vertexFormatProperties;
	}
	if (defaultEdgeProperties!= null){
		this.args.defaultEdgeProperties = defaultEdgeProperties;
	}
	
	/** Events **/
	this.changed = new Event(this);
	this.edgeChanged = new Event(this);
	this.resized = new Event(this);
	this.backgroundImageChanged= new Event(this);
	this.backgroundColorChanged= new Event(this);
};

NetworkDataSetFormatter.prototype.loadFromJSON = function(dataset, json){
	this.args = new Object();
	this.vertices = new Object();
	this.args = json;
	this._setDataset(dataset);
	var _this = this;
	
	for ( var vertex in json.vertices) {
		this.addVertex(vertex, json.vertices[vertex]);
	}
	
	for ( var edgeId in json.edges) {
		this.addEdge(edgeId, json.edges[edgeId]);
	}
};


NetworkDataSetFormatter.prototype.toJSON = function(){
	
	
//	this.args.vertices = new Object();
//	this.args.edges = new Object();
//	
//	for ( var vertex in this.vertices) {
//		this.args.vertices[vertex] = this.getVertexById(vertex).toJSON();
//	}
//	for ( var edge in this.edges) {
//		this.args.edges[edge] = this.getEdgeById(edge).toJSON();
//	}
//	
//	return (this.args);
	

	var serialize = new Object();
	serialize = JSON.parse(JSON.stringify(this.args));
	serialize.vertices = new Object();
	serialize.edges = new Object();
	
	for ( var vertex in this.vertices) {
		serialize.vertices[vertex] = this.getVertexById(vertex).toJSON();
	}
	for ( var edge in this.edges) {
		serialize.edges[edge] = this.getEdgeById(edge).toJSON();
	}
	
	return (serialize);
};



NetworkDataSetFormatter.prototype._getNodeSize = function(nodeId){
	if (this.isVerticesBalanced()){
		var total =  this.maxClass - this.minClass;
		if (total == 0){ total = 1;}
		var nodeConnection = this.dataset.getVertexById(nodeId).getEdges().length;
		return ((nodeConnection*this.args.nodesMaxSize)/total)  + this.args.nodesMinSize;
	}
	return this.getVertexById(nodeId).getDefault().getSize();
};

NetworkDataSetFormatter.prototype._recalculateSize = function(){
	if (this.isVerticesBalanced()){
		this.maxClass = this.dataset.getMaxClass();
		this.minClass = this.dataset.getMinClass();
		for ( var vertexIdAll in this.vertices) {
				var size = this._getNodeSize(vertexIdAll);
				this.vertices[vertexIdAll].getDefault().setSize(size);
				this.vertices[vertexIdAll].getSelected().setSize(size);
				this.vertices[vertexIdAll].getOver().setSize(size);
		}
	}
};


NetworkDataSetFormatter.prototype.addVertex = function(vertexId, json){
	
	
	if (json == null){
		this.vertices[vertexId] = new CircleVertexGraphFormatter(vertexId, this.args.vertexFormatProperties.defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	else{
		
		/** Cargo los attributos desde el json **/
		if (json.type == null){
			this.vertices[vertexId] = new CircleVertexGraphFormatter(vertexId, this.args.vertexFormatProperties.defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
		}
		
		if ((json.type == "SquareVertexGraphFormatter")||(json.type == "SquareVertexNetworkFormatter")){
			this.vertices[vertexId] = new SquareVertexGraphFormatter(vertexId);
			this.vertices[vertexId].loadFromJSON(json);
		}
		
		if ((json.type == "CircleVertexGraphFormatter")||(json.type == "CircleVertexNetworkFormatter")){
			this.vertices[vertexId] = new CircleVertexGraphFormatter(vertexId);
			this.vertices[vertexId].loadFromJSON(json);
		}
		
		if ((json.type == "EllipseVertexGraphFormatter")||(json.type == "EllipseVertexNetworkFormatter")){
			this.vertices[vertexId] = new EllipseVertexGraphFormatter(vertexId);
			this.vertices[vertexId].loadFromJSON(json);
		}
		
		if ((json.type == "RectangleVertexGraphFormatter")||(json.type == "RectangleVertexNetworkFormatter")){
			this.vertices[vertexId] = new RectangleVertexGraphFormatter(vertexId);
			this.vertices[vertexId].loadFromJSON(json);
		}
		
		if ((json.type == "RoundedVertexGraphFormatter")||(json.type == "RoundedVertexNetworkFormatter")){
			this.vertices[vertexId] = new RoundedVertexGraphFormatter(vertexId);
			this.vertices[vertexId].loadFromJSON(json);
		}
		
	}
	
	
	var _this = this;
	this.vertices[vertexId].stateChanged.attach(function (sender, item){
		_this.changed.notify(item);
	});
	
	var size = this._getNodeSize(vertexId);
	this.vertices[vertexId].defaultFormat.args.size = size;
	this.vertices[vertexId].selected.args.size =  size;
	this.vertices[vertexId].over.args.size =  size;
	
};

NetworkDataSetFormatter.prototype.addEdge = function(edgeId, json){
	
	/** Es un edge nuevo que le doy los atributos por defecto **/
	if (json == null){
		if (this.dataset.getEdgeById(edgeId).getNodeSource().getId() == this.dataset.getEdgeById(edgeId).getNodeTarget().getId()){
			this.edges[edgeId] = new BezierEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
		}else{
			this.edges[edgeId] = new DirectedLineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
		}
	}
	else{
		/** Cargo los attributos desde el json **/
		if (json.type == null){
			this.edges[edgeId] = new LineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
		}
		
		if ((json.type == "LineEdgeGraphFormatter")||(json.type == "LineEdgeNetworkFormatter")){
			this.edges[edgeId] = new LineEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
		if ((json.type == "DirectedLineEdgeGraphFormatter")||(json.type == "DirectedLineEdgeNetworkFormatter")){
			this.edges[edgeId] = new DirectedLineEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
		
		if ((json.type == "BezierEdgeGraphFormatter")||(json.type == "BezierEdgeNetworkFormatter")){
			this.edges[edgeId] = new BezierEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
		
		
		if ((json.type == "CutDirectedLineEdgeGraphFormatter")||(json.type == "CutDirectedLineEdgeNetworkFormatter")){
			this.edges[edgeId] = new CutDirectedLineEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
		
		if ((json.type == "DotDirectedLineEdgeGraphFormatter")||(json.type == "DotDirectedLineEdgeNetworkFormatter")){
			this.edges[edgeId] = new DotDirectedLineEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
		if ((json.type == "OdotDirectedLineEdgeGraphFormatter")||(json.type == "OdotDirectedLineEdgeNetworkFormatter")){
			this.edges[edgeId] = new OdotDirectedLineEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
		
		if ((json.type == "OdirectedLineEdgeGraphFormatter")||(json.type == "OdirectedLineEdgeNetworkFormatter")){
			this.edges[edgeId] = new OdirectedLineEdgeGraphFormatter(edgeId);
			this.edges[edgeId].loadFromJSON(json);
		}
	}
	
	var _this = this;
	this.edges[edgeId].stateChanged.attach(function (sender, item){
		_this.edgeChanged.notify(item);
	});
	
	this._recalculateSize();
};

NetworkDataSetFormatter.prototype._setDataset = function(dataset){
	this.dataset = dataset;
	this.maxClass = dataset.getMaxClass();
	this.minClass = dataset.getMinClass();
	this._attachDatasetEvents();
};

NetworkDataSetFormatter.prototype.changeEdgeType = function(edgeId, type){
	if ((type == "LineEdgeGraphFormatter")||(type == "LineEdgeNetworkFormatter")){
		this.edges[edgeId] = new LineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
		
	}
	if ((type == "DirectedLineEdgeGraphFormatter")||(type == "DirectedLineEdgeNetworkFormatter")){
		this.edges[edgeId] = new DirectedLineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
	}
	
	if ((type == "CutDirectedLineEdgeGraphFormatter")||(type == "CutDirectedLineEdgeNetworkFormatter")){
		this.edges[edgeId] = new CutDirectedLineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
	}
	
	if ((type == "DotDirectedLineEdgeGraphFormatter")||(type == "DotDirectedLineEdgeNetworkFormatter")){
		this.edges[edgeId] = new DotDirectedLineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
	}
	
	if ((type == "OdotDirectedLineEdgeGraphFormatter")||(type == "OdotDirectedLineEdgeNetworkFormatter")){
		this.edges[edgeId] = new OdotDirectedLineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
	}
	
	if ((type == "OdirectedLineEdgeGraphFormatter")||(type == "OdirectedLineEdgeNetworkFormatter")){
		this.edges[edgeId] = new OdirectedLineEdgeGraphFormatter(edgeId, this.args.defaultEdgeProperties.defaultFormat, this.args.defaultEdgeProperties.selected, this.args.defaultEdgeProperties.over, this.args.defaultEdgeProperties.dragging);
	}
	
	
	
	var _this = this;
	this.edges[edgeId].stateChanged.attach(function (sender, item){
		_this.edgeChanged.notify(item);
	});
	_this.edgeChanged.notify(this.edges[edgeId]);
};
/*
classe = "SquareNetworkNodeFormatter";
}
if (value == "circle"){
	classe = "CircleNetworkNodeFormatter";
	**/
NetworkDataSetFormatter.prototype.changeNodeType = function(vertexId, type){
	var defaultFormat = JSON.parse(JSON.stringify(this.vertices[vertexId].getDefault()));
	var selectedFormat = JSON.parse(JSON.stringify(this.vertices[vertexId].getSelected()));
	var defaultFormat = JSON.parse(JSON.stringify(this.vertices[vertexId].getDefault()));
	var defaultFormat = JSON.parse(JSON.stringify(this.vertices[vertexId].getDefault()));
	
	if ((type == "SquareVertexGraphFormatter")||(type == "SquareVertexNetworkFormatter")){
		this.vertices[vertexId] = new SquareVertexGraphFormatter(vertexId,defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	
	if ((type == "CircleVertexGraphFormatter")||(type == "CircleVertexNetworkFormatter")){
		this.vertices[vertexId] = new CircleVertexGraphFormatter(vertexId, defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	
	if ((type == "EllipseVertexGraphFormatter")||(type == "EllipseVertexNetworkFormatter")){
		this.vertices[vertexId] = new EllipseVertexGraphFormatter(vertexId, defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	
	if ((type == "RectangleVertexGraphFormatter")||(type == "RectangleVertexNetworkFormatter")){
		this.vertices[vertexId] = new RectangleVertexGraphFormatter(vertexId, defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	
	if ((type == "RoundedVertexGraphFormatter")||(type == "RoundedVertexNetworkFormatter")){
		this.vertices[vertexId] = new RoundedVertexGraphFormatter(vertexId, defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	
	if ((type == "OctagonVertexGraphFormatter")||(type == "OctagonVertexNetworkhFormatter")){
		this.vertices[vertexId] = new OctagonVertexGraphFormatter(vertexId, defaultFormat, this.args.vertexFormatProperties.selected, this.args.vertexFormatProperties.over, this.args.vertexFormatProperties.dragging);
	}
	

	var _this = this;
	this.vertices[vertexId].stateChanged.attach(function (sender, item){
		_this.changed.notify(item);
	});
	_this.changed.notify(this.vertices[vertexId]);
};



NetworkDataSetFormatter.prototype.dataBind = function(networkDataSet){
	var _this = this;
	this._setDataset(networkDataSet);
		
	for ( var vertex in this.dataset.getVertices()) {
		this.addVertex(vertex);
	}
	
	for ( var edge in this.dataset.getEdges()) {
		this.addEdge(edge);
	}
};

NetworkDataSetFormatter.prototype._removeEdge = function(edgeId){
	delete this.edges[edgeId];
};

NetworkDataSetFormatter.prototype._removeVertex = function(vertexId){
	delete this.vertices[vertexId];
};

NetworkDataSetFormatter.prototype._attachDatasetEvents = function(id){
	var _this = this;
	this.dataset.vertexDeleted.attach(function (sender, item){
		_this._removeVertex(item.getId());
	});
	
	this.dataset.edgeDeleted.attach(function (sender, item){
		_this._removeEdge(item.getId());
	});
	
	this.dataset.newVertex.attach(function (sender, item){
		_this.addVertex(item.getId());
	});
	
	this.dataset.newEdge.attach(function (sender, item){
		_this.addEdge(item.getId());
	});
};


NetworkDataSetFormatter.prototype.getVertexById = function(id){
	return this.vertices[id];
};

NetworkDataSetFormatter.prototype.getEdgeById = function(id){
	return this.edges[id];
};

NetworkDataSetFormatter.prototype.makeLabelsBigger = function(){
for ( var vertexId in this.vertices) {
		var fontSize = this.vertices[vertexId].getDefault().getFontSize() + 2;
		this.vertices[vertexId].getDefault().setFontSize(fontSize);
	}
};

NetworkDataSetFormatter.prototype.makeLabelsSmaller = function(){
	for ( var vertexId in this.vertices) {
			var fontSize = this.vertices[vertexId].getDefault().getFontSize() - 2;
			this.vertices[vertexId].getDefault().setFontSize(fontSize);
		}
};


NetworkDataSetFormatter.prototype.resize = function(width, height){
	this.args.width = width;
	this.args.height = height;
	this.resized.notify();
};

/** ZOOM GETTERS **/
NetworkDataSetFormatter.prototype.getZoomScaleStepFactor = function(){return this.args.zoomScaleStepFactor;};
NetworkDataSetFormatter.prototype.setZoomScaleStepFactor = function(scaleFactor){this.args.zoomScaleStepFactor = scaleFactor;};
NetworkDataSetFormatter.prototype.getZoomScale = function(){return this.args.zoomScale;};
NetworkDataSetFormatter.prototype.setZoomScale = function(scale){this.args.zoomScale = scale;};

NetworkDataSetFormatter.prototype.getNodesMaxSize = function(){return this.args.nodesMaxSize;};
NetworkDataSetFormatter.prototype.getNodesMinSize = function(){return this.args.nodesMinSize;};

/** SIZE SETTERS AND GETTERS **/
NetworkDataSetFormatter.prototype.isVerticesBalanced = function(){return this.args.balanceNodes;};
NetworkDataSetFormatter.prototype.getWidth = function(){return this.args.width;};
NetworkDataSetFormatter.prototype.getHeight = function(){return this.args.height;};

/** OPTIONAL PARAMETERS GETTERS AND SETTERS **/
NetworkDataSetFormatter.prototype.getBackgroundImage = function(){return this.args.backgroundImage;};
NetworkDataSetFormatter.prototype.setBackgroundImage = function(value){this.args.backgroundImage = value; this.backgroundImageChanged.notify(this);};


NetworkDataSetFormatter.prototype.getBackgroundImageWidth = function(){return this.args.backgroundImageWidth;};
NetworkDataSetFormatter.prototype.setBackgroundImageWidth = function(value){this.args.backgroundImageWidth = value; this.backgroundImageChanged.notify(this);};

NetworkDataSetFormatter.prototype.getBackgroundImageHeight = function(){return this.args.backgroundImageHeight;};
NetworkDataSetFormatter.prototype.setBackgroundImageHeight = function(value){this.args.backgroundImageHeight = value; this.backgroundImageChanged.notify(this);};

NetworkDataSetFormatter.prototype.getBackgroundImageX = function(){return this.args.backgroundImageX;};
NetworkDataSetFormatter.prototype.setBackgroundImageX = function(value){this.args.backgroundImageX = value; this.backgroundImageChanged.notify(this);};

NetworkDataSetFormatter.prototype.getBackgroundImageY = function(){return this.args.backgroundImageX;};
NetworkDataSetFormatter.prototype.setBackgroundImageY = function(value){this.args.backgroundImageY = value; this.backgroundImageChanged.notify(this);};



NetworkDataSetFormatter.prototype.getBackgroundColor = function(){return this.args.backgroundColor;};
NetworkDataSetFormatter.prototype.setBackgroundColor = function(value){this.args.backgroundColor = value; this.backgroundColorChanged.notify(this);};

NetworkDataSetFormatter.prototype.getWidth = function(){return this.args.width;};
NetworkDataSetFormatter.prototype.setWidth = function(value){this.args.width = value;};

NetworkDataSetFormatter.prototype.getHeight = function(){return this.args.height;};
NetworkDataSetFormatter.prototype.setHeight = function(value){this.args.height = value;};




Vertex.prototype.getName = GraphItem.prototype.getName;
Vertex.prototype.setName = GraphItem.prototype.setName;
Vertex.prototype.getId = GraphItem.prototype.getId;

function Vertex(id, name, args){
	GraphItem.prototype.constructor.call(this, id, name, args);
	this.edgesIn= new Array();
	this.edgesOut= new Array();
};

Vertex.prototype.getEdges = function(){
	return this.edgesIn.concat(this.edgesOut);
};

Vertex.prototype.getEdgesCount = function(){
	return this.getEdges().length;
};

Vertex.prototype.getEdgesIn = function(){
	return this.edgesIn;
};

Vertex.prototype.getEdgesOut = function(){
	return this.edgesOut;
};

Vertex.prototype.addEdge = function(edge){
	if (edge.getNodeSource().getId() == this.id){
		this.edgesIn.push(edge);
	}
	else{
		this.edgesOut.push(edge);
	}
};

Vertex.prototype.removeEdge = function(edge){
	for ( var i = 0; i < this.getEdgesIn().length; i++) {
		var edgeIn = this.edgesIn[i];
		if (edgeIn.getId() == edge.getId()){
			this.edgesIn.splice(i, 1);
		}
	}
	for ( var i = 0; i < this.getEdgesOut().length; i++) {
		var edgeIn = this.edgesOut[i];
		if (edgeIn.getId() == edge.getId()){
			this.edgesOut.splice(i, 1);
		}
	}
};

Vertex.prototype.remove = function(){
	var edges = this.getEdges();
	for ( var i = 0; i < edges.length; i++) {
		var edge = edges[i];
		edge.remove();
	}
	this.deleted.notify(this);
};





VertexGraphFormatter.prototype.getDefault = ItemGraphFormatter.prototype.getDefault;
VertexGraphFormatter.prototype.getSelected = ItemGraphFormatter.prototype.getSelected;
VertexGraphFormatter.prototype.getOver = ItemGraphFormatter.prototype.getOver;
VertexGraphFormatter.prototype.getDragging = ItemGraphFormatter.prototype.getDragging; 
VertexGraphFormatter.prototype.getId = ItemGraphFormatter.prototype.getId; 
VertexGraphFormatter.prototype.toJSON = ItemGraphFormatter.prototype.toJSON; 
VertexGraphFormatter.prototype.loadFromJSON = ItemGraphFormatter.prototype.loadFromJSON; 
VertexGraphFormatter.prototype._setEvents = ItemGraphFormatter.prototype._setEvents; 


function VertexGraphFormatter(defaultFormat, selectedFormat, overFormat, draggingFormat){
	ItemGraphFormatter.prototype.constructor.call(this, defaultFormat, selectedFormat, overFormat, draggingFormat);
};


CircleVertexGraphFormatter.prototype.getDefault = VertexGraphFormatter.prototype.getDefault;
CircleVertexGraphFormatter.prototype.getSelected = VertexGraphFormatter.prototype.getSelected;
CircleVertexGraphFormatter.prototype.getOver = VertexGraphFormatter.prototype.getOver;
CircleVertexGraphFormatter.prototype.getDragging = VertexGraphFormatter.prototype.getDragging; 
CircleVertexGraphFormatter.prototype.getId = VertexGraphFormatter.prototype.getId; 
CircleVertexGraphFormatter.prototype.toJSON = VertexGraphFormatter.prototype.toJSON; 
CircleVertexGraphFormatter.prototype.loadFromJSON = VertexGraphFormatter.prototype.loadFromJSON;
CircleVertexGraphFormatter.prototype._setEvents = VertexGraphFormatter.prototype._setEvents;

function CircleVertexGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	VertexGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, draggingFormat);
	this.args.type = "CircleVertexGraphFormatter";
	if (defaultFormat != null){
		if (defaultFormat.radius != null){
			this.defaultFormat.args.radius = defaultFormat.radius;
		}
	}
	
	if (selectedFormat != null){
		if (selectedFormat.radius != null){
			this.selected.args.radius = selectedFormat.radius;
		}
	}
	
	if (overFormat != null){
		if (overFormat.radius != null){
			this.over.args.radius = overFormat.radius;
		}
	}
	
	if (draggingFormat != null){
		if (draggingFormat.radius != null){
			this.dragging.args.draggingFormat = draggingFormat.radius;
		}
	}
};



SquareVertexGraphFormatter.prototype.getDefault = VertexGraphFormatter.prototype.getDefault;
SquareVertexGraphFormatter.prototype.getSelected = VertexGraphFormatter.prototype.getSelected;
SquareVertexGraphFormatter.prototype.getOver = VertexGraphFormatter.prototype.getOver;
SquareVertexGraphFormatter.prototype.getDragging = VertexGraphFormatter.prototype.getDragging; 
SquareVertexGraphFormatter.prototype.getId = VertexGraphFormatter.prototype.getId; 
SquareVertexGraphFormatter.prototype.toJSON = VertexGraphFormatter.prototype.toJSON; 
SquareVertexGraphFormatter.prototype.loadFromJSON = VertexGraphFormatter.prototype.loadFromJSON;
SquareVertexGraphFormatter.prototype._setEvents = VertexGraphFormatter.prototype._setEvents;

function SquareVertexGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	VertexGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, draggingFormat);
	this.args.type =  "SquareVertexGraphFormatter";
	if (defaultFormat != null){
		if (defaultFormat.radius != null){
			this.defaultFormat.args.radius = defaultFormat.radius;
		}
	}
	
	if (selectedFormat != null){
		if (selectedFormat.radius != null){
			this.selected.args.radius = selectedFormat.radius;
		}
	}
	
	if (overFormat != null){
		if (overFormat.radius != null){
			this.over.args.radius = overFormat.radius;
		}
	}
	
	if (draggingFormat != null){
		if (draggingFormat.radius != null){
			this.dragging.args.draggingFormat = draggingFormat.radius;
		}
	}
};


EllipseVertexGraphFormatter.prototype.getDefault = VertexGraphFormatter.prototype.getDefault;
EllipseVertexGraphFormatter.prototype.getSelected = VertexGraphFormatter.prototype.getSelected;
EllipseVertexGraphFormatter.prototype.getOver = VertexGraphFormatter.prototype.getOver;
EllipseVertexGraphFormatter.prototype.getDragging = VertexGraphFormatter.prototype.getDragging; 
EllipseVertexGraphFormatter.prototype.getId = VertexGraphFormatter.prototype.getId; 
EllipseVertexGraphFormatter.prototype.toJSON = VertexGraphFormatter.prototype.toJSON; 
EllipseVertexGraphFormatter.prototype.loadFromJSON = VertexGraphFormatter.prototype.loadFromJSON;
EllipseVertexGraphFormatter.prototype._setEvents = VertexGraphFormatter.prototype._setEvents;

function EllipseVertexGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	VertexGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, draggingFormat);
	this.args.type  = "EllipseVertexGraphFormatter";
	if (defaultFormat != null){
		if (defaultFormat.radius != null){
			this.defaultFormat.args.radius = defaultFormat.radius;
		}
	}
	
	if (selectedFormat != null){
		if (selectedFormat.radius != null){
			this.selected.args.radius = selectedFormat.radius;
		}
	}
	
	if (overFormat != null){
		if (overFormat.radius != null){
			this.over.args.radius = overFormat.radius;
		}
	}
	
	if (draggingFormat != null){
		if (draggingFormat.radius != null){
			this.dragging.args.draggingFormat = draggingFormat.radius;
		}
	}
};



RectangleVertexGraphFormatter.prototype.getDefault = ItemGraphFormatter.prototype.getDefault;
RectangleVertexGraphFormatter.prototype.getSelected = ItemGraphFormatter.prototype.getSelected;
RectangleVertexGraphFormatter.prototype.getOver = ItemGraphFormatter.prototype.getOver;
RectangleVertexGraphFormatter.prototype.getDragging = ItemGraphFormatter.prototype.getDragging; 
RectangleVertexGraphFormatter.prototype.getId = ItemGraphFormatter.prototype.getId; 
RectangleVertexGraphFormatter.prototype.toJSON = ItemGraphFormatter.prototype.toJSON; 
RectangleVertexGraphFormatter.prototype.loadFromJSON = ItemGraphFormatter.prototype.loadFromJSON; 
RectangleVertexGraphFormatter.prototype._setEvents = ItemGraphFormatter.prototype._setEvents; 

function RectangleVertexGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	VertexGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, draggingFormat);
	this.args.type = "RectangleVertexGraphFormatter";
	if (defaultFormat != null){
		if (defaultFormat.radius != null){
			this.defaultFormat.args.radius = defaultFormat.radius;
		}
	}
	
	if (selectedFormat != null){
		if (selectedFormat.radius != null){
			this.selected.args.radius = selectedFormat.radius;
		}
	}
	
	if (overFormat != null){
		if (overFormat.radius != null){
			this.over.args.radius = overFormat.radius;
		}
	}
	
	if (draggingFormat != null){
		if (draggingFormat.radius != null){
			this.dragging.args.draggingFormat = draggingFormat.radius;
		}
	}
};



RoundedVertexGraphFormatter.prototype.getDefault = ItemGraphFormatter.prototype.getDefault;
RoundedVertexGraphFormatter.prototype.getSelected = ItemGraphFormatter.prototype.getSelected;
RoundedVertexGraphFormatter.prototype.getOver = ItemGraphFormatter.prototype.getOver;
RoundedVertexGraphFormatter.prototype.getDragging = ItemGraphFormatter.prototype.getDragging; 
RoundedVertexGraphFormatter.prototype.getId = ItemGraphFormatter.prototype.getId; 
RoundedVertexGraphFormatter.prototype.toJSON = ItemGraphFormatter.prototype.toJSON; 
RoundedVertexGraphFormatter.prototype.loadFromJSON = ItemGraphFormatter.prototype.loadFromJSON; 
RoundedVertexGraphFormatter.prototype._setEvents = ItemGraphFormatter.prototype._setEvents; 

function RoundedVertexGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	VertexGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, draggingFormat);
	this.args.type = "RoundedVertexGraphFormatter";
	if (defaultFormat != null){
		if (defaultFormat.radius != null){
			this.defaultFormat.args.radius = defaultFormat.radius;
		}
	}
	
	if (selectedFormat != null){
		if (selectedFormat.radius != null){
			this.selected.args.radius = selectedFormat.radius;
		}
	}
	
	if (overFormat != null){
		if (overFormat.radius != null){
			this.over.args.radius = overFormat.radius;
		}
	}
	
	if (draggingFormat != null){
		if (draggingFormat.radius != null){
			this.dragging.args.draggingFormat = draggingFormat.radius;
		}
	}
};



OctagonVertexGraphFormatter.prototype.getDefault = ItemGraphFormatter.prototype.getDefault;
OctagonVertexGraphFormatter.prototype.getSelected = ItemGraphFormatter.prototype.getSelected;
OctagonVertexGraphFormatter.prototype.getOver = ItemGraphFormatter.prototype.getOver;
OctagonVertexGraphFormatter.prototype.getDragging = ItemGraphFormatter.prototype.getDragging; 
OctagonVertexGraphFormatter.prototype.getId = ItemGraphFormatter.prototype.getId; 
OctagonVertexGraphFormatter.prototype.toJSON = ItemGraphFormatter.prototype.toJSON; 
OctagonVertexGraphFormatter.prototype.loadFromJSON = ItemGraphFormatter.prototype.loadFromJSON; 
OctagonVertexGraphFormatter.prototype._setEvents = ItemGraphFormatter.prototype._setEvents; 

function OctagonVertexGraphFormatter(id, defaultFormat, selectedFormat, overFormat, draggingFormat){
	VertexGraphFormatter.prototype.constructor.call(this, id, defaultFormat, selectedFormat, overFormat, draggingFormat);
	this.args.type = "OctagonVertexGraphFormatter";
	if (defaultFormat != null){
		if (defaultFormat.radius != null){
			this.defaultFormat.args.radius = defaultFormat.radius;
		}
	}
	
	if (selectedFormat != null){
		if (selectedFormat.radius != null){
			this.selected.args.radius = selectedFormat.radius;
		}
	}
	
	if (overFormat != null){
		if (overFormat.radius != null){
			this.over.args.radius = overFormat.radius;
		}
	}
	
	if (draggingFormat != null){
		if (draggingFormat.radius != null){
			this.dragging.args.draggingFormat = draggingFormat.radius;
		}
	}
};



var Colors = new function()
{
   this.hashColor = [];
   this.getColorByScoreArrayValue = function (arrayScore)
   {
	   var array = new Array();
	   
	   for (var i = 0; i< arrayScore.length; i++)
	   {
		
		   var color = this.getColorByScoreValue(arrayScore[i])
		   array.push( color);
		
	   }
	   return array;  
   };
   
   this.getHexStringByScoreArrayValue = function (arrayScore)
   {
	   var arrayColor = this.getColorByScoreArrayValue(arrayScore); 
	   var arrayHex = new Array();
	   for (var i = 0; i< arrayColor.length; i++)
	   {
		   arrayHex.push( arrayColor[i].HexString());
	   }
	   return arrayHex;   
   };
  
   this.getColorByScoreValue = function (score)
   {

		var truncate = score.toString().substr(0,4);
		if (this.hashColor[truncate]!=null)
		{
			return this.hashColor[truncate];
		}


		if(isNaN(score)) {
			return Colors.ColorFromRGB(0,0,0);
		}
		var value;
	
		var from, to;
		if(score < 0.5) {
			from = Colors.ColorFromRGB(0,0,255);
			to = Colors.ColorFromRGB(255,255,255);
			value = (score * 2);
		} else {
			from = Colors.ColorFromRGB(255,255,255);
			to = Colors.ColorFromRGB(255,0,0);			
			value = (score * 2) - 1;
		}

		var x = value;
		var y = 1.0 - value;
		var color = Colors.ColorFromRGB(y * from.Red() + x * to.Red(), y * from.Green() + x * to.Green(), y * from.Blue() + x * to.Blue());

		this.hashColor[truncate] = color;

		return color;
	};
	
  this.ColorFromHSV = function(hue, sat, val)
  {
    var color = new Color();
    color.SetHSV(hue,sat,val);
    return color;
  };

  this.ColorFromRGB = function(r, g, b)
  {
    var color = new Color();
    color.SetRGB(r,g,b);
    return color;
  };

  this.ColorFromHex = function(hexStr)
  {
    var color = new Color();
    color.SetHexString(hexStr);
    return color;
  };

  function Color() {
    //Stored as values between 0 and 1
    var red = 0;
    var green = 0;
    var blue = 0;
    
    //Stored as values between 0 and 360
    var hue = 0;
    
    //Strored as values between 0 and 1
    var saturation = 0;
    var value = 0;
     
    this.SetRGB = function(r, g, b)
    {
      red = r/255.0;
      green = g/255.0;
      blue = b/255.0;
      calculateHSV();
    };
    
    this.Red = function() { return Math.round(red*255); };
    
    this.Green = function() { return Math.round(green*255); };
    
    this.Blue = function() { return Math.round(blue*255); };
    
    this.SetHSV = function(h, s, v)
    {
      hue = h;
      saturation = s;
      value = v;
      calculateRGB();
    };
      
    this.Hue = function()
    { return hue; };
      
    this.Saturation = function()
    { return saturation; };
      
    this.Value = function()
    { return value; };
     
    this.SetHexString = function(hexString)
    {
      if(hexString == null || typeof(hexString) != "string")
      {
        this.SetRGB(0,0,0);
        return;
      }
       
      if (hexString.substr(0, 1) == '#')
        hexString = hexString.substr(1);
        
      if(hexString.length != 6)
      {
        this.SetRGB(0,0,0);
        return;
      }
          
      var r = parseInt(hexString.substr(0, 2), 16);
      var g = parseInt(hexString.substr(2, 2), 16);
      var b = parseInt(hexString.substr(4, 2), 16);
      if (isNaN(r) || isNaN(g) || isNaN(b))
      {
        this.SetRGB(0,0,0);
        return;
      }
        
      this.SetRGB(r,g,b);  
    };
      
    this.HexString = function()
    {
    
      var rStr = this.Red().toString(16);
      if (rStr.length == 1)
        rStr = '0' + rStr;
      var gStr = this.Green().toString(16);
      if (gStr.length == 1)
        gStr = '0' + gStr;
      var bStr = this.Blue().toString(16);
      if (bStr.length == 1)
        bStr = '0' + bStr;
      return ('#' + rStr + gStr + bStr).toUpperCase();
    };
    
    this.Complement = function()
    {
      var newHue = (hue >= 180) ? hue - 180 : hue + 180;
      var newVal = (value * (saturation - 1) + 1);
      var newSat = (value*saturation) / newVal;
      var newColor = new Color();
      newColor.SetHSV(newHue, newSat, newVal);
      return newColor; 
    } ;
    
    function calculateHSV()
    {
      var max = Math.max(Math.max(red, green), blue);
      var min = Math.min(Math.min(red, green), blue);
      
      value = max;
      
      saturation = 0;
      if(max != 0)
        saturation = 1 - min/max;
        
      hue = 0;
      if(min == max)
        return;
      
      var delta = (max - min);
      if (red == max)
        hue = (green - blue) / delta;
      else if (green == max)
        hue = 2 + ((blue - red) / delta);
      else
        hue = 4 + ((red - green) / delta);
      hue = hue * 60;
      if(hue < 0)
        hue += 360;
    }
    
    function calculateRGB()
    {
      red = value;
      green = value;
      blue = value;
      
      if(value == 0 || saturation == 0)
        return;
      
      var tHue = (hue / 60);
      var i = Math.floor(tHue);
      var f = tHue - i;
      var p = value * (1 - saturation);
      var q = value * (1 - saturation * f);
      var t = value * (1 - saturation * (1 - f));
      switch(i)
      {
        case 0:
          red = value; green = t;       blue = p;
          break;
        case 1:
          red = q; green = value; blue = p;
          break;
        case 2:
          red = p; green = value; blue = t;
          break;
        case 3:
          red = p; green = q; blue = value;
          break;
        case 4:
          red = t; green = p;   blue = value;
          break;
        default:
          red = value; green = p;       blue = q;
          break;
      }
    }
  }
}
();
/*
 * Clase gestiona la inserccin, eliminacin de los elementos en el DOM
 * 
 * Vital hacerla SIEMPRE compatible hacia atrs
 * 
 * Last update: 28-10-2010
 * 
 */


var DOM = {};

DOM.createNewElement = function(type, nodeParent, attributes)
{
	
	var node = document.createElement(type);
	for (var i=0; i<attributes.length; i++)
	{
		node.setAttribute(attributes[i][0], attributes[i][1]);
	}
	nodeParent.appendChild(node);
	return node;
		
};

DOM.createTextNode = function(text, nodeParent)
{
	var aText = document.createTextNode(text);
	nodeParent.appendChild(aText);
	return aText;

		
};

DOM.removeChilds = function(targetID)
{
	
	var parent = document.getElementById(targetID);
	while (parent.childNodes.length>0)
	{
	      parent.removeChild(parent.childNodes[0]);

	}
};

DOM.select = function(targetID)
{
  return document.getElementById(targetID);
//  return $("#"+targetID);
};
var Geometry =
{
		
	/** From tow points obtains the angles formed with the cartesian side **/
	getAngleBetweenTwoPoints : function(x1, y1, x2, y2){
		//var m = (y1 - y2)/ (x1 - x2);
		return Math.atan2(y2-y1, x2-x1);
	},
	
	getAdjacentSideOfRectangleRight : function(angle, hypotenuse){
		return Math.abs(Math.cos(angle)*hypotenuse);
	},
	
	getOppositeSideOfRectangleRight : function(angle, hypotenuse){
		return Math.abs(Math.sin(angle)*hypotenuse);
	},
	
	toDegree: function(radian){
		return radian*180/Math.PI;
		
	}
	
	
};

var SVG =
{
		svgns : 'http://www.w3.org/2000/svg',
		xlinkns : "http://www.w3.org/1999/xlink",

	createSVGCanvas: function(parentNode, attributes)
	{
		
		attributes.push( ['xmlns', SVG.svgns], ['xmlns:xlink', 'http://www.w3.org/1999/xlink']);
		var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
		this._setProperties(svg, attributes);
		parentNode.appendChild( svg);
		return svg;
		
	}, 
	
	createRectangle : function (x, y, width, height,  attributes){
				var rect = document.createElementNS(this.svgns, "rect");
				rect.setAttribute("x",x);		
				rect.setAttribute("y",y);	
				rect.setAttribute("width",width);		
				rect.setAttribute("height",height);	
				SVG._setProperties(rect, attributes);
				return rect;
	},
	
	drawImage64 : function (x, y, width, height, base64, svgNode, attributes) {
		var node = SVG.createImage64(x, y, width, height, base64, attributes);
		svgNode.appendChild(node);
		return node;
	},
	
	createImage64 : function (x, y, width, height, base64,  attributes)	{
				var img = document.createElementNS(this.svgns, "image");
				img.setAttribute("x",x);		
				img.setAttribute("y",y);	
				img.setAttribute("width",width);		
				img.setAttribute("height",height);	
				img.setAttribute("xlink:href",base64);	
				SVG._setProperties(img, attributes);
				return img;
	},
	
	createLine:  function (x1, y1, x2, y2, attributes){
				var line = document.createElementNS(this.svgns,"line");
				line.setAttribute("x1",x1);		
				line.setAttribute("y1",y1);	
				line.setAttribute("x2", x2);	
				line.setAttribute("y2", y2);
				SVG._setProperties(line, attributes);
				return line;
	},
	
	createClip:  function (id, nodeToClip, attributes){
				var clip = document.createElementNS(this.svgns,"clipPath");
				clip.setAttribute("id",id);
				clip.appendChild(nodeToClip);
				return clip;
	},
	
	drawClip : function (id, nodeToClip, svgNode) {
		var node = SVG.createClip(id, nodeToClip);
		svgNode.appendChild(node);
		return node;
	},

	drawRectangle : function (cx, cy, width, height, svgNode, attributes) {
		try{
			var node = SVG.createRectangle(cx, cy, width, height, attributes);
			svgNode.appendChild(node);
		}
		catch(e){
			
			console.log("-------------------- ");
			console.log("Error on drawRectangle " + e);
			console.log(attributes);
			console.log("-------------------- ");
		}
			return node;
	},
	
	createEllipse : function (x, y, rx, ry,  attributes){
				var rect = document.createElementNS(this.svgns, "ellipse");
				rect.setAttribute("cx",x);		
				rect.setAttribute("cy",y);
				rect.setAttribute("rx",rx);		
				rect.setAttribute("ry",ry);	
				SVG._setProperties(rect, attributes);
				return rect;
 	},
	
	drawEllipse : function (cx, cy, rx, ry, svgNode, attributes) {
		var node = SVG.createEllipse(cx, cy, rx, ry, attributes);
		svgNode.appendChild(node);
		return node;
	},
	
	drawImage : function (x, y, canvasSVG, attributes) {
				var image = document.createElementNS(this.svgns, "image");
				image.setAttribute("x",x);		
				image.setAttribute("y",y);		
				canvasSVG.appendChild(image);
				SVG._setProperties(image, attributes);
	},

	drawLine : function (x1, y1, x2, y2, nodeSVG, attributes) {
		try{
				var line = SVG.createLine(x1, y1, x2, y2, attributes);
				nodeSVG.appendChild(line);
		}catch(e){
		}
				return line;
	},
	
	
	 drawPath: function (d, nodeSVG, attributes) {
        var path = SVG.createPath(d, attributes);
        nodeSVG.appendChild(path);
        return path;
	},

	 createPoligon : function (points,  attributes){
        var poligon = document.createElementNS(this.svgns, "polygon");
        poligon.setAttribute("points",points);
        SVG._setProperties(poligon, attributes);
        return poligon;
    },
    
    drawPoligon : function (points,  canvasSVG, attributes){
    	var poligon = SVG.createPoligon(points, attributes);
    	canvasSVG.appendChild(poligon);
		return poligon;
    },
	//<polygon points="20,420, 300,420 160,20" />
	
	 createPath : function (d,  attributes){
         var path = document.createElementNS(this.svgns, "path");
         path.setAttribute("d",d);
         SVG._setProperties(path, attributes);
         return path;
     },

	drawCircle : function (x, y, radio, canvasSVG, attributes) {
	
				var newText = document.createElementNS(this.svgns,"circle");
				newText.setAttribute("cx",x);		
				newText.setAttribute("cy",y);	
				newText.setAttribute("r",radio);	
				
				canvasSVG.appendChild(newText);
				attributes["cursor"] = "pointer";
				this._setProperties(newText, attributes);	
				return newText;
	},
	
	
	_setProperties: function(node, attributes)
	{
		if (attributes instanceof Array){
				for (var i=0; i< attributes.length; i++)
				{
					node.setAttribute(attributes[i][0], attributes[i][1]);
				}
		}
		else{
			for ( var key in attributes){
				node.setAttribute(key, attributes[key]);
			}
		}
	},

/*	drawPath: function(pointsArray, canvasSVG, attributes){
				var path = document.createElementNS(this.svgns,"polyline");
				path.setAttribute ('id', id);
				
				var d= pointsArray[0].x+ " "+ pointsArray[0].y;
				for (var i=1; i< pointsArray.length; i++)
				{
						d=d+" "+pointsArray[i].x+" "+pointsArray[i].y; 
				}
				path.setAttribute ('points', d);
				canvasSVG.appendChild(path);
	},*/

	createText : function (x, y, text, attributes) {
				var node = document.createElementNS(this.svgns,"text");
				node.setAttributeNS(null , "x",x);		
				node.setAttributeNS(null, "y",y);	
				
				var textNode = document.createTextNode(text);
				node.appendChild(textNode);
				
				this._setProperties(node, attributes);
				return node;
	},
	
	drawText : function (x, y, text, canvasSVG, attributes) {
				var text = SVG.createText(x, y, text, attributes);
				canvasSVG.appendChild(text);
				return text;
	},



	drawGroup: function(svgNode, attributes)
	{
		 var group = SVG.createGroup(attributes);
		 svgNode.appendChild(group);
		 return group;
	},
			
	createGroup: function(attributes){
				var group = document.createElementNS(this.svgns,"g");
				this._setProperties(group, attributes);	
				return group;
	}
			
};



var CanvasToSVG = {
		
	convert: function(sourceCanvas, targetSVG, x, y, id, attributes) {
		
		var img = this._convert(sourceCanvas, targetSVG, x, y, id);
		
		for (var i=0; i< attributes.length; i++)
		{
			img.setAttribute(attributes[i][0], attributes[i][1]);
		}
	},
	
	_convert: function(sourceCanvas, targetSVG, x, y, id) {
		var svgNS = "http://www.w3.org/2000/svg";
		var xlinkNS = "http://www.w3.org/1999/xlink";
		// get base64 encoded png from Canvas
		var image = sourceCanvas.toDataURL();

		// must be careful with the namespaces
		var svgimg = document.createElementNS(svgNS, "image");

		svgimg.setAttribute('id', id);
	
		//svgimg.setAttribute('class', class);
		//svgimg.setAttribute('xlink:href', image);
		svgimg.setAttributeNS(xlinkNS, 'xlink:href', image);
		

		

		svgimg.setAttribute('x', x ? x : 0);
		svgimg.setAttribute('y', y ? y : 0);
		svgimg.setAttribute('width', sourceCanvas.width);
		svgimg.setAttribute('height', sourceCanvas.height);
		//svgimg.setAttribute('cursor', 'pointer');
		svgimg.imageData = image;
	
		targetSVG.appendChild(svgimg);
		return svgimg;
	},
	
	importSVG: function(sourceSVG, targetCanvas) {
	    svg_xml = sourceSVG;//(new XMLSerializer()).serializeToString(sourceSVG);
	    var ctx = targetCanvas.getContext('2d');

	    var img = new Image();
	    img.src = "data:image/svg+xml;base64," + btoa(svg_xml);
//	    img.onload = function() {
	        ctx.drawImage(img, 0, 0);
//	    };
	}
	
};
/*
Graph.prototype.importSVG = function(sourceSVG, targetCanvas) {
	sourceSVG = this._svg;
	targetCanvas = document.createElementNS('canvas'); 
    // https://developer.mozilla.org/en/XMLSerializer
    svg_xml = (new XMLSerializer()).serializeToString(sourceSVG);
    var ctx = targetCanvas.getContext('2d');
    // this is just a JavaScript (HTML) image
    var img = new Image();
    // http://en.wikipedia.org/wiki/SVG#Native_support
    // https://developer.mozilla.org/en/DOM/window.btoa
    img.src = "data:image/svg+xml;base64," + btoa(svg_xml);
    img.onload = function() {
        // after this, Canvas origin-clean is DIRTY
        ctx.drawImage(img, 0, 0);
    }
};
*/

/*

Normalizacion de datos para dibujar colores
Issues:
		No s como debera llamarse esta libreria
		No s si ya existe una funcion en javascript que lo haga


*/


var Normalizer = new function()
{
   this.normalizeArray = function (arrayData)
   {
	   
	   return this.standardizeArray(this.normal(arrayData));
	   
//	  var result = this._getMaxAndMin(arrayData);
//	  var min =result[0];
//	  var max = result[1];
//	
//
//	  //los hacemos todos positivos
//	  for (var i = 0; i< arrayData.length; i++)
//	  {
//		 arrayData[i]= Math.abs(min) + parseFloat(arrayData[i]);
//	  }
//	 
//	  var result = this._getMaxAndMin(arrayData);
//	  var min =result[0];
//	  var max = result[1];
//	  
//	  
//	  var resultArray = new Array();
//	  for (var i = 0; i< arrayData.length; i++)
//	  {
//		  resultArray.push(arrayData[i]*1/max);
//	  }
//	  return resultArray;
   };
   
   this.normal = function(arrayData){
		var mean = this._getMean(arrayData);
		var deviation = this._getStdDeviation(arrayData);
		var result = this._getMaxAndMin(arrayData);
		var min = result[0];
		var max = result[1];
		
		var resultArray = new Array();
	    for (var i = 0; i< arrayData.length; i++) {
	    	if (deviation!=0){
	    		resultArray.push((arrayData[i]-mean)/deviation);
	    	}else{
	    		resultArray.push(arrayData[i]);
	    	}
	    }
	    return resultArray;
   };

   this.standardizeArray = function(arrayData)
   {
		var result = this._getMaxAndMin(arrayData);
		var min = result[0];
		var max = result[1];
		
		var offset = ( min <= 0 ) ? Math.abs(min) : (-1 * min);
		var resultArray = new Array();
	    for (var i = 0; i< arrayData.length; i++) {
	    	if(max + offset!=0){
	    		resultArray.push((arrayData[i] + offset) / (max + offset));
	    	}else{
	    		resultArray.push(arrayData[i]+offset);
	    	}
	    }
	    return resultArray;
   };


   this._getMean = function(arrayData) {
		var sum = 0;
		for (var i = 0; i< arrayData.length; i++) {
			sum = sum + parseFloat(arrayData[i]);
		}
		return sum/arrayData.length;
	};
	
   this._getStdDeviation = function(arrayData) {
	   var mean = this._getMean(arrayData);
	   var acum = 0.0;
	   for(var i=0; i<arrayData.length; i++) {
		   acum += Math.pow(parseFloat(arrayData[i]) - mean, 2);
	   }
	   return Math.sqrt(acum/arrayData.length);
   };

   this._getMaxAndMin = function(arrayData){
	   var min = Number.MAX_VALUE;
	   var max = Number.MIN_VALUE;
	   
	   for (var i = 0; i< arrayData.length; i++){
		   if (arrayData[i] < min) min =  parseFloat(arrayData[i]);
		   
		   if (arrayData[i] > max) max =  parseFloat(arrayData[i]);
	   }
	   
	   return [min, max];
   };
};
function GraphCanvas(componentID, targetNode, args) {
	this.args = {};
	/** target */
	this.targetID = targetNode.id;

	/** id manage */
	this.id = componentID;
	this.args.idGraph = this.id + "main";
	this.args.idBackgroundNode = this.id + "background";

	this.args.idEdgesGraph = this.id + "edges";
	this.args.idNodesGraph = this.id + "vertices";
	this.args.idLabelGraph = this.id + "label";
	this.args.idBackground = this.id + "background";

	/** Objects Graph **/
	this.dataset = null;
	this.formatter = null;
	this.layout = null;

	/** Drawing **/
	this.circleDefaultRadius = 2;
	this.squareDefaultSide = this.circleDefaultRadius * 1.5;

	/** Directed Arrow **/
	this.arrowDefaultSize = this.circleDefaultRadius;

	/** Groups **/
	this.GraphGroup = null;
	this.GraphNodeGroup = null;
	this.GraphLabelGroup = null;
	this.GraphBackground = null;

	/** SETTINGS FLAGS **/
	this.args.draggingCanvasEnabled = false; //Flag to set if the canvas can be dragged
	this.args.multipleSelectionEnabled = false;
	this.args.interactive = false;
	this.args.labeled = false;
	this.args.linkEnabled = false;

	/** If numberEdge > maxNumberEdgesMoving then only it will move edges when mouse up **/
	this.args.maxNumberEdgesMoving = 3;
	this.args.maxNumberEdgesFiringEvents = 50;

	/** Linking edges **/
	this.args.linking = false;
	this.linkStartX = 0;
	this.linkStartY = 0;
	this.linkSVGNode = null;
	this.linkNodeSource = null;
	this.linkNodeTarget = null;

	/** Dragging Control **/
	this.draggingElement = null;
	this.dragging = false;
	this.nMouseOffsetX = 0;
	this.nMouseOffsetY = 0;
	this.dragStartX = 0;
	this.dragStartY = 0;
	this.desplazamientoX = 0;
	this.desplazamientoY = 0;

	/** Selection Control **/
	this.selecting = false;
	this.selectorX = null;
	this.selectorY = null;
	this.selectorSVGNode = null;

	/** Node status **/
	this.args.isVertexSelected = {};
	this.args.selectedVertices = [];

	/** Edges status **/
	this.args.isEdgeSelected = {};
	//this.args.selectedEdges = [];

	if (args != null) {
		if (args.multipleSelectionEnabled != null) {
			this.args.multipleSelectionEnabled = args.multipleSelectionEnabled;
			this.args.draggingCanvasEnabled = !(this.args.multipleSelectionEnabled);
		}
		if (args.draggingCanvasEnabled != null) {
			this.args.draggingCanvasEnabled = args.draggingCanvasEnabled;
			this.args.multipleSelectionEnabled = !(this.args.draggingCanvasEnabled);
		}
		if (args.interactive != null) {
			this.args.interactive = args.interactive;
		}
		if (args.labeled != null) {
			this.args.labeled = args.labeled;
		}

	}

	/** Hashmap with the svg node labels **/
	this.svgLabels = {};

	/** EVENTS **/
	this.onVertexOut = new Event(this);
	this.onVertexOver = new Event(this);
	this.onVertexSelect = new Event(this);
	this.onEdgeSelect = new Event(this);
	this.onCanvasClicked = new Event(this);
	this.onVertexUp = new Event(this);
}

GraphCanvas.prototype.showLabels = function(value) {
	this.args.labeled = value;
	this.removeLabels();
	if (value) {
		this.renderLabels();
	}
};

GraphCanvas.prototype.getSelectedVertices = function() {
	return this.args.selectedVertices;
};

GraphCanvas.prototype.getSelectedEdges = function() {
	var selected = [];
	for ( var selectedEdge in this.args.isEdgeSelected) {
		selected.push(selectedEdge);
	}
	return selected;
};

GraphCanvas.prototype.createSVGDom = function(targetID, id, width, height, backgroundColor) {
	var container = document.getElementById(targetID);
	this._svg = SVG.createSVGCanvas(container, [
		[ "style", "background-color:" + backgroundColor + ";" ], [ "id", id ], [ "dragx", 0 ], [ "dragy", 0 ],
		[ "height", this.getFormatter().getHeight() ], [ "width", this.getFormatter().getWidth() ] ]);
	return this._svg;
};

/** MULTIPLE SELECTION **/
GraphCanvas.prototype.isMultipleSelectionEnabled = function() {
	return this.args.multipleSelectionEnabled;
};

GraphCanvas.prototype.setMultipleSelection = function(value) {
	this.args.multipleSelectionEnabled = value;
	this.args.draggingCanvasEnabled = (!value);
};

GraphCanvas.prototype.setSelecting = function(value) {
	this.selecting = value;
};

/** linking **/
GraphCanvas.prototype.setLinking = function(value) {
	this.args.linkEnabled = value;
	this.selecting = !value;
	this.dragging = !value;
};

/** CANVAS MOVING **/
GraphCanvas.prototype.setDraggingCanvas = function(value) {
	this.args.draggingCanvasEnabled = value;
	this.args.multipleSelectionEnabled = !value;
};

GraphCanvas.prototype.isDraggingCanvasEnabled = function() {
	return this.args.draggingCanvasEnabled;
};
/** ZOOM **/
GraphCanvas.prototype.getScale = function() {
	return this.getFormatter().getZoomScale();
};

GraphCanvas.prototype.setScale = function(scale) {
	var graphNode = document.getElementById(this.args.idGraph);
	graphNode.setAttribute("transform", graphNode.getAttribute("transform").replace("scale(" + this.getScale() + ")", "scale(" + scale + ")"));
	this.getFormatter().setZoomScale(scale);
};

GraphCanvas.prototype.zoomIn = function() {
	this.setScale(this.getScale() + this.getFormatter().getZoomScaleStepFactor());
};

GraphCanvas.prototype.zoomOut = function() {
	this.setScale(this.getScale() - this.getFormatter().getZoomScaleStepFactor());

};

/** SVG COORDENATES **/
GraphCanvas.prototype.getSVGCoordenates = function(evt) {
	var p = this._svg.createSVGPoint();
	p.x = evt.clientX;
	p.y = evt.clientY;

	var m = this._svg.getScreenCTM(document.documentElement);
	p = p.matrixTransform(m.inverse());
	return p;
};

/** SVG EVENTS **/
GraphCanvas.prototype.mouseClick = function(event) {
	if (event.button == 0) {
		if (!this.args.interactive) {
			return;
		}

		if (this.isVertex(event.target)) {
			this.clickNode(this.getVertexIdFromSVGId(event.target.id));
		}
		/** Como el evento mouseClick viene despues del mouse up es aqui donde manejo el tema de deseccionar los elementos que estoy dragging **/
		if (this.dragging) {
			this.dragging = false;
		}
	}
};

GraphCanvas.prototype.mouseMove = function(evt) {
	if (this.selecting) {
		this.clearLabels();

		var width = (this.getSVGCoordenates(evt).x - this.selectorX);
		var height = (this.getSVGCoordenates(evt).y - this.selectorY);
		if ((width > 0) && (height > 0)) {
			this.displaySelection(this.selectorX, this.selectorY, width, height);
		}
		if ((width > 0) && (height < 0)) {
			this.displaySelection(this.selectorX, this.getSVGCoordenates(evt).y, width, Math.abs(height));
		}
		if ((width < 0) && (height < 0)) {
			this.displaySelection(this.getSVGCoordenates(evt).x, this.getSVGCoordenates(evt).y, Math.abs(width), Math.abs(height));
		}
		if ((width < 0) && (height > 0)) {
			this.displaySelection(this.selectorX + width, this.selectorY, Math.abs(width), Math.abs(height));
		}

		var x1 = (parseFloat(this.selectorSVGNode.getAttribute("x")) - DOM.select(this.id).getAttribute("dragx")) / this.getFormatter().getWidth();
		var y1 = (parseFloat(this.selectorSVGNode.getAttribute("y")) - DOM.select(this.id).getAttribute("dragy")) / this.getFormatter().getHeight();
		var x2 = (x1 + parseFloat(this.selectorSVGNode.getAttribute("width") / this.getFormatter().getWidth()));
		var y2 = (y1 + parseFloat(this.selectorSVGNode.getAttribute("height") / this.getFormatter().getHeight()));

		this.deselectNodes(this.getLayout());
		var verticesSelected = this.getLayout().getVerticesByArea(x1 / this.getFormatter().getZoomScale(), y1 / this.getFormatter().getZoomScale(),
				x2 / this.getFormatter().getZoomScale(), y2 / this.getFormatter().getZoomScale());
		for ( var i = 0; i < verticesSelected.length; i++) {
			this.selectNode(verticesSelected[i].getId());
			this.renderLabel(verticesSelected[i].getId());
		}

	}
	var p = null;
	if (this.args.linking) {
		p = this.getSVGCoordenates(evt);
		if (this.linkSVGNode != null) {
			this.linkSVGNode.setAttribute("x2", p.x - 2);
			this.linkSVGNode.setAttribute("y2", p.y - 2);
		}
	}

	if (this.dragging) {
		p = this.getSVGCoordenates(evt);
		p.x -= this.nMouseOffsetX;
		p.y -= this.nMouseOffsetY;
		this.desplazamientoX = (this.getSVGCoordenates(evt).x - this.dragStartX);//  + parseFloat(DOM.select(this.id).getAttribute("dragx"));
		this.desplazamientoY = (this.getSVGCoordenates(evt).y - this.dragStartY);//  + parseFloat(DOM.select(this.id).getAttribute("dragy"));

		if (this.draggingElement != null) {
			/** Click sobre el recct del banground que provoca que mueva todo el canvas **/
			if (this.isNodeCanvas(this.draggingElement)) {

				p = this.getSVGCoordenates(evt);
				p.x = this.desplazamientoX;
				p.y = this.desplazamientoY;

				this.draggingElement.setAttribute("dragx", p.x);
				this.draggingElement.setAttribute("dragy", p.y);
				this.draggingElement = document.getElementById(this.args.idGraph);
				this.draggingElement.setAttribute("transform", "translate(" + p.x + "," + p.y + "), scale(" + this.getScale() + ")");

				DOM.select(this.id).setAttribute("dragx", p.x);
				DOM.select(this.id).setAttribute("dragy", p.y);

				if (this.NodeSVGbackgroundImage != null) {
					this.NodeSVGbackgroundImage.setAttribute("dragx", p.x);
					this.NodeSVGbackgroundImage.setAttribute("dragy", p.y);
				}
			} else {
				if (this.isVertex(this.draggingElement)) {
					this.selectNode(this.getVertexIdFromSVGId(this.draggingElement.id));
					this.desplazamientoX = this.desplazamientoX / this.getFormatter().getZoomScale();
					this.desplazamientoY = this.desplazamientoY / this.getFormatter().getZoomScale();
					this.moveSelectedNodes(this.desplazamientoX, this.desplazamientoY);

					this.dragStartX = this.getSVGCoordenates(evt).x;
					this.dragStartY = this.getSVGCoordenates(evt).y;
				} else {
					if (this.isNodeBackground(this.draggingElement)) {

						this.draggingElement.setAttribute("dragx", p.x);
						this.draggingElement.setAttribute("dragy", p.y);
						this.draggingElement = document.getElementById(this.args.idGraph);
						this.draggingElement.setAttribute("transform", "translate(" + p.x + "," + p.y + "), scale(" + this.getScale() + ")");
					} else {
						this.draggingElement.setAttribute("transform", "translate(" + p.x + "," + p.y + ")");
					}
				}
			}
		}
	}
};

GraphCanvas.prototype.moveSelectedNodes = function(offsetX, offsetY) {
	for ( var i = 0; i < this.getSelectedVertices().length; i++) {

		var nodeId = this.getSelectedVertices()[i];
		var svgNodeId = this.getSVGNodeId(nodeId);

		var x = parseFloat(DOM.select(svgNodeId).getAttribute("dragx")) + parseFloat(offsetX);// -   parseFloat(DOM.select(this.id).getAttribute("dragx"));
		var y = parseFloat(DOM.select(svgNodeId).getAttribute("dragy")) + parseFloat(offsetY);// +   parseFloat(DOM.select(this.id).getAttribute("dragy"));

		this._movingNode(DOM.select(svgNodeId), x, y);
	}
};

GraphCanvas.prototype.mouseDown = function(evt) {
	if (event.button == 0) {

		/** if !no interactive mouse events do anything **/
		if (!this.args.interactive) {
			return;
		}

		var p = this.getSVGCoordenates(evt);

		/** When click on canvas or background deselect all **/
		if (this.isNodeCanvas(evt.target) || this.isNodeBackground(evt.target)) {
			this.deselectNodes();
			this.deselectEdges();
			this.onCanvasClicked.notify();
		}

		/** if I am linking vertices **/
		if (this.args.linkEnabled) {

			if (!this.args.linking) {
				this.args.linking = true;
				if (this.isVertex(evt.target)) {
					this.linkStartX = p.x;
					this.linkStartY = p.y;
					this.linkSVGNode = SVG.drawLine(p.x, p.y, p.x, p.y, this._svg, {
						"stroke" : "#FF0000"
					});
					this.linkNodeSource = this.getVertexIdFromSVGId(evt.target.id);
				}
			} else {
				this.linkNodeTarget = this.getVertexIdFromSVGId(evt.target.id);
				this.args.linking = false;
				this.args.linkEnabled = false;
				if (this.isVertex(evt.target)) {
					this.getDataset().addEdge(this.linkNodeSource + "_" + this.linkNodeTarget, this.linkNodeSource, this.linkNodeTarget, {});
				}
				this.linkSVGNode.parentNode.removeChild(this.linkSVGNode);
			}
			return;
		}

		/** Id is a vertex or the canvas **/
		if (this.isVertex(evt.target) || this.isNodeCanvas(evt.target) || this.isNodeBackground(evt.target)) {
			this._startDragging(evt);
		}
		/** if i is  edge **/
		if (this.isEdge(evt.target)) {
			this.selectEdge(this.getEdgeIdFromSVGId(evt.target.getAttribute("id")));
		}

		if (this.args.multipleSelectionEnabled) {
			if (!this.dragging) {
				this.setSelecting(true);
				this.selectorX = p.x;
				this.selectorY = p.y;
				this.displaySelection(p.x, p.y, 1, 1);
			}
		}

	}
	if (event.button == 1) {
		this.setLinking(false);
		this.setMultipleSelection(false);
		this.selecting = false;

		/** Id is a vertex or the canvas **/
		if (this.isVertex(evt.target) || this.isNodeCanvas(evt.target) || this.isNodeBackground(evt.target)) {
			this._startDragging(evt);
		}
	}
};

GraphCanvas.prototype.mouseUp = function(event) {
	if (!this.args.interactive) {
		return;
	}

	if (this.dragging) {
		this._stopDragging(event);
		if (this.isVertex(event.target)) {
			var vertexId = this.getVertexIdFromSVGId(event.target.id);
			if (this.getDataset().getVertexById(vertexId).getEdges().length >= this.args.maxNumberEdgesMoving) {
				this.moveEdge(vertexId);
			}
		}
	}

	if (this.selecting) {
		this.setSelecting(false);

		var x1 = (parseFloat(this.selectorSVGNode.getAttribute("x")) - DOM.select(this.id).getAttribute("dragx")) / this.getFormatter().getWidth();
		var y1 = (parseFloat(this.selectorSVGNode.getAttribute("y")) - DOM.select(this.id).getAttribute("dragy")) / this.getFormatter().getHeight();
		var x2 = (x1 + parseFloat(this.selectorSVGNode.getAttribute("width") / this.formatter.getWidth()));
		var y2 = (y1 + parseFloat(this.selectorSVGNode.getAttribute("height") / this.formatter.getHeight()));

		var verticesSelected = this.getLayout().getVerticesByArea(x1 / this.getFormatter().getZoomScale, y1 / this.getFormatter().getZoomScale,
				x2 / this.getFormatter().getZoomScale, y2 / this.getFormatter().getZoomScale);

		for ( var i = 0; i < verticesSelected.length; i++) {
			this.selectNode(verticesSelected[i].getId());
		}

		if (this.selectorSVGNode != null) {
			this._svg.removeChild(this.selectorSVGNode);
		}

		if (this.args.labeled) {
			this.clearLabels();
			this.renderLabels();
		}

		this.selectorSVGNode = null;
		//		this.renderLabels();
	}
};

/** SELECTION **/
GraphCanvas.prototype.displaySelection = function(x, y, width, height) {
	if (this.selectorSVGNode != null) {
		this.selectorSVGNode.setAttribute("x", x);
		this.selectorSVGNode.setAttribute("y", y);
		this.selectorSVGNode.setAttribute("width", width);
		this.selectorSVGNode.setAttribute("height", height);
	} else {
		this.selectorSVGNode = SVG.drawRectangle(x, y, width, height, this._svg, {
			"fill" : "red",
			"stroke" : "black",
			"opacity" : "0.2",
			"stroke-opacity" : "1"
		});
	}
};

/** DRAGGING **/
GraphCanvas.prototype._startDragging = function(evt) {
	if (!this.isDraggingCanvasEnabled()) {
		if (this.isNodeCanvas(evt.target)) {
			this.draggingElement = null;
		}
	}

	if (this.isVertex(evt.target) || (this.isNodeBackground(evt.target) && (this.isDraggingCanvasEnabled()))|| (this.isNodeCanvas(evt.target) && (this.isDraggingCanvasEnabled()))) {
		this.clearLabels();
		this.draggingElement = evt.target;
		this.dragging = true;
		var p = this.getSVGCoordenates(evt);

		this.nMouseOffsetX = p.x - parseInt(evt.target.getAttribute("dragx"));
		this.nMouseOffsetY = p.y - parseInt(evt.target.getAttribute("dragy"));

		if (this.isVertex(evt.target)) {
			this.dragStartX = parseInt(this.draggingElement.getAttribute("dragx")) * this.getFormatter().getZoomScale()
					+ parseFloat(DOM.select(this.id).getAttribute("dragx"));
			this.dragStartY = parseInt(this.draggingElement.getAttribute("dragy")) * this.getFormatter().getZoomScale()
					+ parseFloat(DOM.select(this.id).getAttribute("dragy"));
		} else {
			this.dragStartX = p.x - parseInt(this.draggingElement.getAttribute("dragx"));// + parseFloat(DOM.select(this.id).getAttribute("dragx"));
			this.dragStartY = p.y - parseInt(this.draggingElement.getAttribute("dragy"));// + parseFloat(DOM.select(this.id).getAttribute("dragy"));
		}
	}
};

GraphCanvas.prototype._stopDragging = function(event) {
	this.nMouseOffsetX = 0;
	this.nMouseOffsetX = 0;
	/** despues del evento up viene el evento click entonces acabo el dragging en el mouseclick **/
	this.dragging = false;
	this.draggingElement = null;
	this.renderLabels();

	this.setLinking(false);
	this.setMultipleSelection(true);
	this.selecting = false;

};

/** Move the edges of the vertex with the vertexId indicado **/
GraphCanvas.prototype.moveEdge = function(vertexId) {
	var x = this.getLayout().getNodeById(vertexId).x * this.getFormatter().getWidth();
	var y = this.getLayout().getNodeById(vertexId).y * this.getFormatter().getHeight();

	/** Moving edges out **/
	for ( var i = 0; i < this.getDataset().getVertexById(vertexId).getEdgesOut().length; i++) {
		var edgeId = this.getDataset().getVertexById(vertexId).getEdgesOut()[i].getId();
		var svgEdgeId = this.getSVGEdgeId(edgeId);
		var edgeFormatter = this.getFormatter().getEdgeById(edgeId);
		if (edgeFormatter instanceof LineEdgeGraphFormatter) {
			DOM.select(svgEdgeId + "_shadow").setAttribute("x2", x);
			DOM.select(svgEdgeId + "_shadow").setAttribute("y2", y);
			DOM.select(svgEdgeId).setAttribute("x2", x);
			DOM.select(svgEdgeId).setAttribute("y2", y);
		}

		if ((edgeFormatter instanceof DirectedLineEdgeGraphFormatter) || (edgeFormatter instanceof OdirectedLineEdgeGraphFormatter)
				|| (edgeFormatter instanceof OdotDirectedLineEdgeGraphFormatter) || (edgeFormatter instanceof DotDirectedLineEdgeGraphFormatter)
				|| (edgeFormatter instanceof CutDirectedLineEdgeGraphFormatter)) {
			this.removeEdge(edgeId);
			this.renderEdge(edgeId);
		}
	}

	/** Moving edges in **/
	for ( var i = 0; i < this.getDataset().getVertexById(vertexId).getEdgesIn().length; i++) {
		var edgeId = this.getDataset().getVertexById(vertexId).getEdgesIn()[i].getId();
		var svgEdgeId = this.getSVGEdgeId(edgeId);
		var edgeFormatter = this.getFormatter().getEdgeById(edgeId);
		if (edgeFormatter instanceof LineEdgeGraphFormatter) {
			DOM.select(svgEdgeId).setAttribute("x1", x);
			DOM.select(svgEdgeId).setAttribute("y1", y);
			DOM.select(svgEdgeId + "_shadow").setAttribute("x1", x);
			DOM.select(svgEdgeId + "_shadow").setAttribute("y1", y);
		}

		if ((edgeFormatter instanceof DirectedLineEdgeGraphFormatter) || (edgeFormatter instanceof OdirectedLineEdgeGraphFormatter)
				|| (edgeFormatter instanceof OdotDirectedLineEdgeGraphFormatter) || (edgeFormatter instanceof DotDirectedLineEdgeGraphFormatter)
				|| (edgeFormatter instanceof CutDirectedLineEdgeGraphFormatter)) {
			this.removeEdge(edgeId);
			this.renderEdge(edgeId);
		}

		if (edgeFormatter instanceof BezierEdgeGraphFormatter) {
			var radius = this.getFormatter().getVertexById(vertexId).getDefault().getSize() * this.getFormatter().getNodesMaxSize();
			var d = this.calculateCoordenatesBezier(radius, x, y);
			DOM.select(svgEdgeId).setAttribute("d", d);
		}
	}
};

GraphCanvas.prototype.moveNode = function(vertexId) {
	var x = this.getLayout().getNodeById(vertexId).x * this.getFormatter().getWidth();
	var y = this.getLayout().getNodeById(vertexId).y * this.getFormatter().getHeight();
	var svgNodeElement = DOM.select(this.getSVGNodeId(vertexId));

	svgNodeElement.setAttribute("dragx", x);
	svgNodeElement.setAttribute("dragy", y);
	svgNodeElement.setAttribute("transform", "translate(" + x + "," + y + ")");

	if (this.getDataset().getVertexById(vertexId).getEdges().length < this.args.maxNumberEdgesMoving) {
		this.moveEdge(vertexId);
	}
};

GraphCanvas.prototype._movingNode = function(svgNodeElement, x, y) {
	var vertexId = this.getVertexIdFromSVGId(svgNodeElement.getAttribute("id"));
	this.getLayout().getNodeById(vertexId).setCoordinates(x / this.getFormatter().getWidth(), y / this.getFormatter().getHeight());
	this.desplazamientoX = 0;
	this.desplazamientoY = 0;
	this.removeLabel(vertexId);
	this.renderLabel(vertexId);
};

/** INIT **/
GraphCanvas.prototype.init = function() {

	this._svg = this.createSVGDom(this.targetID, this.id, this.getFormatter().getWidth(), this.getFormatter().getHeight(), this.getFormatter()
			.getBackgroundColor());
	this.GraphGroup = SVG.drawGroup(this._svg, [ [ "id", this.args.idGraph ], [ "transform", "translate(0,0), scale(1)" ] ]);
	this.GraphBackground = SVG.drawGroup(this.GraphGroup, [ [ "id", this.args.idBackground ] ]);
	this.GraphEdgeGroup = SVG.drawGroup(this.GraphGroup, [ [ "id", this.args.idEdgesGraph ] ]);
	this.GraphNodeGroup = SVG.drawGroup(this.GraphGroup, [ [ "id", this.args.idNodesGraph ] ]);
	this.GraphLabelGroup = SVG.drawGroup(this.GraphGroup, [ [ "id", this.args.idLabelGraph ] ]);

	if ((this.getFormatter().getBackgroundImage() != null) && (this.getFormatter().getBackgroundImage() != "")) {
		this.setBackgroundImage(this.getFormatter().getBackgroundImage());
	}
	/** SVG Events listener */
	var _this = this;
	this._svg.addEventListener("click", function(event) {
		_this.mouseClick(event);
	}, false);
	this._svg.addEventListener("mousemove", function(event) {
		_this.mouseMove(event, _this);
	}, false);
	this._svg.addEventListener("mousedown", function(event) {
		_this.mouseDown(event, _this);
	}, false);
	this._svg.addEventListener("mouseup", function(event) {
		_this.mouseUp(event, _this);
	}, false);
};

/*
 GraphCanvas.prototype.backgroungToSVG = function(){
 var _this = this;
 var canvas = document.createElement('canvas');
 canvas.setAttribute("id", "canvas");
 canvas.width = this.formatter.getWidth();
 canvas.height = this.formatter.getHeight();

 this._svg.parentNode.parentNode.appendChild(canvas);
 var ctx = document.getElementById('canvas').getContext('2d');
 var img = new Image();

 img.src = this.formatter.getBackgroundImage();
 ctx.drawImage(img,0,0 ,_this.formatter.getWidth(), _this.formatter.getHeight()); 


 img.onload  = function() { 
 canvas.parentNode.removeChild(canvas);
 }

 this.NodeSVGbackgroundImage.setAttribute("xlink:href", document.getElementById("canvas").toDataURL());
 this.NodeSVGbackgroundImage.removeAttribute("href");

 //

 };*/

GraphCanvas.prototype.setBackgroundImage = function() {
	if (this.NodeSVGbackgroundImage != null) {
		this.NodeSVGbackgroundImage.parentNode.removeChild(this.NodeSVGbackgroundImage);
	}
	$('#' + this.targetID).svg();
	$('#' + this.targetID).svg("get");

	$('#' + this.targetID).svg("get")._svg = document.getElementById(this.id);

	var svg = $('#' + this.targetID).svg("get");
	this.NodeSVGbackgroundImage = svg.image(0, 0, this.getFormatter().getWidth(), this.getFormatter().getHeight(), this.getFormatter()
			.getBackgroundImage());
	this.NodeSVGbackgroundImage.setAttribute("id", this.args.idBackgroundNode);

	this.NodeSVGbackgroundImage.setAttribute("x", 0);
	this.NodeSVGbackgroundImage.setAttribute("y", 0);

	this.NodeSVGbackgroundImage.setAttribute("dragx", 0);
	this.NodeSVGbackgroundImage.setAttribute("dragy", 0);

	if (this.getFormatter().args.backgroundImageHeight != null) {
		this.NodeSVGbackgroundImage.setAttribute("height", this.getFormatter().args.backgroundImageHeight);
	}
	if (this.getFormatter().args.backgroundImageWidth != null) {
		this.NodeSVGbackgroundImage.setAttribute("width", this.getFormatter().args.backgroundImageWidth);
	}

	if (this.getFormatter().args.backgroundImageX != null) {
		this.NodeSVGbackgroundImage.setAttribute("x", this.getFormatter().args.backgroundImageX);
	}
	if (this.getFormatter().args.backgroundImageY != null) {
		this.NodeSVGbackgroundImage.setAttribute("y", this.getFormatter().args.backgroundImageY);
	}

	this.GraphBackground.appendChild(this.NodeSVGbackgroundImage);
	this.NodeSVGbackgroundImage.removeAttribute("href");
	this.NodeSVGbackgroundImage.setAttribute("xlink:href", this.getFormatter().getBackgroundImage());
};

GraphCanvas.prototype.removeBackgroundImage = function() {
	if (this.NodeSVGbackgroundImage != null) {
		this.NodeSVGbackgroundImage.parentNode.removeChild(this.NodeSVGbackgroundImage);
	}
};

GraphCanvas.prototype._setBackgroundColor = function(color) {
	var attributes = [ [ "fill", color ] ];
	SVG.drawRectangle(0, 0, this.getFormatter().getWidth(), this.getFormatter().getHeight(), this.GraphBackground, attributes);
};

/** Serialize **/
GraphCanvas.prototype.toJSON = function() {
	var json = {};
	json.dataset = {};
	json.formatter = {};
	json.layout = {};
	json.dataset = this.getDataset().toJSON();
	json.formatter = this.getFormatter().toJSON();
	json.layout = this.getLayout().toJSON();
	return json;
};

GraphCanvas.prototype.toHTML = function() {
	//this.backgroungToSVG();
	var html = this._svg.parentElement.innerHTML;

	var start = html.indexOf("<svg");
	var end = html.indexOf("</svg>") + 6;

	return html.substr(start, end);
};

/** DRAW **/
GraphCanvas.prototype.draw = function(graphdataset, graphformatter, graphlayout) {
	this.setDataset(graphdataset);
	this.setFormatter(graphformatter);
	this.setLayout(graphlayout);

	var _this = this;
	this.getFormatter().changed.attach(function(sender, item) {
		_this.removeNode(item.getId());
		_this.renderNode(item.getId());
		if (_this.args.labeled) {
			_this.removeLabel(item.getId());
			_this.renderLabel(item.getId());
		}

	});
	//TODO
	this.getFormatter().edgeChanged.attach(function(sender, item) {
		_this.removeEdge(item.getId());
		_this.renderEdge(item.getId());
	});

	this.getFormatter().resized.attach(function(sender, item) {
		_this.resize(_this.getFormatter().getWidth(), _this.getFormatter().getHeight());
	});

	this.getFormatter().backgroundImageChanged.attach(function(sender, item) {
		_this.setBackgroundImage(_this.getFormatter().getBackgroundImage());
	});

	this.getFormatter().backgroundColorChanged.attach(function(sender, item) {
		_this._setBackgroundColor(_this.getFormatter().getBackgroundColor());
	});

	this.getLayout().changed.attach(function(sender, item) {
		_this.moveNode(item.getId());
		_this.moveEdge(item.getId());
		if (_this.args.labeled) {
			_this.removeLabel(item.getId());
			_this.renderLabel(item.getId());
		}
	});

	this.getDataset().newVertex.attach(function(sender, item) {

		_this.renderNode(item.getId());
		if (_this.args.labeled) {
			_this.renderLabel(item.getId());
		}
	});

	this.getDataset().newEdge.attach(function(sender, item) {
		_this.renderEdge(item.getId());
	});

	this.getDataset().vertexDeleted.attach(function(sender, item) {
		_this.removeNode(item.getId());
		if (_this.args.labeled) {
			_this.removeLabel(item.getId());
		}
	});

	this.getDataset().edgeDeleted.attach(function(sender, item) {
		_this.removeEdge(item.getId());
	});

	this.getDataset().vertexNameChanged.attach(function(sender, args) {
		if (_this.args.labeled) {
			_this.removeLabel(args.item.getId());
			_this.removeLabel(args.item.getId());
			_this.renderLabel(args.item.getId());
		}
	});
	this.init();
	this.render();
};

GraphCanvas.prototype.render = function() {
	for ( var id in this.getDataset().getVertices()) {
		this.renderNode(id);
	}
	this.renderLabels();
	this.renderEdges();
};

GraphCanvas.prototype.renderLabels = function() {
	if (this.args.labeled) {
		for ( var id in this.getDataset().getVertices()) {
			this.renderLabel(id);
		}
	}
};

GraphCanvas.prototype.removeLabels = function() {
	for ( var id in this.getDataset().getVertices()) {
		this.removeLabel(id);
	}
};

/** Utilities method for nodes **/
GraphCanvas.prototype.isNodeCanvas = function(node) {
	return ((node.id == this.args.idGraph) || (node.id == this.id));
};

GraphCanvas.prototype.isNodeBackground = function(node) {
	return ((node.id == this.args.idBackgroundNode));
};

GraphCanvas.prototype.isVertex = function(node) {
	if (node.getAttribute("id") != null) {
		if (node.getAttribute("id").indexOf("_v_") != -1) {
			return true;
		}
	}
	return false;
};

GraphCanvas.prototype.isLabel = function(node) {
	if (node.getAttribute("id") != null) {
		if (node.getAttribute("id").indexOf("_l_") != -1) {
			return true;
		}
	}
	return false;
};

GraphCanvas.prototype.isEdge = function(node) {
	if (node.getAttribute("id") != null) {
		if (node.getAttribute("id").indexOf("_e_") != -1) {
			return true;
		}
	}
	return false;
};

/** Resize **/
GraphCanvas.prototype.resize = function(width, height) {
	//	this._svg.setAttribute("width", width);
	//	this._svg.setAttribute("height", height);
	if (this.NodeSVGbackgroundImage != null) {
		this.NodeSVGbackgroundImage.setAttribute("width", width);
		this.NodeSVGbackgroundImage.setAttribute("height", height);
	}

	this._svg.setAttribute("width", width);
	this._svg.setAttribute("height", height);

	this.clearCanvas();
	this.render();
};

GraphCanvas.prototype.clearCanvas = function() {
	DOM.removeChilds(this.GraphEdgeGroup.getAttribute("id"));
	DOM.removeChilds(this.GraphNodeGroup.getAttribute("id"));
	this.clearLabels();
};

GraphCanvas.prototype.clearLabels = function() {
	DOM.removeChilds(this.GraphLabelGroup.getAttribute("id"));
};

/** ID'S converter **/
GraphCanvas.prototype.getSVGNodeId = function(nodeId) {
	return this.id + "_v_" + nodeId;
};

GraphCanvas.prototype.getSVGEdgeId = function(edgeId) {
	return this.id + "_e_" + edgeId;
};

GraphCanvas.prototype.getSVGArrowEdgeId = function(edgeId) {
	return this.id + "_arrow_" + edgeId;
};

GraphCanvas.prototype.getSVGLabelId = function(edgeId) {
	return this.id + "_l_" + edgeId;
};

GraphCanvas.prototype.blinkVertexById = function(vertexId) {
	$("#" + this.getSVGNodeId(vertexId)).fadeIn().fadeOut().fadeIn().fadeOut().fadeIn().fadeOut();
};

GraphCanvas.prototype.getVertexIdFromSVGId = function(svgVertexId) {
	return svgVertexId.replace(this.id, "").replace("_v_", "");
};

GraphCanvas.prototype.getEdgeIdFromSVGId = function(svgEdgeId) {
	return svgEdgeId.replace(this.id, "").replace("_e_", "");
};

/** VERTEX **/
GraphCanvas.prototype.getVertexById = function(id) {
	return document.getElementById(this.getSVGNodeId(id));
};

GraphCanvas.prototype.renderNodes = function() {
	for ( var id in this.getDataset().getVertices()) {
		this.renderNode(id);
	}
};

GraphCanvas.prototype.overNode = function(nodeId) {
	if (!this.args.interactive) {
		return;
	}
	/** If selected we don't change the format **/
	if (this.args.isVertexSelected[nodeId] == null) {
		var args = this.getFormatter().getVertexById(nodeId).getOver();
		args.args["cursor"] = 'pointer';
		this.changeVertexFormat(nodeId, args);
	}
};

GraphCanvas.prototype.outNode = function(nodeId) {
	if (!this.args.interactive) {
		return;
	}

	/** If selected we don't change the format **/
	if (this.args.isVertexSelected[nodeId] == null) {
		this.changeVertexFormat(nodeId, this.getFormatter().getVertexById(nodeId).getDefault());
	}
};

GraphCanvas.prototype.overLabel = function(nodeId) {
	this.overNode(nodeId);
	//	this.svgLabels[nodeId].setAttribute("cursor", "pointer");
};

GraphCanvas.prototype.outLabel = function(nodeId) {
	this.outNode(nodeId);
	//	this.svgLabels[nodeId].setAttribute("cursor", "");
};

GraphCanvas.prototype.clickNode = function(nodeId) {
	if (!this.args.interactive) {
		return;
	}

	/** si el evento se dispara oprque estaba dragging entonces no activo nada **/
	if (this.args.isVertexSelected[nodeId] == null) {
		this.selectNode(nodeId);
	} else {
		this.deselectNode(nodeId);
	}
};

GraphCanvas.prototype.selectNode = function(nodeId) {
	for ( var i = 0; i < this.args.selectedVertices.length; i++) {
		var format = this.getFormatter().getVertexById(nodeId).getSelected();
		format.opacity = 0.2;
		this.changeVertexFormat(nodeId, this.getFormatter().getVertexById(nodeId).getSelected());
	}

	if (this.args.isVertexSelected[nodeId] == null) {
		var format = this.getFormatter().getVertexById(nodeId).getSelected();
		format.opacity = 1;
		this.changeVertexFormat(nodeId, this.getFormatter().getVertexById(nodeId).getSelected());
		this.args.selectedVertices.push(nodeId);
		this.args.isVertexSelected[nodeId] = this.args.selectedVertices.length - 1;
		this.onVertexSelect.notify(nodeId);
	}
};

GraphCanvas.prototype.selectAllEdges = function() {
	this.deselectNodes();
	this.deselectEdges();

	for ( var edgesId in this.getDataset().edges) {
		this.selectEdge(edgesId);
	}
};

GraphCanvas.prototype.selectAllNodes = function() {
	this.deselectNodes();
	this.deselectEdges();

	for ( var vertexId in this.getDataset().vertices) {
		this.selectNode(vertexId);
	}
};

GraphCanvas.prototype.selectAll = function() {
	this.deselectNodes();
	this.deselectEdges();

	for ( var vertexId in this.getDataset().vertices) {
		this.selectNode(vertexId);
	}

	for ( var edgesId in this.getDataset().edges) {
		this.selectEdge(edgesId);
	}
};

GraphCanvas.prototype.selectEdge = function(edgeId) {
	if (this.args.isEdgeSelected[edgeId] == null) {
		this.changeEdgeFormat(edgeId, this.getFormatter().getEdgeById(edgeId).getSelected());
		//this.args.selectedEdges.push(edgeId);
		this.args.isEdgeSelected[edgeId] = true; //this.args.selectedEdges.length - 1;
		this.onEdgeSelect.notify(edgeId);
	}
};

GraphCanvas.prototype.selectEdges = function(edges) {

	for ( var i = 0; i < edges.length; i++) {
		this.selectEdge(edges[i]);
	}
};

GraphCanvas.prototype.deselectNode = function(nodeId) {
	if (this.args.isVertexSelected[nodeId] != null) {
		this.changeVertexFormat(nodeId, this.getFormatter().getVertexById(nodeId).getDefault());
		this.args.selectedVertices.splice(this.args.isVertexSelected[nodeId], 1);
		var index = this.args.isVertexSelected[nodeId];
		delete this.args.isVertexSelected[nodeId];

		for ( var vertex in this.args.isVertexSelected) {
			if (this.args.isVertexSelected[vertex] > index) {
				this.args.isVertexSelected[vertex] = this.args.isVertexSelected[vertex] - 1;
			}
		}
	}
};

GraphCanvas.prototype.deselectNodes = function() {
	var selected = JSON.parse(JSON.stringify(this.getSelectedVertices()));
	for ( var i = 0; i < selected.length; i++) {
		this.deselectNode(selected[i]);
	}
};
GraphCanvas.prototype.selectNodes = function(idNodes) {

	for ( var i = 0; i < idNodes.length; i++) {
		this.selectNode(idNodes[i]);
	}

	//	for ( var vertex in this.args.isVertexSelected) {
	//		if (this.args.isVertexSelected[vertex] > index){
	//			this.args.isVertexSelected[vertex] = this.args.isVertexSelected[vertex] - 1;
	//		}
	//	}

};

GraphCanvas.prototype.changeVertexFormat = function(nodeId, format) {
	var svgNode = DOM.select(this.getSVGNodeId(nodeId));
	if (svgNode != null) {
		var properties = format.toJSON();
		for ( var item in properties) {
			svgNode.setAttribute(item, properties[item]);
		}

		if (this.getFormatter().getVertexById(nodeId) instanceof CircleVertexGraphFormatter) {
			var transform = "translate(" + svgNode.getAttribute("dragx") + "," + svgNode.getAttribute("dragy") + "), scale(" + format.getSize() + ")";
			svgNode.setAttribute("transform", transform);
		}
	}
};

GraphCanvas.prototype.renderLabel = function(nodeId) {
	var x = Math.ceil(this.getLayout().getNodeById(nodeId).x * this.getFormatter().getWidth());
	var y = Math.ceil(this.getLayout().getNodeById(nodeId).y * this.getFormatter().getHeight());

	var svgAttributesNode = JSON.parse(JSON.stringify(this.getFormatter().getVertexById(nodeId).getDefault().toJSON().title));
	svgAttributesNode.id = this.getSVGLabelId(this.getDataset().getVertexById(nodeId).getId());
	svgAttributesNode.dx = (-1) * (this.getDataset().getVertexById(nodeId).getName().length * svgAttributesNode["font-size"]) / 4 - 4;

	svgAttributesNode.dy = parseFloat((this.getFormatter().getVertexById(nodeId).getDefault().getSize()))
			+ parseFloat(svgAttributesNode["font-size"]) + parseFloat(this.getFormatter().getVertexById(nodeId).getDefault().getStrokeWidth()) - 4;
	svgAttributesNode.dragx = Math.ceil(this.getLayout().getNodeById(nodeId).x * this.getFormatter().getWidth());

	var gragy = parseFloat(this.getFormatter().getVertexById(nodeId).getDefault().getSize())
			+ Math.ceil(this.getLayout().getNodeById(nodeId).y * this.getFormatter().getHeight());
	svgAttributesNode.dragy = gragy;
	svgAttributesNode.transform = "translate(" + svgAttributesNode.dragx + "," + svgAttributesNode.dragy + ")";//, scale("+this.formatter.getVertexById(nodeId).getDefault().getSize()+")";

	var nodeSVG = SVG.drawText(0, 0, this.getDataset().getVertexById(nodeId).getName(), this.GraphLabelGroup, svgAttributesNode);

	this.svgLabels[nodeId] = nodeSVG;

	/** Events for the SVG node **/
	var _this = this;
	if (nodeSVG != null) {
		nodeSVG.addEventListener("mouseover", function() {
			_this.overLabel(nodeId);
		}, false);
		nodeSVG.addEventListener("mouseout", function() {
			_this.outLabel(nodeId);
		}, false);
	}

};

GraphCanvas.prototype.removeLabel = function(labelId) {
	if (DOM.select(this.getSVGLabelId(labelId)) != null) {
		DOM.select(this.getSVGLabelId(labelId)).parentNode.removeChild(DOM.select(this.getSVGLabelId(labelId)));
	}
};

GraphCanvas.prototype.renderNode = function(nodeId) {
	var svgAttributesNode = JSON.parse(JSON.stringify(this.getFormatter().getVertexById(nodeId).getDefault().toJSON()));
	svgAttributesNode.dragx = Math.ceil(this.getLayout().getNodeById(nodeId).x * this.getFormatter().getWidth());
	svgAttributesNode.dragy = Math.ceil(this.getLayout().getNodeById(nodeId).y * this.getFormatter().getHeight());
	svgAttributesNode.transform = "translate(" + svgAttributesNode.dragx + "," + svgAttributesNode.dragy + ")";
	svgAttributesNode.id = this.getSVGNodeId(nodeId);
	/*svgAttributesNode["stroke-width"] = 3 ;
	svgAttributesNode["stroke-opacity"] = 1 ;
	svgAttributesNode["fill-opacity"] = svgAttributesNode["opacity"] ;
	svgAttributesNode["opacity"] = 1 ;*/
	this.circleDefaultRadius = this.getFormatter().getVertexById(nodeId).getDefault().getSize();
	var nodeSVG;

	if (this.getFormatter().getVertexById(nodeId) instanceof CircleVertexGraphFormatter) {
		nodeSVG = SVG.drawCircle(0, 0, this.circleDefaultRadius, this.GraphNodeGroup, svgAttributesNode);
	}

	if (this.getFormatter().getVertexById(nodeId) instanceof SquareVertexGraphFormatter) {
		//nodeSVG = SVG.drawRectangle(0 - (this.circleDefaultRadius) ,0 - (this.formatter.getVertexById(nodeId).getDefault().getSize()) , (this.getFormatter().getVertexById(nodeId).getDefault().getSize()*2),  (this.getFormatter().getVertexById(nodeId).getDefault().getSize()*2), this.GraphNodeGroup, svgAttributesNode);
		nodeSVG = SVG.drawRectangle(0 - (this.circleDefaultRadius), 0 - (this.circleDefaultRadius), (this.circleDefaultRadius * 2),
				(this.circleDefaultRadius * 2), this.GraphNodeGroup, svgAttributesNode);
	}

	if (this.getFormatter().getVertexById(nodeId) instanceof EllipseVertexGraphFormatter) {
		nodeSVG = SVG.drawEllipse(0, 0, this.circleDefaultRadius * 1.5, this.circleDefaultRadius, this.GraphNodeGroup, svgAttributesNode);
	}

	if (this.getFormatter().getVertexById(nodeId) instanceof RectangleVertexGraphFormatter) {
		//nodeSVG = SVG.drawRectangle(0 - (this.circleDefaultRadius) ,0 - ((this.circleDefaultRadius*2)/2) , (this.circleDefaultRadius*2),  (this.circleDefaultRadius), this.GraphNodeGroup, svgAttributesNode);
		nodeSVG = SVG.drawRectangle(0 - (this.circleDefaultRadius * 1.5), 0 - (this.circleDefaultRadius), (this.circleDefaultRadius * 2 * 1.5),
				(this.circleDefaultRadius * 2), this.GraphNodeGroup, svgAttributesNode);

	}

	if (this.getFormatter().getVertexById(nodeId) instanceof RoundedVertexGraphFormatter) {
		svgAttributesNode.ry = 2;// this.formatter.getVertexById(nodeId).getDefault().getSize()/4;
		svgAttributesNode.rx = 2;// this.formatter.getVertexById(nodeId).getDefault().getSize()/4;
		nodeSVG = SVG.drawRectangle(0 - (this.circleDefaultRadius * 1.5), 0 - (this.circleDefaultRadius), (this.circleDefaultRadius * 2 * 1.5),
				(this.circleDefaultRadius * 2), this.GraphNodeGroup, svgAttributesNode);
	}

	//<polygon fill="violet" stroke="violet" points="935.972,-363.757 935.972,-380.243 914.9,-391.9 885.1,-391.9 864.028,-380.243 864.028,-363.757 885.1,-352.1 914.9,-352.1 935.972,-363.757"/> 

	if (this.getFormatter().getVertexById(nodeId) instanceof OctagonVertexGraphFormatter) {
		svgAttributesNode.ry = 2;
		svgAttributesNode.rx = 2;
		nodeSVG = SVG.drawRectangle(0 - (this.circleDefaultRadius * 1.5), 0 - (this.circleDefaultRadius), (this.circleDefaultRadius * 2 * 1.5),
				(this.circleDefaultRadius * 2), this.GraphNodeGroup, svgAttributesNode);
	}

	nodeSVG.internalId = nodeId;
	//
	var _this = this;

	/** Events for the SVG node **/
	if (nodeSVG != null) {
		nodeSVG.addEventListener("mouseover", function() {
			_this.onVertexOver.notify(nodeId);
			_this.overNode(nodeId);
		}, false);
		nodeSVG.addEventListener("mouseout", function() {
			_this.onVertexOut.notify(nodeId);
			_this.outNode(nodeId);
		}, false);
		//nodeSVG.addEventListener("click", function(){_this.clickNode(nodeId);}, false);
		//
		nodeSVG.addEventListener("mouseup", function() {
			_this.onVertexUp.notify(nodeId);
		}, false);
	}
};

GraphCanvas.prototype.removeNode = function(nodeId) {
	DOM.select(this.getSVGNodeId(nodeId)).parentNode.removeChild(DOM.select(this.getSVGNodeId(nodeId)));
	if (this.args.labeled) {
		this.removeLabel(nodeId);
	}
};

/** REMOVING **/
GraphCanvas.prototype.removeSelected = function() {
	/** El orden importa **/
	this.removeSelectedEdges();
	this.removeSelectedNode();

};

GraphCanvas.prototype.removeSelectedNode = function() {
	var selected = JSON.parse(JSON.stringify(this.getSelectedVertices()));
	this.deselectNodes();
	var sorted = selected.sort(function(a, b) {
		return a - b
	});
	for ( var i = 0; i < sorted.length; i++) {
		if (this.getDataset().getVertexById(sorted[i]) != null) {
			this.getDataset().getVertexById(sorted[i]).remove();
		}
	}
};

/** EDGES **/
GraphCanvas.prototype.removeEdge = function(edgeId) {
	if (DOM.select(this.getSVGEdgeId(edgeId)) != null) {
		DOM.select(this.getSVGEdgeId(edgeId)).parentNode.removeChild(DOM.select(this.getSVGEdgeId(edgeId)));
	}

	if (DOM.select(this.getSVGEdgeId(edgeId) + "_shadow") != null) {
		DOM.select(this.getSVGEdgeId(edgeId) + "_shadow").parentNode.removeChild(DOM.select(this.getSVGEdgeId(edgeId) + "_shadow"));
	}

	if (DOM.select(this.getSVGArrowEdgeId(edgeId)) != null) {
		DOM.select(this.getSVGArrowEdgeId(edgeId)).parentNode.removeChild(DOM.select(this.getSVGArrowEdgeId(edgeId)));
	}
};

GraphCanvas.prototype.overEdge = function(edgeId) {
	if ((!this.args.interactive) || this.dragging || this.selecting) {
		return;
	}

	/** If selected we don't change the format **/
	if (this.args.isEdgeSelected[edgeId] == null) {
		var format = this.getFormatter().getEdgeById(edgeId).getOver();
		format.args["cursor"] = "pointer";
		this.changeEdgeFormat(edgeId, format);
	}
};

GraphCanvas.prototype.outEdge = function(edgeId) {
	if (!this.args.interactive) {
		return;
	}

	/** If selected we don't change the format **/
	if (this.args.isEdgeSelected[edgeId] == null) {
		this.changeEdgeFormat(edgeId, this.getFormatter().getEdgeById(edgeId).getDefault());
	}
};

GraphCanvas.prototype.changeEdgeFormat = function(edgeId, format) {
	var svgEdge = DOM.select(this.getSVGEdgeId(edgeId) + "_shadow");
	if (svgEdge != null) {
		var properties = format.toJSON();
		for ( var item in properties) {
			svgEdge.setAttribute(item, properties[item]);
		}
	}
};

GraphCanvas.prototype.deselectEdge = function(edgeID) {
	if (this.args.isEdgeSelected[edgeID] != null) {
		this.changeEdgeFormat(edgeID, this.getFormatter().getEdgeById(edgeID).getDefault());
		var index = this.args.isEdgeSelected[edgeID];
		delete this.args.isEdgeSelected[edgeID];
	}
};

GraphCanvas.prototype.deselectEdges = function() {
	var selected = JSON.parse(JSON.stringify(this.getSelectedEdges()));
	for ( var i = 0; i < selected.length; i++) {
		this.deselectEdge(selected[i]);
	}
};

GraphCanvas.prototype.removeSelectedEdges = function() {
	var selected = JSON.parse(JSON.stringify(this.getSelectedEdges()));
	this.deselectEdges();
	for ( var i = 0; i < selected.length; i++) {
		if (this.getDataset().getEdgeById(selected[i]) != null) {
			this.getDataset().getEdgeById(selected[i]).remove();
		}
	}
};

GraphCanvas.prototype.renderEdge = function(edgeId) {
	var svgAttributesEdge = this.getFormatter().getEdgeById(edgeId).getDefault().toJSON();
	var edge = this.getDataset().getEdgeById(edgeId);

	var svgNodeTarget = this.getVertexById(edge.getNodeTarget().getId());
	var svgNodeSource = this.getVertexById(edge.getNodeSource().getId());
	svgAttributesEdge.id = this.getSVGEdgeId(edge.getId()) + "_shadow";

	var svgEdge = null;

	if (this.getFormatter().getEdgeById(edgeId) instanceof LineEdgeGraphFormatter) {
		var coordenateSourceX = svgNodeSource.getAttribute("dragx");
		var coordenateSourceY = svgNodeSource.getAttribute("dragy");
		var coordenateTargetX = svgNodeTarget.getAttribute("dragx");
		var coordenateTargetY = svgNodeTarget.getAttribute("dragy");

		SVG.drawLine(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, this.GraphEdgeGroup, svgAttributesEdge);
		var attributesShadow = {};
		attributesShadow.id = this.getSVGEdgeId(edge.getId());
		attributesShadow["stroke-opacity"] = 0;
		attributesShadow["stroke-width"] = 4;
		attributesShadow["stroke"] = "black";
		svgEdge = SVG.drawLine(svgNodeSource.getAttribute("dragx"), svgNodeSource.getAttribute("dragy"), svgNodeTarget.getAttribute("dragx"),
				svgNodeTarget.getAttribute("dragy"), this.GraphEdgeGroup, attributesShadow);
	}

	if (this.getFormatter().getEdgeById(edgeId) instanceof BezierEdgeGraphFormatter) {
		var nodeId = edge.getNodeTarget().getId();
		var nodeSize = this.formatter.getVertexById(nodeId).getDefault().getSize() * this.getFormatter().getNodesMaxSize();
		svgAttributesEdge.fill = "none";
		svgAttributesEdge.id = this.getSVGEdgeId(edgeId);
		var d = this.calculateCoordenatesBezier(nodeSize, svgNodeSource.getAttribute("dragx"), svgNodeSource.getAttribute("dragy"));
		svgEdge = SVG.drawPath(d, this.GraphEdgeGroup, svgAttributesEdge);
	}
	;

	if ((this.getFormatter().getEdgeById(edgeId) instanceof DirectedLineEdgeGraphFormatter)
			|| (this.getFormatter().getEdgeById(edgeId) instanceof CutDirectedLineEdgeGraphFormatter)
			|| (this.getFormatter().getEdgeById(edgeId) instanceof DotDirectedLineEdgeGraphFormatter)
			|| (this.getFormatter().getEdgeById(edgeId) instanceof OdotDirectedLineEdgeGraphFormatter)
			|| (this.getFormatter().getEdgeById(edgeId) instanceof OdirectedLineEdgeGraphFormatter)) {
		var coordenateSourceX = svgNodeSource.getAttribute("dragx");
		var coordenateSourceY = svgNodeSource.getAttribute("dragy");
		var coordenateTargetX = svgNodeTarget.getAttribute("dragx");
		var coordenateTargetY = svgNodeTarget.getAttribute("dragy");

		var offset = parseFloat(this.getFormatter().getVertexById(this.getDataset().getEdgeById(edgeId).getNodeTarget().getId()).getDefault()
				.getSize()
				* this.circleDefaultRadius);
		var point = this._calculateEdgePointerPosition(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, offset);
		coordenateTargetX = point.x;
		coordenateTargetY = point.y;
		SVG.drawLine(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, this.GraphEdgeGroup, svgAttributesEdge);

		var attributesShadow = {};
		attributesShadow.id = this.getSVGEdgeId(edge.getId());
		attributesShadow["stroke-opacity"] = 0;
		attributesShadow["stroke-width"] = 4;
		attributesShadow["stroke"] = "black";
		svgEdge = SVG.drawLine(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, this.GraphEdgeGroup, attributesShadow);
	}

	if (this.getFormatter().getEdgeById(edgeId) instanceof DirectedLineEdgeGraphFormatter
			|| (this.getFormatter().getEdgeById(edgeId) instanceof OdirectedLineEdgeGraphFormatter)) {
		var coordenateSourceX = svgNodeSource.getAttribute("dragx");
		var coordenateSourceY = svgNodeSource.getAttribute("dragy");
		var coordenateTargetX = svgNodeTarget.getAttribute("dragx");
		var coordenateTargetY = svgNodeTarget.getAttribute("dragy");

		var point = this._calculateEdgePointerPosition(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, offset);
		coordenateTargetX = point.x;
		coordenateTargetY = point.y;

		var angle = Geometry.toDegree(point.angle) + 90;
		this.arrowDefaultSize = this.getFormatter().getEdgeById(edgeId).getArrowSize(); //getDefault().getArrowSize();
		var d = "-" + this.arrowDefaultSize + ",0 0,-" + parseFloat(this.arrowDefaultSize) * 2 + " " + this.arrowDefaultSize + ",0";

		var attributes;

		if (this.getFormatter().getEdgeById(edgeId) instanceof DirectedLineEdgeGraphFormatter) {
			attributes = [
				[ "fill", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ],
				[ "stroke", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ], [ "id", this.getSVGArrowEdgeId(edgeId) ] ];
		} else {
			attributes = [
				[ "fill", "#FFFFFF" ], [ "stroke", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ],
				[ "id", this.getSVGArrowEdgeId(edgeId) ] ];
		}

		var flechaSVGNode = SVG.drawPoligon(d, this.GraphEdgeGroup, attributes);//, ["transform", "rotate("+angle+"), translate(0,0)"]]);
		flechaSVGNode.setAttribute("transform", " translate(" + coordenateTargetX + ", " + coordenateTargetY + "), rotate(" + angle + ")");
	}
	;

	if (this.getFormatter().getEdgeById(edgeId) instanceof CutDirectedLineEdgeGraphFormatter) {
		var coordenateSourceX = svgNodeSource.getAttribute("dragx");
		var coordenateSourceY = svgNodeSource.getAttribute("dragy");
		var coordenateTargetX = svgNodeTarget.getAttribute("dragx");
		var coordenateTargetY = svgNodeTarget.getAttribute("dragy");

		var point = this._calculateEdgePointerPosition(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, offset);
		coordenateTargetX = point.x;
		coordenateTargetY = point.y;

		var angle = Geometry.toDegree(point.angle) + 90;

		//this.arrowDefaultSize = 2; //getDefault().getArrowSize();
		var d = "-4,0 4,0 4,-2 -4,-2";

		var flechaSVGNode = SVG.drawPoligon(d, this.GraphEdgeGroup, [
			[ "fill", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ],
			[ "stroke", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ], [ "id", this.getSVGArrowEdgeId(edgeId) ] ]);//, ["transform", "rotate("+angle+"), translate(0,0)"]]);
		flechaSVGNode.setAttribute("transform", " translate(" + coordenateTargetX + ", " + coordenateTargetY + "), rotate(" + angle + ")");
	}
	;

	if ((this.getFormatter().getEdgeById(edgeId) instanceof DotDirectedLineEdgeGraphFormatter)
			|| (this.getFormatter().getEdgeById(edgeId) instanceof OdotDirectedLineEdgeGraphFormatter)) {
		var coordenateSourceX = svgNodeSource.getAttribute("dragx");
		var coordenateSourceY = svgNodeSource.getAttribute("dragy");
		var coordenateTargetX = svgNodeTarget.getAttribute("dragx");
		var coordenateTargetY = svgNodeTarget.getAttribute("dragy");
		var point = this._calculateEdgePointerPosition(coordenateSourceX, coordenateSourceY, coordenateTargetX, coordenateTargetY, offset);
		coordenateTargetX = point.x;
		coordenateTargetY = point.y;
		var angle = Geometry.toDegree(point.angle) + 90;
		//	this.arrowDefaultSize = this.formatter.getEdgeById(edgeId).getArrowSize(); //getDefault().getArrowSize();
		var attributes = [];
		if (this.getFormatter().getEdgeById(edgeId) instanceof OdotDirectedLineEdgeGraphFormatter) {
			attributes = [
				[ "fill", "#FFFFFF" ], [ "stroke", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ],
				[ "id", this.getSVGArrowEdgeId(edgeId) ] ];
		} else {
			attributes = [
				[ "fill", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ],
				[ "stroke", this.getFormatter().getEdgeById(edgeId).getDefault().getStroke() ], [ "id", this.getSVGArrowEdgeId(edgeId) ] ];
		}
		var flechaSVGNode = SVG.drawCircle(0, 0, 4, this.GraphEdgeGroup, attributes);
		flechaSVGNode.setAttribute("transform", " translate(" + coordenateTargetX + ", " + coordenateTargetY + "), rotate(" + angle + ")");
	}
	;

	var _this = this;
	/** Events for the SVG edge **/
	if (svgEdge != null) {
		if (this.getDataset().getEdgesCount() < this.args.maxNumberEdgesFiringEvents) {
			svgEdge.addEventListener("mouseover", function() {
				_this.overEdge(edgeId);
			}, false);
			svgEdge.addEventListener("mouseout", function() {
				_this.outEdge(edgeId);
			}, false);
		}
	}
};

GraphCanvas.prototype._calculateEdgePointerPosition = function(sourceX, sourceY, targetX, targetY, radius) {
	var angle = Geometry.getAngleBetweenTwoPoints(sourceX, sourceY, targetX, targetY);

	/** Suponiendo el node source que este a la derecha **/
	if ((targetX - sourceX) < 0) {
		var b = Geometry.getAdjacentSideOfRectangleRight(angle, radius);
		targetX = parseFloat(targetX) + parseFloat(b);
		arrowX = parseFloat(targetX) + parseFloat(b) + this.arrowDefaultSize / 2;
	} else {
		var b = Geometry.getAdjacentSideOfRectangleRight(angle, radius);
		targetX = parseFloat(targetX) - parseFloat(b);
		arrowX = parseFloat(targetX) - parseFloat(b) - this.arrowDefaultSize / 2;
	}

	/** Suponiendo el node source que este a la arriba **/
	if ((targetY - sourceY) > 0) {
		var a = Geometry.getOppositeSideOfRectangleRight(angle, radius);
		targetY = parseFloat(targetY) - parseFloat(a);
		arrowY = parseFloat(targetY) - parseFloat(a) - this.arrowDefaultSize / 2;
	} else {
		var a = Geometry.getOppositeSideOfRectangleRight(angle, radius);
		targetY = parseFloat(targetY) + parseFloat(a);
		arrowY = parseFloat(targetY) + parseFloat(a) - this.arrowDefaultSize / 2;

	}

	return {
		"x" : arrowX,
		"y" : arrowY,
		"angle" : angle
	};
};

GraphCanvas.prototype.calculateCoordenatesBezier = function(nodeSize, x1, y1) {
	var x11 = x1 - (nodeSize / 2);
	var y11 = y1 - (nodeSize / 2);

	var x12 = parseFloat(x1) + parseFloat(nodeSize / 2);
	var y12 = y1 - (nodeSize / 2);

	var curvePointX = (x12 - x11) / 2 + x11;
	var curvePointY = y1 - (nodeSize * 2);
	var d = "M" + x11 + "," + y11 + " T" + curvePointX + "," + curvePointY + " " + x12 + "," + y12;
	return d;

};

GraphCanvas.prototype.renderEdges = function() {
	for ( var edge in this.getDataset().getEdges()) {
		this.renderEdge(this.getDataset().getEdgeById(edge).getId());

	}
};

GraphCanvas.prototype.getLastSelectedNode = function() {
	var node = null;
	if (this.getSelectedVertices().length > 0) {
		var nodeId = this.getSelectedVertices()[this.getSelectedVertices().length - 1];
		node = this.getDataset().getVertexById(nodeId);
	}
	return node;
};
/*
 GraphCanvas.prototype.getNodeByNameAndIndex = function(node, index){
 var nodeId = this.getDataset().verticesIndex[node][index];
 var nodeItem = this.getDataset().getVertexById(nodeId);
 return nodeItem;
 };
 */

GraphCanvas.prototype.setDataset = function(dataset) {
	this.dataset = dataset;
};

GraphCanvas.prototype.setFormatter = function(formatter) {
	this.formatter = formatter;
};

GraphCanvas.prototype.setLayout = function(layout) {
	this.layout = layout;
};

/** API **/
GraphCanvas.prototype.getDataset = function() {
	return this.dataset;
};

GraphCanvas.prototype.getFormatter = function() {
	return this.formatter;
};

GraphCanvas.prototype.getLayout = function() {
	return this.layout;
};

/** API DATASET **/
GraphCanvas.prototype.addVertex = function(name, args) {
	this.getDataset().addNode(name, args);
};

GraphCanvas.prototype.removeVertex = function(vertexId) {
	this.getDataset().getVertexById(vertexId).remove();
};

GraphCanvas.prototype.addEdge = function(edgeName, nodeSourceId, nodeTargetId, args) {
	this.getDataset().addEdge(edgeName, nodeSourceId, nodeTargetId, args);
};
/*
 GraphCanvas.prototype.removeEdge = function(edgeId){
 this.getDataset().getEdgeById(edgeId).remove();
 };
 */

/** API FORMATTER **/
GraphCanvas.prototype.getWidth = function() {
	return this.getFormatter().getWidth();
};

GraphCanvas.prototype.getHeight = function() {
	return this.getFormatter().getHeight();
};

GraphCanvas.prototype.getBackgroundImage = function() {
	return this.getFormatter().getBackgroundImage();
};

//GraphCanvas.prototype.setBackgroundImage = function(value){
//	this.getFormatter().setBackgroundImage(value); 
//};

GraphCanvas.prototype.getBackgroundColor = function() {
	return this.getFormatter().getBackgroundColor();
};

GraphCanvas.prototype.setBackgroundColor = function() {
	this.getFormatter().setBackgroundColor(value);
};

//GraphCanvas.prototype.setEdgeFill = function(edgeId, value){
//	this.getFormatter().getEdgeById(edgeId).getDefault().setFill(value);
//};
//
//GraphCanvas.prototype.getEdgeFill = function(edgeId){
//	return this.getFormatter().getEdgeById(edgeId).getDefault().getFill();
//};

/** VERTICES FORMATTER **/
GraphCanvas.prototype.setVertexSize = function(vertexId, value) {
	this.getFormatter().getVertexById(vertexId).getDefault().setSize(value);
};

GraphCanvas.prototype.getVertexSize = function(vertexId) {
	return this.getFormatter().getVertexById(vertexId).getDefault().getSize();
};

GraphCanvas.prototype.setVertexStroke = function(vertexId, value) {
	this.getFormatter().getVertexById(vertexId).getDefault().setStroke(value);
};

GraphCanvas.prototype.getVertexStroke = function(vertexId) {
	return this.getFormatter().getVertexById(vertexId).getDefault().getStroke();
};

GraphCanvas.prototype.setVertexStrokeOpacity = function(vertexId, value) {
	this.getFormatter().getVertexById(vertexId).getDefault().setStrokeOpacity(value);
};

GraphCanvas.prototype.getVertexStrokeOpacity = function(vertexId) {
	return this.getFormatter().getVertexById(vertexId).getDefault().getStrokeOpacity();
};

GraphCanvas.prototype.setVertexOpacity = function(vertexId, value) {
	this.getFormatter().getVertexById(vertexId).getDefault().setOpacity(value);
};

GraphCanvas.prototype.getVertexOpacity = function(vertexId) {
	return this.getFormatter().getVertexById(vertexId).getDefault().getOpacity();
};

GraphCanvas.prototype.setVertexFill = function(vertexId, color) {
	this.getFormatter().getVertexById(vertexId).getDefault().setFill(color);
};

GraphCanvas.prototype.getVertexFill = function(vertexId) {
	return this.getFormatter().getVertexById(vertexId).getDefault().getFill();
};

/** EDGES FORMATTER **/
GraphCanvas.prototype.setEdgeSize = function(edgeId, value) {
	this.getFormatter().getEdgeById(edgeId).getDefault().setSize(value);
};

GraphCanvas.prototype.getEdgeSize = function(edgeId) {
	return this.getFormatter().getEdgeById(edgeId).getDefault().getSize();
};

GraphCanvas.prototype.setEdgeStroke = function(edgeId, value) {
	this.getFormatter().getEdgeById(edgeId).getDefault().setStroke(value);
};

GraphCanvas.prototype.getEdgeStroke = function(edgeId) {
	return this.getFormatter().getEdgeById(edgeId).getDefault().getStroke();
};

GraphCanvas.prototype.setEdgeStrokeOpacity = function(edgeId, value) {
	this.getFormatter().getEdgeById(edgeId).getDefault().setStrokeOpacity(value);
};

GraphCanvas.prototype.getEdgeStrokeOpacity = function(edgeId) {
	return this.getFormatter().getEdgeById(edgeId).getDefault().getStrokeOpacity();
};

GraphCanvas.prototype.setEdgeFill = function(edgeId, color) {
	this.getFormatter().getEdgeById(edgeId).getDefault().setFill(color);
};

GraphCanvas.prototype.getEdgeFill = function(edgeId) {
	return this.getFormatter().getEdgeById(edgeId).getDefault().getFill();
};

/** API LAYOUT **/
GraphCanvas.prototype.setCoordinates = function(vertexId, x, y) {
	return this.getLayout().getEdgeById(vertexId).setCoordinates(x, y);
};



function HPLCGraph(args) {
	this.width = 600;
	this.height = 600;
	this.title = '';
	this.bbar = false;
	this.plotInnerPanelPadding = 10;
	this.plotPanelPadding = 5;
	this.id = BUI.id();

	this.hidePlots = null;
	this.xlabel = "";
	this.scaled = false;
	this.xParam = null;
	this.showRangeSelector = true;
	this.interactionModel = null;

	/** for each stat the max and minimum value when it is scaled in order to show correctly in the legend **/
	this.ranges = {};
	if (args != null) {
		if (args.interactionModel != null) {
			this.interactionModel = args.interactionModel;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.bbar != null) {
			this.bbar = args.bbar;
		}
		if (args.title != null) {
			this.title = args.title;
		}
		if (args.plots != null) {
			this.plots = args.plots;
		}

		if (args.scaled != null) {
			this.scaled = args.scaled;
		}
		if (args.xlabel != null) {
			this.xlabel = args.xlabel;
		}
		if (args.xParam != null) {
			this.xParam = args.xParam;
		}
		if (args.showRangeSelector != null) {
			this.showRangeSelector = args.showRangeSelector;
		}
	}

	this.onZoomX = new Event(this);
	this.onResetZoom = new Event(this);
	this.dblclick = new Event(this);
}

HPLCGraph.prototype.getMenu = function () {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	function toggle(item, pressed) {
		if (pressed) {
			_this.plots[item.param] = true;
		} else {
			delete _this.plots[item.param];
		}
		_this.reloadData(this.hplcData);
	}

	for (var i = 0; i < this.hplcData.length; i++) {
		if (this.hplcData[i].showOnMenu != false) {
			var param = this.hplcData[i].param;
			var style = "style='padding:0 0px 0 5px;'";
			actions.push({
				text : "<table><tr><td>" + BUI.getRectangleColorDIV(this.hplcData[i].color, 10, 10) + "</td><td " + style + "> " + this.hplcData[i].label + "</td></tr></table>",
				id : _this.id + param,
				param : param,
				enableToggle : true,
				scope : this,
				toggleHandler : toggle,
				pressed : (_this.plots[param] != null)
			});
		}
	}
	actions.push("-");

	actions.push({
		text : "Scale",
		enableToggle : true,
		scope : this,
		pressed : this.scaled,
		icon : '../images/icon_graph.png',
		toggleHandler : function (item, pressed) {
			_this.scaled = pressed;
			_this.reloadData(this.hplcData);
		}
	});

	actions.push("->");
	actions.push({
		text : "Save",
		scope : this,
		icon : '../images/save.gif',
		handler : function (item, pressed) {
			var largeImage = document.createElement("img");
			largeImage.style.display = 'block';
			largeImage.style.width = 200 + "px";
			largeImage.style.height = 200 + "px";
			largeImage.setAttribute('src', Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL());
			window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(), 'Image', '');
		}
	});

	return actions;
};

/** Looks for the maximum value and then divide everything but that value **/
HPLCGraph.prototype.scaledData = function (data) {
	for (var i = 0; i < data.length; i++) {
		var values = this.getMaxAndMinValue(data[i]);
		data[i] = this.divideValuesByMax(data[i], values.max);
		this.ranges[data[i].label] = values;
	}
	return data;
};


/** Given a stat float[] and a max number it will divide each value by max **/
HPLCGraph.prototype.divideValuesByMax = function (stat, max) {
	for (var j = 0; j < stat.data.length; j++) {
		if (max != 0) {
			stat.data[j] = Number(stat.data[j]) / max;
			stat.std[j] = Number(stat.std[j]) / max;
		}
	}
	return stat;
};

/** returns max value of a stat **/
HPLCGraph.prototype.getMaxAndMinValue = function (stat) {
	var max = 0;
	var min = stat.data[0];
	for (var j = 0; j < stat.data.length; j++) {
		if (Number(stat.data[j]) > max) {
			max = Number(stat.data[j]);
		}
		if (Number(stat.std[j]) > max) {
			max = Number(stat.std[j]);
		}
		if (Number(stat.data[j]) < min) {
			min = Number(stat.data[j]);
		}
	}
	return {
		max : Number(max),
		min : Number(min)
	};
};

HPLCGraph.prototype.getPoint = function (data, i) {
	var point = [ 10, 10, 10 ];
	var y = parseFloat(data.data[i]);
	var error = parseFloat(data.std[i]);
	if (data.fdata == null) {
		return [ y - error, y, y + error ];
	} else {
		if (data.fstd != null) {
			return [ data.fstd(y - error), data.fdata(y), data.fstd(y + error) ];
		}
		return [ data.fdata(y) - error, data.fdata(y), data.fdata(y) + error ];
	}
	return point;
};

HPLCGraph.prototype.reloadData = function(hplcData) {
	this.panel.setLoading(false);
	this.hplcData = hplcData;

	var data = hplcData;
	

	/** In case of having peaks **/
	if (this.peaks != null) {
		for (var peak in this.peaks) {
			var values = [];
			var std = [];
			for (var i = 0; i < this.peaks[peak].length; i++) {
				values.push(this.peaks[peak][i][1]);
				std.push(this.peaks[peak][i][2]);
			}
			data.push({
				param : peak,
				data : values,
				showOnMenu : false,
				fdata : function (a) {
					var value = (Math.log(parseFloat(a)));
					if (isNumber(value)) {
						return value;
					}
				},
				fstd : function (a) {
					var value =  Math.log(Math.abs(parseFloat(a)));
					if (isNumber(value))
						return value;
				},
				std : std,
				color : this.colorPeak[peak],
				label : peak
			});
			
		}
	}
	
	
	if (this.scaled) {
		data = this.scaledData(JSON.parse(JSON.stringify(hplcData)));
	} 

	var paramIndex = {};
	var parsed = [];
	var j = 0;
	for (var i = 0; i < data[0].data.length - 1; i++) {
		var aux = [];
		for (j = 0; j < data.length; j++) {
			if (this.plots != null) {
				if (this.plots[data[j].param] != null) {
					aux.push(this.getPoint(data[j], i));
					paramIndex[data[j].param] = aux.length - 1;
				}
			} else {
				aux.push([ data[j].data[i] - data[j].std[i], data[j].data[i], data[j].data[i] + data[j].std[i] ]);
			}
		}
		parsed.push([]);

		var index = i;
		if (this.xParam != null) {
			index = parseFloat(data[this.xParam].data[i]);
		}

		parsed[parsed.length - 1].push(index);

		for (j = 0; j < data.length; j++) {
			if (this.plots != null) {
				if (this.plots[data[j].param] != null) {
					parsed[parsed.length - 1].push(aux[paramIndex[data[j].param]]);
				}
			} else {
				parsed[parsed.length - 1].push(aux[j]);
			}
		}
	}

	var colors = [];
	var labels = [ "" ];
	for (j = 0; j < data.length; j++) {
		if (this.plots != null) {
			if (this.plots[data[j].param] != null) {
				colors.push(data[j].color);
				labels.push(data[j].label);
			}
		} else {
			parsed[parsed.length - 1].push(aux[j]);
		}
	}

	this._renderDygraph(parsed, colors, labels);
};

HPLCGraph.prototype._renderDygraph = function (parsed, colors, labels) {
	this.dygraphObject = new StdDevDyGraph(this.id, {
		width : this.width,
		height : this.height - 10,
		xlabel : this.xlabel,
		showRangeSelector : this.showRangeSelector,
		interactionModel : this.interactionModel,
		scaled : this.scaled,
		ranges : this.ranges
	});
	this.dygraphObject.draw(parsed, colors, labels);

	var _this = this;
	this.dygraphObject.onZoomX.attach(function (sender, args) {
		try {
			_this.onZoomX.notify(args);
		} catch (e) {
		}
	});

	this.dygraphObject.onResetZoom.attach(function (sender, args) {
		try {
			_this.onResetZoom.notify(args);
		} catch (e) {
		}
	});

	this.dygraphObject.dblclick.attach(function (sender, args) {
		try {
			_this.dblclick.notify(args);
		} catch (e) {
		}
	});

};

HPLCGraph.prototype.loadData = function (data) {
	var _this = this;
	this.reloadData(data);
	this.panel.addDocked({
		xtype : 'toolbar',
		items : this.getMenu()
	});
	
	
	if (this.bbar == true){
		this.panel.addDocked({
			xtype : 'toolbar',
			dock: 'bottom',
			items : [
					{
					    xtype: 'numberfield',
					    id: 'main_field_start',
					    fieldLabel: 'Range from',
					    width: 170,
					    labelWidth : 70,
					    value: 0,
					    minValue: 0
					},
					{
						    xtype: 'numberfield',
						    id: 'main_field_end',
						    fieldLabel: 'to',
						    width: 130,
						    labelWidth : 30,
						    value: 0,
						    minValue: 0
						},
					{ 
							xtype: 'button', 
							text: 'Go', 
							handler: function () {
								var start = parseFloat(Ext.getCmp("main_field_start").getValue());
								var end = parseFloat(Ext.getCmp("main_field_end").getValue());
								
								if (start < 0) {
									start = 0;
								}
								if (end < 0) {
									end = 0;
								}
								if (start > end) {
									var aux = end;
									end = start;
									start = aux;
								}
								
								_this.dygraphObject.dygraph.updateOptions({ isZoomedIgnoreProgrammaticZoom: true, dateWindow: [start, end] });
							}	
						}
				]
		});
	}
};

HPLCGraph.prototype.getPanel = function () {
	this.panel = Ext.create('Ext.panel.Panel', {
		padding : this.plotPanelPadding,
		width : this.width + 4 * this.plotInnerPanelPadding,
		height : this.height + 4 * this.plotInnerPanelPadding,
		items : [ {
			html : "",
			id : this.id,
			width : this.width,
			height : this.height
		} ]
	});

	return this.panel;
};

HPLCGraph.prototype.input = function () {
	return DATADOC.getHPLCData();
};

HPLCGraph.prototype.getDataByFrameNumber = function (frameNumber) {
	var data = {};
	data.frameNumber = frameNumber;
	for (var key in this.hplcData){
		data[this.hplcData[key].label] = this.hplcData[key].data[frameNumber];
	}
	console.log(data);
	return data;
};


HPLCGraph.prototype.test = function (targetId) {
	var mainPlotPanel = new HPLCGraph({
		title : 'I0',
		width : 800,
		height : 400,
		plots : {
			"I0" : true,
			"Rg" : true,
			"Mass" : true
		},
		xlabel : "HPLC Frames",
		scaled : this.scaled,
		interactionModel : {
			'dblclick' : function (event, g, context) {
			}
		}
	});
	mainPlotPanel.getPanel().render(targetId);
	mainPlotPanel.loadData(mainPlotPanel.input());

};


function MergesHPLCGraph(args) {
	HPLCGraph.prototype.constructor.call(this, args);
	
//	this.peakColors = ["#00FB42", "#00BA31", "#007C21", "#003E10"];
	this.peakColors = ["#DEBD00", "#6D9100", "#872900", "#0092CC"];
}


MergesHPLCGraph.prototype.scaledData = HPLCGraph.prototype.scaledData;
MergesHPLCGraph.prototype.divideValuesByMax = HPLCGraph.prototype.divideValuesByMax;
MergesHPLCGraph.prototype.getMaxAndMinValue = HPLCGraph.prototype.getMaxAndMinValue;
MergesHPLCGraph.prototype.getPoint = HPLCGraph.prototype.getPoint;
MergesHPLCGraph.prototype.reloadData = HPLCGraph.prototype.reloadData;
MergesHPLCGraph.prototype._renderDygraph = HPLCGraph.prototype._renderDygraph;
MergesHPLCGraph.prototype.loadData = HPLCGraph.prototype.loadData;
MergesHPLCGraph.prototype.getPanel = HPLCGraph.prototype.getPanel;
MergesHPLCGraph.prototype.getDataByFrameNumber = HPLCGraph.prototype.getDataByFrameNumber;


MergesHPLCGraph.prototype.setPeaks = function (data) {
	this.peaks = data;
	/** get size of peaks **/
	this.peakKeys = [];
	this.colorPeak = {};
	var colorCount = 1;
	for (var key in this.peaks) {
		if (this.peaks.hasOwnProperty(key)) {
			var color = this.peakColors[colorCount % this.peakColors.length];
			colorCount = colorCount + 1;
			this.peakKeys.push(key);
			this.colorPeak[key] = color;
		}
	}
	this.peakKeys.sort();
};


MergesHPLCGraph.prototype.getMenu = function () {
	var _this = this;
	/** Actions buttons **/
	var actions = [];
	
	function toggle(item, pressed) {
		if (pressed) {
			_this.plots[item.param] = true;
		} else {
			delete _this.plots[item.param];
		}
		_this.reloadData(_this.hplcData);
	}
	
	
	/** Toolbar for peaks  Average **/
	if (this.peaks != null) {
		var items = [];
		for (var i = 0; i < this.peakKeys.length; i++) {
			var color =  this.colorPeak[this.peakKeys[i]];
			items.push({
				text: "<span style='color:" + color + "; font-weight:bold;'>Peak #" + i + " " + this.peakKeys[i].replace("- ", " to #").replace(".0", "").replace(".0", "") + "</span>",
				peakid : this.peakKeys[i],
				checked: false,
				checkHandler: function (sender, pressed) {
					var item = new Object();
					item.param = sender.peakid;
					toggle(item, pressed);
				}
			});
		}
		
		var menu = Ext.create('Ext.menu.Menu', {
			id: 'mainMenu',
			style: {
				overflow: 'visible'
			},
			items: items
		});
		var tb = Ext.create('Ext.toolbar.Toolbar');
		tb.add({
			text: 'Peaks Avg.',
			menu: menu  
		});
		actions.push(tb);
	}

	

	for (var i = 0; i < this.hplcData.length; i++) {
		if (this.hplcData[i].showOnMenu != false) {
			var param = this.hplcData[i].param;
			var style = "style='padding:0 0px 0 5px;'";
			actions.push({
				text : "<table><tr><td>" + BUI.getRectangleColorDIV(this.hplcData[i].color, 10, 10) + "</td><td " + style + "> " + this.hplcData[i].label + "</td></tr></table>",
				id : _this.id + param,
				param : param,
				enableToggle : true,
				scope : this,
				margin : 5,
				toggleHandler : toggle,
				pressed : (_this.plots[param] != null)
			});
		}
	}

	actions.push("->");
	actions.push({
		text : "Save",
		scope : this,
		icon : '../images/save.gif',
		handler : function (item, pressed) {
			var largeImage = document.createElement("img");
			largeImage.style.display = 'block';
			largeImage.style.width = 200 + "px";
			largeImage.style.height = 200 + "px";
			largeImage.setAttribute('src', Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL());
			window.open(Dygraph.Export.asCanvas(this.dygraphObject.dygraph).toDataURL(), 'Image', '');
		}
	});

	return actions;
};


MergesHPLCGraph.prototype.input = function () {
	return DATADOC.getScatteringHPLCFrameData();
};

MergesHPLCGraph.prototype.test = function (targetId) {
	var mainPlotPanel = new MergesHPLCGraph({
		title : 'Scattering',
		width : this.plotWidth,
		height : 500,
		showRangeSelector : false,
		xParam : 0,
		xlabel : "scattering_I",
		plots : {
			"scattering_I" : true,
			"subtracted_I" : true,
			"buffer_I" : true
		}
	});
	mainPlotPanel.getPanel().render(targetId);
	mainPlotPanel.loadData(mainPlotPanel.input());
};


function NetworkWidget(args) {
	this.id = "NetworkViewer_" + Math.random().toString().replace(".", "_");

	this.label = true;
	if (args != null) {
		if (args.targetId != null) {
			this.targetId = args.targetId;
		}
		if (args.label != null) {
			this.label = args.label;
		}
	}

	this.onVertexOver = new Event(this);
	this.onVertexOut = new Event(this);
}

NetworkWidget.prototype.draw = function(dataset, formatter, layout) {

	this.graphCanvas = new GraphCanvas(this.id, document.getElementById(this.targetId), {
		"labeled" : this.label,
		"multipleSelectionEnabled" : false,
		"draggingCanvasEnabled" : false
	});
	this.graphCanvas.draw(dataset, formatter, layout);

	var _this = this;
	this.graphCanvas.onVertexOver.attach(function(sender, nodeId) {
		_this.onVertexOver.notify(nodeId);
	});

	this.graphCanvas.onVertexOut.attach(function(sender, nodeId) {
		_this.onVertexOut.notify(nodeId);
	});
};

/** SELECT VERTICES BY NAME * */
NetworkWidget.prototype.selectVertexByName = function(vertexName) {
	var vertices = this.getDataset().getVertexByName(vertexName);
	if (vertices != null) {
		for ( var nodeId in vertices) {
			if (vertices.hasOwnProperty(nodeId)) {
				var vertexId = vertices[nodeId].getId();
				this.selectVertexById(vertexId);
			}
		}
	}
};

NetworkWidget.prototype.selectVerticesByName = function(verticesName) {
	for ( var i = 0; i < verticesName.length; i++) {
		this.selectVertexByName(verticesName[i]);
	}
};

/** SELECT VERTICES BY ID * */
NetworkWidget.prototype.selectVertexById = function(vertexId) {
	this.graphCanvas.selectNode(vertexId);
	this.blinkVertexById(vertexId);
};

NetworkWidget.prototype.selectVerticesById = function(verticesId) {
	for ( var i = 0; i < verticesId.length; i++) {
		this.selectVertexById(verticesId[i]);
	}
};

/** VECINDARIO * */
NetworkWidget.prototype.selectNeighbourhood = function() {
	this.selectEdgesFromVertices();
	this.selectAdjacent();
};

/** DESELECT * */
NetworkWidget.prototype.deselectNodes = function() {
	this.graphCanvas.deselectNodes();
};

/** SELECT ALL NODES * */
NetworkWidget.prototype.selectAllNodes = function() {
	this.getGraphCanvas().selectAllNodes();
};

/** SELECT EVERYTHING * */
NetworkWidget.prototype.selectAll = function() {
	this.getGraphCanvas().selectAll();
};

/** SELECT ALL EDGES * */
NetworkWidget.prototype.selectAllEdges = function() {
	this.getGraphCanvas().selectAllEdges();
};

/** ZOOM * */
NetworkWidget.prototype.setScale = function(value) {
	this.graphCanvas.setScale(value);
};

NetworkWidget.prototype.getScale = function() {
	return this.graphCanvas.getScale(value);
};

/** SELECT ADJACENT VERTICES FROM SELECTED VERTICES * */
NetworkWidget.prototype.selectAdjacent = function() {
	var selectedVertices = this.getGraphCanvas().getSelectedVertices();
	var edges = [];
	for ( var i = 0; i < selectedVertices.length; i++) {
		edges = edges.concat(this.getGraphCanvas().getDataset().getVertexById(selectedVertices[i]).getEdges());
	}
	var vertices = [];
	for ( i = 0; i < edges.length; i++) {
		vertices.push(edges[i].getNodeSource().getId());
		vertices.push(edges[i].getNodeTarget().getId());
	}

	this.selectVerticesById(vertices);
};

/** SELECT EDGES FROM SELECTED VERTICES * */
NetworkWidget.prototype.selectEdgesFromVertices = function() {
	var selectedVertices = this.getGraphCanvas().getSelectedVertices();
	var edges = [];
	for ( var i = 0; i < selectedVertices.length; i++) {
		edges = edges.concat(this.getGraphCanvas().getDataset().getVertexById(selectedVertices[i]).getEdges());
	}
	var edgesId = [];
	for (  i = 0; i < edges.length; i++) {
		edgesId.push(edges[i].getId());
	}
	this.getGraphCanvas().selectEdges(edgesId);
};

/** BLINKING * */
NetworkWidget.prototype.blinkVertexById = function(vertexId) {
	this.graphCanvas.blinkVertexById(vertexId);
};

/** COMPONENTE CONEXA DE LOS NODOS SELECCIONADOS * */
NetworkWidget.prototype.selectConnectedComponent = function() {
	var elements = this.getConnectedComponent();
	this.selectVerticesById(elements.nodes);
	this.graphCanvas.selectEdges(elements.edges);
};

NetworkWidget.prototype.getConnectedComponent = function() {
	var nodosVisitados = {};
	var aristasVisitadas = {};
	var arrNodos = [];
	var arrAristas = [];
	var selectedGraphNodesId = this.getGraphCanvas().getSelectedVertices();
	for ( var i = 0; i < selectedGraphNodesId.length; i++) {
		this.visitNode(selectedGraphNodesId[i], nodosVisitados, aristasVisitadas, arrNodos, arrAristas);
	}
	return {
		nodes : arrNodos,
		edges : arrAristas
	};
};

NetworkWidget.prototype.visitNode = function(nodeId, nodosVisitados, aristasVisitadas, arrNodos, arrAristas) {
	nodosVisitados[nodeId] = true;
	arrNodos.push(nodeId);
	var nodeEdges = this.getDataset().getVertexById(nodeId).getEdges();
	for ( var j = 0; j < nodeEdges.length; j++) {
		var edge = nodeEdges[j];
		var edgeId = edge.getId();
		if (aristasVisitadas[edgeId] == null) {
			aristasVisitadas[edgeId] = true;
			arrAristas.push(edgeId);
			var nodeTargetId = edge.getNodeTarget().getId();
			if (nodosVisitados[nodeTargetId] == null) {
				this.visitNode(nodeTargetId, nodosVisitados, aristasVisitadas, arrNodos, arrAristas);
			}
			var nodeSourceId = edge.getNodeSource().getId();
			if (nodosVisitados[nodeSourceId] == null) {
				this.visitNode(nodeSourceId, nodosVisitados, aristasVisitadas, arrNodos, arrAristas);
			}
		}
	}
};

/** COLLAPSE SELECTED VERTICES * */
NetworkWidget.prototype.collapse = function() {
	var selectedVertices = this.getGraphCanvas().getSelectedVertices();
	var xMin = -Infinity;
	var xMax = Infinity;
	var yMin = -Infinity;
	var yMax = Infinity;

	for ( var i = 0; i < selectedVertices.length; i++) {
		var vertex = this.getGraphCanvas().getLayout().getNodeById(selectedVertices[i]);
		if (xMin < vertex.x) {
			xMin = vertex.x;
		}
		if (xMax > vertex.x) {
			xMax = vertex.x;
		}
		if (yMin < vertex.y) {
			yMin = vertex.y;
		}
		if (yMax > vertex.y) {
			yMax = vertex.y;
		}
	}

	var centerX = xMin - xMax;
	var centerY = yMin - yMax;
	var radius = (xMax - xMin) / 4;

	var count = selectedVertices.length;
	var verticesCoordinates = [];

	for ( i = 0; i < selectedVertices.length; i++) {
		x = centerX + radius * Math.sin(i * 2 * Math.PI / count);
		y = centerY + radius * Math.cos(i * 2 * Math.PI / count);
		verticesCoordinates.push({
			'x' : x,
			'y' : y
		});
	}

	for ( i = 0; i < selectedVertices.length; i++) {
		this.getGraphCanvas().getLayout().getNodeById(selectedVertices[i]).setCoordinates(verticesCoordinates[i].x, verticesCoordinates[i].y);
	}
};

/** SETTER FONT SIZE * */
NetworkWidget.prototype.setVerticesFontSize = function(value) {
	for ( var nodeId in this.getDataset().getVertices()) {
		if (this.getDataset().getVertices().hasOwnProperty(nodeId)) {
			this.getFormatter().getVertexById(nodeId).getDefault().setFontSize(value);
		}
	}
};

/** GETTERS * */
NetworkWidget.prototype.getFormatter = function() {
	return this.getGraphCanvas().getFormatter();
};
NetworkWidget.prototype.getLayout = function() {
	return this.getGraphCanvas().getLayout();
};

NetworkWidget.prototype.getDataset = function() {
	return this.getGraphCanvas().getDataset();
};

NetworkWidget.prototype.getGraphCanvas = function() {
	return this.graphCanvas;
};

RangeWhiskerGraph.prototype.cleanArray = GenericGraph.prototype.cleanArray;
RangeWhiskerGraph.prototype.plotAxes = GenericGraph.prototype.plotAxes;
RangeWhiskerGraph.prototype.plotRuler = GenericGraph.prototype.plotRuler;
RangeWhiskerGraph.prototype.drawSVGVerticalText = GenericGraph.prototype.drawSVGVerticalText;
RangeWhiskerGraph.prototype.getClassColor = GenericGraph.prototype.getClassColor;
RangeWhiskerGraph.prototype.getDimensions = GenericGraph.prototype.getDimensions;
RangeWhiskerGraph.prototype.calculate = GenericGraph.prototype.calculate;
RangeWhiskerGraph.prototype.getMedian = GenericGraph.prototype.getMedian;
RangeWhiskerGraph.prototype.pointToPixel = GenericGraph.prototype.pointToPixel;
RangeWhiskerGraph.prototype.maxValueWhisker = GenericGraph.prototype.maxValueWhisker;
RangeWhiskerGraph.prototype.refresh = GenericGraph.prototype.refresh;

/**
 * Subclass of GenericGraph
 * 
 * @plotHorizontalByCluster
 */
function RangeWhiskerGraph(args) {
	this.maxBoxWidth = 25;

	if (args == null) {
		args = {};
	}
	args.plotHorizontalByCluster = false;

	GenericGraph.call(this, args);

	if (args.maxBoxWidth != null) {
		this.maxBoxWidth = args.maxBoxWidth;
	}
}

RangeWhiskerGraph.prototype.refresh = function(data) {
	document.getElementById(this.targetId).innerHTML = "";
	this.draw(this.targetId, data);
};

RangeWhiskerGraph.prototype.isNumber = function(value) {
	if (value == "")
		return false;

	var d = parseInt(value);
	if (!isNaN(d))
		return true;
	else
		return false;

};

/**
 There are several different methods for calculating quartiles.[1] This calculator uses a method described by Moore and McCabe to find quartile values. 
 The same method also used by The TI-83 to calculate quartile values. 
 With this method, the first quartile is the median of the numbers below the median, the third quartile is the median of the numbers above the median.

 http://www.miniwebtool.com/quartile-calculator/
 http://www.alcula.com/calculators/statistics/box-plot/

 **/
RangeWhiskerGraph.prototype.getQ1 = function(array) {
	array = array.slice(0, array.length / 2);
	return this.getMedian(array);
};

RangeWhiskerGraph.prototype.getQ3 = function(array) {
	array = array.slice((array.length + 1) / 2);
	return this.getMedian(array);

};

RangeWhiskerGraph.prototype.getQ2 = function(array) {
	return this.getMedian(array);
};

RangeWhiskerGraph.prototype.getBelowOutliers = function(belowLimit, array) {
	var points = [];
	for ( var i = 0; i < array.length; i++) {
		if (array[i] <= belowLimit) {
			points.push(array[i]);
		}
	}
	return points;
};

RangeWhiskerGraph.prototype.getAboveOutliers = function(aboveLimit, array) {
	var points = [];
	for ( var i = 0; i < array.length; i++) {
		if (array[i] >= aboveLimit) {
			points.push(array[i]);
		}
	}
	return points;
};

RangeWhiskerGraph.prototype.minValueWhisker = function(belowLimit, q1, array) {
	var points = [];

	for ( var i = 0; i < array.length; i++) {
		if ((array[i] < q1) && (array[i]) > belowLimit) {
			points.push(array[i]);
		}
	}

	if (points.length > 0) {
		points.sort(function(a, b) {
			return a - b;
		});
		return points[0];
	}
	return null;
};

//RangeWhiskerGraph.prototype.maxValueWhisker = function(aboveLimit, q3, array){
//	var points = [];
//	for (var i = 0; i < array.length; i++){
//		if ((array[i] > q3) && (array[i]) <= aboveLimit){
//			points.push(array[i]);
//		}
//	}
//	if (points.length > 0){
//		points.sort(function(a, b){return a - b;});
//		return points[points.length - 1];
//	}
//	return null;
//};

RangeWhiskerGraph.prototype.drawPoints = function(boxProperties) {
	if (this.plotPoints) {
		for ( var i = 0; i < boxProperties.values.length; i++) {
			var value = boxProperties.values[i];
			var toPixel = this.pointToPixel(value, boxProperties);
			SVG.drawCircle(boxProperties.x, toPixel, this.pointRadius, this.svg,
					[
						[ "fill", "green" ], [ "fill-opacity", this.fillOpacityPoint ], [ 'stroke-opacity', this.strokeOpacityPoint ],
						[ "stroke", "black" ] ]);
		}
	}
};

RangeWhiskerGraph.prototype.plotRangeQ1Q3 = function(data, properties) {
	var posX = this.left + this.rulerWidth;

	var boxBordersPointsQ1 = [];
	var boxBordersPointsQ3 = [];
	var Q2 = [];

	for ( var i = 0; i < data.clusters.length; i++) {
		var cluster = data.clusters[i];
		/** inter cluster space **/
		posX = posX + this.interClustersSpace;

		for ( var j = 0; j < cluster.classes.length; j++) {
			var ratio = properties.width / (properties.xValues.range);
			var coorX = (cluster.x - properties.xValues.min) * ratio + this.rulerWidth;
			var boxProperties = {
				name : cluster.classes[j].name,
				values : cluster.classes[j].values,
				minPoint : properties.minPoint,
				maxPoint : properties.maxPoint,
				x : coorX + this.left,
				y : this.top,
				width : properties.classWidth,
				height : this.height - this.top - this.bottom - this.clusterTitleHeight - this.rulerHeight
			};

			var result = this.calculate(boxProperties.values);
			var boxColor = this.getClassColor(boxProperties.name);

			if (this.isNumber(result.Q1) && this.isNumber(result.Q3)) {
				var x = boxProperties.x;
				var y = this.pointToPixel(result.Q1, boxProperties);
				if (boxBordersPointsQ1[cluster.classes[j].name] == null) {
					boxBordersPointsQ1[cluster.classes[j].name] = [];
				}
				boxBordersPointsQ1[cluster.classes[j].name].push({
					x : x,
					y : y
				});

				x = boxProperties.x;
				y = this.pointToPixel(result.Q3, boxProperties);
				if (boxBordersPointsQ3[cluster.classes[j].name] == null) {
					boxBordersPointsQ3[cluster.classes[j].name] = [];
				}
				boxBordersPointsQ3[cluster.classes[j].name].push({
					x : x,
					y : y
				});
			} else {

				if (this.isNumber(result.Q2)) {

					if (boxBordersPointsQ1[cluster.classes[j].name] == null) {
						boxBordersPointsQ1[cluster.classes[j].name] = [];
					}

					if (boxBordersPointsQ3[cluster.classes[j].name] == null) {
						boxBordersPointsQ3[cluster.classes[j].name] = [];
					}

					boxBordersPointsQ1[cluster.classes[j].name].push({
						x : boxProperties.x,
						y : this.pointToPixel(result.Q2, boxProperties)
					});
					boxBordersPointsQ3[cluster.classes[j].name].push({
						x : boxProperties.x,
						y : this.pointToPixel(result.Q2, boxProperties)
					});
				}
			}
		}
	}
	for ( var classe in boxBordersPointsQ1) {
		var points = boxBordersPointsQ1[classe];
		var pointsSVG = "";
		for (var k = 0; k < points.length; k++) {
			pointsSVG = Number(points[k].x).toFixed(1) + "," + Number(points[k].y).toFixed(1) + " " + pointsSVG;
		}

		points = boxBordersPointsQ3[classe];
		for (var z = points.length - 1; z >= 0; z--) {
			pointsSVG = Number(points[z].x).toFixed(1) + "," + Number(points[z].y).toFixed(1) + " " + pointsSVG;
		}

		SVG.drawPoligon(pointsSVG, this.svg, [
			[ "fill", this.getClassColor(classe) ], [ "opacity", "0.3" ], [ "stroke", "black" ], [ "stroke-width", 1 ] ]);
	}
};

RangeWhiskerGraph.prototype.plotWhisters = function(data, properties) {
	var colors = [ "yellow", "orange", "green" ];

	this.plotRangeQ1Q3(data, properties);
	var Q2 = {};

	for ( var i = 0; i < data.clusters.length; i++) {
		var cluster = data.clusters[i];
		for ( var j = 0; j < cluster.classes.length; j++) {
			var ratio = properties.width / (properties.xValues.range);
			var coorX = (cluster.x - properties.xValues.min) * ratio + this.left + this.rulerWidth - this.rulerStroke;
			var boxProperties = {
				name : cluster.classes[j].name,
				values : cluster.classes[j].values,
				minPoint : properties.minPoint,
				maxPoint : properties.maxPoint,
				x : coorX,
				y : this.top,
				width : properties.classWidth,
				height : this.height - this.top - this.bottom - this.clusterTitleHeight - this.rulerHeight
			};

			this.drawPoints(boxProperties);

			/** PLOTTING Q2 **/
			var result = this.calculate(boxProperties.values);
			var boxColor = this.getClassColor(boxProperties.name);
			if (this.isNumber(result.Q2)) {
				if (Q2[boxProperties.name] != null) {
					SVG.drawLine(boxProperties.x, this.pointToPixel(result.Q2, boxProperties), Q2[boxProperties.name].x, Q2[boxProperties.name].y,
							this.svg, [ [ "stroke", boxColor ], [ "stroke-width", "2" ] ]);
				}
				Q2[boxProperties.name] = {
					x : boxProperties.x,
					y : this.pointToPixel(result.Q2, boxProperties)
				}
			}
		}
	}

};

RangeWhiskerGraph.prototype.draw = function(targetId, data) {
	//this.calculate(data);
	this.targetId = targetId;
	var properties = (this.getDimensions(data));
	this.svg = SVG.createSVGCanvas(document.getElementById(this.targetId), [ [ "width", this.width ], [ "height", this.height ] ]);
	this.plotAxes(properties);
	this.plotWhisters(data, properties);
};

RangeWhiskerGraph.prototype.input = function() {
	return DATADOC.getBoxWhikerData();
};

RangeWhiskerGraph.prototype.test = function(targetId) {
	var plot = new RangeWhiskerGraph({
		targetId : targetId,
		height : 350,
		width : 450,
		maxBoxWidth : 25
	});
	plot.refresh(this.input());
};

StdDevDyGraph.prototype.dblclick = DygraphWidget.prototype.dblclick;
StdDevDyGraph.prototype._createHTLMWrapper = DygraphWidget.prototype._createHTLMWrapper;
StdDevDyGraph.prototype.draw = DygraphWidget.prototype.draw;

function StdDevDyGraph(targetId, args) {
	this.scaled = false;
	if (args == null) {
		args = {};
	}
	args.customBars = true;
	DygraphWidget.prototype.constructor.call(this, targetId, args);
}

StdDevDyGraph.prototype.input = function () {
	return {
		data : [ [ 1, [ 2, 3, 3.5 ], [ 4, 4.2, 5 ] ], [ 2, [ 5, 5.5, 5.7 ], [ 4, 4.2, 5 ] ] ],
		colors : [ "blue", "red" ],
		labels : [ "", 'data1', 'data2' ]
	};
};

StdDevDyGraph.prototype.test = function (targetId) {
	var dygraphObject = new StdDevDyGraph(targetId, {
		width : 500,
		height : 400,
		xlabel : "xLabel",
		showRangeSelector : false
	});

	dygraphObject.draw(dygraphObject.input().data, dygraphObject.input().colors, dygraphObject.input().labels);
};



function AbinitioGrid(args) {
	this.height = null;
	this.width = null;
	this.id = BUI.id();

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;

			if (args.width != null) {
				this.width = args.width;
			}
		}
	}
	
	this.onSelected = new Event(this);
};


AbinitioGrid.prototype.refresh = function(subtractions){
	this.store.loadData(this._prepareData(subtractions));
};

AbinitioGrid.prototype._prepareData = function(subtractions){
	/** Parsing data * */
	var models = [];
	for (var l = 0; l < subtractions.length; l++) {
		var subtraction = subtractions[l];
		for (var k = 0; k < subtraction.substractionToAbInitioModel3VOs.length; k++) {
			var data = subtraction.substractionToAbInitioModel3VOs[k].abinitiomodel3VO;
			if (data.averagedModel != null) {
				models.push(data.averagedModel);
				models[models.length - 1].type = "Reference";
			}
	
			if (data.shapeDeterminationModel != null) {
				models.push(data.shapeDeterminationModel);
				models[models.length - 1].type = "Refined";
			}
	
			if (data.modelList3VO != null) {
				if (data.modelList3VO.modeltolist3VOs != null) {
					for (var i = 0; i < data.modelList3VO.modeltolist3VOs.length; i++) {
						models.push(data.modelList3VO.modeltolist3VOs[i].model3VO);
						models[models.length - 1].type = "Model";
					}
				}
			}
		}
	}
	return models;
};

AbinitioGrid.prototype.getPanel = function(){
	var _this = this;
	
	
	var modelFields = [ "modelId", "type", "chiSqrt", "dmax", "firFile", "logFile", "fitFile", "pdbFile", "rfactor", "rg", "volume" ];
	Ext.define('AbinitioModel', {
		extend : 'Ext.data.Model',
		fields : modelFields
		
	});

	/**
	 * Store in Memory
	 */
	this.store = Ext.create('Ext.data.Store', {
		model : 'AbinitioModel',
		autoload : true,
		groupField : 'type'
	});
	
	
	  var groupingFeature = Ext.create('Ext.grid.feature.Grouping',{
	        groupHeaderTpl: '{name} ({rows.length} model{[values.rows.length > 1 ? "s" : ""]})',
	        startCollapsed: true,
	        collapsible : true
	  });
	
	this.grid = Ext.create('Ext.grid.Panel', {
		collapsible : false,
		resizable : true,
		features: [groupingFeature],
		autoscroll : true,
		multiSelect : true,
		store : this.store,
		height : this.height,
		width : this.width,
		margin : 10,
		columns : [ {
			text : "Type",
			dataindex : "type",
			hidden : true,
			renderer : function(a, b, record) {
				return record.data.type;
			},
			flex : 1
		},
		{
			text : "ModelId",
			dataindex : "modelId",
			hidden : true,
			renderer : function(a, b, record) {
					return record.data.modelId;
				
			},
			flex : 1
		},
		
		{
			text : "chiSqrt",
			dataindex : "chiSqrt",
			renderer : function(a, b, record) {
				if (record.data.dmax != null) {
					return BUI.formatValuesUnits(record.data.chiSqrt, "", 12, this.decimals);
				}
				
			},
			flex : 1
		},
		{
			text : "Dmax",
			dataindex : "dmax",
			renderer : function(a, b, record) {
				if (record.data.dmax != null) {
					return BUI.formatValuesUnits(record.data.dmax, "nm", 12, this.decimals);
				}
				
			},
			flex : 1
		}, {
			text : "rFactor",
			dataindex : "rfactor",
			hidden : true,
			renderer : function(a, b, record) {
				if (record.data.rfactor != null) {
					return record.data.rfactor;
				}
			},
			flex : 1
		}, {
			text : "Rg",
			dataindex : "rg",
			renderer : function(a, b, record) {
				if (record.data.rg != null) {
					return BUI.formatValuesUnits(record.data.rg, "nm", 12, this.decimals);
				}
				
			},
			flex : 1
		},
		{
			text : "Volume",
			dataindex : "volume",
			renderer : function(a, b, record) {
				if (record.raw.volume != null){
					return BUI.formatValuesUnits(record.raw.volume, '') + "<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>";
				}
			},
			flex : 1
		},
		{
			text : "PDB",
			dataindex : "pdbFile",
			renderer : function(a, b, record) {
				if (record.data.pdbFile != null){
					return record.data.pdbFile.split("/")[record.data.pdbFile.split("/").length - 1];
				}
			},
			flex : 1
		}, {
			text : "Fir",
			dataindex : "firFile",
			renderer : function(a, b, record) {
				if (record.data.firFile != null){
					return record.data.firFile.split("/")[record.data.firFile.split("/").length - 1];
				}
			},
			flex : 1
		}, {
			text : "LOG",
			dataindex : "logFile",
			hidden : true,
			renderer : function(a, b, record) {
				if (record.data.logFile != null){
					return record.data.logFile.split("/")[record.data.logFile.split("/").length - 1];
				}
			},
			flex : 1
		}
		],
		viewConfig : {
			enableTextSelection : true,
			preserveScrollOnRefresh : true,
			stripeRows : true,
			listeners : {
				'celldblclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
				},
				'cellclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					var models = [];
					for (var i = 0; i < grid.getSelectionModel().selected.items.length; i++) {
						models.push(grid.getSelectionModel().selected.items[i].raw);
					}
					_this.onSelected.notify(models); 
				}
			}
		}
	});
	return this.grid;
	
};


function AdditiveGrid(args) {
	this.onRemoveButtonClicked = new Event(this);
}

AdditiveGrid.prototype.getBuffer = function() {
	return this.buffer;
};

AdditiveGrid.prototype._getActions = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add',
		disabled : true,
		alwaysEnabled : true,
		handler : function(widget, event) {
			_this.buffer.bufferhasadditive3VOs.push(BIOSAXS_BEANS.getBufferhasAdditive3VO());
			_this.refresh(_this.buffer, _this.experiment);
		}
	}));

	return actions;
};

AdditiveGrid.prototype.refresh = function(buffer, experiment) {
	this.buffer = buffer;
	this.experiment = experiment;
	if (buffer) {
		if (buffer.bufferhasadditive3VOs) {
			this.features = buffer.bufferhasadditive3VOs;
		}
	}
	this.experiment = experiment;
	this.store.loadData(this._prepareData(), false);
};

AdditiveGrid.prototype.getAdditives = function() {
	var additives = [];
	for ( var i = 0; i < this.store.getCount(); i++) {
		var bufferHasAdditive = BIOSAXS_BEANS.getBufferhasAdditive3VO();
		var data = this.store.getAt(i).getData();

		bufferHasAdditive.additive3VO.name = data.name;
		bufferHasAdditive.additive3VO.comments = data.comments;
		bufferHasAdditive.additive3VO.additiveType = data.additiveType;

		bufferHasAdditive.bufferId = this.buffer.bufferId;
		bufferHasAdditive.bufferHasAdditiveId = data.bufferHasAdditiveId;
		bufferHasAdditive.quantity = data.quantity;
		additives.push(bufferHasAdditive);
	}

	return additives;
};

AdditiveGrid.prototype._getFields = function(buffers) {
	var columns = [

		{
			header : 'Name',
			dataIndex : 'name',
			type : 'string',
			editor : {
				allowBlank : true
			},
			flex : 1
		},
		{
			header : 'Type',
			name : 'additiveType',
			dataIndex : 'additiveType',
			editor : {
				xtype : 'combobox',
				typeAhead : true,
				triggerAction : 'all',
				selectOnTab : true,
				store : BIOSAXS.proposal.getAdditiveTypes(),
				lazyRender : true,
				listClass : 'x-combo-list-small'
			},
			flex : 0.6
		},
		{
			header : 'Quantity',
			dataIndex : 'quantity',
			name : 'quantity',
			editor : {
				allowBlank : true
			},
			type : 'string',
			flex : 1
		},
		{
			xtype : 'actioncolumn',
			items : [ {
				icon : '../images/cancel.png',
				tooltip : 'Delete additive',
				scope : this,
				handler : function(grid, rowIndex, colIndex) {
					if ((grid.getStore().getAt(rowIndex).data.bufferHasAdditiveId == null)|| (grid.getStore().getAt(rowIndex).data.bufferHasAdditiveId == "")) {
						grid.getStore().removeAt(rowIndex);
					} else {
						this.onRemoveButtonClicked.notify({
							'bufferId' : this.buffer.bufferId,
							'bufferHasAdditiveId' : this.store.getAt(rowIndex).data.bufferHasAdditiveId
						});
					}
				}
			} ]
		} ];

	return columns;
};

AdditiveGrid.prototype._prepareData = function() {
	var data = [];
	if (this.features == null) {
		this.features = [];
	}
	for (var i = 0; i < this.features.length; i++) {
		var object = this.features[i];
		object.name = this.features[i].additive3VO.name;
		object.additiveType = this.features[i].additive3VO.additiveType;
		object.comments = this.features[i].additive3VO.comments;
		object.additiveId = this.features[i].additive3VO.additiveId;
		data.push(object);
	}
	return data;
};

AdditiveGrid.prototype.getPanel = function(buffer, experiment) {
	this.buffer = buffer;
	this.features = buffer.bufferhasadditive3VOs;
	this.experiment = experiment;
	return this._renderGrid();
};

AdditiveGrid.prototype.getStore = function() {
	var _this = this;
	var store = Ext.create('Ext.data.Store', {
		fields : [ "name", "additiveType", "comments", "additiveId", "bufferHasAdditiveId", "quantity" ],
		autoload : false,
		data : this._prepareData(),
		listeners : {
			update : function(store, record) {
				record.index = _this.grid.getSelectionModel().getCurrentPosition().row;
				_this.buffer.bufferhasadditive3VOs[record.index].additive3VO.name = record.data.name;
				_this.buffer.bufferhasadditive3VOs[record.index].additive3VO.additiveType = record.data.additiveType;
				_this.buffer.bufferhasadditive3VOs[record.index].additive3VO.comments = record.data.comments;
				_this.buffer.bufferhasadditive3VOs[record.index].quantity = record.data.quantity;
			}
		}
	});

	//	store.sort('bufferHasAdditiveId', 'ASC');
	store.loadData(this._prepareData(), false);
	return store;
};

AdditiveGrid.prototype._renderGrid = function() {
	var _this = this;
	this.store = this.getStore();

	var cellEditing = Ext.create('Ext.grid.plugin.CellEditing', {
		clicksToEdit : 1
	});

	this.grid = Ext.create('Ext.grid.Panel', {
		dockedItems : [ {
			xtype : 'toolbar',
			items : this._getActions()
		} ],
		store : this.store,
		height : 230,
		title : "Additives",
		width : "100%",
		columns : _this._getFields(),
		plugins : [ cellEditing ],
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemcontextmenu : function(view, rec, node, index, e) {
					e.stopEvent();
					contextMenu.showAt(e.getXY());
					return false;
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	return this.grid;
};

AdditiveGrid.prototype.input = function() {
};

AdditiveGrid.prototype.test = function(targetId) {
	var grid = new AdditiveGrid();
	var panel = grid.getPanel([]);
	panel.render(targetId);

};

/** AnalysisGrid **/
function AnalysisGrid(args) {
	var _this = this;

	this.id = BUI.id();
	if (Ext.get("mainPanel")){
		this.width = Ext.get("mainPanel").getWidth();
	}
	else{
		this.width = this.maxWidth;
	}
	this.maxWidth = 1500;

	/** Visibles **/
	this.isGuinierTabVisible = true;
	this.isGnomTabVisible = true;
	this.isPorodTabVisible = true;
	this.isScatteringPlotVisible = true;
	this.isAbinitioTabVisible = true;
	this.showButtonsVisible = true;
	this.isI0Visible = true;

	this.margin = null;
	this.grouped = true;

	this.hideNulls = false;
	this.decimals = 4;
	this.height = null;
	this.sorters = [ {
		property : 'conc',
		direction : 'ASC'
	} ];

	if (args != null) {
		if (args.grouped != null) {
			this.grouped = args.grouped;
		}

		if (args.showButtonsVisible != null) {
			this.showButtonsVisible = args.showButtonsVisible;
		}
		if (args.isI0Visible != null) {
			this.isI0Visible = args.isI0Visible;
		}
		if (args.sorters != null) {
			this.sorters = args.sorters;
		}
		if (args.isScatteringPlotVisible != null) {
			this.isScatteringPlotVisible = args.isScatteringPlotVisible;
		}
		if (args.isGuinierTabVisible != null) {
			this.isGuinierTabVisible = args.isGuinierTabVisible;
		}
		if (args.isGnomTabVisible != null) {
			this.isGnomTabVisible = args.isGnomTabVisible;
		}
		if (args.isPorodTabVisible != null) {
			this.isPorodTabVisible = args.isPorodTabVisible;
		}
		if (args.hideNulls != null) {
			this.hideNulls = args.hideNulls;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.maxWidth != null) {
			this.maxWidth = args.maxWidth;
		}
	}
}

AnalysisGrid.prototype.refresh = function(data, args) {
	this.store.loadData(this._prepareData(data), false);
	if (args != null){
		if (args.experiment != null){
			this.experiment = args.experiment;
		}
	}
};

AnalysisGrid.prototype._getPorod = function() {
	return {
		text : 'Porod',
		name : 'Porod',
		columns : [
			{
				text : 'Volume',
				dataIndex : 'volumeEdna',
				width : 75,
				sortable : true,
				hidden : !this.isPorodTabVisible,
				renderer : function(val, y, sample) {
					if (sample.raw.volume != null)
						return BUI.formatValuesUnits(sample.raw.volume, '') + "<span style='font-size:8px;color:gray;'> nm<sub>3</sub></span>";
					}
			},
			{
				text : 'MM Vol. est.',
				dataIndex : 'volumeEdna',
				tooltip : '[Volume/2 - Volume/1.5] (Guinier)',
				sortable : true,
				width : 95,
				hidden : !this.isPorodTabVisible,
				renderer : function(val, y, sample) {
					if (sample.raw.volume != null)
						return Number(sample.raw.volume / 2).toFixed(1) + " - " + Number(sample.raw.volume / 1.5).toFixed(1)+ "<span style='font-size:8px;color:gray;'>kD</span>";
				}
			} ]
	};
};


AnalysisGrid.prototype._getFramesColumn = function() {
	var _this = this;
	return {
		text : 'Frames (Averaged/Total)',
		dataIndex : 'datacollection',
		name : 'datacollection',
		sortable : true,
		width : 150,
		renderer : function(dataCollections, y, data) {
			/** Bug of Webservices: frames count were swapped with frames averages **/
			if (data.raw.bufferAfterFramesCount){
				if (data.raw.bufferAfterFramesMerged){
					if (parseInt(data.raw.bufferAfterFramesMerged) > parseInt(data.raw.bufferAfterFramesCount)){
						var aux =  parseInt(data.raw.bufferAfterFramesCount);
						data.raw.bufferAfterFramesCount= data.raw.bufferAfterFramesMerged;
						data.raw.bufferAfterFramesMerged =  aux;
					}
				}
			}
			
			if (data.raw.bufferBeforeFramesCount){
				if (data.raw.bufferBeforeFramesMerged){
					if (parseInt(data.raw.bufferBeforeFramesMerged) > parseInt(data.raw.bufferBeforeFramesCount)){
						var aux =  parseInt(data.raw.bufferBeforeFramesCount);
						data.raw.bufferBeforeFramesCount= data.raw.bufferBeforeFramesMerged;
						data.raw.bufferBeforeFramesMerged =  aux;
					}
				}
				
			}
				
			var bufferAcronym = data.raw.bufferAcronym;
			var macromoleculeAcronym = data.raw.macromoleculeAcronym;
			var bbmerges = data.raw.bufferBeforeFramesMerged;
			var molmerges = data.raw.framesMerge;
			var bamerges = data.raw.bufferAfterFramesMerged;
			var totalframes = data.raw.framesCount;
			var bufferId = data.raw.bufferId;
			var macromoleculeId = data.raw.macromoleculeId;
			var macromoleculeColor = null;
			if (_this.experiment != null){
				macromoleculeColor = _this.experiment.macromoleculeColors[data.raw.macromoleculeId];
			}
			
			/** BUG in the database to be fixed **/
			try{
				if (totalframes != null){
					if(molmerges != null){
						if (parseFloat(totalframes) < parseFloat(molmerges)){
							var aux = totalframes;
							totalframes = molmerges;
							molmerges = aux;
						}
					}
				}
			}
			catch(e){
				
			}
			
			return BUI.getHTMLTableForFrameAveraged(bufferAcronym, 
					macromoleculeAcronym, 
					bbmerges, 
					molmerges, 
					bamerges, 
					totalframes, 
					bufferId,
					macromoleculeId,
					macromoleculeColor);
		}
	};
};

AnalysisGrid.prototype._getColumns = function() {
	var _this = this;
	return [
		{
			name : 'groupeField',
			dataIndex : 'groupeField',
			hidden : true

		},
		{
			"header" : "subtractionId",
			hidden : true,
			"dataIndex" : "subtractionId",
			"name" : "subtractionId"
		},
		{
			header : "Macromolecule",
			dataIndex : "macromoleculeAcronym",
			name : "macromoleculeAcronym",
			renderer : function(val, y, sample) {
				return '<table><tr><td><span style="color:green;font-size:14;">' + val + '</span></td></tr><tr><td>' +
					BUI.formatValuesUnits(sample.raw.conc, "mg/ml", 10, this.decimals) + '</td></tr><tr><td>' +
					BUI.formatValuesUnits(sample.raw.exposureTemperature, "C", 10, this.decimals) + '</td></tr></table>'
			}
		},
		{
			header : "Order",
			dataIndex : "priorityLevelId",
			name : "priorityLevelId",
			hidden : true
		},
		{
			header : "Code",
			dataIndex : "code",
			name : "code",
			hidden : true
		},
		{
			header : "Conc.",
			dataIndex : "conc",
			width : 80,
			name : "conc",
			type : "number",
			hidden : true,
			renderer : function(val, y, sample) {
				return BUI.formatValuesUnits(val, "mg/ml", 10, this.decimals);
			}
		},
		{
			text : 'Scattering',
			width : 100,
			dataIndex : 'subtractionId',
			name : 'subtractionId',
			hidden : !this.isScatteringPlotVisible,
			renderer : function(val, y, sample) {
				var url = BUI.getURL() + '&type=scattering&subtractionId=' + sample.raw.subtractionId;
				var event = "OnClick= window.open('" + url + "')";
				return '<img src=' + url + '   height="80" width="80" ' + event + '>';
			}
		},
		{
			text : 'Kratky',
			width : 100,
			dataIndex : 'subtractionId',
			hidden : true,
			name : 'subtractionId',
			renderer : function(val, y, sample) {
				var url = BUI.getURL() + '&type=kratky&subtractionId=' + sample.raw.subtractionId;
				var event = "OnClick= window.open('" + url + "')";
				return '<img src=' + url + '   height="80" width="80" ' + event + '>';
			}
		},
		this._getFramesColumn(),
		{
			text : 'File Name',
			dataIndex : 'averageFilePath',
			name : 'averageFilePath',
			sortable : true,
			width : 150,
			hidden : true,
			renderer : function(dataCollections, y, data) {
				return BUI.getHTMLTableForPrefixes(data.raw.bufferBeforeAverageFilePath, data.raw.averageFilePath,
						data.raw.bufferAfterAverageFilePath);
			}
		},

		{
			text : 'Guinier',
			name : 'Guinier',
			columns : [
				{
					text : 'Rg',
					dataIndex : 'rgGuinier',
					name : 'rgGuinier',
					hidden : !this.isGuinierTabVisible,
					width : 75,
					tooltip : 'In polymer physics, the radius of gyration is used to describe the dimensions of a polymer chain.',
					sortable : true,
					renderer : function(val, y, sample) {
						if (sample.raw.rgGuinier != null) {
							/** Show warning if rgGuinier and rgGnom differ more than 10% **/
							if (Math.abs(sample.raw.rgGuinier - sample.raw.rgGnom) > (sample.raw.rgGuinier * 0.1)) {
								return "<span style='color:orange;'>" + BUI.formatValuesUnits(sample.raw.rgGuinier, "") + "</span>";

							}
							return BUI.formatValuesUnits(sample.raw.rgGuinier, "nm", 12, this.decimals);
						}
					}
				},
				{
					text : 'Points',
					dataIndex : 'points',
					sortable : true,
					width : 100,
					type : 'string',
					hidden : !this.isGuinierTabVisible,
					renderer : function(val, y, sample) {
						if ((sample.raw.firstPointUsed == "") || (sample.raw.firstPointUsed == null))
							return;
						return "<span>" + sample.raw.firstPointUsed + " - " + sample.raw.lastPointUsed + " (" +
								(sample.raw.lastPointUsed - sample.raw.firstPointUsed) + " )</span>";
					}
				},
				{
					text : 'Quality',
					dataIndex : 'quality',
					hidden : !this.isGuinierTabVisible,
					tooltip : 'Estimated data quality. 1.0 - means ideal quality, 0.0 - unusable data. In table format it is given in percent (100% - ideal quality, 0% - unusable data). Please note that this estimation is based only on the Guinier interval (very low angles).',
					width : 60,
					sortable : true,
					renderer : function(val, y, sample) {
						if (sample.raw.quality != null) {
							val = sample.raw.quality;
							if ((val != null) && (val != "")) {
								return "<span>" + (Number(val) * 100).toFixed(2) + "</span><span style='font-size:8px;color:gray;'> %</span>";
							}
						}
					}
				}, {
					text : 'I(0)',
					dataIndex : 'I0',
					sortable : true,
					hidden : !this.isI0Visible,
					tooltip : 'Extrapolated scattering intensity at zero angle I(0) (forward scattering)',
					width : 75,
					type : 'string',
					renderer : function(val, y, sample) {
						if (sample.raw.I0 != null) {
							return BUI.formatValuesErrorUnitsScientificFormat(sample.raw.I0, sample.raw.i0stdev, "");
						}
					}
				}, {
					text : 'Aggregated',
					tooltip : "If aggregation was detected from the slope of the data curve at low angles the value is '1', otherwise '0'.",
					dataIndex : 'isagregated',
					hidden : true,
					width : 75,
					renderer : function(val, y, sample) {
						if ((sample.raw.isagregated != null)) {
							if (val == true) {
								return "Yes";
							} else {
								return "No";
							}
						}
					}
				}, {
					text : 'Guinier',
					sortable : true,
					dataIndex : 'subtractionId',
					type : 'string',
					width : 100,
					hidden : true,
					renderer : function(val, y, sample) {

						if (sample.raw.subtractionId != null) {
							var url = BUI.getURL() + '&type=guinier&subtractionId=' + sample.raw.subtractionId;
							var event = "OnClick= window.open('" + url + "')";
							return '<img src=' + url + '   height="80" width="80" ' + event + '>';
						}
					}
				} ]
		},
		{
			text : 'Gnom',
			name : 'Gnom',

			columns : [ {
				text : 'Rg',
				dataIndex : 'rgGnom',
				type : 'string',
				width : 65,
				hidden : !this.isGnomTabVisible,
				sortable : true,
				renderer : function(val, y, sample) {
					/** Show warning if rgGuinier and rgGnom differ more than 10% **/
					if (sample.raw.rgGnom != null) {
						if (Math.abs(sample.raw.rgGuinier - sample.raw.rgGnom) > (sample.raw.rgGuinier * 0.1)) {
							return "<span style='color:orange;'>" + BUI.formatValuesUnits(sample.raw.rgGnom, "") + "</span>";

						}
						return BUI.formatValuesUnits(sample.raw.rgGnom, "nm");
					}
				}
			}, {
				text : 'Total',
				dataIndex : 'total',
				width : 65,
				hidden : !this.isGnomTabVisible,
				sortable : true,
				renderer : function(val, y, sample) {
					if (sample.raw.total != null)
						return BUI.formatValuesUnits(sample.raw.total, '');
				}
			}, {
				text : 'D<sup>max</sup>',
				dataIndex : 'dmax',
				sortable : true,
				width : 75,
				hidden : !this.isGnomTabVisible,
				renderer : function(val, y, sample) {
					if (sample.raw.dmax != null)
						return BUI.formatValuesUnits(sample.raw.dmax, "") + "<span style='font-size:8px;color:gray;'> nm</span>";
				}
			}, {
				text : 'P(r)',
				sortable : true,
				hidden : true,
				width : 100,
				dataIndex : 'subtractionId',
				type : 'string',
				renderer : function(val, y, sample) {
					var url = BUI.getURL() + '&type=gnom&subtractionId=' + sample.raw.subtractionId;
					var event = "OnClick= window.open('" + url + "')";
					return '<img src=' + url + '   height="80" width="80" ' + event + '>';
				}
			} ]
		},
		this._getPorod(),
		{
			text : 'AbInitio Modeling',
			name : 'AbInitio_modeling',

			columns : [
				{
					text : 'NSD',
					dataIndex : 'volumeEdna',
					width : 100,
					sortable : true,
					hidden : true,
					renderer : function(val, y, sample) {
						var url = BUI.getNSDImageURL(sample.raw.modelListId); 
						var event = "OnClick= window.open('" + url + "')";
						return '<img src=' + url + '   height="80" width="80" ' + event + '>';
					}
				},
				{
					text : 'Chi2',
					dataIndex : 'volumeEdna',
					sortable : true,
					hidden : true,
					width : 100,
					renderer : function(val, y, sample) {
						var url = BUI.getCHI2ImageURL(sample.raw.modelListId);
						var event = "OnClick= window.open('" + url + "')";
						return '<img src=' + url + '   height="80" width="80" ' + event + '>';
					}
				},
				{
					text : 'Pdb',
					dataIndex : 'volumeEdna',
					tooltip : 'Damaver: The program suite DAMAVER is a set of programs to align ab initio models, select the most typical one and build an averaged model. Dammif : Rapid ab initio shape determination by simulated annealing using a single phase dummy atom model. Dammin :Ab initio shape determination by simulated annealing using a single phase dummy atom model',
					sortable : true,
					width : 125,
					hidden : !this.isAbinitioTabVisible,
					renderer : function(val, y, sample) {
						var html = new String();
						var split = null;
						var url = null;
						var file = sample.raw.averagedModel;
						if (file != null) {
							split = file.split("/");
							if (split.length > 0) {
								url = BUI.getPdbURL() + '&type=AVERAGED&abInitioModelId=' + sample.raw.abInitioModelId;
								html = html + '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >'+ split[split.length - 1] + '</a><br /><br />';

							}
						}

						file = sample.raw.rapidShapeDeterminationModel;
						if (file != null) {
							split = file.split("/");
							if (split.length > 0) {
								url = BUI.getPdbURL() + '&type=RAPIDSHAPEDETERMINATIONMODEL&abInitioModelId=' + sample.raw.abInitioModelId;
								html = html + '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >' + split[split.length - 1] + '</a><br /><br />';
							}
						}

						file = sample.raw.shapeDeterminationModel;
						if (file != null) {
							split = file.split("/");
							if (split.length > 0) {
								url = BUI.getPdbURL() + '&type=SHAPEDETERMINATIONMODEL&abInitioModelId=' + sample.raw.abInitioModelId;
								html = html + '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >'+ split[split.length - 1] + '</a>';
							}
						}
						return html;
					}
				},
				{
					text : 'Damaver',
					dataIndex : 'volumeEdna',
					hidden : true,
					tooltip : 'Damaver: The program suite DAMAVER is a set of programs to align ab initio models, select the most typical one and build an averaged model. ',
					sortable : true,
					width : 125,
					renderer : function(val, y, sample) {
						var file = sample.raw.averagedModel;
						if (file != null) {
							var split = file.split("/");
							if (split.length > 0) {
								var url = BUI.getPdbURL() + '&type=AVERAGED&abInitioModelId=' + sample.raw.abInitioModelId;
								return '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >' + split[split.length - 1]+ '</a>';
							}
						}
						return sample.raw.averagedModel;
					}
				},
				{
					text : 'Dammif',
					dataIndex : 'volumeEdna',
					hidden : true,
					tooltip : 'Dammif : Rapid ab initio shape determination by simulated annealing using a single phase dummy atom model',
					sortable : true,
					width : 125,
					renderer : function(val, y, sample) {
						var file = sample.raw.rapidShapeDeterminationModel;
						if (file != null) {
							var split = file.split("/");
							if (split.length > 0) {
								var url = BUI.getPdbURL() + '&type=RAPIDSHAPEDETERMINATIONMODEL&abInitioModelId=' + sample.raw.abInitioModelId;
								return '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >' + split[split.length - 1] + '</a>';
							}
						}
						return sample.raw.averagedModel;
					}
				},
				{
					text : 'Dammin',
					dataIndex : 'volumeEdna',
					hidden : true,
					tooltip : 'Dammin :Ab initio shape determination by simulated annealing using a single phase dummy atom model',
					sortable : true,
					width : 125,
					renderer : function(val, y, sample) {
						var file = sample.raw.shapeDeterminationModel;
						if (file != null) {
							var split = file.split("/");
							if (split.length > 0) {
								var url = BUI.getPdbURL() + '&type=SHAPEDETERMINATIONMODEL&abInitioModelId=' + sample.raw.abInitioModelId;
								return '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >' + split[split.length - 1]+ '</a>';
							}
						}
						return sample.raw.averagedModel;
					}
				} ]
		}, {
			text : 'Time',
			dataIndex : 'substractionCreationTime',
			name : 'substractionCreationTime',
			hidden : true,
			width : 80,
			sortable : true,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				try {
					if (record.raw.substractionCreationTime != null) {
						return moment(record.raw.substractionCreationTime).format('h:mm:ss a');
					}
				} catch (e) {
					return "NA";
				}
			}
		}, {
			text : 'Date',
			dataIndex : 'substractionCreationTime',
			name : 'substractionCreationTime',
			hidden : true,
			width : 80,
			sortable : true,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				try {
					if (record.raw.substractionCreationTime != null) {
						return moment(record.raw.substractionCreationTime).format("LL");
					}
				} catch (e) {
					return "NA";
				}
			}
		}, 
		this._getButtons()];
};

AnalysisGrid.prototype._getButtons = function() {
	return {
		id : this.id + 'buttonPlot',
		name : 'buttonPlot',
		hidden : !this.showButtonsVisible,
		width : 110,
		sortable : false,
		renderer : function(value, metaData, sample, rowIndex, colIndex, store) {
			var html = "<table><tr><td style='padding:2px;'>" + BUI.getGreenButton('Calibration', {
				height : 20,
				width : 100
			}) + "</td></tr>";
	
			if (sample.raw.subtractionId) {
				html = html + "<tr><td style='padding:2px;'>" + BUI.getGreenButton('Primary Data Proc.', {
					height : 20,
					width : 100
				}) + "</td></tr>";
				if (sample.raw.rapidShapeDeterminationModelId != null) {
					html = html + "<tr><td  style='padding:2px;'>" + BUI.getGreenButton('AbInitio Modeling', {
						height : 20,
						width : 100
					}) + "<td></tr>";
				}
			}
			return html + "</table>";
		}
	};
};
AnalysisGrid.prototype._prepareData = function(data) {
	if (this.hideNulls) {
		var result = [];
		for ( var i = 0; i < data.length; i++) {
			if (data[i].subtractionId != null) {
				data[i].groupeField = data[i].macromoleculeAcronym + " " + data[i].bufferAcronym;
				result.push(data[i]);
			}
		}
		return result;
	} else {
		return data;
	}
};

AnalysisGrid.prototype.getPanel = function(data) {
	var _this = this;
	var columns = this._getColumns();

	var fields = JSON.parse(JSON.stringify(columns));
	fields.push({
		name : 'experimentId',
		dataIndex : 'experimentId'

	});
	this.store = Ext.create('Ext.data.Store', {
		fields : fields,
		autoload : true,
		data : this._prepareData(data),
		groupField : 'groupeField'
	});

	this.store.sort(this.sorters);

	var features = [];

	if (this.grouped) {
		features.push({
			ftype : 'grouping',
			groupHeaderTpl : '{name}',
			hideGroupedHeader : false,
			startCollapsed : false
		});
	}

	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		maxWidth : this.maxWidth,
		width : this.width,
		height : this.height,
		store : this.store,
		columns : columns,
		resizable : true,
		features : features,
		viewConfig : {
			preserveScrollOnRefresh : true,
			stripeRows : true,
			listeners : {
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonPlot') {
						if (e.target.defaultValue == 'AbInitio Modeling') {
							var url = BUI.getPDBVisualizerURL(record.raw.averagedModelId, record.raw.subtractionId, record.raw.experimentId);
							window.open(url, "_blank");
						}

						if (e.target.defaultValue == 'Primary Data Proc.') {
							_this._edit(record.raw);
						}

						if (e.target.defaultValue == 'Calibration') {
							_this._showCalibration(record.raw);
						}
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	return this.grid;

};

AnalysisGrid.prototype._openVisualizarBySubstractionId = function(record) {
	//experimentId, subtractionId) {
	var experimentId = record.experimentId;
	var subtractionId = record.subtractionId;

	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	this.subtractionId = subtractionId;

	adapter.onSuccess.attach(function(sender, data) {
		var experiment = new Experiment(data);
		var experimentList = new ExperimentList([ experiment ]);
		var subtraction = experiment.getSubtractionById(_this.subtractionId);
		_this.grid.setLoading(false);
		_this._openVisualizer(experimentList, subtraction, record);
	});
	this.grid.setLoading("ISPyB: Fetching experiment");
	adapter.getExperimentById(experimentId, "MEDIUM");
};

AnalysisGrid.prototype._edit = function(record) {
	var experimentId = record.experimentId;
	var _this = this;

	if (BIOSAXS.proposal.macromolecules == null) {
		this.grid.setLoading("ISPyB: Fetching proposal");
		BIOSAXS.proposal.onInitialized.attach(function(sender, data) {
			_this._openVisualizarBySubstractionId(record);
		});
		BIOSAXS.proposal.init();
	} else {
		this._openVisualizarBySubstractionId(record);
	}
};


AnalysisGrid.prototype._showCalibration = function(row) {
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		Ext.create('Ext.window.Window', {
			title : 'Calibration',
			width : 900,
			resizable : true,
			height : 400,
			modal : true,
			frame : false,
			draggable : true,
			closable : true,
			autoscroll : true,
			paddin : 5,
			layout : {
				type : 'vbox',
				align : 'stretch'
			},
			items : [ new AnalysisGrid({
				isGuinierTabVisible : false,
				isGnomTabVisible : false,
				isPorodTabVisible : false,
				isAbinitioTabVisible : false,
				isI0Visible : true,
				showButtonsVisible : false,
				height : 350,
				sorters : [ {
					property : 'experimentId',
					direction : 'DESC'
				} ]
			}).getPanel(data) ]
		}).show();
	});
	adapter.getAnalysisCalibrationByProposalId();
};

AnalysisGrid.prototype._openVisualizer = function(experimentList, subtraction, record) {
	var merges = experimentList.getMergesByDataCollectionId(subtraction.dataCollectionId);
	var mergeIdList = [];
	for ( var i = 0; i < merges.length; i++) {
		mergeIdList.push(merges[i].mergeId);
	}

	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, merges) {
		var dataCollectionCurveVisualizer = new DataCollectionCurveVisualizer();
		dataCollectionCurveVisualizer.draw();
		dataCollectionCurveVisualizer.refresh(merges, experimentList, subtraction.dataCollectionId, record);
	});

	dataAdapter.onError.attach(function(sender, error) {
	});

	dataAdapter.getMergesByIdsList(mergeIdList);
};

AnalysisGrid.prototype.input = function() {
	return {
		data : DATADOC.getData_3367().slice(20, 30),//[{"total":"0.447505552082","bufferBeforeMeasurementId":22150,"sampleMergeId":12373,"averagedModelId":43636,"I0":"32.50776","proposalCode":"OPD","averagedModel":"/data/pyarch/bm29/opd29/1137/1d/damaver.pdb","bufferAfterMergeId":12374,"framesCount":"10","bufferBeforeMergeId":12372,"averageFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_016_ave.dat","bufferAfterMeasurementId":22152,"rgGuinier":"2.96883","subtractedFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_016_sub.dat","firstPointUsed":"30","chi2RgFilePath":"/data/pyarch/bm29/opd29/1137/1d/chi2_R.png","abInitioModelId":272,"macromoleculeId":112,"code":"_20.0_1.25","transmission":"100.0","timeStart":"2013-07-17 17:10:25.743734","bufferAcronym":"MES","quality":"0.87091","shapeDeterminationModelId":43638,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":707,"isagregated":"False","dmax":"10.390905","bufferBeforeAverageFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_015_ave.dat","exposureTemperature":"20.0","subtractionId":5165,"conc":"1.25","rapidShapeDeterminationModel":"/data/pyarch/bm29/opd29/1137/1d/damfilt.pdb","experimentCreationDate":"Jul 17, 2013 5:08:37 PM","lastPointUsed":"92","modelListId":272,"framesMerge":"10","rapidShapeDeterminationModelId":43637,"bufferAfterAverageFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_017_ave.dat","nsdFilePath":"/data/pyarch/bm29/opd29/1137/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1137,"macromoleculeAcronym":"MG386","i0stdev":"0.05726128","sampleMeasurementId":22151,"measurementComments":"[1] MES","priorityLevelId":2,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Jul 17, 2013 5:12:32 PM","proposalNumber":"29","rgGnom":"3.05242714339","volume":"44.1406","shapeDeterminationModel":"/data/pyarch/bm29/opd29/1137/1d/dammin.pdb","comments":null},{"total":"0.582641941147","bufferBeforeMeasurementId":22152,"sampleMergeId":12375,"averagedModelId":43809,"I0":"31.4366153846","proposalCode":"OPD","averagedModel":"/data/pyarch/bm29/opd29/1137/1d/damaver.pdb","bufferAfterMergeId":12376,"framesCount":"10","bufferBeforeMergeId":12374,"averageFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_018_ave.dat","bufferAfterMeasurementId":22155,"rgGuinier":"2.95541","subtractedFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_018_sub.dat","firstPointUsed":"21","chi2RgFilePath":"/data/pyarch/bm29/opd29/1137/1d/chi2_R.png","abInitioModelId":273,"macromoleculeId":112,"code":"_20.0_0.65000000000000002","transmission":"100.0","timeStart":"2013-07-17 17:12:55.837462","bufferAcronym":"MES","quality":"0.870164","shapeDeterminationModelId":43811,"expermientComments":"[BsxCube] Generated from BsxCube","bufferId":707,"isagregated":"False","dmax":"10.343935","bufferBeforeAverageFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_017_ave.dat","exposureTemperature":"20.0","subtractionId":5166,"conc":"0.65000000000000002","rapidShapeDeterminationModel":"/data/pyarch/bm29/opd29/1137/1d/damfilt.pdb","experimentCreationDate":"Jul 17, 2013 5:08:37 PM","lastPointUsed":"80","modelListId":273,"framesMerge":"10","rapidShapeDeterminationModelId":43810,"bufferAfterAverageFilePath":" /data/pyarch/bm29/opd29/1137/1d/MG386_019_ave.dat","nsdFilePath":"/data/pyarch/bm29/opd29/1137/1d/nsd.png","bufferAfterFramesMerged":"10","experimentId":1137,"macromoleculeAcronym":"MG386","i0stdev":"0.100250461538","sampleMeasurementId":22154,"measurementComments":"[2] MES","priorityLevelId":4,"bufferBeforeFramesMerged":"10","substractionCreationTime":"Jul 17, 2013 5:15:02 PM","proposalNumber":"29","rgGnom":"2.9963404542","volume":"42.2255","shapeDeterminationModel":"/data/pyarch/bm29/opd29/1137/1d/dammin.pdb","comments":null}],
		proposal : new ResultsAssemblyGrid().input().proposal
	};
};

AnalysisGrid.prototype.test = function(targetId) {
	var analysisGrid = new AnalysisGrid();
	BIOSAXS.proposal = new Proposal(analysisGrid.input().proposal);
	var panel = analysisGrid.getPanel(analysisGrid.input().data);
	panel.render(targetId);
};


function HPLCAnalysisGrid(args) {
	AnalysisGrid.prototype.constructor.call(this, args);
}
	
HPLCAnalysisGrid.prototype._edit = AnalysisGrid.prototype._edit;
HPLCAnalysisGrid.prototype._getColumns = AnalysisGrid.prototype._getColumns;
HPLCAnalysisGrid.prototype._openVisualizarBySubstractionId = AnalysisGrid.prototype._openVisualizarBySubstractionId;
HPLCAnalysisGrid.prototype._openVisualizer = AnalysisGrid.prototype._openVisualizer;
HPLCAnalysisGrid.prototype._prepareData = AnalysisGrid.prototype._prepareData;
HPLCAnalysisGrid.prototype._showCalibration = AnalysisGrid.prototype._showCalibration;
HPLCAnalysisGrid.prototype.getPanel = AnalysisGrid.prototype.getPanel;
HPLCAnalysisGrid.prototype.input = AnalysisGrid.prototype.input;
HPLCAnalysisGrid.prototype.test = AnalysisGrid.prototype.test;
HPLCAnalysisGrid.prototype.refresh = AnalysisGrid.prototype.refresh;
HPLCAnalysisGrid.prototype._getPorod = AnalysisGrid.prototype._getPorod;

HPLCAnalysisGrid.prototype._getButtons = function() {
	return {
		id : this.id + 'buttonPlot',
		name : 'buttonPlot',
		hidden : !this.showButtonsVisible,
		width : 110,
		sortable : false,
		renderer : function(value, metaData, sample, rowIndex, colIndex, store) {
			var html = "<table>";
	
			if (sample.raw.subtractionId) {
				if (sample.raw.rapidShapeDeterminationModelId != null) {
					html = html + "<tr><td  style='padding:2px;'>" + BUI.getGreenButton('AbInitio Modeling', {
						height : 20,
						width : 100
					}) + "<td></tr>";
				}
			}
			return html + "</table>";
		}
	};
};

HPLCAnalysisGrid.prototype._getFramesColumn = function() {
	return {
		text : 'Frames',
		dataIndex : 'datacollection',
		name : 'datacollection',
		sortable : true,
		width : 150,
		renderer : function(dataCollections, y, data) {
			molmerges = data.raw.framesMerge;
			totalframes = data.raw.framesCount;
			return molmerges +" - "+  totalframes;
		}
	};
};




/**
 * Rigid body grid to show PDB, symmetry and multiplicity
 * 
 * 
 * #onUploadFile click on upload file
 */
function AprioriRigidBodyGrid(args) {

	this.height = 250;
	this.btnEditVisible = true;
	this.btnRemoveVisible = true;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
		if (args.btnRemoveVisible != null) {
			this.btnRemoveVisible = args.btnRemoveVisible;
		}
	}

	/** Events **/
	this.onUploadFile = new Event(this);
	this.onRemove = new Event(this);
}

AprioriRigidBodyGrid.prototype._getColumns = function() {
};

AprioriRigidBodyGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	/** ADD BUTTON **/
	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add',
		disabled : false,
		handler : function(widget, event) {
			_this.onAddButtonClicked.notify();
		}
	}));

	return actions;
};

AprioriRigidBodyGrid.prototype.refresh = function(macromolecule) {
	this.macromolecule = macromolecule;
	if (macromolecule != null){
		this.pdbStore.loadData(macromolecule.structure3VOs);
	}
};

AprioriRigidBodyGrid.prototype._prepareData = function() {
	var data = [];
	for ( var i = 0; i < this.features.length; i++) {
		data.push(this.features[i]);
	}
	return data;
};

AprioriRigidBodyGrid.prototype._getPlugins = function() {
	var _this = this;
	var plugins = [];
	plugins.push(Ext.create('Ext.grid.plugin.RowEditing', {
		clicksToEdit : 1,
		listeners : {
			validateedit : function(grid, e) {
				/** Comments are always updatable* */
				e.record.raw.symmetry = e.newValues.symmetry;
				e.record.raw.multiplicity = e.newValues.multiplicity;

				var adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, proposal) {
					BIOSAXS.proposal.setItems(proposal);
					_this.refresh(BIOSAXS.proposal.getMacromoleculeById(_this.macromolecule.macromoleculeId));
					_this.panel.setLoading(false);
				});
				adapter.onError.attach(function() {
					alert("Error");
				});

				_this.panel.setLoading();
				adapter.saveStructure(e.record.raw);
			}
		}
	}));
	return plugins;
};

AprioriRigidBodyGrid.prototype.getPanel = function() {
	var _this = this;

	this.pdbStore = Ext.create('Ext.data.Store', {
		fields : [ 'filePath', 'structureId', 'structureType', 'symmetry', 'structureId', 'name', 'multiplicity' ],
		groupField : 'structureType',
		sorters : {
			property : 'structureId',
			direction : 'DESC'
		}
	});

	var groupingFeature = Ext.create('Ext.grid.feature.Grouping', {
		groupHeaderTpl : Ext.create('Ext.XTemplate',
				"<div style='background:#0ca3d2; color:white; float:left; font-size:10px; margin:6px 8px 0 0; padding:5px 8px;'>{name:this.formatName}</div>", {
					formatName : function(name) {
						return name;
					}
				}),
		hideGroupedHeader : true,
		startCollapsed : false
	});

	this.panel = Ext.create('Ext.grid.Panel', {
		margin : "15 10 0 10",
		height : this.height,
		store : this.pdbStore,
		plugins : _this._getPlugins(),
		tbar : [ {
			text : 'Add Modeling Option (PDB)',
			icon : '../images/add.png',
			handler : function() {
				_this.onUploadFile.notify('PDB', 'Upload PDB File');
			}
		}

		],
		columns : [
				{
					text : "structureId",
					flex : 0.2,
					hidden : true,
					dataIndex : 'structureId',
					sortable : true
				},
				{
					text : "File",
					flex : 0.5,
					dataIndex : 'filePath',
					sortable : true,
					hidden : true
				},
				{
					text : "PDB",
					flex : 0.4,
					dataIndex : 'name',
					sortable : true
				},
				{
					text : "Symmetry",
					flex : 0.2,
					dataIndex : 'symmetry',
					sortable : true,
					editor : {
						xtype : 'combobox',
						typeAhead : true,
						triggerAction : 'all',
						selectOnTab : true,
						store : [ [ "P1", "P1" ], [ "P2", "P2" ], [ "P3", "P3" ], [ "P4", "P4" ], [ "P5", "P5" ], [ "P6", "P6" ], [ "P32", "P32" ], [ "P42", "P42" ],
								[ "P52", "P52" ], [ "P62", "P62" ], [ "P222", "P222" ] ],
					}
				}, {
					text : "Multiplicity",
					flex : 0.2,
					dataIndex : 'multiplicity',
					sortable : true,
					editor : {
						xtype : 'textfield'
					}

				}, {
					text : "Subunit",
					flex : 0.2,
					dataIndex : 'isSubunit',
					sortable : true,
					hidden : true
				}, {
					text : "Type",
					flex : 0.2,
					dataIndex : 'structureType',
					sortable : true,
					hidden : true
				},

				{
					id : this.id + 'REMOVE',
					flex : 0.2,
					sortable : false,
					renderer : function(value, metaData, record, rowIndex, colIndex, store) {
						return BUI.getRedButton('REMOVE');
					}
				}, ],

		listeners : {
			itemdblclick : function(dataview, record, item, e) {
				_this._editExperiment(record.raw.experimentId);
			},
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

				if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'REMOVE') {
					var dataAdapter = new BiosaxsDataAdapter();
					dataAdapter.onSuccess.attach(function() {
						_this.panel.setLoading(false);
						_this.onRemove.notify();
					});
					_this.panel.setLoading("Removing PDB file");
					dataAdapter.removeStructure(record.data.structureId);
				}

			}
		},
		viewConfig : {
			getRowClass : function(record, rowIdx, params, store) {
				if (record.raw.isSubunit != null) {
					return "blue-row";
				}
			}
		}
	});

	return this.panel;
};




AprioriRigidBodyGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10(),
		dewars : DATADOC.getDewars_10()

	};
};

AprioriRigidBodyGrid.prototype.test = function(targetId) {
	var AprioriRigidBodyGrid = new AprioriRigidBodyGrid({
		height : 150
	});
	BIOSAXS.proposal = new Proposal(AprioriRigidBodyGrid.input().proposal);
	var panel = AprioriRigidBodyGrid.getPanel(AprioriRigidBodyGrid.input().dewars);
	panel.render(targetId);

};

/**
 * It shows buffer grid with a top bar with "Add" button
 * 
 * @height
 * @searchBar
 * @collapsed
 * @width
 */
function BufferGrid(args) {
	this.height = 500;
	this.searchBar = false;
	this.tbar = false;
	this.collapsed = false;
	this.id = BUI.id();

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.searchBar != null) {
			this.searchBar = args.searchBar;
		}

		if (args.tbar != null) {
			this.tbar = args.tbar;
		}

		if (args.collapsed != null) {
			this.collapsed = args.collapsed;
		}

		if (args.width != null) {
			this.width = args.width;
		}
	}
}

BufferGrid.prototype._edit = function(bufferId) {
	var _this = this;
	var window = new BufferWindow();
	window.onSuccess.attach(function(sender, proposal) {
		_this.store.loadData(BIOSAXS.proposal.getBuffers());
	});
	window.draw(BIOSAXS.proposal.getBufferById(bufferId));
};

BufferGrid.prototype.refresh = function(buffers) {
	this.store.loadData(this._prepareData(buffers), false);
};

BufferGrid.prototype._prepareData = function(buffers) {
	return buffers;
};

BufferGrid.prototype._getTbar = function() {
	var _this = this;
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add buffer',
		disabled : false,
		handler : function(widget, event) {
			var window = new BufferWindow();
			window.onSuccess.attach(function(sender) {
				_this.store.loadData(BIOSAXS.proposal.getBuffers());
			});
			window.draw({});
		}
	}));
	return actions;
};

BufferGrid.prototype.getPanel = function(buffers) {
	var _this = this;

	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'bufferId', 'acronym', 'name', 'composition' ],
		data : buffers
	});

	this.store.sort('acronym');

	var type = 'Ext.grid.Panel';
	if (this.searchBar == true) {
		type = 'Ext.ux.LiveSearchGridPanel';
	}

	this.grid = Ext.create(type, {
		title : 'Buffers',
		collapsible : true,
		collapsed : this.collapsed,
		store : this.store,
		height : this.height,
		width : this.width,
		columns : [ 
		/*{
			text : '',
			dataIndex : 'bufferId',
			width : 20,
			renderer : function(val, y, sample) {
				return BUI.getRectangleColorDIV(BIOSAXS.proposal.bufferColors[val], 10, 10);
			}
		},*/ 
		{
			text : 'Acronym',
			dataIndex : 'acronym',
			flex : 1
		}, {
			text : 'Name',
			dataIndex : 'name',
			flex : 1,
			hidden : true
		}, {
			text : 'Composition',
			dataIndex : 'composition',
			flex : 1,
			hidden : true
		}, {
			id : _this.id + 'buttonEditBuffer',
			width : 80,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getGreenButton('EDIT');
			}
		}, {
			id : _this.id + 'buttonRemoveBuffer',
			width : 85,
			hidden : true,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getRedButton('REMOVE');
			}
		} ],
		flex : 1,
		viewConfig : {
			stripeRows : true,
			listeners : {
				'celldblclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					_this._edit(record.data.bufferId);
				},
				'cellclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEditBuffer') {
						_this._edit(record.data.bufferId);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemoveBuffer') {
						BUI.showBetaWarning();
					}
				}

			}
		}
	});

	/** Adding the tbar **/
	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : this._getTbar()
		});
	}
	return this.grid;
};

BufferGrid.prototype.input = function() {
	return new MacromoleculeGrid().input();
};

BufferGrid.prototype.test = function(targetId) {
	var bufferGrid = new BufferGrid({
		width : 800,
		height : 350,
		collapsed : false,
		tbar : true
	});

	BIOSAXS.proposal = new Proposal(bufferGrid.input().proposal);
	var panel = bufferGrid.getPanel(BIOSAXS.proposal.macromolecules);
	panel.render(targetId);
};

/**
 * A shipment may contains one or more cases where stock solutions and sample plates are stored
 * 
 * @height
 * @btnEditVisible
 * @btnRemoveVisible
 * 
 * #onEditButtonClicked
 * #onAddButtonClicked
 * #onRemoveButtonClicked
 * #onDuplicateButtonClicked
 */
function CaseGrid(args) {

	this.height = 100;
	this.btnEditVisible = true;
	this.btnRemoveVisible = true;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
		if (args.btnRemoveVisible != null) {
			this.btnRemoveVisible = args.btnRemoveVisible;
		}
	}

	/** Events **/
	this.onEditButtonClicked = new Event(this);
	this.onAddButtonClicked = new Event(this);
	this.onRemoveButtonClicked = new Event(this);
	this.onDuplicateButtonClicked = new Event(this);
}

CaseGrid.prototype._getColumns = function() {
	var _this = this;

	function actionItemRenderer(value, meta, record, rowIx, ColIx, store) {
		/*if (record.raw.specimen3VOs.length > 0){
			return 'x-hide-display';
		}*/
	}

	var columns = [
		{
			header : 'Code',
			dataIndex : 'code',
			name : 'code',
			type : 'string',
			flex : 1
		},
		{
			header : 'Bar Code',
			dataIndex : 'barCode',
			name : 'barCode',
			type : 'string',
			flex : 1,
			hidden : true
		},
		{
			header : 'BeamLine',
			dataIndex : 'barCode',
			type : 'string',
			flex : 1,
			renderer : function(comp, val, record) {
				if (record.raw.sessionVO != null) {
					return "<span style='font-weight:bold;'>" + record.raw.sessionVO.beamlineName + "</span>";
				}
			}
		},
		{
			header : 'Session',
			dataIndex : 'barCode',
			type : 'string',
			flex : 1,
			renderer : function(comp, val, record) {
				if (record.raw.sessionVO != null) {
					return "<span>" + moment(record.raw.sessionVO.startDate).format("MMM Do YY") + "</span>";
				}
			}
		},
		{
			header : 'Status',
			dataIndex : 'dewarStatus',
			name : 'dewarStatus',
			type : 'string',
			flex : 1,
			renderer : function(comp, val, record) {
				if (new String(record.raw.dewarStatus).toUpperCase() == 'OPENED') {
					return "<span style='color:green;font-weight:bold;'>" + new String(record.raw.dewarStatus).toUpperCase() + "</span>";
				}
				return "<span style='font-weight:bold;'>" + new String(record.raw.dewarStatus).toUpperCase() + "</span>";
			}
		},
		{
			header : 'Type',
			dataIndex : 'type',
			name : 'type',
			type : 'string',
			flex : 1,
			hidden : true
		},
		{
			header : 'Sample Plates',
			dataIndex : 'plates',
			name : 'plates',
			type : 'string',
			flex : 1,
			hidden : true
		},
		{
			header : 'Stock Solutions',
			dataIndex : 'plates',
			name : 'plates',
			type : 'string',
			width : 100,
			renderer : function(comp, val, record) {
				var html = "<div>";
				var stockSolutions = BIOSAXS.proposal.getStockSolutionsByDewarId(record.raw.dewarId);
				html = html + "<span style='font-size:18px'>" + stockSolutions.length + "</span> x<img height='15px' src='/ispyb/images/SampleHolder_24x24_01.png'>";
				return html + "</div>";
			}
		}, {
			header : 'isStorageDewar',
			dataIndex : 'isStorageDewar',
			name : 'isStorageDewar',
			type : 'string',
			flex : 1,
			hidden : true
		}, {
			header : 'Tracking Number From Synchrotron',
			dataIndex : 'trackingNumberFromSynchrotron',
			name : 'trackingNumberFromSynchrotron',
			type : 'string',
			flex : 1,
			hidden : true
		}, {
			header : 'Tracking Number To Synchrotron',
			dataIndex : 'trackingNumberToSynchrotron',
			name : 'trackingNumberToSynchrotron',
			type : 'string',
			flex : 1,
			hidden : true
		}, {
			header : 'Storage Location',
			dataIndex : 'storageLocation',
			name : 'storageLocation',
			type : 'string',
			flex : 1,
			hidden : false
		}, {
			header : 'Comments',
			dataIndex : 'comments',
			name : 'comments',
			type : 'string',
			flex : 1,
			hidden : false
		}
	];

	if (this.btnEditVisible) {
		columns.push({
			id : _this.id + 'buttonEdit',
			text : '',
			hidden : !_this.btnEditVisible,
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getGreenButton('EDIT');
			}
		});
	}

	if (this.btnRemoveVisible) {
		columns.push({
			id : _this.id + 'buttonRemove',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnRemoveVisible) {
					return BUI.getRedButton('REMOVE');
				}
			}
		});
	}

	columns.push({
		dataIndex : 'comments',
		type : 'string',
		width : 85,
		hidden : false,
		renderer : function(comp, val, record) {
			return BUI.getBlueButton("LABELS", {
				href : BUI.getPrintcomponentURL(record.raw.dewarId)
			});
		}
	});

	return columns;
};

CaseGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	/** ADD BUTTON **/
	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add',
		disabled : false,
		handler : function(widget, event) {
			_this.onAddButtonClicked.notify();
		}
	}));

	return actions;
};

CaseGrid.prototype.refresh = function(dewars) {
	this.features = dewars;
	this.store.loadData(this._prepareData(dewars), false);
};

CaseGrid.prototype._sort = function(store) {
	store.sort('dewarId', 'DESC');
};

CaseGrid.prototype._prepareData = function() {
	var data = [];
	for ( var i = 0; i < this.features.length; i++) {
		data.push(this.features[i]);
	}
	return data;
};

CaseGrid.prototype.getPanel = function(dewars, plates) {
	this.features = dewars;
	this.plates = plates;
	return this._renderGrid();
};

CaseGrid.prototype._edit = function(dewar) {
	var _this = this;
	var caseWindow = new CaseWindow();
	/**SAVED **/
	caseWindow.onSaved.attach(function(sender, dewar) {
		var adapter = new BiosaxsDataAdapter();
		adapter.onSuccess.attach(function(sender, shipment) {
			_this.refresh(shipment.dewarVOs);
		});
		adapter.saveCase(BIOSAXS.proposal.getShipmentByDewarId(dewar.dewarId).shippingId, dewar);
	});
	caseWindow.draw(dewar);
};

CaseGrid.prototype._getStoreFields = function(data) {
	return [ {
		name : 'dewarId',
		type : 'string'
	}, {
		name : 'barCode',
		type : 'string'
	}, {
		name : 'code',
		type : 'string'
	}, {
		name : 'comments',
		type : 'string'
	}, {
		name : 'dewarStatus',
		type : 'string'
	}, {
		name : 'isStorageDewar',
		type : 'string'
	}, {
		name : 'plates',
		type : 'string'
	}, {
		name : 'transportValue',
		type : 'string'
	}, {
		name : 'trackingNumberFromSynchrotron',
		type : 'string'
	}, {
		name : 'trackingNumberToSynchrotron',
		type : 'string'
	}, {
		name : 'timeStamp',
		type : 'string'
	}, {
		name : 'storageLocation',
		type : 'string'
	}, {
		name : 'type',
		type : 'string'
	}

	];
};

CaseGrid.prototype._renderGrid = function() {
	var _this = this;

	/** Store **/
	var data = this._prepareData();
	this.store = Ext.create('Ext.data.Store', {
		fields : this._getStoreFields(data),
		autoload : true,
		data : data
	});
	this._sort(this.store);

	this.store.loadData(data, false);

	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		height : this.height,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this._edit(record.raw);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this._edit(record.raw);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						_this.onRemoveButtonClicked.notify(_this.store.getAt(rowIndex).raw.dewarId);
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};

CaseGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10(),
		dewars : DATADOC.getDewars_10()

	};
};

CaseGrid.prototype.test = function(targetId) {
	var CaseGrid = new CaseGrid({
		height : 150
	});
	BIOSAXS.proposal = new Proposal(CaseGrid.input().proposal);
	var panel = CaseGrid.getPanel(CaseGrid.input().dewars);
	panel.render(targetId);

};

/**
 * A shipment may contains one or more cases where stock solutions and sample plates are stored
 * 
 * @height
 * @btnEditVisible
 * @btnRemoveVisible
 * 
 * #onEditButtonClicked
 * #onAddButtonClicked
 * #onRemoveButtonClicked
 * #onDuplicateButtonClicked
 */
function ExampleGrid(args) {

	this.height = 100;
	this.btnEditVisible = true;
	this.btnRemoveVisible = true;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
		if (args.btnRemoveVisible != null) {
			this.btnRemoveVisible = args.btnRemoveVisible;
		}
	}

	/** Events **/
	this.onEditButtonClicked = new Event(this);
	this.onAddButtonClicked = new Event(this);
	this.onRemoveButtonClicked = new Event(this);
	this.onDuplicateButtonClicked = new Event(this);
}

ExampleGrid.prototype._getColumns = function() {
	var _this = this;

	function actionItemRenderer(value, meta, record, rowIx, ColIx, store) {
		/*if (record.raw.specimen3VOs.length > 0){
			return 'x-hide-display';
		}*/
	}

	var columns = [
		{
			header : 'Code',
			dataIndex : 'code',
			name : 'code',
			type : 'string',
			flex : 1
		},
		{
			header : 'Bar Code',
			dataIndex : 'barCode',
			name : 'barCode',
			type : 'string',
			flex : 1,
			hidden : true
		},
		{
			header : 'BeamLine',
			dataIndex : 'barCode',
			type : 'string',
			flex : 1,
			renderer : function(comp, val, record) {
				if (record.raw.sessionVO != null) {
					return "<span style='font-weight:bold;'>" + record.raw.sessionVO.beamlineName + "</span>";
				}
			}
		},
		{
			header : 'Session',
			dataIndex : 'barCode',
			type : 'string',
			flex : 1,
			renderer : function(comp, val, record) {
				if (record.raw.sessionVO != null) {
					return "<span>" + moment(record.raw.sessionVO.startDate).format("MMM Do YY") + "</span>";
				}
			}
		},
		{
			header : 'Status',
			dataIndex : 'dewarStatus',
			name : 'dewarStatus',
			type : 'string',
			flex : 1,
			renderer : function(comp, val, record) {
				if (new String(record.raw.dewarStatus).toUpperCase() == 'OPENED') {
					return "<span style='color:green;font-weight:bold;'>" + new String(record.raw.dewarStatus).toUpperCase() + "</span>";
				}
				return "<span style='font-weight:bold;'>" + new String(record.raw.dewarStatus).toUpperCase() + "</span>";
			}
		},
		{
			header : 'Type',
			dataIndex : 'type',
			name : 'type',
			type : 'string',
			flex : 1,
			hidden : true
		},
		{
			header : 'Sample Plates',
			dataIndex : 'plates',
			name : 'plates',
			type : 'string',
			flex : 1,
			hidden : true
		},
		{
			header : 'Stock Solutions',
			dataIndex : 'plates',
			name : 'plates',
			type : 'string',
			width : 100,
			renderer : function(comp, val, record) {
				var html = "<div>";
				var stockSolutions = BIOSAXS.proposal.getStockSolutionsByDewarId(record.raw.dewarId);
				html = html + "<span style='font-size:18px'>" + stockSolutions.length + "</span> x<img height='15px' src='/ispyb/images/SampleHolder_24x24_01.png'>";
				return html + "</div>";
			}
		}, {
			header : 'isStorageDewar',
			dataIndex : 'isStorageDewar',
			name : 'isStorageDewar',
			type : 'string',
			flex : 1,
			hidden : true
		}, {
			header : 'Tracking Number From Synchrotron',
			dataIndex : 'trackingNumberFromSynchrotron',
			name : 'trackingNumberFromSynchrotron',
			type : 'string',
			flex : 1,
			hidden : true
		}, {
			header : 'Tracking Number To Synchrotron',
			dataIndex : 'trackingNumberToSynchrotron',
			name : 'trackingNumberToSynchrotron',
			type : 'string',
			flex : 1,
			hidden : true
		}, {
			header : 'Storage Location',
			dataIndex : 'storageLocation',
			name : 'storageLocation',
			type : 'string',
			flex : 1,
			hidden : false
		}, {
			header : 'Comments',
			dataIndex : 'comments',
			name : 'comments',
			type : 'string',
			flex : 1,
			hidden : false
		}
	];

	if (this.btnEditVisible) {
		columns.push({
			id : _this.id + 'buttonEdit',
			text : '',
			hidden : !_this.btnEditVisible,
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getGreenButton('EDIT');
			}
		});
	}

	if (this.btnRemoveVisible) {
		columns.push({
			id : _this.id + 'buttonRemove',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnRemoveVisible) {
					return BUI.getRedButton('REMOVE');
				}
			}
		});
	}

	columns.push({
		dataIndex : 'comments',
		type : 'string',
		width : 85,
		hidden : false,
		renderer : function(comp, val, record) {
			return BUI.getBlueButton("LABELS", {
				href : BUI.getPrintcomponentURL(record.raw.dewarId)
			});
		}
	});

	return columns;
};

ExampleGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	/** ADD BUTTON **/
	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add',
		disabled : false,
		handler : function(widget, event) {
			_this.onAddButtonClicked.notify();
		}
	}));

	return actions;
};

ExampleGrid.prototype.refresh = function(dewars) {
	this.features = dewars;
	this.store.loadData(this._prepareData(dewars), false);
};

ExampleGrid.prototype._sort = function(store) {
	store.sort('dewarId', 'DESC');
};

ExampleGrid.prototype._prepareData = function() {
	var data = [];
	for ( var i = 0; i < this.features.length; i++) {
		data.push(this.features[i]);
	}
	return data;
};

ExampleGrid.prototype.getPanel = function() {
	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		height : this.height,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this._edit(record.raw);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this._edit(record.raw);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						_this.onRemoveButtonClicked.notify(_this.store.getAt(rowIndex).raw.dewarId);
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};


ExampleGrid.prototype._getStoreFields = function(data) {
	return [ {
		name : 'dewarId',
		type : 'string'
	}, {
		name : 'barCode',
		type : 'string'
	}, {
		name : 'code',
		type : 'string'
	}, {
		name : 'comments',
		type : 'string'
	}, {
		name : 'dewarStatus',
		type : 'string'
	}, {
		name : 'isStorageDewar',
		type : 'string'
	}, {
		name : 'plates',
		type : 'string'
	}, {
		name : 'transportValue',
		type : 'string'
	}, {
		name : 'trackingNumberFromSynchrotron',
		type : 'string'
	}, {
		name : 'trackingNumberToSynchrotron',
		type : 'string'
	}, {
		name : 'timeStamp',
		type : 'string'
	}, {
		name : 'storageLocation',
		type : 'string'
	}, {
		name : 'type',
		type : 'string'
	}

	];
};

ExampleGrid.prototype._renderGrid = function() {
	var _this = this;

	/** Store **/
	var data = this._prepareData();
	this.store = Ext.create('Ext.data.Store', {
		fields : this._getStoreFields(data),
		autoload : true,
		data : data
	});
	this._sort(this.store);

	this.store.loadData(data, false);

	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		height : this.height,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this._edit(record.raw);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this._edit(record.raw);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						_this.onRemoveButtonClicked.notify(_this.store.getAt(rowIndex).raw.dewarId);
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};

ExampleGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10(),
		dewars : DATADOC.getDewars_10()

	};
};

ExampleGrid.prototype.test = function(targetId) {
	var ExampleGrid = new ExampleGrid({
		height : 150
	});
	BIOSAXS.proposal = new Proposal(ExampleGrid.input().proposal);
	var panel = ExampleGrid.getPanel(ExampleGrid.input().dewars);
	panel.render(targetId);

};


/**
 *  Shows a list of experiment AKA data acquisitions
 *	@height
 *	@sorters 
 *	@minHeight
 *	@gridType: Ext.ux.LiveSearchGridPanel or Ext.grid.Panel
 *	@tbar true or false
 *	@grouping true or false
 *	@width
 *	@title
 *	#onEditButtonClicked
 */
function ExperimentGrid(args) {
	this.width = "100%";
	this.height = 700;
	this.minHeight = 500;

	this.id =  BUI.id();
	this.gridType = 'Ext.grid.Panel'; //'Ext.ux.LiveSearchGridPanel';
	this.tbar = false;
	this.hideHeaders = false;
	this.grouping = true;
	this.title = null;

	this.filtered = null;
	
	/** maximum row count **/
	this.limit = 100;
	
	this.sessionIdFilter = null;
	
	/** if not null filtered by date **/
	this.date = null;
	
	this.sorters = [ {
		property : 'date',
		direction : 'DESC'
	}, {
		property : 'time',
		direction : 'DESC'
	} ];

	this.dates = {};
	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.limit != null) {
			this.limit = args.limit;
		}
		if (args.sorters != null) {
			this.sorters = args.sorters;
		}
		if (args.sessionId != null){
			this.sessionIdFilter = args.sessionId;
		}
		if (args.filtered != null) {
			this.filtered = args.filtered;
		}
		if (args.minHeight != null) {
			this.minHeight = args.minHeight;
		}
		if (args.gridType != null) {
			this.gridType = args.gridType;
		}
		if (args.tbar != null) {
			this.tbar = args.tbar;
		}
		if (args.grouping != null) {
			this.grouping = args.grouping;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.title != null) {
			this.title = args.title;
		}

	}
	/** Events **/
	this.onEditButtonClicked = new Event(this);
}

ExperimentGrid.prototype._getFilterTypes = function() {
	return [];
};

ExperimentGrid.prototype._prepareData = function(rows) {
	var data = [];
	var count = 0;
	
	rows.sort(function(a,b){return b.experimentId - a.experimentId;});
	for ( var i = 0; i < rows.length; i++) {
	var row = rows[i];
				this.dates[moment(row.creationDate).format("YYYYMMDD")] = moment(row.creationDate).format("MMM Do YY");
				if (
						  ( this.filtered == null || row.experimentType == this.filtered ) && (count < this.limit || this.limit == null )	&& (this.sessionIdFilter == null || this.date != null || (this.date == null && this.sessionIdFilter == row.sessionId)) 
					){

					data.push({
						experimentId : row.experimentId,
						status : row.status,
						dataAcquisitionFilePath : row.dataAcquisitionFilePath,
						type : row.experimentType,
						name : row.name,
						macromolecules_names : row.macromolecules,
						percentageAnalysed : {
							value : (row.dataCollectionDoneCount / row.dataCollectionCount) * 100,
							text : row.dataCollectionDoneCount + " of " + row.dataCollectionCount
						},
						percentageCollected : {
							value : (row.measurementDoneCount / row.measurementCount) * 100,
							text : row.measurementDoneCount + " of " + row.measurementCount
						},
						percentageMerged : {
							value : (row.measurementAveragedCount / row.measurementCount) * 100,
							text : row.measurementAveragedCount + " of " + row.measurementCount
						},
						date : moment(row.creationDate).format("YYYYMMDD"),
						time : moment(row.creationDate).format("YYYYMMDDHHmmss"),
						creationDate : row.creationDate
					});
					count ++;
		}
	}
	return data;
};

ExperimentGrid.prototype.getPanel = function(experiments) {
	this.features = experiments;
	return this._renderGrid(experiments);
};

ExperimentGrid.prototype.refresh = function(experiments) {
	this.experiments = experiments;
	var filtered = [];
	for ( var i = 0; i < experiments.length; i++) {
		if (experiments[i].experimentType != "TEMPLATE") {
			filtered.push(experiments[i]);
		}
	}

	this.parsedData = this._prepareData(filtered);
	
	var day = {};
	var dates = [];
	for ( var i = 0; i < this.experiments.length; i++) {
		var date  =  moment(this.experiments[i].creationDate).format("MMM Do YYYY");
		if (day[date] == null){
			dates.push({
				date : date,
				value :  moment(this.experiments[i].creationDate)
			});
			day[date] = true;
		}
	}
	
	this.storeDate.loadData(dates, false);
	this.store.loadData(this.parsedData, false);
	
	/** If it has already been filtered by date we keep the filter **/
	if (this.date != null){
		this._filterByDate(this.date);
	}
};

ExperimentGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/calendar_icon.png',
		text : 'Show Calendar',
		disabled : false,
		handler : function(widget, event) {
			var window = Ext.create('Ext.window.Window', {
				title : 'Calendar',
				width : 600,
				height : 600,
				modal : true,
				closable : true,
				layout : {
					type : 'vbox',
					align : 'stretch'
				},
				items : [ {
					xtype : 'label',
					html : 'Click on a data acquisition to select:',
					margin : '5 5 5 5'
				}, {
					html : '<div id="calendar" style="height:450px;overflow-y: scroll;"></div>',
					margin : '5 5 5 5'
				}

				]
			}).show();

			var calendarWidget = new CalendarWidget({
				height : 450
			});
			var aux = _this.limit;
			/** we remove the limit temporarily **/
			_this.limit = null;
			_this.sessionIdFilter = null;
			calendarWidget.loadData(_this._prepareData(_this.experiments));
			_this.limit = aux;
			calendarWidget.draw('calendar');
			calendarWidget.onClick.attach(function(sender, date) {
				date = moment(date, "YYYY-MM-DD");
				_this._filterByDate(date);
				window.close();
				
			});

		}
	}));
	this.storeDate =  Ext.create('Ext.data.ArrayStore', {
		        fields: ['date', 'value'],
		        data : []
		    });
	
	this.dateMenu = Ext.create('Ext.form.field.ComboBox', {
	        hideLabel: true,
	        store: this.storeDate,
	        displayField: 'date',
	        typeAhead: true,
	        queryMode: 'local',
	        margin : '0 0 0 30',
	        triggerAction: 'all',
	        emptyText:'Select a date...',
	        selectOnFocus:true,
	        width:135,
	        listeners:{
	            scope: this,
	            'select': function (a,b,c){
	            	_this.limit = null;
	            	_this._filterByDate(moment(b[0].raw.value, "YYYY-MM-DD"));
	            }
	       }
	 });
	 
	actions.push(this.dateMenu);
	
	actions.push("->");
	if (_this.filtered != null){
		actions.push({
			html	: "<span>Experiment Type: " + _this.filtered +"</span>"
		});
	}
	else{
		actions.push({
			html	: "<span>Experiment Type: ALL</span>"
		});
	}
	return actions;
};

/**
 * Date format: "YYYY-MM-DD"
 */
ExperimentGrid.prototype._filterByDate = function(date) {
	var experimentsFiltered = [];
	/** Getting all the experiments of date**/
	for ( var i = 0; i < this.experiments.length; i++) {
		var experiment = this.experiments[i];
		if (experiment.creationDate != null) {
			var experimentDate = moment(experiment.creationDate);
			if (experimentDate.year() == date.year()) {
				if (experimentDate.month() == date.month()) {
					if (experimentDate.date() == date.date()) {
						experimentsFiltered.push(experiment);
					}
				}
			}
		}
	}
	var parsedData = this._prepareData(experimentsFiltered);
	this.store.loadData(parsedData);
	this.date = date;
};

/** Only for templates **/
ExperimentGrid.prototype._removeExperimentById = function(experimentId) {
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(evt, args) {
		_this.grid.setLoading(false);
		document.getElementById(BIOSAXS.targetId).innerHTML = "";
		BIOSAXS.start(BIOSAXS.targetId);
	});
	this.grid.setLoading("Removing experiment ");
	adapter.removeExperimentById(experimentId);
};

ExperimentGrid.prototype._renderGrid = function() {
	var _this = this;

	/** Store **/
	this.store = Ext.create('Ext.data.Store', {
		fields : this._getColumns(), 
		groupField : 'date',
		autoload : true,
		data : [],
		remoteSort: false,
		sorters : this.sorters
	});

	
	
	
	var groupingFeature = Ext.create('Ext.grid.feature.Grouping', {
		groupHeaderTpl : Ext.create('Ext.XTemplate',
				"<div style='background:#0ca3d2; color:white; float:left; margin:6px 8px 0 0; padding:5px 8px;'>{name:this.formatName}</div>", {
					formatName : function(name) {
						return _this.dates[name];
					}
				}),
		hideGroupedHeader : true,
		startCollapsed : false
	});

	this.features = [];
	if (this.grouping) {
		this.features.push(groupingFeature);
	}

	/** Grid **/
	this.grid = Ext.create(this.gridType, {
		hideHeaders : this.hideHeaders,
		resizable : true,
		title : this.title,
		width : this.width,
		minHeight : this.minHeight,
		height : this.height,
		features : this.features,
		store : this.store,
		columns : this._getColumns(),
		selModel : {
			mode : 'SINGLE'
		},
		viewConfig : {
			stripeRows : true,
			getRowClass : function(record, rowIdx, params, store) {
				if (record.raw.type == "TEMPLATE") {
					return "template-color-row";
				}
				if ((record.raw.type == "CALIBRATION") && (record.raw.status == "FINISHED")) {
					return "blue-row";
				}
			},
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this._editExperiment(record.raw.experimentId);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'GO') {
						_this._editExperiment(record.raw.experimentId);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'REMOVE') {
						_this._removeExperimentById(record.raw.experimentId);
					}

				}
			}
		}
	});

	var actions = _this._getTopButtons();

	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : actions
		});
		this.grid.getSelectionModel().on({
			selectionchange : function(sm, selections) {
				if (selections.length) {
					for ( var i = 0; i < actions.length; i++) {
						if (actions[i].enable) {
							actions[i].enable();
						}
					}
				} else {
					for ( var i = 0; i < actions.length; i++) {
						if (actions[i].alwaysEnabled == false) {
							if (actions[i].disable) {
								actions[i].disable();
							}
						}
					}
				}
			}
		});
	}

	return this.grid;
};

ExperimentGrid.prototype._getColumns = function() {
	var _this = this;
	function actionItemRenderer(value, meta, record, rowIx, ColIx, store) {
		if (record.raw.buffer3VOs != null) {
			if (record.raw.buffer3VOs.length > 0) {
				return 'x-hide-display';
			}
		}

		if (record.data.platesCount > 0) {
			return 'x-hide-display';
		}
	}

	return [
		{
			text : 'experimentId',
			dataIndex : 'experimentId',
			name : 'experimentId',
			type : 'string',
			hidden : true
		},
		{
			xtype : 'rownumberer',
			width : 40
		},
		{
			text : 'Name',
			dataIndex : 'name',
			name : 'name',
			type : 'string',
			flex : 1
		},

		{
			text : 'Type',
			dataIndex : 'type',
			name : 'type',
			type : 'string',
			flex : 1,
			renderer : function(val) {
				if (val == "CALIBRATION") {
					return "<span style='color:blue;'>" + val + "</span>";
				}

				return val;
			}
		},
		{
			text : 'Macromolecules',
			name : 'macromolecules_names',
			dataIndex : 'macromolecules_names',
			flex : 1,
			renderer : function(val) {
				if (val != null) {
					return " <span style='font-weight:bold'>" + val + "</span>";
				}
				return " <span style='font-style:italic;color:gray;'>Information not available</span>";
			}
		},
		{
			text : 'Buffers',
			dataIndex : 'buffer_names',
			name : 'buffer_names',
			flex : 1,
			hidden : true,
			renderer : function(val) {
				return "Buffer/s: <span style='font-weight:bold'>" + val + "</span>";
			}
		},
		{
			text : 'Status',
			dataIndex : 'status',
			name : 'status',
			type : 'string',
			flex : 1,
			renderer : function(val, x, sample) {
				if (sample.raw.type == "TEMPLATE") {
					return "READY";
				}
				if (sample.raw.status == "ABORTED") {
					return "<span style='color:red;'>" + val + "</span>";
				}
				return "<span style='color:green;'>" + val + "</span>";
			}
		},
		{
			text : 'Download',
			dataIndex : 'creationDate',
			name : 'creationDate',
			renderer : function(val, x, sample) {
				if (sample != null) {
					if (sample.raw.type == "HPLC") {
						return;
					}
					return BUI.getZipHTMLByExperimentId(sample.raw.experimentId, sample.raw.name);
				}
			},
			width : 100

		},
		{
			header : 'Measurements',
			dataIndex : 'percentageCollected',
			name : 'percentageCollected',
			type : 'string',
			renderer : function(val, y, sample) {
				if ((sample.raw.type == "TEMPLATE") || (sample.raw.type == "HPLC")) {
					return;
				}
				return "<table><tr><td>" + BUI.getProgessBar(sample.raw.percentageCollected.value, sample.raw.percentageCollected.text) + "</td></table>";
			},
			width : 100
		},
		{
			header : 'Averaged',
			dataIndex : 'percentageMerged',
			name : 'percentageMerged',
			type : 'string',
			renderer : function(val, y, sample) {
				if ((sample.raw.type == "TEMPLATE") || (sample.raw.type == "HPLC")) {
					return;
				}
				return "<table><tr><td>" + BUI.getProgessBar(sample.raw.percentageMerged.value, sample.raw.percentageMerged.text) + "</td></table>";
			},
			width : 100
		},
		{
			header : 'Subtractions',
			dataIndex : 'percentageAnalysed',
			name : 'percentageAnalysed',
			type : 'string',
			renderer : function(val, y, sample) {
				if ((sample.raw.type == "TEMPLATE") || (sample.raw.type == "HPLC")) {
					return;
				}
				return "<table><tr><td>" + BUI.getProgessBar(sample.raw.percentageAnalysed.value, sample.raw.percentageAnalysed.text) + "</td></table>";
			},
			width : 100
		},

		{
			text : 'time',
			dataIndex : 'time',
			name : 'time',
			hidden : true,
			renderer : function(val) {
				return val;
			},
			width : 100

		}, {
			text : 'Date',
			dataIndex : 'date',
			name : 'date',
			renderer : function(val) {
				return val;
			},
			width : 100

		},

		{
			text : 'Time',
			dataIndex : 'creationDate',
			name : 'creationDate',
			renderer : function(val) {
				return moment(val).format(" HH:mm:ss");
			},
			width : 100

		}, {
			id : _this.id + 'GO',
			width : 80,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getGreenButton('GO');
			}
		} ];
};

/** Changes location.href in order to edit the experiment **/
ExperimentGrid.prototype._editExperiment = function(experimentId) {
	if (Ext.urlDecode(window.location.href).sessionId != null) {
		location.href = 'viewProjectList.do?reqCode=display&experimentId=' + experimentId + '&sessionId='+ Ext.urlDecode(window.location.href).sessionId;
	} else {
		location.href = 'viewProjectList.do?reqCode=display&experimentId=' + experimentId;
	}
};

ExperimentGrid.prototype.input = function() {
	var experiments = DATADOC.getExperimentList_10();
	return {
		experiments : experiments,
		proposal : new MeasurementGrid().input().proposal

	};
};

ExperimentGrid.prototype.test = function(targetId) {
	var experimentGrid = new ExperimentGrid({
		height : 350,
		minHeight : 350,
		width : 1000

	});
	BIOSAXS.proposal = new Proposal(experimentGrid.input().proposal);
	var panel = experimentGrid.getPanel(experimentGrid.input().experiments);
	experimentGrid.refresh(experimentGrid.input().experiments);
	panel.render(targetId);
};


function FitStructureToExperimentDataGrid(args) {
	this.height = null;
	this.width = null;
	this.id = BUI.id();

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;

			if (args.width != null) {
				this.width = args.width;
			}
		}
	}
	
	this.onSelected = new Event(this);
}

FitStructureToExperimentDataGrid.prototype.getStructuresByMacromolecule = function(macromolecule) {
	var structures = [];
	if (macromolecule.structure3VOs != null) {
		if (macromolecule.structure3VOs.length > 0) {
			for (var i = 0; i < macromolecule.structure3VOs.length; i++) {
				structures.push(macromolecule.structure3VOs[i]);
			}
		}
	}
	return structures;
};

FitStructureToExperimentDataGrid.prototype._prepareData = function(subtractions) {
	var data = [];
	for (var i = 0; i < subtractions.length; i++) {
		
		for (var j = 0; j < subtractions[i].fitStructureToExperimentalData3VOs.length; j++) {
			var fit = subtractions[i].fitStructureToExperimentalData3VOs[j];
			data.push({
				fit : fit.fitFilePath,
				fitStructureToExperimentalDataId : fit.fitStructureToExperimentalDataId,
				mixtureToStructure3VOs : fit.mixtureToStructure3VOs,
				subtractedFile : subtractions[i].substractedFilePath
			});
		}
	}
	return data;

};

FitStructureToExperimentDataGrid.prototype.refresh = function(subtractions) {
	this.store.loadData(this._prepareData(subtractions), false);
};

FitStructureToExperimentDataGrid.prototype.getPanel = function() {
	var _this = this;
	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'fit', 'subtractedFile', 'structureId', 'fitFilePath', 'mixtureToStructure3VOs' ],
		data : []
	});

	this.store.sort([ {
		property : 'name',
		direction : 'ASC'
	} ]);

	this.selModel = Ext.create('Ext.selection.RowModel', {
		allowDeselect : true,
		mode : 'MULTI',
		listeners : {
			selectionchange : function(sm, selections) {
				var selected = [];
				for (var i = 0; i < selections.length; i++) {
					selected.push(selections[i].raw);
				}
				_this.onSelected.notify(selected);
			}
		}
	});
	
	this.panel = Ext.create('Ext.grid.Panel', {
		store : this.store,
		deferredRender : false,
		width : this.width,
		height : this.height,
		margin : 10,
		selModel : this.selModel,
		columns : [ {
			text : 'Name',
			dataIndex : 'fit',
			flex : 1,
			renderer : function(val, b, record) {
				return BUI.getFileName(val);
			}
		}, {
			text : 'PDB',
			dataIndex : 'mixtureToStructure3VOs',
			flex : 1,
			renderer : function(values, b, record) {
				var html = "<table>";
				for (var i = 0; i < values.length; i++) {
					var structure = BIOSAXS.proposal.getStructuresById(values[i].structureId);
					html = html + "<tr>";
					if (structure != null){
						html = html + "<td style='width:200px'>" + structure.name + "</td>";
					}
					html = html + "</tr>";
				}
				return html + "</table>";
			}
		}, {
			text : 'Volume Fraction',
			dataIndex : 'mixtureToStructure3VOs',
			flex : 1,
			renderer : function(values, b, record) {
				var html = "<table>";
				for (var i = 0; i < values.length; i++) {
					html = html + "<tr>";
					html = html + "<td>" + values[i].volumeFraction + "</td>";
					html = html + "</tr>";
				}

				return html + "</table>";
			}
		},{
			text : 'Subtraction',
			dataIndex : 'subtractedFile',
			flex : 1,
			renderer : function(values, b, record) {
				return values.split("/")[values.split("/").length - 1];
			}
		},],

		viewConfig : {
			enableTextSelection : true,
			preserveScrollOnRefresh : true
		},
		listeners : {
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
			},
			afterrender : function() {
			}
		}
	});
	return this.panel;
};

/** Static method **/
FitStructureToExperimentDataGrid.prototype.RUNFitScattering = function(subtractionId, structureId) {
	var _this = this;
	/** Add to Workflow **/
	var adapter = new BiosaxsDataAdapter();
	var workflow = {
		'workflowTitle' : 'FitExperimentalDatatoStructure',
		'comments' : 'FitExperimentalDatatoStructure run from ISPyB for subtractionId: ' + subtractionId + ' and structureId ' + structureId
	}

	var inputs = [ {
		name : 'subtractionId',
		value : subtractionId
	}, {
		name : 'structureId',
		value : structureId
	} ];

	adapter.onSuccess.attach(function(sender, data) {
		/** Add to Fit **/
		var adapter2 = new BiosaxsDataAdapter();
		var fit = {
			'workflowId' : data.workflowId,
			'subtractionId' : subtractionId,
			'structureId' : structureId,
			'comments' : 'Sent to workflow engine'
		}
		adapter2.onSuccess.attach(function(sender, fit) {
			_this.refresh(_this.subtractionId, _this.macromolecule);
		});
		adapter2.addFitStructureData(fit);

	});
	adapter.addWorkflow(workflow, inputs);

};

/**
 * It shows buffer grid with a top bar with "Add" button
 * 
 * @height
 * @searchBar
 * @collapsed
 * @width
 */
function FrameGrid(args) {
	this.height = 500;
	this.width = 500;
	this.searchBar = false;
	this.tbar = false;
	this.collapsed = false;
	
	
	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		
		if (args.searchBar != null) {
			this.searchBar = args.searchBar;
		}

		if (args.tbar != null) {
			this.tbar = args.tbar;
		}

		if (args.collapsed != null) {
			this.collapsed = args.collapsed;
		}

		if (args.width != null) {
			this.width = args.width;
		}
	}
}

FrameGrid.prototype._edit = function(bufferId) {
	var _this = this;
	var window = new BufferWindow();
	window.onSuccess.attach(function(sender, proposal) {
		_this.store.loadData(BIOSAXS.proposal.getBuffers());
	});
	window.draw(BIOSAXS.proposal.getBufferById(bufferId));
};

FrameGrid.prototype.refresh = function(buffers, experimentId) {
	this.experimentId = experimentId;
	this.store.loadData(this._prepareData(buffers), false);
};

FrameGrid.prototype._prepareData = function(buffers) {
	return buffers;
};

FrameGrid.prototype._getTbar = function() {
	var _this = this;
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add Buffer',
		disabled : false,
		handler : function(widget, event) {
			var window = new BufferWindow();
			window.onSuccess.attach(function(sender) {
				_this.store.loadData(BIOSAXS.proposal.getBuffers());
			});
			window.draw({});
		}
	}));
	return actions;
};

FrameGrid.prototype.getPanel = function(buffers) {
	var _this = this;

	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'frameNumber', 'I0', 'Rg', 'Mass', 'Vc', 'Qr', 'quality'],
		data : buffers
	});

	this.store.sort('frameNumber');

	var type = 'Ext.grid.Panel';
	if (this.searchBar == true) {
		type = 'Ext.ux.LiveSearchGridPanel';
	}

	this.grid = Ext.create(type, {
		store : this.store,
		height : this.height,
		width : this.width,
		margin	: 5,
		columns : [{
			text : 'Frame',
			dataIndex : 'frameNumber',
			flex : 1
		},{
			text : 'I0',
			dataIndex : 'I0',
			flex : 1,
			renderer : function(val, y, sample) {
				return BUI.formatValuesUnits(sample.data.I0, "", 12, 3);
			}
		},{
			text : 'Rg',
			dataIndex : 'Rg',
			flex : 1,
			renderer : function(val, y, sample) {
				return BUI.formatValuesUnits(sample.data.Rg, "nm", 12, 3);
			}
		},{
			text : 'Mass',
			dataIndex : 'Mass',
			flex : 1,
			renderer : function(val, y, sample) {
				return BUI.formatValuesUnits(sample.data.Mass, "", 12, 3);
			}
		},{
			text : 'Vc',
			dataIndex : 'Vc',
			flex : 1,
			renderer : function(val, y, sample) {
				return BUI.formatValuesUnits(sample.data.Vc, "", 12, 3);
			}
		},{
			text : 'Qr',
			dataIndex : 'Qr',
			flex : 1,
			renderer : function(val, y, sample) {
				return BUI.formatValuesUnits(sample.data.Qr, "", 12, 3);
			}
		},{
			text : 'Quality',
			dataIndex : 'quality',
			flex : 1,
			renderer : function(val, y, sample) {
				return (Number(sample.data.quality) * 100).toFixed(2) + "%";
			}
		},
		{
			text : '',
			renderer : function(val, x, sample) {
				if (sample != null) {
					return BUI.getZipHTMLByFrameRangeId(_this.experimentId, sample.raw.frameNumber, sample.raw.frameNumber);
				}
			},
			width : 100
		}],
		flex : 1,
		viewConfig : {
			stripeRows : true
		}
	});

	/** Adding the tbar **/
	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : this._getTbar()
		});
	}
	return this.grid;
};

FrameGrid.prototype.input = function() {
	return [];
};

FrameGrid.prototype.test = function(targetId) {
	var frameGrid = new FrameGrid({
		width : 800,
		height : 350,
		collapsed : false,
		tbar : true
	});

	var panel = frameGrid.getPanel([]);
	panel.render(targetId);
};


function PeakGrid(args) {
	this.height = 500;
	this.searchBar = false;
	this.tbar = false;
	this.collapsed = false;
	this.width = 500;
	this.showExtendedColumns = false;
	
	if (args != null) {
		if (args.showExtendedColumns != null) {
			this.showExtendedColumns = args.showExtendedColumns;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.searchBar != null) {
			this.searchBar = args.searchBar;
		}

		if (args.tbar != null) {
			this.tbar = args.tbar;
		}

		if (args.collapsed != null) {
			this.collapsed = args.collapsed;
		}

		if (args.width != null) {
			this.width = args.width;
		}
	}
}


PeakGrid.prototype.refresh = function(buffers) {
	this.store.loadData(this._prepareData(buffers), false);
};

PeakGrid.prototype._prepareData = function(buffers) {
	
//	for ( var i = 0; i < buffers.length; i++) {
//		buffers[i].name = "Peak #" + (i+1);
//	}
	/** Adding information of buffer **/
	if (buffers.length > 0){
		buffers.unshift({
			name	: "BUFFER",
			start	: 0,
			experimentId	: buffers[0].experimentId,
			end		: buffers[0].start - 1
		});
	}
	
	
	return buffers;
};

PeakGrid.prototype._getTbar = function() {
	var _this = this;
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add Buffer',
		disabled : false,
		handler : function(widget, event) {
			var window = new BufferWindow();
			window.onSuccess.attach(function(sender) {
				_this.store.loadData(BIOSAXS.proposal.getBuffers());
			});
			window.draw({});
		}
	}));
	return actions;
};

PeakGrid.prototype.getPanel = function(buffers) {
	var _this = this;
	this.peakCount = 0;
	this.store = Ext.create('Ext.data.Store', {
		fields : ['name', {name:'start', type : 'int'}, {name:'end', type : 'int'}],
		data : buffers
		
	});
	
	this.store.sort('start');

	var type = 'Ext.grid.Panel';
	if (this.searchBar == true) {
		type = 'Ext.ux.LiveSearchGridPanel';
	}
	this.grid = Ext.create(type, {
		store : this.store,
		height : this.height,
		width : this.width,
		margin	: 5,
		columns : [
		           {
		        	   text : '',
		        	   dataIndex : 'name',
		        	   width : 100,
		        	   hidden : _this.showExtendedColumns,
		        	   renderer : function(val, y, sample) {
		        		   if (sample.data.name == "BUFFER")
		        			   return "BUFFER";
		        		    _this.peakCount++;
							return  "Peak #" + _this.peakCount;
						}
		        	  
		        	   
		           },
		           {
						text : 'Peaks',
						dataIndex : 'start',
						sortable : true,
						width : 100,
						hidden: !_this.showExtendedColumns,
						renderer : function(val, y, sample) {
							return "From " + Number(sample.raw.start) + " to " + Number(sample.raw.end);
						}
					},
		           {
		   			text : 'Frames',
		   			hidden : _this.showExtendedColumns,
		   			columns : [
									{
										text : 'Start',
										dataIndex : 'start',
										sortable : true,
										hidden : _this.showExtendedColumns,
										width : 100,
										renderer : function(val, y, sample) {
											return Number(val);
										}
									},{
										text : 'End',
										dataIndex : 'end',
										width : 100,
										hidden : _this.showExtendedColumns,
										renderer : function(val, y, sample) {
											return Number(val);
										}
									},{
										text : 'Total',
										dataIndex : 'end',
										width : 100,
										hidden : _this.showExtendedColumns,
										renderer : function(val, y, sample) {
											return "<span style='font-style:italic'>" + (sample.raw.end - sample.raw.start) + " frames</span>";
										}
									}
					]
		           }
//					,
//					{
//						text : '',
//						  hidden : _this.showExtendedColumns,
//						renderer : function(val, x, sample) {
//							if (sample != null) {
//								return BUI.getZipHTMLByFrameRangeId(sample.raw.experimentId, sample.raw.start, sample.raw.end);
//							}
//						},
//						width : 100
//					}
		           ],
		flex : 1,
		viewConfig : {
			stripeRows : true,
			getRowClass : function(record, rowIdx, params, store) {
				if (record.raw.name == "BUFFER") {
					return "blue-row";
				}
			}
		}
	});

	/** Adding the tbar **/
	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : this._getTbar()
		});
	}
	return this.grid;
};

PeakGrid.prototype.input = function() {
	return [];
};

PeakGrid.prototype.test = function(targetId) {
	var PeakGrid = new PeakGrid({
		width : 800,
		height : 350,
		collapsed : false,
		tbar : true
	});

	var panel = PeakGrid.getPanel([]);
	panel.render(targetId);
};

/**
 * Macromolecule Grid showing macromolecules and adding anb updating buttons
 * 
 * @height
 * @maxHeight
 * @width
 * @cssFontStyle
 * @searchBar makes this grid as Ext.ux.LiveSearchGridPanel
 * @tbar top bar containing "Add" and "Update From SMIS" button 
 * @collapsed
 * @collapsible
 * @btnEditVisible
 * @btnRemoveVisible
 * @multiselect makes it multiselect using Ext.selection.CheckboxModel
 * 
 * #onSelected
 * #onMacromoleculesChanged
 */
function MacromoleculeGrid(args) {
	this.height = 500;
	this.width = 500;
	this.id = BUI.id();
	this.maxHeight = this.height;

	this.searchBar = false;
	this.tbar = false;

	this.collapsible = true;
	this.collapsed = true;

	this.btnEditVisible = true;
	this.btnRemoveVisible = false;
	this.multiselect = false;

	/** Font style applied to the acronym column **/
	this.cssFontStyle = null;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
			this.maxHeight = this.height;
		}
		if (args.maxHeight != null) {
			this.maxHeight = args.maxHeight;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.cssFontStyle != null) {
			this.cssFontStyle = args.cssFontStyle;
		}

		if (args.searchBar != null) {
			this.searchBar = args.searchBar;
		}
		if (args.tbar != null) {
			this.tbar = args.tbar;
		}
		if (args.collapsible != null) {
			this.collapsible = args.collapsible;
		}
		if (args.collapsed != null) {
			this.collapsed = args.collapsed;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
		if (args.btnRemoveVisible != null) {
			this.btnRemoveVisible = args.btnRemoveVisible;
		}
		if (args.multiselect != null) {
			this.multiselect = args.multiselect;
		}
	}

	this.onSelected = new Event();

	this.onMacromoleculesChanged = new Event();
}





MacromoleculeGrid.prototype.edit = function(macromolecule) {
	var _this = this;
	var window = new MacromoleculeWindow();
	window.onSave.attach(function(sender) {
		_this.store.loadData(BIOSAXS.proposal.getMacromolecules());
		_this.onMacromoleculesChanged.notify();
	});
	window.draw(macromolecule);
};

MacromoleculeGrid.prototype.getTbar = function() {
	var _this = this;
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add macromolecule',
		disabled : false,
		handler : function(widget, event) {
			_this.edit();
		}
	}));
	actions.push("->");
	actions.push(Ext.create('Ext.Action', {
		icon : '../images/folder_go.png',
		text : 'Update From SMIS',
		tooltip : "Retrieve all the macromolecules of your proposal from SMIS database",
		disabled : false,
		handler : function(widget, event) {
			_this.grid.setLoading("Connecting to SMIS");
			var adapter = new BiosaxsDataAdapter();
			adapter.onSuccess.attach(function(sender, data) {
				BIOSAXS.proposal.setMacromolecules(data.macromolecules);
				_this.refresh(BIOSAXS.proposal.macromolecules);
				_this.grid.setLoading(false);
			});
			adapter.onError.attach(function(sender, data) {
				_this.grid.setLoading(false);
			});
			adapter.updateDataBaseFromSMIS();
		}
	}));
	return actions;
};

MacromoleculeGrid.prototype.deselectAll = function() {
	this.grid.getSelectionModel().deselectAll();
};

MacromoleculeGrid.prototype.selectById = function(macromoleculeId) {
	this.grid.getSelectionModel().deselectAll();
	for ( var i = 0; i < this.grid.getStore().data.items.length; i++) {
		var item = this.grid.getStore().data.items[i].raw;
		if (item.macromoleculeId == macromoleculeId) {
			this.grid.getSelectionModel().select(i);
		}
	}
};

MacromoleculeGrid.prototype.refresh = function(macromolecules) {
	this.store.loadData(macromolecules, false);
};

MacromoleculeGrid.prototype.getColumns = function() {
	var _this = this;
	var columns = [
	{
		text : 'Acronym',
		dataIndex : 'acronym',
		id : this.id + "acronym",
		flex : 1,
		renderer : function(value, metaData, record, rowIndex, colIndex, store) {
			if (_this.cssFontStyle != null) {
				return "<span style='" + _this.cssFontStyle + "'>" + value + "</span>";
			}
			return value;
		}
	}, {
		text : 'Name',
		dataIndex : 'name',
		id : this.id + "name",
		flex : 1,
		hidden : true
	} ];

	if (this.btnEditVisible) {
		columns.push({
			id : _this.id + 'buttonEditMacromolecule',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnEditVisible) {
					return BUI.getGreenButton('EDIT');
				}
				return null;
			}
		});
	}
	if (this.btnRemoveVisible) {
		columns.push({
			id : _this.id + 'buttonRemoveMacromolecule',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnRemoveVisible) {
					return BUI.getRedButton('REMOVE');
				}
				return null;
			}
		});
	}

	return columns;
};


/** Returns the grid **/
MacromoleculeGrid.prototype.getPanel = function() {
	var _this = this;

	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'macromoleculeId', 'name', 'acronym' ]
	});

	var type = 'Ext.grid.Panel';
	if (this.searchBar == true) {
		type = 'Ext.ux.LiveSearchGridPanel';
	}

	this.selModel = Ext.create('Ext.selection.RowModel', {
//		allowDeselect : true,
//		mode : 'MULTI',
		listeners : {
			selectionchange : function(sm, selections) {
				var selected = [];
				for (var i = 0; i < selections.length; i++) {
					selected.push(selections[i].raw);
				}
				_this.onSelected.notify(selected);
			}
		}
	});

	this.grid = Ext.create(type, {
		id : this.id,
		title : 'Macromolecules',
		collapsible : this.collapsible,
		collapsed : this.collapsed,
		store : this.store,
		height : this.height,
		maxHeight : this.maxHeight,
		selModel : this.selModel,
		columns : this.getColumns(),
		width : this.width,
		viewConfig : {
			stripeRows : true,
			listeners : {
				'celldblclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					_this.edit(BIOSAXS.proposal.getMacromoleculeById(record.data.macromoleculeId));
				},
				'cellclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEditMacromolecule') {
						_this.edit(BIOSAXS.proposal.getMacromoleculeById(record.data.macromoleculeId));
					}
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemoveMacromolecule') {
						BUI.showBetaWarning();
					}
				}

			}
		}
	});

	/** Adding the tbar **/
	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : this.getTbar()
		});
	}
	return this.grid;
};

MacromoleculeGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10()
	};
};

MacromoleculeGrid.prototype.test = function(targetId) {
	var macromoleculeGrid = new MacromoleculeGrid({
		width : 800,
		height : 350,
		collapsed : false,
		tbar : true
	});

	BIOSAXS.proposal = new Proposal(macromoleculeGrid.input().proposal);
	var panel = macromoleculeGrid.getPanel(BIOSAXS.proposal.macromolecules);
	panel.render(targetId);
};

/**
 * Shows measurements with their attributes as specimen, exposure temperature,
 * volume to load, transmission etc...
 * 
 * @addBtnMultipleEdit: if true add a button for changing measurements'
 *                      parameters by choosing multiple measurements. It opens
 *                      <span
 *                      style="color:blue;">MultipleEditMeasurementGridWindow</span>
 * @collapsed: if true it doesn't show buffer's measurements
 * @editor: hashmap containing columns to be edited. It is an array of a json
 *          like editor of Ext
 * @selModel
 * @collapseBtnEnable
 * @removeBtnEnabled Ext.selection.RowModel
 * @addBtnEnable
 * @updateRowEnabled true/false if update plugin is set to the grid
 * @showTitle
 * @title
 * @isStatusColumnHidden
 * @isPriorityColumnHidden
 * @isTimeColumnHidden
 * @estimateTime
 * @margin
 * @tbar
 * @height
 * @maxHeight
 * @minHeight
 * @width
 * @maxWidth
 * @resizable
 * @experimentColorBased when colors for buffers and macromolecules are not
 *                       selected by the proposal but by experiment, so the
 *                       number of colors is smaller
 * 
 * #onClick #onSelected #onRemoved #onUpdateTime #onMeasurementChanged
 * #onExperimentChanged
 */
function MeasurementGrid(args) {
	this.id = BUI.id();

	this.height = 500;
	this.width = 900;

	this.maxWidth = 1200;
	this.maxHeight = 600;
	this.minHeight = 500;

	this.unitsFontSize = 9;
	this.title = "Measurements";
	this.estimateTime = false;
	this.collapsed = true;
	this.tbar = true;

	this.showTitle = true;
	this.resizable = true;
	this.updateRowEnabled = true;

	/**
	 * Hash map containing the keys of the editable columns. Ex:
	 * 'exposureTemperature' *
	 */
	this.editor = {
		comments : {
			xtype : 'textfield',
			allowBlank : true
		}
	};

	this.isTimeColumnHidden = false;
	this.isStatusColumnHidden = false;
	this.isPriorityColumnHidden = true;
	this.margin = "0 0 0 0";

	this.addBtnEnable = true;
	this.sorter = [ {
		property : 'priority',
		direction : 'ASC'
	} ];

	this.removeBtnEnabled = false;
	this.collapseBtnEnable = true;
	this.addBtnMultipleEdit = false;
	this.sortingBtnEnable = false;

	var _this = this;
	this.selModel = Ext.create('Ext.selection.RowModel', {
		allowDeselect : true,
		mode : 'MULTI',
		listeners : {
			selectionchange : function(sm, selections) {
				var selected = [];
				for (var i = 0; i < selections.length; i++) {
					selected.push(selections[i].raw);
				}
				_this.onSelected.notify(selected);
			}
		}
	});

	if (args != null) {

		if (args.selModel != null) {
			this.selModel = args.selModel;
		}

		if (args.removeBtnEnabled != null) {
			this.removeBtnEnabled = args.removeBtnEnabled;
		}

		if (args.addBtnMultipleEdit != null) {
			this.addBtnMultipleEdit = args.addBtnMultipleEdit;
		}

		// if (args.experimentColorBased != null) {
		// this.experimentColorBased = args.experimentColorBased;
		// }

		if (args.collapsed != null) {
			this.collapsed = args.collapsed;
		}
		if (args.resizable != null) {
			this.resizable = args.resizable;
		}

		if (args.editor != null) {
			this.editor = args.editor;
		}

		if (args.collapseBtnEnable != null) {
			this.collapseBtnEnable = args.collapseBtnEnable;
		}

		if (args.addBtnEnable != null) {
			this.addBtnEnable = args.addBtnEnable;
		}
		if (args.sortingBtnEnable != null) {
			this.sortingBtnEnable = args.sortingBtnEnable;
		}

		if (args.isPriorityColumnHidden != null) {
			this.isPriorityColumnHidden = args.isPriorityColumnHidden;
		}

		if (args.width != null) {
			this.width = args.width;
		}

		if (args.updateRowEnabled != null) {
			this.updateRowEnabled = args.updateRowEnabled;
		}

		if (args.showTitle != null) {
			this.showTitle = args.showTitle;
			if (this.showTitle == false) {
				this.title = null;
			}
		}

		if (args.height != null) {
			this.height = args.height;
		}

		if (args.maxHeight != null) {
			this.maxHeight = args.maxHeight;
		}

		if (args.minHeight != null) {
			this.minHeight = args.minHeight;
		}

		if (args.maxWidth != null) {
			this.maxWidth = args.maxWidth;
		}

		if (args.isStatusColumnHidden != null) {
			this.isStatusColumnHidden = args.isStatusColumnHidden;
		}
		if (args.isTimeColumnHidden != null) {
			this.isTimeColumnHidden = args.isTimeColumnHidden;
		}

		if (args.title != null) {
			this.title = args.title;
		}
		if (args.estimateTime != null) {
			this.estimateTime = args.estimateTime;
		}

		if (args.margin != null) {
			this.margin = args.margin;
		}

		if (args.tbar != null) {
			this.tbar = args.tbar;
		}

		if (args.sorter != null) {
			this.sorter = args.sorter;
		}

	}
	this.onClick = new Event(this);
	this.onSelected = new Event(this);
	this.onRemoved = new Event(this);
	this.onUpdateTime = new Event(this);
	this.onMeasurementChanged = new Event(this);
	this.onExperimentChanged = new Event(this);
}

MeasurementGrid.prototype._sortBy = function(sort) {
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		_this.onExperimentChanged.notify(data);
		_this.grid.setLoading(false);
		// wizardWidget.window.close();
	});
	adapter.onError.attach(function(sender, data) {
		_this.grid.setLoading(false);
		alert("Oops, there was a problem");
	});
	_this.grid.setLoading("Sorting");
	adapter.sortMeasurements(this.experiments.experiments[0].experimentId, sort);
};

MeasurementGrid.prototype._getMenu = function() {
	var _this = this;
	if (this.tbar) {

		var items = [];
		if (_this.addBtnEnable) {
			items.push({
				icon : '../images/add.png',
				text : 'Add measurements',
				handler : function() {
					_this._openAddMeasurementWindow();
				}
			});
		}

		if (_this.addBtnMultipleEdit) {
			items.push({
				icon : '../images/Edit_16x16_01.png',
				text : 'Multiple Edit',
				handler : function() {
					var multipleEditMeasurementGridWindow = new MultipleEditMeasurementGridWindow();
					multipleEditMeasurementGridWindow.onExperimentChanged.attach(function(sender, data) {
						_this.onExperimentChanged.notify(data);
					});

					multipleEditMeasurementGridWindow.draw(_this.measurements, _this.experiments);

				}
			});
		}

		items.push("->");

		if (_this.sortingBtnEnable) {
			var split = Ext.create('Ext.button.Split', {
				text : 'Sort by',
				// handle a click on the button itself
				handler : function() {
					// alert("The button was clicked");
				},
				menu : new Ext.menu.Menu({
					items : [
					{
						text : 'First Created First Measured',
						handler : function() {
							_this._sortBy("FIFO");
						}
					}, "-", {
						text : 'Default',
						handler : function() {
							_this._sortBy("DEFAULT");
						}
					} ]
				})
			});
			items.push(split);
		}

		if (_this.collapseBtnEnable) {
			items.push({
				text : 'Collapse buffers',
				enableToggle : true,
				scope : this,
				toggleHandler : function(item, pressed) {
					this.collapsed = pressed;
					this.grid.getStore().loadData(this._prepareData(this.measurements, this.experiments), false);
				},
				pressed : this.collapsed
			});
		}
		var tb = Ext.create('Ext.toolbar.Toolbar', {
			items : items
		});
		return tb;
	}
	return null;
};

/** Opens WizardWidget for adding new measurements * */
MeasurementGrid.prototype._openAddMeasurementWindow = function(measurements, experiments) {
	var _this = this;
	var wizardWidget = new WizardWidget();
	wizardWidget.onFinished.attach(function(sender, result) {
		var adapter = new BiosaxsDataAdapter();
		adapter.onSuccess.attach(function(sender, data) {
			_this.onExperimentChanged.notify(data);
			_this.grid.setLoading(false);
			wizardWidget.window.close();
		});
		wizardWidget.current.setLoading("ISPyB: Adding measurements");
		adapter.addMeasurements(result.name, "comments", result.data, _this.experiments.experiments[0].experimentId);
	});

	wizardWidget.draw(null, new MeasurementCreatorStepWizardForm(BIOSAXS.proposal.getMacromolecules(), {
		noNext : true
	}));
};

/*******************************************************************************
 * Opens WizardWidget for adding new measurements
 * 
 * @Measurements
 * @Experiments experimentList Object
 ******************************************************************************/
MeasurementGrid.prototype._prepareData = function(measurements, experiments) {
	var data = [];
	for (var i = 0; i < measurements.length; i++) {
		var measurement = measurements[i];
		var specimen = experiments.getSampleById(measurement.specimenId);
		var buffer = experiments.getBufferById(specimen.bufferId);
		measurement.buffer_acronym = buffer.acronym;
		measurement.bufferId = buffer.bufferId;
		measurement.volume = specimen.volume;
		if (specimen.macromolecule3VO != null) {
			measurement.acronym = specimen.macromolecule3VO.acronym;
			measurement.macromoleculeId = specimen.macromolecule3VO.macromoleculeId;
		}
		measurement.concentration = specimen.concentration;
		if (measurement.run3VO != null) {
			measurement.energy = measurement.run3VO.energy;
			measurement.expExposureTemperature = measurement.run3VO.exposureTemperature;
			measurement.storageTemperature = measurement.run3VO.storageTemperature;
			measurement.timePerFrame = measurement.run3VO.timePerFrame;
			measurement.radiationAbsolute = measurement.run3VO.radiationAbsolute;
			measurement.radiationRelative = measurement.run3VO.radiationRelative;
			measurement.status = "DONE";

			try {
				if (measurement.run3VO.timeStart != null) {
					if (measurement.run3VO.timeStart != "") {
						measurement.miliseconds = moment(measurement.run3VO.timeStart).format("X");
					}
				}
			} catch (E) {
				console.log(E);
			}
		}

		if (experiments.getDataCollectionByMeasurementId(measurement.measurementId).length > 0) {
			var measurementtodatacollection3VOs = experiments.getDataCollectionByMeasurementId(measurement.measurementId)[0].measurementtodatacollection3VOs;
			for (var k = 0; k < measurementtodatacollection3VOs.length; k++) {
				if (measurementtodatacollection3VOs[k].dataCollectionOrder == 1) {
					var specimenBuffer = experiments.getSampleById(experiments.getMeasurementById(measurementtodatacollection3VOs[k].measurementId).specimenId);
					if (specimenBuffer.sampleplateposition3VO != null) {
						measurement.bufferSampleplateposition3VO = specimenBuffer.sampleplateposition3VO;
						measurement.bufferSampleplate = (experiments.getSamplePlateById(specimenBuffer.sampleplateposition3VO.samplePlateId));
					}
				}
			}
		}

		if (this.collapsed) {
			/** If collapsed only the samples * */
			if (specimen.macromolecule3VO != null) {
				data.push(measurement);
			}
		} else {
			data.push(measurement);
		}

	}
	return data;
};

/**
 * Refresh data grid with the measurements and the experiments
 * 
 * @measurements array with measurement3VO objects
 * @experiments array with experiments objects
 */
MeasurementGrid.prototype.refresh = function(measurements, experiments) {
	this.experiments = experiments;
	this.measurements = measurements;
	this.store.loadData(this._prepareData(measurements, experiments), false);
};

/**
 * Set status bar to busy (refreshing icon)
 * 
 * @msg message to be displayed on the bar
 */
MeasurementGrid.prototype._showStatusBarBusy = function(msg) {
	var statusBar = Ext.getCmp(this.id + 'basic-statusbar');
	statusBar.setStatus({
		text : msg,
		iconCls : 'x-status-busy',
		clear : false
	});
};

/**
 * Set status bar to ready (ok icon)
 * 
 * @msg message to be displayed on the bar
 */
MeasurementGrid.prototype._showStatusBarReady = function(msg) {
	var statusBar = Ext.getCmp(this.id + 'basic-statusbar');
	statusBar.setStatus({
		text : msg,
		iconCls : 'x-status-valid',
		clear : false
	});
};

/**
 * If updateRowEnabled returns an array with Ext.grid.plugin.RowEditing
 */
MeasurementGrid.prototype._getPlugins = function() {
	var _this = this;
	var plugins = [];
	if (this.updateRowEnabled) {
		plugins.push(Ext.create('Ext.grid.plugin.RowEditing', {
			clicksToEdit : 1,
			listeners : {
				validateedit : function(grid, e) {
					/** Setting values * */
					for ( var key in _this.editor) {
						e.record.raw[key] = e.newValues[key];
					}
					/** Comments are always updatable* */
					e.record.raw.comments = e.newValues.comments;

					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, measurement) {
						_this.onMeasurementChanged.notify(measurement);
						_this.grid.setLoading(false);
					});
					adapter.onError.attach(function() {
						alert("Error");
						_this.grid.setLoading(false);
					});

					_this.grid.setLoading();
					adapter.saveMeasurement(e.record.raw, _this.experiments.experiments[0]);
				}
			}
		}));
	}
	return plugins;
};

/**
 * @key name of the columns mathing the this.editor[key]
 */
MeasurementGrid.prototype._getEditor = function(key) {
	if (this.editor[key] != null) {
		return this.editor[key];
	}
	return null;
};

MeasurementGrid.prototype.getPanel = function(measurements, experiments) {
	this.experiments = experiments;
	this.measurements = measurements;
	var _this = this;
	this.store = Ext.create('Ext.data.Store', {
		fields : [ {
			name : 'miliseconds',
			type : 'int'
		}, 'priority', 'bufferId', {
			name : 'exposureTemperature',
			type : 'numeric'
		}, 'volumeToLoad','code', 'transmission', 'viscosity', 'waitTime', 'flow', 'buffer_acronym', 'macromoleculeId', 'acronym', 'concentration', 'extraFlowTime', 'volume', 'energy',
				'expExposureTemperature', 'storageTemperature', 'timePerFrame', 'radiationAbsolute', 'radiationRelative', 'status', 'comments' ],
		data : this._prepareData(measurements, experiments)
	});
	this.store.sort(this.sorter);
	var bbar = {};
	try {
		bbar = Ext.create('Ext.ux.StatusBar', {
			id : _this.id + 'basic-statusbar',
			defaultText : 'Ready',
			text : 'Ready',
			iconCls : 'x-status-valid',
			items : []
		});
	} catch (exp) {
		console.log("bbar error");
	}

	this.grid = Ext
			.create(
					'Ext.grid.Panel',
					{
						id : this.id,
						title : this.title,
						store : this.store,
						selModel : this.selModel,
						plugins : this._getPlugins(),
						resizable : this.resizable,
						margin : this.margin,
						maxHeight : this.maxHeight,
						minHeight : this.minHeight,
						maxWidth : this.maxWidth,
						width : this.width,
						tbar : this._getMenu(),
						columns : [
								{
									text : 'Order',
									dataIndex : 'priority',
									width : 50,
									hidden : _this.isPriorityColumnHidden,
									sortable : true

								},
								{
									text : 'Run Number',
									dataIndex : 'code',
									width : 50,
									hidden : true,
									sortable : true

								},

								{
									text : 'Specimen',
									columns : [

											{
												text : '',
												dataIndex : 'macromoleculeId',
												width : 30,
												renderer : function(val, y, sample) {
													if (val != null) {
														if (_this.experiments == null) {
															return BUI.getRectangleColorDIV(BIOSAXS.proposal.macromoleculeColors[val], 10, 10);
														} else {
															return BUI.getRectangleColorDIV(_this.experiments.macromoleculeColors[val], 10, 10);
														}
													}
												},
												sortable : true
											},
											{
												text : 'Macromo.',
												dataIndex : 'acronym',
												width : 80,
												renderer : function(val, y, sample) {
													return val;
												},
												sortable : true
											},
											{
												text : 'Conc. ',
												dataIndex : 'concentration',
												width : 80,
												renderer : function(val, y, sample) {
													if (sample.raw.macromoleculeId == null) {
														return "";
													}
													if (isNaN(val))
														return val;

													if (val != 0) {
														return BUI.formatValuesUnits(val, '', {
															fontSize : 16,
															decimals : 3,
															unitsFontSize : this.unitsFontSize
														});
													} else {
														return;
													}

												},
												sortable : true
											},
											{
												text : '',
												dataIndex : 'bufferId',
												width : 30,
												hidden : false,
												renderer : function(val, y, sample) {
													if (val != null) {
														var color = '#FFCCFF';
														if (_this.experiments != null) {
															var dc = _this.experiments.getDataCollectionByMeasurementId(sample.raw.measurementId);
															if (dc != null) {
																if (dc.length > 0) {
																	color = _this.experiments.getSpecimenColorByBufferId(_this.experiments
																			.getMeasurementById(dc[0].measurementtodatacollection3VOs[0].measurementId).specimenId);
																}
															}
														} else {
															color = BIOSAXS.proposal.bufferColors[val];
														}
														return BUI.getRectangleColorDIV(color, 10, 10);
													}
												},
												sortable : true
											},
											{
												text : 'Buffer',
												dataIndex : 'buffer_acronym',
												width : 120,
												renderer : function(val, y, sample) {
													if (sample.raw.bufferSampleplateposition3VO != null) {
														return BIOSAXS.proposal.getBufferById(sample.raw.bufferId).acronym + "<span style='font-style:oblique;'> Plate: ["
																+ sample.raw.bufferSampleplate.slotPositionColumn + ", "
																+ BUI.getSamplePlateLetters()[sample.raw.bufferSampleplateposition3VO.rowNumber - 1] + "-"
																+ sample.raw.bufferSampleplateposition3VO.columnNumber + "]</span>";
													}
													return val;
												},
												sortable : true
											}, {
												text : 'Position',
												width : 100,
												hidden : true,
												renderer : function(val, y, sample) {
													if (_this.experiments != null) {
														return BUI.getSamplePositionHTML(_this.experiments.getSampleById(sample.raw.specimenId), _this.experiments.experiments[0]);
													}
												}
											} ]
								},
								{
									text : 'Parameters',
									columns : [
											{
												text : 'Ex. Flow. time (s)',
												dataIndex : 'extraFlowTime',
												width : 100,
												hidden : true,
												renderer : function(val, y, sample) {
													return BUI.formatValuesUnits(val, 's', {
														fontSize : 12,
														decimals : 0,
														unitsFontSize : this.unitsFontSize
													});
												}
											},
											{
												text : 'Exp. Temp.',
												dataIndex : 'exposureTemperature',
												width : 70,
												renderer : function(val, y, sample) {
													if (Number(val)) {
														return BUI.formatValuesUnits(val, 'C', {
															fontSize : 12,
															decimals : 2,
															unitsFontSize : this.unitsFontSize
														});
													}
													return null;
												},
												sortable : true,
												editor : this._getEditor("exposureTemperature")
											},
											{
												text : 'Vol. Load',
												dataIndex : 'volumeToLoad',
												width : 60,
												hidden : false,
												editor : this._getEditor("volumeToLoad"),
												renderer : function(val, y, sample) {
													// return val+ " &#181l";
													return BUI.formatValuesUnits(val, '&#181l', {
														fontSize : 12,
														decimals : 2,
														unitsFontSize : this.unitsFontSize
													});
												}
											},
											{
												text : 'Volume in Well',
												dataIndex : 'volume',
												hidden : true,
												editor : this._getEditor("volume"),
												width : 80,
												renderer : function(val, y, sample) {
													// return val + "(&#181l)";
													return BUI.formatValuesUnits(val, '&#181l', {
														fontSize : 12,
														decimals : 2,
														unitsFontSize : this.unitsFontSize
													});
												}
											},
											{
												text : 'Trans.',
												dataIndex : 'transmission',
												width : 60,
												editor : this._getEditor("transmission"),
												renderer : function(val, y, sample) {
													return BUI.formatValuesUnits(val, '%', {
														fontSize : 12,
														decimals : 0,
														unitsFontSize : this.unitsFontSize
													});
												}
											},
											{
												text : 'Wait T.',
												dataIndex : 'waitTime',
												editor : this._getEditor("waitTime"),
												width : 50,
												renderer : function(val, y, sample) {
													// if (val != 0) {
													return BUI.formatValuesUnits(val, 's', {
														fontSize : 12,
														decimals : 0,
														unitsFontSize : this.unitsFontSize
													});
													// }
												}
											},
											{
												text : 'Flow',
												dataIndex : 'flow',
												editor : this._getEditor("flow"),
												width : 50,
												renderer : function(val, y, sample) {
													if (val == true) {
														return "yes";
													}
													return null;
												}
											},
											{
												text : 'Viscosity',
												dataIndex : 'viscosity',
												tooltip : 'The viscosity of a fluid is a measure of its resistance to gradual deformation by shear stress or tensile stress. For liquids, it corresponds to the informal notion of "thickness"',
												editor : this._getEditor("viscosity"),
												width : 50,
												renderer : function(val, y, sample) {
													return val;
												}
											} ]
								}, {
									text : 'Status',
									dataIndex : 'status',
									width : 50,
									hidden : _this.isStatusColumnHidden,
									renderer : function(val, y, sample) {
										if (val != null) {
											if (val == 'DONE') {
												return "<span style='color:green; font-weight:bold;'>" + val + " </span>";
											}
										}
									}
								}, {
									text : 'Time',
									dataIndex : 'time',
									width : 80,
									hidden : _this.isTimeColumnHidden,
									renderer : function(val, y, sample) {
										if (sample.raw.run3VO != null) {
											if (sample.raw.run3VO.timeStart != null) {
												if (sample.raw.run3VO.timeStart != "") {
													var m = moment(sample.raw.run3VO.timeStart);
													return m.format("hh:mm:ss a");
												}
											}
										}
									}
								}, {
									text : 'Energy',
									dataIndex : 'energy',
									width : 100,
									hidden : true
								}, {
									text : 'Real Exp. Temp.(C)',
									width : 100,
									dataIndex : 'expExposureTemperature',
									hidden : true
								}, {
									text : 'Storage Temp.(C)',
									width : 100,
									dataIndex : 'storageTemperature',
									hidden : true
								}, {
									text : 'Time/Frame (s)',
									width : 100,
									dataIndex : 'timePerFrame',
									hidden : true
								}, {
									text : 'Radiation Relative',
									dataIndex : 'radiationRelative',
									width : 100,
									hidden : true
								}, {
									text : 'Radiation Absolute',
									dataIndex : 'radiationAbsolute',
									width : 100,
									hidden : true
								}, {
									text : 'Comments',
									dataIndex : 'comments',
									flex : 1,
									hidden : false,
									editor : this._getEditor("comments")

								}, {
									id : _this.id + 'buttonRemoveSample',
									text : '',
									hidden : !_this.removeBtnEnabled,
									width : 100,
									sortable : false,
									renderer : function(value, metaData, record, rowIndex, colIndex, store) {
										if (record.raw.macromoleculeId != null) {
											if (_this.removeBtnEnabled) {
												return BUI.getRedButton('REMOVE');
											}
										}
									}
								} ],
						bbar : bbar,
						viewConfig : {
							stripeRows : true,
							getRowClass : function(record, index, rowParams, store) {
								if (record.data.status == "DONE") {
									return 'green-row';
								}

							},
							listeners : {
								'itemclick' : function(grid, record, item, index, e, eOpts) {
									_this.onClick.notify({
										specimen : record.raw
									});
								},
								'cellclick' : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
									if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemoveSample') {
										grid.getStore().removeAt(rowIndex);

										if (record.raw.measurementId != null) {
											/** For testing * */
											grid.setLoading("ISPyB: Removing measurement");
											var adapter = new BiosaxsDataAdapter();
											adapter.onSuccess.attach(function(sender, data) {
												grid.setLoading(false);
												/**
												 * We get and refresh experiment
												 * because specimens has changed *
												 */
												var adapter2 = new BiosaxsDataAdapter();
												adapter2.onSuccess.attach(function(sender, experiment) {
													_this.onRemoved.notify(experiment);
													_this._showStatusBarReady('Ready');
												});
												if (_this.experiments.experiments[0].experimentId != null) {
													adapter2.getExperimentById(_this.experiments.experiments[0].experimentId, "MEDIUM");
													_this._showStatusBarBusy("ISPyB: Removing Unused Specimens");
												}
											});

											adapter.onError.attach(function(sender, data) {
												alert("Error: " + data);
												grid.setLoading(false);
											});

											adapter.removeMeasurement(record.raw);
										}
									}

								}

							}
						}
					});

	this.grid.on("afterrender", function() {

		function updateTime() {
			try {
				_this.estimatedTime = _this.estimatedTime - 1;

				_this.onUpdateTime.notify({
					hours : (Number(_this.estimatedTime / 3600).toFixed()),
					minutes : (Number((_this.estimatedTime / 60) % 60).toFixed()),
					seconds : (Number(_this.estimatedTime % 60).toFixed())

				});

				if (Number(_this.estimatedTime) < 0) {
					_this.timer = null;
					grid.setTitle(_this.title);
				}

			} catch (e) {
				console.log(e);
				_this.timer = null;
			}
		}

		if (_this.estimateTime) {
			var experimentList = _this.experiments;
			var collected = experimentList.getMeasurementsCollected();
			if (collected.length > 0) {
				if (collected[0].run3VO != null) {
					try {
						var end = collected[0].run3VO.timeEnd;
						var start = collected[0].run3VO.timeStart;
						var dstart = moment(start);
						var dend = moment(end);
						var seconds = Number(dend.diff(dstart) / 1000).toFixed();

						_this.estimatedTime = (seconds * experimentList.getMeasurementsNotCollected().length);

						if (_this.estimatedTime > 0) {
							updateTime();
							_this.timer = setInterval(function() {
								updateTime();
							}, 1000);
						}

					} catch (e) {
					}
				}
			}
		}
	});

	return this.grid;
};

/** Method for testing * */
MeasurementGrid.prototype.input = function() {
	var experiment = DATADOC.getExperiment_10();
	var measurements = DATADOC.getMeasurements_10();
	var proposal = DATADOC.getProposal_10();
	return {
		experiment : experiment,
		measurements : measurements,
		proposal : proposal
	};
};

MeasurementGrid.prototype.test = function(targetId) {
	var measurementGrid = new MeasurementGrid({
		tbar : true

	});
	BIOSAXS.proposal = new Proposal(measurementGrid.input().proposal);
	var panel = measurementGrid.getPanel(measurementGrid.input().measurements, new ExperimentList([ new Experiment(measurementGrid.input().experiment) ]));
	panel.render(targetId);
};

/**
 * A shipment may contains one or more cases where stock solutions and sample
 * plates are stored
 * 
 * @height
 * @btnEditVisible
 * @btnRemoveVisible
 * 
 * #onEditButtonClicked
 */
function MolarityGrid(args) {
	this.height = 100;
	this.width = 100;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.width != null) {
			this.width = args.width;
		}
	}

	var _this = this;
	
	this.molarityForm = new MolarityForm({height : 180, width : 455});

	this.molarityForm.onSave.attach(function(sender){
		_this.molarityWindow.destroy();
		_this.updateProposal();
		
	});
	
	this.molarityForm.onClose.attach(function(sender){
		_this.molarityWindow.destroy();
		
	});
	
	/** Events * */
	this.onEditButtonClicked = new Event(this);
}

MolarityGrid.prototype._getColumns = function() {
	return [ {
		text : 'Subunit',
		columns : [ {
			text : "Acronym",
			width : 100,
			hidden : false,
			dataIndex : 'acronym',
			sortable : true
		}, {
			text : "Name",
			width : 125,
			hidden : false,
			dataIndex : 'name',
			sortable : true
		}, {
			text : "MM Est.",
			width : 100,
			dataIndex : 'molecularMass',
			sortable : true,
			renderer : function(grid, cls, record){
				return BUI.formatValuesUnits(record.data.molecularMass , "Da", 10, 2); 
				
			}
		} ]
	}, {
//		text : "Number <br/><span style='font-size:10px'>in assymmetric units</span>",
		text : "Ratio",
		width : 100,
		dataIndex : 'ratio',
		tooltip : 'Number of times the subunit is present in the macromolecule',
		sortable : true
	}, {
		id : this.id + 'MOLARITY_REMOVE',
		flex : 0.1,
		sortable : false,
		renderer : function(value, metaData, record, rowIndex, colIndex, store) {
			return BUI.getRedButton('REMOVE');
		}
	} ];
};

MolarityGrid.prototype._openMolarityWindow = function() {
	this.molarityWindow = Ext.create('Ext.window.Window', {
		title : 'Molarity',
		height : 220,
		width : 500,
		modal : true,
		items : [this.molarityForm.getPanel() ]
	}).show();
};

MolarityGrid.prototype._getButtons = function() {
	var _this = this;
	return [ {
		text : 'Add subunit',
		icon : '../images/add.png',
		handler : function() {
			_this._openMolarityWindow();
		}
    }];
};


MolarityGrid.prototype.updateProposal = function() {
	var _this = this;
	this.panel.setLoading();
	BIOSAXS.proposal.onInitialized.attach(function() {
		if (BIOSAXS.proposal != null) {
			var macromolecules = BIOSAXS.proposal.macromolecules;
			for (var i = 0; i < macromolecules.length; i++) {
				
				if (macromolecules[i].macromoleculeId == _this.macromolecule.macromoleculeId) {
					_this.refresh(macromolecules[i]);
					_this.panel.setLoading(false);
				}
			}
		}
	});
	BIOSAXS.proposal.init();
};


MolarityGrid.prototype.getPanel = function() {
	var _this = this;

	this.molarityStore = Ext.create('Ext.data.Store', {
		fields : [ 'acronym', 'ratio', 'comments', 'stoichiometryId', 'name', 'molecularMass' ],
		sorters : {
			property : 'ratio',
			direction : 'DESC'
		}
	});

	this.panel = Ext.create('Ext.grid.Panel', {
		store : this.molarityStore,
		height : this.height,
		padding : 5,
		columns : this._getColumns(),
		listeners : {
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

				/** Remove entry * */
				if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'MOLARITY_REMOVE') {
					var dataAdapter = new BiosaxsDataAdapter();
					dataAdapter.onSuccess.attach(function(sender) {
						_this.updateProposal();
						
					});
					dataAdapter.removeStoichiometry(record.data.stoichiometryId);
					_this.panel.setLoading("Removing Structure");
				}
			}
		},
		tbar : this._getButtons()
	});
	return this.panel;
};

MolarityGrid.prototype._prepareData = function(macromolecule) {
	/** Return an array of [{ratio,acronym, stoichiometryId, name}] **/
		var data = [];
		if (macromolecule.stoichiometry != null) {
			for (var i = 0; i < macromolecule.stoichiometry.length; i++) {
				var hostMacromolecule = BIOSAXS.proposal.getMacromoleculeById(macromolecule.stoichiometry[i].macromoleculeId);
				data.push({
					ratio : macromolecule.stoichiometry[i].ratio,
					acronym : hostMacromolecule.acronym,
					comments : hostMacromolecule.comments,
					molecularMass : hostMacromolecule.molecularMass,
					stoichiometryId : macromolecule.stoichiometry[i].stoichiometryId,
					name : hostMacromolecule.name
				});
			}
		}
		return data;
};

MolarityGrid.prototype.refresh = function(macromolecule) {
	if (macromolecule != null){
		this.molarityStore.loadData(this._prepareData(macromolecule));
		this.molarityForm.refresh(macromolecule);
		this.macromolecule = macromolecule;
	}
};

MolarityGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10(),
		dewars : DATADOC.getDewars_10()

	};
};

MolarityGrid.prototype.test = function(targetId) {
	var MolarityGrid = new MolarityGrid({
		height : 150
	});
	BIOSAXS.proposal = new Proposal(MolarityGrid.input().proposal);
	var panel = MolarityGrid.getPanel(MolarityGrid.input().dewars);
	panel.render(targetId);

};


/**
 * Given data analysis parsed with ResultsAssemblyWidget makes a selector grid with buffer/protein
 **/
function SpecimenSelectorResultGrid() {
	this.id = BUI.id();
}

SpecimenSelectorResultGrid.prototype._prepareData = function(data) {
	var parsed = [];
	for ( var i = 0; i < data.length; i++) {
		var row = data[i];
		for ( var j = 0; j < row.conditions.length; j++) {
			parsed.push({
				bufferId : row.conditions[j].bufferId,
				macromoleculeId : row.macromoleculeId,
				macromoleculeAcronym : BIOSAXS.proposal.getMacromoleculeById(row.macromoleculeId).acronym,
				bufferAcronym : BIOSAXS.proposal.getBufferById(row.conditions[j].bufferId).acronym
			});
		}
	}
	return parsed;
};

SpecimenSelectorResultGrid.prototype.refresh = function(data) {
	this.store.loadData(this._prepareData(data));
};

SpecimenSelectorResultGrid.prototype.getPanel = function(data) {
	var _this = this;
	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'macromoleculeId', 'bufferId', 'macromoleculeAcronym', 'bufferAcronym', 'concentration' ],
		data : this._prepareData(data),
		groupField : 'macromoleculeAcronym'
	});

	this.store.sort('concentration');
	this.grid = Ext.create('Ext.grid.Panel', {
		id : this.id,
		store : this.store,
		width : this.width,
		height : this.height,
		maxHeight : this.maxHeight,
		border : 1,
		features : [ {
			ftype : 'grouping',
			groupHeaderTpl : '{name}',
			hideGroupedHeader : true,
			startCollapsed : false
		} ],
		selModel : Ext.create('Ext.selection.CheckboxModel', {
			allowDeselect : true,
			mode : 'MULTI',
			listeners : {
				selectionchange : function(sm, selections) {
					_this.selected = [];
					for ( var i = 0; i < selections.length; i++) {
						_this.selected.push(selections[i].raw);
					}
				}
			}
		}),
		margin : 10,
		sortableColumns : true,
		columns : [ {
			text : 'Macromolecule',
			dataIndex : 'macromoleculeAcronym',
			flex : 1
		}, {
			text : '',
			dataIndex : 'bufferId',
			width : 20,
			hidden : false,
			renderer : function(val, y, sample) {
				return BUI.getRectangleColorDIV(BIOSAXS.proposal.bufferColors[val], 10, 10);
			}
		}, {
			text : 'Buffer',
			dataIndex : 'bufferAcronym',
			flex : 1
		}, {
			text : 'Concentration',
			dataIndex : 'concentration',
			flex : 1,
			renderer : function(val, y, sample) {
				return val + " mg/ml";
			}
		} ]
	});

	/** Adding the tbar **/
	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : this.getTbar()
		});
	}
	return this.grid;
};

SpecimenSelectorResultGrid.prototype.input = function() {
	return {
		data : new ResultsAssemblyGrid()._prepareData(new ResultsAssemblyGrid().input().data),
		proposal : new ResultsAssemblyGrid().input().proposal
	};
};

SpecimenSelectorResultGrid.prototype.test = function(targetId) {
	var specimenSelectorResultGrid = new SpecimenSelectorResultGrid();
	BIOSAXS.proposal = new Proposal(specimenSelectorResultGrid.input().proposal);
	var panel = specimenSelectorResultGrid.getPanel(specimenSelectorResultGrid.input().data);
	panel.render(targetId);
};

/**
 * Show all buffer conditions for each macromolecules pointing out the measurements quality
 * 
 * @height
 * @maxHeight
 * @width
 * @searchBar
 * @tbar
 * @btnResultVisible
 * 
 * #onClick
 */
function ResultsAssemblyGrid(args) {
	this.height = 500;
	this.id = BUI.id();
	this.maxHeight = this.height;

	this.width = 900;
	this.searchBar = false;
	this.tbar = false;
	this.btnResultVisible = false;

	/** For processing **/
	this.processed = {};
	this.renderedPlotIndex = 0;

	this.plotWidth = 210;
	this.plotHeight = 80;

	/** Colors **/
	this.validColor = BUI.getValidColor();
	this.warningColor = BUI.getWarningColor();
	this.notValidColor = BUI.getErrorColor();

	/** Show warning if guinier quality less than **/
	this.guinierQuality = BUI.getQualityThreshold();
	this.framePercentageThreshold = BUI.getRadiationDamageThreshold();

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
			this.maxHeight = this.height;
		}
		if (args.maxHeight != null) {
			this.maxHeight = args.maxHeight;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.searchBar != null) {
			this.searchBar = args.searchBar;
		}

		if (args.tbar != null) {
			this.tbar = args.tbar;
		}
		if (args.btnResultVisible != null) {
			this.btnResultVisible = args.btnResultVisible;
		}

	}

	this.onClick = new Event();
}

ResultsAssemblyGrid.prototype.edit = function(macromoleculeId) {
	var _this = this;
	var window = new MacromoleculeWindow();
	window.onSuccess.attach(function(sender, proposal) {
		_this.store.loadData(_this._prepareData(BIOSAXS.proposal.getMacromolecules()));
	});
	window.draw(BIOSAXS.proposal.getMacromoleculeById(macromoleculeId));
};

ResultsAssemblyGrid.prototype.getTbar = function() {
	var _this = this;
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add Macromolecule',
		disabled : false,
		handler : function(widget, event) {
			var window = new MacromoleculeWindow();
			window.onSuccess.attach(function(sender) {
				_this.refresh();
			});
			window.draw({});
		}
	}));

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Define an Assembly',
		disabled : false,
		handler : function(widget, event) {
			var createAssemblywindow = new CreateAssemblyWindow();
			createAssemblywindow.onSaved.attach(function(evt, args) {
				if (args.macromoleculeIds.length > 0) {
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, proposal) {
						_this.refresh();
					});
					adapter.saveAssembly(args.assemblyId, args.macromoleculeIds);

				}

			});
			createAssemblywindow.draw(_this.experiment);
		}
	}));

	return actions;
};

ResultsAssemblyGrid.prototype.refresh = function() {
	this.store.loadData(this._prepareData());
};

ResultsAssemblyGrid.prototype.addCondition = function(record, data_parsed, i) {
	function getCondition(record) {
		return {
			concentration : record.conc,
			quality : record.quality,
			bufferBeforeFramesMerged : record.bufferBeforeFramesMerged,
			bufferAfterFramesMerged : record.bufferAfterFramesMerged,
			framesCount : record.framesCount,
			framesMerge : record.framesMerge
		};
	}

	if (data_parsed[i].conditions != null) {
		var bufferFound = false;
		for ( var index in data_parsed[i].conditions) {
			condition = data_parsed[i].conditions[index];

			if ((condition.macromoleculeId == record.macromoleculeId) && (condition.bufferId == record.bufferId)) {
				data_parsed[i].conditions[index].concentrations.push(getCondition(record));
				bufferFound = true;
			}
		}
		if (!bufferFound) {
			data_parsed[i].conditions.push({
				macromoleculeId : record.macromoleculeId,
				bufferId : record.bufferId,
				concentrations : [ getCondition(record) ]
			});
		}
	}
};

ResultsAssemblyGrid.prototype.process = function(record, data_parsed) {
	if (this.processed[record.macromoleculeId] == null) {
		this.processed[record.macromoleculeId] = true;
		record.measurementCount = 1;
		record.subtractionCount = 1;
		record.averageCount = 1;
		record.conditions = [];
		data_parsed.push(record);
	}

	for ( var i = 0; i < data_parsed.length; i++) {
		if (data_parsed[i].macromoleculeId == record.macromoleculeId) {
			data_parsed[i].measurementCount = data_parsed[i].measurementCount + 1;

			if (record.subtractionId != null) {
				data_parsed[i].subtractionCount = data_parsed[i].subtractionCount + 1;
				this.addCondition(record, data_parsed, i);
			}

			if (record.framesMerge != null) {
				data_parsed[i].averageCount = data_parsed[i].averageCount + 1;
			}

			if (record.timeStart != null) {
				if (data_parsed[i].timeStart != null) {
					if (moment(data_parsed[i].timeStart).format("X") > moment(record.timeStart).format("X")) {
						data_parsed[i].timeStart = record.timeStart;
					}
				}
			}
		}
	}

	return data_parsed;

};

ResultsAssemblyGrid.prototype._prepareData = function(data) {
	var data_parsed = [];
	for ( var i = 0; i < data.length; i++) {
		data_parsed = this.process(data[i], data_parsed);
	}
	this.data = data_parsed;
	return data_parsed;
};

/** Given an array of conditions it returns distinct(concentrations) order by concentration and hash map with number of ocurrences**/
ResultsAssemblyGrid.prototype.parseConcentrations = function(val, conditions, differentConcentration, quality) {
	var conditions = [];
	var differentConcentration = {};
	var quality = [];
	for ( var i = 0; i < val.length; i++) {
		var conc = Number(val[i].concentration).toFixed(1);
		var quality = Number(val[i].quality).toFixed(2);
		if (differentConcentration[conc] == null) {
			differentConcentration[conc] = 0;
			conditions.push({
				concentration : conc,
				quality : [ quality ],
				frames : [ {
					bufferAfterFramesMerged : val[i].bufferAfterFramesMerged,
					bufferBeforeFramesMerged : val[i].bufferBeforeFramesMerged,
					framesMerge : val[i].framesMerge,
					framesCount : val[i].framesCount
				} ]
			});
		} else {
			/** Add quality **/
			for ( var j = 0; j < conditions.length; j++) {
				if (conditions[j].concentration == conc) {
					conditions[j].quality.push(quality);
					conditions[j].frames.push({
						bufferAfterFramesMerged : val[i].bufferAfterFramesMerged,
						bufferBeforeFramesMerged : val[i].bufferBeforeFramesMerged,
						framesMerge : val[i].framesMerge,
						framesCount : val[i].framesCount
					});
				}
			}
		}

		differentConcentration[conc] = differentConcentration[conc] + 1;
	}
	/** sorting concentrations **/
	conditions.sort(function(a, b) {
		return a.concentration - b.concentration;
	});
	return {
		concentrations : conditions,
		differentConcentration : differentConcentration
	};
};

ResultsAssemblyGrid.prototype.getConditionWarnings = function(condition) {

	var withWarnings = 0;

	for ( var i = 0; i < condition.frames.length; i++) {
		if (condition.quality[i] == null) {
			withWarnings = withWarnings + 1;
			continue;
		} else {
			if (Number(condition.quality[i]) < this.guinierQuality) {
				withWarnings = withWarnings + 1;
				continue;
			}
		}

		if (condition.frames[i].bufferBeforeFramesMerged / condition.frames[i].framesCount < this.framePercentageThreshold|| condition.frames[i].framesMerged / condition.frames[i].framesCount < this.framePercentageThreshold|| condition.frames[i].bufferAfterFramesMerged / condition.frames[i].framesCount < this.framePercentageThreshold) {
			withWarnings = withWarnings + 1;
			continue;
		}
	}

	return {
		withWarnings : withWarnings,
		withoutWarnings : condition.frames.length - withWarnings
	};
};

ResultsAssemblyGrid.prototype.getFrameHTMLTable = function(warnings) {
	var html = "";
	if (warnings.withWarnings > 0) {
		html = html + "<div style='cursor: pointer;'><span style='font-size:9px;padding-left:5px;'>" + warnings.withWarnings +
				"x </span> <img height='15px' src='../images/warning_01.png'> </div>";
	}

	if (warnings.withoutWarnings > 0) {
		html = html + "<div style='cursor: pointer;'><span style='font-size:9px;padding-left:5px;'>" + warnings.withoutWarnings +
				"x </span> <img height='15px' src='../images/accept.png'> </div>";
	}
	return html;
};

ResultsAssemblyGrid.prototype.createConcentrationRow = function(numberOcu, condition, warnings){
	var html = "<tr><td>";
	if (numberOcu > 1){
		html = html + "<span style='font-size:9px;'>" +numberOcu + "x </span>" + BUI.formatConcentration(condition.concentration);
	}
	else{
		html = html + BUI.formatConcentration(condition.concentration);
	}
	html = html + "</td><td>";
	html = html + this.getFrameHTMLTable(warnings); + "</td>";
	html = html + "</tr>";
	return html;
};


ResultsAssemblyGrid.prototype.getConditionHTMLTable = function(val, style, record) {
	var maxNumberColumns = 2;
	var html = "<div><table class='conditions'><tr>";
	var nColumns = 0;
	for ( var r = 0; r < val.length; r++) {
		if (nColumns == maxNumberColumns) {
			nColumns = 0;
			html = html + "<tr>";
		}
		html = html + "<td>";
		var value = val[r];

		var bufferAcronym = (BIOSAXS.proposal.getBufferById(value.bufferId).acronym);

		var parsed = (this.parseConcentrations(value.concentrations));
		var conditions = parsed.concentrations;
		var differentConcentration = parsed.differentConcentration;

		/** Checking warnings **/
		var warnings = [];
		var concentrationValidPerconcentration = 0;
		var measurements = 0;
		for ( var i = 0; i < conditions.length; i++) {
			measurements = measurements + conditions[i].frames.length;
			var warning = this.getConditionWarnings(conditions[i]);
			warnings.push(warning);
			if (warning.withoutWarnings > 0) {
				concentrationValidPerconcentration = concentrationValidPerconcentration + 1;
			}
		}

		this.validColor = '#E0F8E0';
		this.warningColor = '#F5DA81';
		this.notValidColor = '#F6CED8';

		var color = this.warningColor;
		if (concentrationValidPerconcentration > 2) {
			color = this.validColor;
		}
		/** More measurement need to be done **/
		if (measurements < 3) {
			color = this.notValidColor;
		}

		html = html + "<table class='condition''>";
		html = html + "<tr style='background-color:" + color + ";'><th  ><a style='color:blue;' href='" +
				BUI.getMacromoleculeBufferResultsURL(record.raw.macromoleculeId, val[r].bufferId) + "'>" + bufferAcronym.toUpperCase() +
				"</a></th></tr>";
		for ( var i = 0; i < conditions.length; i++) {
			html = html + this.createConcentrationRow(differentConcentration[conditions[i].concentration], conditions[i], warnings[i]);
		}

		html = html + "</td></tr>";
		html = html + "</table>";

		html = html + "</td>";
		nColumns = nColumns + 1;
	}
	html = html + "</tr></table></div>";
	return html;
};

ResultsAssemblyGrid.prototype._getTbar = function() {
	function goTo(url) {
		window.location = url;
	}

	var _this = this;
	return [ {
		icon : '../images/application_view_list.png',
		text : 'Multiple Select',
		handler : function() {
			var specimenSelectorResultGrid = new SpecimenSelectorResultGrid();
			var window = Ext.create('Ext.window.Window', {
				title : 'Multiple select',
				height : 600,
				width : 600,
				layout : 'fit',
				items : [ specimenSelectorResultGrid.getPanel(_this.data) ],
				buttons : [ {
					text : 'Go',
					handler : function() {
						var array = [];
						for ( var i = 0; i < specimenSelectorResultGrid.selected.length; i++) {
							var row = specimenSelectorResultGrid.selected[i];
							array.push({
								macromoleculeId : row.macromoleculeId,
								bufferId : row.bufferId
							});
						}
						goTo(BUI.getMacromoleculeResultsURLByMultipleSearch(array));

					}
				}, {
					text : 'Cancel',
					handler : function() {
						window.close();
					}
				} ]

			}).show();

		}
	} ];
};

ResultsAssemblyGrid.prototype.getLegendPanel = function() {
	return {
		html : '<table><tr><td>' + BUI.getRectangleColorDIV(this.validColor, 10, 10) + 
				'</td><td style="padding-left:5px;">Good quality measurements</td><td style="padding-left:20px;">' + 
				BUI.getRectangleColorDIV(this.warningColor, 10, 10) +
				'</td><td style="padding-left:5px;">Probably valid with manual processing</td><td style="padding-left:20px;">' +
				BUI.getRectangleColorDIV(this.notValidColor, 10, 10) +
				'</td><td style="padding-left:5px;">More measurements need to be done</td></tr></table>'
	};
};
/** Returns the grid **/
ResultsAssemblyGrid.prototype.getPanel = function(macromolecules) {
	var _this = this;

	this.store = Ext.create('Ext.data.Store', {
		fields : [
			'macromoleculeId', 'macromoleculeAcronym', 'measurementCount', 'subtractionCount', 'averageCount', 'timeStart', 'concentrationArray',
			'bufferConditions', 'conditions' ],
		data : this._prepareData(macromolecules)
	});

	this.store.sort('macromoleculeAcronym');

	this.grid = Ext.create('Ext.grid.Panel', {
		id : this.id,
		title : 'Macromolecules',
		store : this.store,
		tbar : this._getTbar(),
		bbar : [ this.getLegendPanel() ],
		width : this.width,
		height : this.height,
		maxHeight : this.maxHeight,
		sortableColumns : true,
		columns : [
			{
				text : '',
				dataIndex : 'macromoleculeId',
				width : 20,
				hidden : false,
				renderer : function(val, y, sample) {
					return BUI.getRectangleColorDIV(BIOSAXS.proposal.macromoleculeColors[val], 10, 10);
				}
			},
			{
				text : 'Macromolecule',
				dataIndex : 'macromoleculeAcronym',
				width : 200
			},
			{
				text : 'Buffer Conditions',
				dataIndex : 'conditions',
				flex : 1,
				renderer : function(val, style, record) {
					return _this.getConditionHTMLTable(val, style, record);
				}
			},
			{
				header : 'Average',
				dataIndex : 'percentageCollected',
				name : 'percentageCollected',
				type : 'string',
				hidden : true,
				renderer : function(val, y, sample) {
					return "<table><tr><td>" +
							BUI.getProgessBar((sample.raw.averageCount / sample.raw.measurementCount) * 100, sample.raw.averageCount + "/" +
							sample.raw.measurementCount) + "</td></table>";
				},
				width : 100,
				sorter : false
			},
			{
				header : 'Subtractions',
				dataIndex : 'percentageCollected',
				name : 'percentageCollected',
				type : 'string',
				hidden : true,
				renderer : function(val, y, sample) {
					return "<table><tr><td>"+  BUI.getProgessBar((sample.raw.subtractionCount / sample.raw.measurementCount) * 100, sample.raw.subtractionCount + "/" +
									sample.raw.measurementCount) + "</td></table>";
				},
				width : 100
			}, {
				header : 'Date',
				dataIndex : 'timeStart',
				name : 'timeStart',
				type : 'string',
				renderer : function(value, metaData, record, rowIndex, colIndex, store) {
					if (record.raw.timeStart != null) {
						return moment(record.raw.timeStart).format("MMM Do YY");
					}
				}
			}, {
				header : 'Download',
				dataIndex : 'percentageCollected',
				name : 'percentageCollected',
				type : 'string',
				renderer : function(val, y, sample) {
					return BUI.getZipHTMLByMacromoleculeId(sample.raw.macromoleculeId);
				},
				width : 100
			},

			{
				id : 'btnResultVisible',
				width : 85,
				sortable : false,
				renderer : function(value, metaData, record, rowIndex, colIndex, store) {
					return BUI.getGreenButton('GO');
				}
			} ],
		viewConfig : {
			stripeRows : true,
			listeners : {
				afterrender : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
				},
				celldblclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					_this.edit(record.data.macromoleculeId);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == 'buttonEditMacromolecule') {
						_this.edit(record.data.macromoleculeId);
					}
					if (grid.getGridColumns()[cellIndex].getId() == 'buttonRemoveMacromolecule') {
						BUI.showBetaWarning();
					}
					if (grid.getGridColumns()[cellIndex].getId() == 'btnResultVisible') {
						window.location = BUI.getMacromoleculeResultsURL(record.data.macromoleculeId);
					}
				}
			}
		}
	});

	/** Adding the tbar **/
	if (this.tbar) {
		this.grid.addDocked({
			xtype : 'toolbar',
			items : this.getTbar()
		});
	}
	return this.grid;
};

ResultsAssemblyGrid.prototype.input = function(targetId) {
	return {
		data : DATADOC.getData_3367(),
		proposal : DATADOC.getProposal_3367()
	};
};

ResultsAssemblyGrid.prototype.test = function(targetId) {
	var grid = new ResultsAssemblyGrid({
		height : 600,
		searchBar : false,
		tbar : false,
		btnResultVisible : true,
		width : 1000
	});
	BIOSAXS.proposal = new Proposal(grid.input().proposal);
	var panel = grid.getPanel(grid.input().data);
	panel.render(targetId);

};


function RigidModelGrid(args) {
	this.height = null;
	this.width = null;
	this.id = BUI.id();

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;

			if (args.width != null) {
				this.width = args.width;
			}
		}
	}
	
	this.onSelected = new Event(this);
}


RigidModelGrid.prototype.refresh = function(subtractions) {
	var data  = [];
	if (subtractions != null){
		if (subtractions.length > 0){
			for (j in subtractions){
				var subtraction = subtractions[j];
				if (subtraction.rigidBodyModeling3VOs != null){
					for (i in subtraction.rigidBodyModeling3VOs){
						data.push(subtraction.rigidBodyModeling3VOs[i]);
					}
				}
			}
		}
	}
	this.store.loadData(data);
};

RigidModelGrid.prototype.getPanel = function() {
	var _this = this;
	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'symmetry', 'subtractionId', 'subUnitConfigFilePath', 'rigidBodyModelingId', 'rigidBodyModelFilePath', 'logFilePath', 'fitFilePath', 'curveConfigFilePath',
				'crossCorrConfigFilePath', 'contactDescriptionFilePath' ],
		data : []
	});

	this.store.sort([ {
		property : 'name',
		direction : 'ASC'
	} ]);

	this.panel = Ext.create('Ext.grid.Panel', {
		store : this.store,
		width : this.width,
		height : this.height,
		margin : 10,
		deferredRender : false,
		columns : [ {
			text : 'RBM',
			dataIndex : 'rigidBodyModelFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Sub Unit Conf.',
			dataIndex : 'subUnitConfigFilePath',
			hidden : true,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Log',
			dataIndex : 'logFilePath',
			hidden : true,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Fit',
			dataIndex : 'fitFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Curve Conf.',
			dataIndex : 'curveConfigFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Cross Corr.',
			dataIndex : 'crossCorrConfigFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Contact Desc.',
			dataIndex : 'contactDescriptionFilePath',
			hidden : true,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		} ],

		viewConfig : {
			enableTextSelection : true,
			preserveScrollOnRefresh : true
		},
		listeners : {
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

			},
			afterrender : function() {
			}
		}
	});
	return this.panel;
};


/**
 * shows shipments
 * 
 * @height
 * @width
 * @minHeight
 * @btnEditVisible
 */
function ShipmentGrid(args) {
	this.id = BUI.id();
	this.height = 100;
	this.width = null;
	this.minHeight = null;
	this.btnEditVisible = true;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.minHeight != null) {
			this.minHeight = args.minHeight;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
	}
}

ShipmentGrid.prototype._getColumns = function() {
	var _this = this;
	var columns = [
		{
			text : 'Name',
			dataIndex : 'shippingName',
			flex : 1
		},
		{
			header : 'Type',
			dataIndex : 'shippingType',
			flex : 1,
			hidden : true,
			renderer : function(val, comp, record) {
				if (val != null) {
					return val.toUpperCase();
				}

			}
		},
		{
			header : 'Status',
			type : 'string',
			flex : 1,
			hidden : false,
			renderer : function(comp, val, record) {
				if (record.raw.shippingStatus != null) {
					if (new String(record.raw.shippingStatus).toUpperCase() == 'OPENED') {
						return "<span style='color:green;font-weight:bold;'>" + new String(record.raw.shippingStatus).toUpperCase() + "</span>";
					}
					return "<span style='font-weight:bold;'>" + new String(record.raw.shippingStatus).toUpperCase() + "</span>";
				}
			}
		},
		{
			text : 'Cases',
			flex : 1,
			hidden : false,
			renderer : function(comp, val, record) {
				var shipment = BIOSAXS.proposal.getShipmentById(record.data.shippingId);
				var container = "<table><tr>";
				if (shipment.dewarVOs.length > 0) {
					container = container + "<td><span style='font-size:18px'>" + shipment.dewarVOs.length + "</span>x <img src='../images/box-icon-very-small.png'></td>";
				} else {
					return "<span style='font-size:10px;'>Empty</span>";
				}
				return container + "</tr></table>";
			}
		}, {
			header : 'Comments',
			dataIndex : 'comments',
			flex : 1,
			hidden : false
		}, {
			header : 'Creation Date',
			dataIndex : 'creationDate',
			hidden : true
		} ];

	if (this.btnEditVisible) {
		columns.push({
			id : _this.id + 'buttonEdit',
			text : '',
			hidden : !_this.btnEditVisible,
			width : 100,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				return BUI.getGreenButton('EDIT');
			}
		});
	}

	columns.push({
		id : _this.id + 'buttonRemove',
		text : '',
		width : 100,
		sortable : false,
		renderer : function(value, metaData, record, rowIndex, colIndex, store) {
			var shipment = BIOSAXS.proposal.getShipmentById(record.data.shippingId);
			if (shipment.dewarVOs.length == 0) {
				return BUI.getRedButton('REMOVE');
			}

		}
	});

	return columns;
};

ShipmentGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];
	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add Shipment',
		handler : function(widget, event) {
			//window.location = BUI.getCreateShipmentURL();
			var _this = this;

			var shipmentForm = new ShipmentForm({
				creationMode : true,
				showTitle : false
			});
			shipmentForm.onSaved.attach(function(sender, shipment) {
				_this.showShipmentTabs(shipment, targetId);
			});

			var window = Ext.create('Ext.window.Window', {
				title : 'New Shipment',
				height : 600,
				width : 800,
				layout : 'fit',
				items : [ shipmentForm.getPanel() ]
			}).show();

		}
	}));
	return actions;
};

ShipmentGrid.prototype.refresh = function(shippings) {
	this.features = shippings;
	this.store.loadData(this._prepareData(), false);
};

ShipmentGrid.prototype._prepareData = function() {
	var data = [];
	for ( var i = 0; i < this.features.length; i++) {
		data.push(this.features[i]);
	}
	return data;
};

ShipmentGrid.prototype.getPanel = function(shipments) {
	this.features = shipments;
	return this._renderGrid();
};

ShipmentGrid.prototype.edit = function(shippingId) {
	window.location = BUI.getShippingURL(shippingId);
};

ShipmentGrid.prototype._getStoreFields = function(data) {
	var _this = this;
	return [ {
		name : 'shippingId'
	}, {
		name : 'shippingName'
	}, {
		name : 'shippingStatus'
	}, {
		name : 'shippingType'
	}, {
		name : 'creationDate'
	}, {
		name : 'comments'
	} ];
};

ShipmentGrid.prototype._renderGrid = function() {
	var _this = this;

	/** Store **/
	var data = this._prepareData();
	this.store = Ext.create('Ext.data.Store', {
		fields : this._getStoreFields(data),
		autoload : true,
		data : data
	});

	this.store.loadData(data, false);

	this.grid = Ext.create('Ext.grid.Panel', {
		title : "Shipping",
		icon : '/ispyb/images/plane.gif',
		width : this.width,
		minWidth : this.minWidth,
		height : this.height,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this.edit(record.raw.shippingId);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this.edit(record.data.shippingId);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						var shipment = BIOSAXS.proposal.getShipmentById(record.data.shippingId);
						if (shipment.dewarVOs.length == 0) {

							var adapter = new BiosaxsDataAdapter();
							_this.grid.setLoading("ISPyB: Removing shipment");
							adapter.onSuccess.attach(function(sender) {
								BIOSAXS.proposal.onInitialized.attach(function(sender) {
									_this.refresh(BIOSAXS.proposal.getShipments());
									_this.grid.setLoading(false);
								});
								BIOSAXS.proposal.init();
							});

							adapter.onError.attach(function(sender) {
								alert("Error");
								_this.grid.setLoading(false);
							});
							adapter.removeShipment(record.data.shippingId);
						}
					}
				}
			}
		},
		selModel : {
			mode : 'SINGLE'
		}
	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for ( var i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};

ShipmentGrid.prototype.input = function() {
	return {
		proposal : new MeasurementGrid().input().proposal,
		shippings : DATADOC.getShippings_10()
	};
};

ShipmentGrid.prototype.test = function(targetId) {
	var shipmentGrid = new ShipmentGrid({
		minHeight : 300,
		height : 440
	});
	BIOSAXS.proposal = new Proposal(shipmentGrid.input().proposal);
	var panel = shipmentGrid.getPanel(targetId);
	panel.render(targetId);
	shipmentGrid.refresh(shipmentGrid.input().shippings);
};

function SpecimenGrid(args) {
	this.id = BUI.id();
	this.height = 500;
	this.unitsFontSize = 9;
	this.editEnabled = false;
	this.isPositionColumnHidden = false;
	this.removeBtnEnabled = false;

	this.selectionMode = "MULTI";
	this.updateRowEnabled = false;
	this.grouped = true;
	this.width = 900;
	this.title = 'Specimens';
	
	this.margin = "0 0 0 0";
//	this.experimentColorBased = false;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}

		if (args.showTitle == false) {
			this.title = null;
		}
		
		if (args.margin == false) {
			this.margin = args.margin;
		}

		if (args.grouped == false) {
			this.grouped = null;
		}

		if (args.width != null) {
			this.width = args.width;
		}


		if (args.editEnabled != null) {
			this.editEnabled = args.editEnabled;
		}
		if (args.removeBtnEnabled != null) {
			this.removeBtnEnabled = args.removeBtnEnabled;
		}
		if (args.isPositionColumnHidden != null) {
			this.isPositionColumnHidden = args.isPositionColumnHidden;
		}
		if (args.selectionMode != null) {
			this.selectionMode = args.selectionMode;
		}
		if (args.updateRowEnabled != null) {
			this.updateRowEnabled = args.updateRowEnabled;
		}

	}
	this.onClick = new Event(this);
	this.onSelected = new Event(this);
	this.onRemoved = new Event(this);
	this.onSpecimenChanged = new Event();
}

SpecimenGrid.prototype._prepareData = function(experiment) {
	var data = [];

	var samples = experiment.getSamples();
	for ( var i = 0; i < samples.length; i++) {
		var sample = samples[i];
		if (sample.macromolecule3VO != null) {
			sample.macromolecule = sample.macromolecule3VO.acronym;
			sample.exposureTemperature = [];
			sample.macromoleculeId = sample.macromolecule3VO.macromoleculeId;
		}

		if (sample.sampleplateposition3VO != null) {
			if (sample.sampleplateposition3VO.samplePlateId != null) {
				sample.samplePlateId = sample.sampleplateposition3VO.samplePlateId;
				sample.rowNumber = sample.sampleplateposition3VO.rowNumber;
				sample.columnNumber = sample.sampleplateposition3VO.columnNumber;
				if (experiment.getSamplePlateById(sample.sampleplateposition3VO.samplePlateId).plategroup3VO != null) {
					sample.plateGroupName = experiment.getSamplePlateById(sample.sampleplateposition3VO.samplePlateId).plategroup3VO.name;
					sample.samplePlateName = experiment.getSamplePlateById(sample.sampleplateposition3VO.samplePlateId).name + "  [" + sample.plateGroupName + "]";
					sample.slotPositionColumn = experiment.getSamplePlateById(sample.sampleplateposition3VO.samplePlateId).slotPositionColumn;
				}
			}
		} else {
			sample.samplePlateName = "Unallocated Specimens";
		}

		/** For grouping, because sencha has not option for multiple grouping I add a field to your store with a convert function that concatenates these two fields and then group by that field.**/
		sample.groupIndex = sample.bufferId + sample.macromoleculeId;
		var macromolecule = BIOSAXS.proposal.getMacromoleculeById(sample.macromoleculeId);

		sample.acronym = "Buffers";
		if (macromolecule != null) {
			sample.acronym = BIOSAXS.proposal.getMacromoleculeById(sample.macromoleculeId).acronym;
		}

		sample.buffer = experiment.getBufferById(sample.bufferId);

		sample.volumeToLoad = experiment.getVolumeToLoadBySampleId(sample.sampleId);
		data.push(sample);
	}
	return data;
};

SpecimenGrid.prototype.deselectAll = function() {
	this.grid.getSelectionModel().deselectAll();
};

SpecimenGrid.prototype.selectById = function(specimenId) {
	this.grid.getSelectionModel().deselectAll();
	for ( var i = 0; i < this.grid.getStore().data.items.length; i++) {
		var item = this.grid.getStore().data.items[i].raw;
		if (item.specimenId == specimenId) {
			this.grid.getSelectionModel().select(i);
		}
	}
};

SpecimenGrid.prototype.getStore = function() {
	return this.store;
};

SpecimenGrid.prototype.getPlugins = function() {
	var _this = this;

	var plugins = [];

	if (this.updateRowEnabled) {
		plugins.push(Ext.create('Ext.grid.plugin.RowEditing', {
			clicksToEdit : 1,
			listeners : {
				validateedit : function(grid, e) {
					var measurements = [];

					if (e.newValues.bufferId != e.record.raw.bufferId) {
						/** If buffer has changed we have to change all the specimens sharing same datacollection **/
						var dataCollections = [];
						if (e.record.raw.macromoleculeId == null) {
							dataCollections = dataCollections.concat(_this.experiment.getDataCollectionsBySpecimenId(e.record.raw.specimenId));
						} else {
							var sampleDataCollections = _this.experiment.getDataCollectionsBySpecimenId(e.record.raw.specimenId);
							for ( var i = 0; i < sampleDataCollections.length; i++) {
								var sampleDataCollection = sampleDataCollections[i];
								if (sampleDataCollection != null) {
									for ( var j = 0; j < sampleDataCollection.measurementtodatacollection3VOs.length; j++) {
										var measurementTODc = sampleDataCollection.measurementtodatacollection3VOs[j];
										if (measurementTODc.dataCollectionOrder == 1) {
											dataCollections = dataCollections.concat(_this.experiment.getDataCollectionsBySpecimenId(_this.experiment
													.getMeasurementById(measurementTODc.measurementId).specimenId));
										}
									}
								}
							}
						}
						var i = null;
						for ( i = 0; i < dataCollections.length; i++) {
							var dataCollection = dataCollections[i];
							var specimens = _this.experiment.getSpecimenByDataCollectionId(dataCollection.dataCollectionId);
							measurements = measurements.concat(specimens);
						}

						for ( i = 0; i < measurements.length; i++) {
							var measurement = measurements[i];
							var specimen = _this.experiment.getSpecimenById(measurement.specimenId);
							specimen.bufferId = e.newValues.bufferId;
							new BiosaxsDataAdapter().saveSpecimen(specimen, _this.experiment);
						}
					}

					/** Setting values **/
					e.record.raw.concentration = e.newValues.concentration;
					e.record.raw.volume = e.newValues.volume;

					/** Position **/
					if (e.record.raw.sampleplateposition3VO != null) {
						var samplePlate = _this.experiment.getSamplePlateBySlotPositionColumn(e.newValues.slotPositionColumn);
						if (samplePlate != null) {
							e.record.raw.sampleplateposition3VO = {
								columnNumber : e.newValues.columnNumber,
								rowNumber : e.newValues.rowNumber,
								samplePlateId : samplePlate.samplePlateId
							};
						}
					} else {
						if (e.newValues.slotPositionColumn != null) {
							var samplePlate = _this.experiment.getSamplePlateBySlotPositionColumn(e.newValues.slotPositionColumn);
							if (samplePlate != null) {
								e.record.raw.sampleplateposition3VO = {
									columnNumber : e.newValues.columnNumber,
									rowNumber : e.newValues.rowNumber,
									samplePlateId : samplePlate.samplePlateId
								};
							}
						}
					}

					var macromoleculeId = e.record.data.macromoleculeId;
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, specimen) {
						/** Because macromolecule3VO is fecthed LAZY **/
						if (macromoleculeId != null) {
							specimen.macromolecule3VO = BIOSAXS.proposal.getMacromoleculeById(macromoleculeId);
						}
						_this.onSpecimenChanged.notify(specimen);
						_this.grid.setLoading(false);
					});
					adapter.onError.attach(function() {
						alert("Error");
						_this.grid.setLoading(false);
					});
					_this.grid.setLoading();
					adapter.saveSpecimen(e.record.raw, _this.experiment);
				}
			}
		}));
	}
	return plugins;
};

SpecimenGrid.prototype._getRowCombo = function() {
	var data = [];
	for ( var i = 1; i <= 8; i++) {
		data.push({
			rowNumber : i,
			name : BUI.getSamplePlateLetters()[i - 1]
		});
	}

	var positionsStore = Ext.create('Ext.data.Store', {
		fields : [ 'rowNumber', 'name' ],
		data : data
	});

	return Ext.create('Ext.form.ComboBox', {
		store : positionsStore,
		queryMode : 'local',
		displayField : 'name',
		valueField : 'rowNumber'
	});
};

SpecimenGrid.prototype._getColumnCombo = function() {
	var data = [];
	for ( var i = 1; i <= 12; i++) {
		data.push({
			columnNumber : i
		});
	}

	var positionsStore = Ext.create('Ext.data.Store', {
		fields : [ 'columnNumber' ],
		data : data
	});

	return Ext.create('Ext.form.ComboBox', {
		store : positionsStore,
		queryMode : 'local',
		displayField : 'columnNumber',
		valueField : 'columnNumber'
	});
};

SpecimenGrid.prototype._getSlotColumBombo = function() {
	if (this.experiment){
		var length = this.experiment.getSamplePlates().length;
	
		var data = [];
		for ( var i = 1; i <= length; i++) {
			data.push({
				slotPositionColumn : i
			});
		}
	
		var positionsStore = Ext.create('Ext.data.Store', {
			fields : [ 'slotPositionColumn' ],
			data : data
		});
	
		return Ext.create('Ext.form.ComboBox', {
			store : positionsStore,
			queryMode : 'local',
			displayField : 'slotPositionColumn',
			valueField : 'slotPositionColumn'
		});
	}
};

SpecimenGrid.prototype.getPanelByExperiment = function(experiment) {
	this.experiment = experiment;
	var data = this._prepareData(experiment);
	return this.getPanel(data);
};

SpecimenGrid.prototype.refresh = function(experiment) {
	this.experiment = experiment;
	var data = this._prepareData(experiment);
	this.store.loadData(data);
};

SpecimenGrid.prototype.getPanel = function() {
	var _this = this;
	this.store = Ext.create('Ext.data.Store', {
		fields : [
			'buffer', 'bufferId', 'code', 'macromolecule', 'acronym', 'macromoleculeId', 'concentration', 'volume', 'samplePlateId',
			'slotPositionColumn', 'rowNumber', 'columnNumber', 'groupIndex' ],
		data : [],
		groupField : 'acronym'
	});
	this.store.sort([ {
		property : 'concentration',
		direction : 'ASC'
	}, {
		property : 'buffer',
		direction : 'ASC'
	} ]);

	var selModel = Ext.create('Ext.selection.RowModel', {
		allowDeselect : true,
		mode : this.selectionMode,
		listeners : {
			selectionchange : function(sm, selections) {
				var selected = [];
				for ( var i = 0; i < selections.length; i++) {
					selected.push(selections[i].raw);
				}
				_this.onSelected.notify(selected);
			}
		}
	});

	var features = [];

	if (this.grouped) {
		features.push({
			ftype : 'grouping',
			groupHeaderTpl : '{name}',
			hideGroupedHeader : false,
			startCollapsed : false,
			id : 'myGroupedStore'
		});
	}

	this.grid = Ext.create(
					'Ext.grid.Panel',
					{
						title 		: this.title,
						height 		: this.height,
						width 		: this.width,
						selModel 	: selModel,
						store 		: this.store,
						features 	: features,
						margin 		: this.margin,
						plugins	 : this.getPlugins(),
						columns : [
							{
								text : '',
								dataIndex : 'macromolecule',
								width : 20,
								renderer : function(val, y, sample) {
									var macromoleculeId = null;
									if (sample.raw.macromolecule3VO != null) {
										macromoleculeId = sample.raw.macromolecule3VO.macromoleculeId;
									}
									else{
										macromoleculeId = sample.raw.macromoleculeId;
									}
									
									if (macromoleculeId == null) return; 
									return BUI.getRectangleColorDIV(_this.experiment.macromoleculeColors[macromoleculeId], 10, 10);
								}
							},
							{
								text : 'Macromolecule',
								dataIndex : 'macromolecule',
								width : 100
							},
							{
								text : '',
								dataIndex : 'buffer',
								width : 20,
								renderer : function(val, y, sample) {
									var color = "black";
									if (sample.raw.bufferId != null) {
										if (_this.experiment.getDataCollectionsBySpecimenId(sample.raw.specimenId)[0] != null){
											color = _this.experiment.getSpecimenColorByBufferId(_this.experiment.getMeasurementById(_this.experiment.getDataCollectionsBySpecimenId(sample.raw.specimenId)[0].measurementtodatacollection3VOs[0].measurementId).specimenId);
										}
										return BUI.getRectangleColorDIV(color, 10, 10);
									}
								}
							}, {
								text : 'Buffer',
								dataIndex : 'bufferId',
								width : 140,
								renderer : function(val, y, sample) {
									if (sample.raw.bufferId != null) {
										return BIOSAXS.proposal.getBufferById(val).acronym;
									}
								},
								editor : BIOSAXS_COMBOMANAGER.getComboBuffers(BIOSAXS.proposal.getBuffers(), {
									noLabel : true,
									width : 300
								})
							}, {
								text : 'Conc.',
								dataIndex : 'concentration',
								width : 100,
								editor : {
									allowBlank : false
								},
								renderer : function(val, meta, sample) {
									if (isNaN(val)) {
										meta.tdCls = 'yellow-cell';
										return val;
									} else {
										if (val != 0) {
											return BUI.formatValuesUnits(val, 'mg/ml', {
												fontSize : 16,
												decimals : 3,
												unitsFontSize : this.unitsFontSize
											});
										} else {
											return;
										}
									}
								}
							}, {
								text : 'Vol. Well',
								dataIndex : 'volume',
								width : 70,
								editor : {
									allowBlank : true
								},
								renderer : function(val, y, sample) {
									return BUI.formatValuesUnits(sample.data.volume, '&#181l', {
										fontSize : 12,
										decimals : 2,
										unitsFontSize : this.unitsFontSize
									});
								}
							}, {
								text : 'Position',
								hidden : true,
								flex : 1,
								renderer : function(val, y, sample) {
									return BUI.getSamplePositionHTML(sample.raw, _this.experiment);
								}
							}, {
								text : 'samplePlateId',
								dataIndex : 'samplePlateId',
								hidden : true
							}, {
								text : 'Plate',
								hidden : this.isPositionColumnHidden,
								dataIndex : 'slotPositionColumn',
								editor : _this._getSlotColumBombo(),
								flex : 1,
								renderer : function(val, meta, sample) {
									if ((val != null) & (val != "")) {
										return val;
									} else {
										meta.tdCls = 'yellow-cell';
									}
								}
							}, {
								text : 'Row',
								hidden : this.isPositionColumnHidden,
								dataIndex : 'rowNumber',
								editor : this._getRowCombo(),
								flex : 1,
								renderer : function(val, meta, sample) {
									if ((val != null) && (val != "")) {
										return BUI.getSamplePlateLetters()[val - 1];
									} else {
										meta.tdCls = 'yellow-cell';
									}
								}
							}, {
								text : 'Well',
								hidden : this.isPositionColumnHidden,
								dataIndex : 'columnNumber',
								editor : this._getColumnCombo(),
								flex : 1,
								renderer : function(val, meta, sample) {
									if ((val != null) && (val != "")) {
										return val;
									} else {
										meta.tdCls = 'yellow-cell';
									}
								}
							}, {
								id : _this.id + 'buttonEditSample',
								text : 'Edit',
								width : 80,
								sortable : false,
								hidden : !_this.editEnabled,
								renderer : function(value, metaData, record, rowIndex, colIndex, store) {
									if (_this.editEnabled) {
										return BUI.getGreenButton('EDIT');
									}
								}
							}, {
								id : _this.id + 'buttonRemoveSample',
								text : '',
								hidden : !_this.removeBtnEnabled,
								width : 100,
								sortable : false,
								renderer : function(value, metaData, record, rowIndex, colIndex, store) {
									if (_this.removeBtnEnabled) {
										return BUI.getRedButton('REMOVE');
									}
								}
							}

						],
						viewConfig : {
							preserveScrollOnRefresh : true,
							stripeRows : true,
							getRowClass : function(record) {
								var specimens = _this.experiment.getSampleByPosition(record.data.samplePlateId, record.data.rowNumber,
										record.data.columnNumber);
								if (specimens.length > 1) {
									return 'red-row';

								}
							},
							listeners : {
								selectionchange : function(grid, selected) {
									_this.onClick.notify(record.raw);
								},
								cellclick : function(grid, td, cellIndex, record, tr) {
									if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEditSample') {
									}
									if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemoveSample') {
										grid.getStore().removeAt(rowIndex);
										_this.onRemoved.notify();
									}

								}

							}
						}
					});
	return this.grid;
};

SpecimenGrid.prototype.input = function() {
	return {
		experiment : DATADOC.getExperiment_10(),
		proposal : DATADOC.getProposal_10()
	};
};

SpecimenGrid.prototype.test = function(targetId) {
	var specimenGrid = new SpecimenGrid({
		height : 400,
		maxHeight : 400,
		width : 1000
	});
	BIOSAXS.proposal = new Proposal(specimenGrid.input().proposal);

	var experiment = new Experiment(specimenGrid.input().experiment);
	var panel = specimenGrid.getPanelByExperiment(experiment);
	panel.render(targetId);

};

/**
 * Shows a list of stock solutions with macromolecule, buffer, storage temperature, concentration, shipment and comments
 * 
 * @multiselect allows multiple selection
 * @height 
 * @minHeight
 * @width
 * @tbar
 * @showTitle
 * @isPackedVisible shows is stock solution is in a box
 * @btnEditVisible shows edit button
 * @btnAddVisible
 * @btnAddExisting
 * @btnUnpackVisible allows to unpack a stock solution
 * @btnRemoveVisible allow to remove a stock solution
 */

function StockSolutionGrid(args) {
	this.id = BUI.id();
	this.height = 100;
	this.width = null;
	this.minHeight = null;
	this.tbar = true;

	this.title = "Stock Solutions";

	/** Visible buttons and actions **/
	this.btnEditVisible = true;
	this.btnRemoveVisible = true;
	this.btnAddVisible = true;
	this.btnAddExisting = false;
	this.isPackedVisible = true;
	this.btnUnpackVisible = false;

	/** Selectors **/
	this.multiselect = false;
	this.selectedStockSolutions = [];

	if (args != null) {
		if (args.btnUnpackVisible != null) {
			this.btnUnpackVisible = args.btnUnpackVisible;
		}
		if (args.multiselect != null) {
			this.multiselect = args.multiselect;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.btnEditVisible != null) {
			this.btnEditVisible = args.btnEditVisible;
		}
		if (args.btnAddVisible != null) {
			this.btnAddVisible = args.btnAddVisible;
		}
		if (args.btnAddExisting != null) {
			this.btnAddExisting = args.btnAddExisting;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.minHeight != null) {
			this.minHeight = args.minHeight;
		}
		if (args.tbar != null) {
			this.tbar = args.tbar;
		}
		if (args.btnRemoveVisible != null) {
			this.btnRemoveVisible = args.btnRemoveVisible;
		}
		if (args.isPackedVisible != null) {
			this.isPackedVisible = args.isPackedVisible;
		}
		if (args.showTitle != null) {
			this.showTitle = args.showTitle;
			if (this.showTitle == false) {
				this.title = null;
			}
		}

	}

	/** Events **/
	this.onProposalChanged = new Event(this);
	this.onStockSolutionSelected = new Event(this);
}

StockSolutionGrid.prototype._getColumns = function() {
	var _this = this;
	var columns = [

	{
		header : 'Macromolecule',
		dataIndex : 'macromolecule',
		id : _this.id + 'macromolecule',
		type : 'string',
		renderer : function(val, y, specimen) {
			return '<span style="color:blue;">' + val + '</span>';
		},
		hidden : false,
		flex : 1
	}, {
		header : 'Buffer',
		dataIndex : 'buffer',
		name : 'buffer',
		hidden : false,
		renderer : function(val, y, specimen) {
			return '<span style="color:green;">' + val + '</span>';
		},
		type : 'string',
		flex : 1
	}, {
		header : 'Acronym',
		dataIndex : 'name',
		name : 'name',
		type : 'string',
		flex : 1,
		hidden : true
	}, {
		header : 'Storage Temp.',
		dataIndex : 'storageTemperature',
		name : 'storageTemperature',
		type : 'string',
		flex : 1,
		hidden : false,
		renderer : function(val) {
			return BUI.formatValuesUnits(val, 'C', {
				fontSize : 12,
				decimals : 2,
				unitsFontSize : 10
			});
		}
	}, {
		header : 'Volume',
		dataIndex : 'volume',
		type : 'string',
		flex : 1,
		hidden : false,
		renderer : function(val) {
			return BUI.formatValuesUnits(val, '&#181l', {
				fontSize : 12,
				decimals : 2,
				unitsFontSize : 10
			});
		}
	}, {
		header : 'Concentration',
		dataIndex : 'concentration',
		name : 'concentration',
		type : 'string',
		flex : 1,
		renderer : function(val) {
			return BUI.formatValuesUnits(val, 'mg/ml', {
				fontSize : 12,
				decimals : 2,
				unitsFontSize : 10
			});
		}
	}, {
		header : 'Packed',
		dataIndex : 'comments',
		id : _this.id + "box",
		type : 'string',
		width : 50,
		hidden : !this.isPackedVisible,
		renderer : function(val, cmp, a) {
			if (a.raw.boxId != null) {
				return "<div style='cursor: pointer;'><img height='15px' src='../images/plane.gif'></div>";
			}

		}
	}, {
		header : 'Comments',
		dataIndex : 'comments',
		type : 'string',
		flex : 1
	} ];

	if (this.btnEditVisible) {
		columns.push({
			id : _this.id + 'buttonEdit',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnEditVisible) {
					return BUI.getGreenButton('EDIT');
				}
			}
		});
	}

	if (this.btnRemoveVisible) {
		columns.push({
			id : _this.id + 'buttonRemove',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnRemoveVisible) {
					return BUI.getRedButton('REMOVE');
				}
			}
		});
	}

	if (this.btnUnpackVisible) {
		columns.push({
			id : _this.id + 'buttonUnpack',
			width : 85,
			sortable : false,
			renderer : function(value, metaData, record, rowIndex, colIndex, store) {
				if (_this.btnUnpackVisible) {
					return BUI.getBlueButton('UNPACK');
				}
			}
		});
	}
	return columns;
};

StockSolutionGrid.prototype._getTopButtons = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	/** ADD BUTTON **/
	if (this.btnAddVisible) {
		actions.push(Ext.create('Ext.Action', {
			icon : '../images/add.png',
			text : 'Add Stock Solution',
			tooltip : 'Will create a new stock solution',
			disabled : false,
			alwaysEnabled : true,
			handler : function(widget, event) {
				_this.edit();
			}
		}));
	}

	if (this.btnAddExisting) {
		actions.push(Ext.create('Ext.Action', {
			icon : '../images/add.png',
			text : 'Add Existing',
			tooltip : 'Allows to select upacked stock solutions',
			disabled : false,
			alwaysEnabled : true,
			handler : function(widget, event) {
				var stockSolutionGrid = new StockSolutionGrid({
					btnAddVisible : false,
					btnEditVisible : false,
					btnRemoveVisible : false,
					btnAddExisting : false,
					isPackedVisible : true,
					multiselect : true
				});

				var window = Ext.create('Ext.window.Window', {
					title : 'Select',
					height : 400,
					width : 800,
					layout : 'fit',
					items : [ stockSolutionGrid.getPanel() ],
					buttons : [ {
						text : 'Pack',
						handler : function() {
							_this.onStockSolutionSelected.notify(stockSolutionGrid.selectedStockSolutions);
							window.close();
						}
					}, {
						text : 'Cancel',
						handler : function() {
							window.close();
						}
					} ]

				}).show();

				stockSolutionGrid.refresh(BIOSAXS.proposal.getUnpackedStockSolutions());
			}
		}));
	}

	return actions;
};

StockSolutionGrid.prototype.refresh = function(stockSolutions) {
	this.features = stockSolutions;
	this.store.loadData(this._prepareData(), false);
};

StockSolutionGrid.prototype._prepareData = function() {
	var data = [];
	for ( var i = 0; i < this.features.length; i++) {
		var stockSolution = this.features[i];
		stockSolution.buffer = BIOSAXS.proposal.getBufferById(stockSolution.bufferId).acronym;
		if (stockSolution.macromoleculeId != null) {
			stockSolution.macromolecule = BIOSAXS.proposal.getMacromoleculeById(stockSolution.macromoleculeId).acronym;
		}
		data.push(stockSolution);
	}
	return data;
};

StockSolutionGrid.prototype.getPanel = function() {
	return this._renderGrid();
};

StockSolutionGrid.prototype.edit = function(stockSolutionId) {
	var _this = this;
	var stockSolutionWindow = new StockSolutionWindow();
	/** On stock solution SAVED **/
	stockSolutionWindow.onSaved.attach(function(sender, stockSolution) {
		_this.onProposalChanged.notify(stockSolution);
	});
	stockSolutionWindow.draw(BIOSAXS.proposal.getStockSolutionById(stockSolutionId));
};

StockSolutionGrid.prototype._getStoreFields = function() {
	return [ {
		name : 'name',
		type : 'string'
	}, {
		name : 'stockSolutionId',
		type : 'string'
	}, {
		name : 'macromolecule',
		type : 'string'
	}, {
		name : 'buffer',
		type : 'string'
	}, {
		name : 'storageTemperature',
		type : 'numeric'
	}, {
		name : 'volume',
		type : 'string'
	}, {
		name : 'concentration',
		type : 'string'
	}, {
		name : 'buffer',
		type : 'string'
	}, {
		name : 'comments',
		type : 'string'
	} ];
};

//StockSolutionGrid.prototype.refresh = function() {
//	this.proposal.onInitialized.attach(function(sender){
//		
//	});
//	this.proposal.init(Ext.urlDecode(window.location.href).sessionId);
//};

StockSolutionGrid.prototype._renderGrid = function() {
	var _this = this;

	/** Store **/
	this.store = Ext.create('Ext.data.Store', {
		fields : this._getStoreFields(), //columns,
		autoload : true
	});

	var filters = {
		ftype : 'filters',
		local : true,
		filters : this.filters
	};

	var selModel = null;

	if (this.multiselect) {
		selModel = Ext.create('Ext.selection.CheckboxModel', {
			//multiSelect		: false,//this.multiselect,
			mode : 'SINGLE',
			listeners : {
				selectionchange : function(sm, selections) {
					_this.selectedStockSolutions = [];
					for ( var i = 0; i < selections.length; i++) {
						_this.selectedStockSolutions.push(selections[i].raw);
					}
				}
			}
		});
	} else {
		selModel = {
			mode : 'SINGLE'
		};
	}

	this.store.sort("stockSolutionId", "desc");

	this.grid = Ext.create('Ext.grid.Panel', {
		style : {
			padding : 5
		},
		icon : '/ispyb/images/SampleHolder_24x24_01.png',
		title : this.title,
		height : this.height,
		width : this.width,
		minWidth : this.minWidth,
		selModel : selModel,
		store : this.store,
		columns : this._getColumns(),
		viewConfig : {
			stripeRows : true,
			listeners : {
				itemdblclick : function(dataview, record, item, e) {
					_this.edit(record.raw.stockSolutionId);
				},
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					var adapter = null;
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonUnpack') {
						_this.grid.setLoading("ISPyB: Unpacking stock solution");
						adapter = new BiosaxsDataAdapter();
						adapter.onSuccess.attach(function(sender) {
							_this.onProposalChanged.notify();
							_this.grid.setLoading(false);
						});
						adapter.onError.attach(function(sender) {
							_this.onProposalChanged.notify();
							_this.grid.setLoading(false);
						});
						record.raw.boxId = null;
						adapter.saveStockSolution(record.raw);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + "box") {
						window.location = BUI.getShippingURL(BIOSAXS.proposal.getShipmentByDewarId(record.raw.boxId).shippingId);
					}
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonEdit') {
						_this.edit(record.data.stockSolutionId);
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonRemove') {
						_this.grid.setLoading("ISPyB: Removing stock solution");
						adapter = new BiosaxsDataAdapter();
						adapter.onSuccess.attach(function(sender) {
							_this.onProposalChanged.notify();
							_this.grid.setLoading(false);
						});
						adapter.onError.attach(function(sender) {
							_this.onProposalChanged.notify();
							_this.grid.setLoading(false);
						});
						adapter.removeStockSolution(record.data.stockSolutionId);
					}
				}
			}
		}

	});

	var actions = _this._getTopButtons();
	this.grid.addDocked({
		xtype : 'toolbar',
		items : actions
	});

	var i = null;
	this.grid.getSelectionModel().on({
		selectionchange : function(sm, selections) {
			if (selections.length) {
				for ( i = 0; i < actions.length; i++) {
					if (actions[i].enable) {
						actions[i].enable();
					}
				}
			} else {
				for ( i = 0; i < actions.length; i++) {
					if (actions[i].alwaysEnabled == false) {
						if (actions[i].disable) {
							actions[i].disable();
						}
					}
				}
			}
		}
	});
	return this.grid;
};

StockSolutionGrid.prototype.input = function() {
	return {
		proposal : DATADOC.getProposal_10()
	};
};

StockSolutionGrid.prototype.test = function(targetId) {
	var stockSolutionGrid = new StockSolutionGrid({
		height : 300,
		width : 900
	});
	BIOSAXS.proposal = new Proposal(stockSolutionGrid.input().proposal);
	var panel = stockSolutionGrid.getPanel();
	stockSolutionGrid.refresh(BIOSAXS.proposal.getStockSolutions());
	panel.render(targetId);
};


function SuperpositionGrid(args) {
	this.height = null;
	this.width = null;
	this.id = BUI.id();

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;

			if (args.width != null) {
				this.width = args.width;
			}
		}
	}
	
	this.onSelected = new Event(this);
}

SuperpositionGrid.prototype._prepareData = function(data) {
	return data;
};

SuperpositionGrid.prototype.refresh = function(subtractions) {
	var data  = [];
	if (subtractions != null){
		if (subtractions.length > 0){
			for (j in subtractions){
				var subtraction = subtractions[j];
				if (subtraction.superposition3VOs != null){
					for (i in subtraction.superposition3VOs){
						data.push(subtraction.superposition3VOs[i]);
					}
				}
			}
		}
	}
	this.store.loadData(data);
};

SuperpositionGrid.prototype.getPanel = function() {
	var _this = this;
	this.store = Ext.create('Ext.data.Store', {
		fields : [ 'abinitioModelPdbFilePath', 'aprioriPdbFilePath', 'alignedPdbFilePath' ],
		data : []
	});

	this.selModel = Ext.create('Ext.selection.RowModel', {
		allowDeselect : true,
		mode : 'MULTI',
		listeners : {
			selectionchange : function(sm, selections) {
				var selected = [];
				for (var i = 0; i < selections.length; i++) {
					selected.push(selections[i].raw);
				}
				_this.onSelected.notify(selected);
			}
		}
	});
	
	this.store.sort([ {
		property : 'name',
		direction : 'ASC'
	} ]);

	this.panel = Ext.create('Ext.grid.Panel', {
		store : this.store,
		selModel : this.selModel,
		width : this.width,
		height : this.height,
		margin : 10,
		deferredRender : false,
		columns : [ {
			text : 'Abinitio',
			dataIndex : 'abinitioModelPdbFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Apriori',
			dataIndex : 'aprioriPdbFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		}, {
			text : 'Aligned',
			dataIndex : 'alignedPdbFilePath',
			hidden : false,
			flex : 1,
			renderer : function(val){
				return BUI.getFileName(val);
			}
		} ],

		viewConfig : {
			enableTextSelection : true,
			preserveScrollOnRefresh : true
		},
		listeners : {
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

			},
			afterrender : function() {
			}
		}
	});
	return this.panel;
};

/**
 * See ExperimentGrid
 * 
 */
function TemplateGrid(args) {

	if (args == null) {
		args = {};
	}
	args.sorters = [ {
		property : 'experimentId',
		direction : 'DESC'
	} ];

	ExperimentGrid.prototype.constructor.call(this, args);
}

TemplateGrid.prototype._getFilterTypes = ExperimentGrid.prototype._getFilterTypes;
TemplateGrid.prototype._prettyPrintMacromolecules = ExperimentGrid.prototype._prettyPrintMacromolecules;
TemplateGrid.prototype._getPercentage = ExperimentGrid.prototype._getPercentage;
TemplateGrid.prototype._getPercentageCollected = ExperimentGrid.prototype._getPercentageCollected;
TemplateGrid.prototype.getPercentageMerged = ExperimentGrid.prototype.getPercentageMerged;
TemplateGrid.prototype._prepareData = ExperimentGrid.prototype._prepareData;
TemplateGrid.prototype.getPanel = ExperimentGrid.prototype.getPanel;
TemplateGrid.prototype._renderGrid = ExperimentGrid.prototype._renderGrid;
TemplateGrid.prototype._editExperiment = ExperimentGrid.prototype._editExperiment;
TemplateGrid.prototype._removeExperimentById = ExperimentGrid.prototype._removeExperimentById;

TemplateGrid.prototype._getTopButtons = function() {
	/** Actions buttons * */
	var actions = [];

	actions.push(Ext.create('Ext.Action', {
		icon : '../images/add.png',
		text : 'Add experiment',
		handler : function(widget, event) {
			var wizardWidget = new WizardWidget({
				windowMode : true
			});

			wizardWidget.onFinished.attach(function(sender, result) {
				var adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, data) {
					var experiment = new Experiment(data);
					BIOSAXS.openExperimentByExperiment(experiment);
					wizardWidget.window.close();
				});
				wizardWidget.current.setLoading("ISPyB: Creating experiment");
				adapter.createTemplate(result.name, "comments", result.data);
			});

//			wizardWidget.draw(this.targetId, new ExperimentTypeWizardForm());
			wizardWidget.draw(this.targetId, new MeasurementCreatorStepWizardForm(BIOSAXS.proposal.getMacromolecules()));
		}
	}));
	return actions;
};

TemplateGrid.prototype.refresh = function(data) {
	var filtered = [];
	for ( var i = 0; i < data.length; i++) {
		if (data[i].experimentType == "TEMPLATE") {
			filtered.push(data[i]);
		}
	}
	this.store.loadData(this._prepareData(filtered), false);
};

TemplateGrid.prototype._getColumns = function() {
	var _this = this;
	function actionItemRenderer(value, meta, record, rowIx, ColIx, store) {
		if (record.raw.buffer3VOs != null) {
			if (record.raw.buffer3VOs.length > 0) {
				return 'x-hide-display';
			}
		}

		if (record.data.platesCount > 0) {
			return 'x-hide-display';
		}
	}

	return [ {
		xtype : 'rownumberer',
		width : 40
	}, {
		text : 'experimentId',
		dataIndex : 'experimentId',
		name : 'experimentId',
		type : 'string',
		hidden : true
	}, {
		text : 'Name',
		dataIndex : 'name',
		name : 'name',
		type : 'string',
		flex : 1
	},

	{
		text : 'Type',
		dataIndex : 'type',
		name : 'type',
		type : 'string',
		hidden : true,
		flex : 1,
		renderer : function(val) {
			return val;
		}
	}, {
		text : 'Macromolecules',
		name : 'macromolecules_names',
		dataIndex : 'macromolecules_names',
		flex : 1,
		renderer : function(val) {
			return " <span style='font-weight:bold'>" + val + "</span>";
		}
	}, {
		id : _this.id + 'GO',
		width : 80,
		sortable : false,
		renderer : function(value, metaData, record, rowIndex, colIndex, store) {
			return BUI.getGreenButton('EDIT');
		}
	}, {
		id : _this.id + 'REMOVE',
		width : 100,
		sortable : false,
		renderer : function(value, metaData, record, rowIndex, colIndex, store) {
			return BUI.getRedButton('REMOVE');
		}
	} ];
};

TemplateGrid.prototype.input = function() {
	var experiments = DATADOC.getExperimentList_10();
	return {
		experiments : experiments,
		proposal : new MeasurementGrid().input().proposal

	};
};

TemplateGrid.prototype.test = function(targetId) {
	var experimentGrid = new TemplateGrid({
		height : 350,
		minHeight : 350,
		width : 1000,
		gridType : 'Ext.grid.Panel',
		title : 'Experiments',
		grouping : false,
		tbar : true

	});
	BIOSAXS.proposal = new Proposal(experimentGrid.input().proposal);
	var panel = experimentGrid.getPanel(experimentGrid.input().experiments);
	experimentGrid.refresh(experimentGrid.input().experiments);
	panel.render(targetId);
};

function VolumeGrid() {
	this.id = BUI.id();
}

VolumeGrid.prototype.getPanel = function(experiment) {
	this.experiment = experiment;
	return this.render();
};

VolumeGrid.prototype.getVolumesPanel = function(data, title) {
	var _this = this;
	var store = Ext.create('Ext.data.Store', {
		fields : [ 'name', 'volume', 'macromoleculeId', 'bufferId' ],
		data : data
	});
	store.sort([ {
		property : 'name',
		direction : 'ASC'
	} ]);

	var grid = Ext.create('Ext.grid.Panel', {
		title : title,
		height : 400,
		maxHeight : 400,
		width : 900,
		store : store,
		margin : '10 0 50 10',
		tbar : [ {
			text : 'Go to Shipment',
			icon : '../images/plane-small.gif',
			handler : function() {
				window.location = BUI.getCreateShipmentList();
			}
		} ],
		viewConfig : {
			stripeRows : true,
			listeners : {
				cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {
					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonCreate') {
						var stockSolutionWindow = new StockSolutionWindow();
						/** On stock solution SAVED **/
						stockSolutionWindow.onSaved.attach(function(sender, stockSolution) {
							BIOSAXS.proposal.onInitialized.attach(function(sender, data) {
								_this.refresh(_this.experiment);
							});
							BIOSAXS.proposal.init();
						});
						var acronym = "ST";
						if (record.raw.macromoleculeId != null) {
							acronym = acronym + "_" + BIOSAXS.proposal.getMacromoleculeById(record.raw.macromoleculeId).acronym;
						}
						if (record.raw.bufferId != null) {
							acronym = acronym + "_" + BIOSAXS.proposal.getBufferById(record.raw.bufferId).acronym;
						}
						stockSolutionWindow.draw({
							concentration : record.raw.concentration,
							macromoleculeId : record.raw.macromoleculeId,
							bufferId : record.raw.bufferId,
							name : acronym,
							volume : record.raw.volume
						});
					}

					if (grid.getGridColumns()[cellIndex].getId() == _this.id + 'buttonStockSolutions') {
						var stockSolutionGrid = new StockSolutionGrid({
							btnAddVisible : false,
							btnEditVisible : false,
							btnRemoveVisible : false,
							btnAddExisting : false,
							isPackedVisible : true,
							multiselect : false
						});

						var window = Ext.create('Ext.window.Window', {
							title : 'Stock solutions by specimen',
							height : 400,
							width : 800,
							layout : 'fit',
							items : [ stockSolutionGrid.getPanel() ],
							buttons : [ {
								text : 'Close',
								handler : function() {
									window.close();
								}
							} ]

						}).show();
						stockSolutionGrid.refresh(BIOSAXS.proposal.getStockSolutionsBySpecimen(record.raw.macromoleculeId, record.raw.bufferId));
					}
				}
			}
		},
		columns : [
//			{
//				text : '',
//				dataIndex : 'macromoleculeId',
//				width : 20,
//				renderer : function(val, y, sample) {
//					if (val != null) {
////						return BUI.getRectangleColorDIV(BIOSAXS.proposal.macromoleculeColors[val], 10, 10);
//						return BUI.getRectangleColorDIV(_this.experiment.macromoleculeColors[val], 10, 10);
//					}
//				}
//			},
//			{
//				text : '',
//				dataIndex : 'bufferId',
//				width : 20,
//				renderer : function(val, y, sample) {
//					if (val != null) {
//						return BUI.getRectangleColorDIV(_this.experiment.getSpecimenColorByBufferId(val), 10, 10);
//					}
//				}
//			},
			{
				text : 'Specimen',
				dataIndex : 'name',
				flex : 0.5
			},
			{
				text : 'Estimated Volume',
				dataIndex : 'volume',
				tooltip : 'Estimation of the maximum volume needed for making this experiment',
				flex : 0.5,
				editor : {
					allowBlank : true
				},
				renderer : function(val, y, sample) {
					return BUI.formatValuesUnits(sample.data.volume, '&#181l', {
						fontSize : 16,
						decimals : 2,
						unitsFontSize : this.unitsFontSize
					});
				}
			},
			{
				text : 'Stock Solution',
				id : _this.id + 'buttonStockSolutions',
				dataIndex : 'name',
				flex : 0.5,
				tooltip : 'Stock Solutions containing this specimen in this proposal',
				renderer : function(value, metaData, record, rowIndex, colIndex, store) {
					var macromoleculeId = record.raw.macromoleculeId;
					var bufferId = record.raw.bufferId;
					var stockSolutions = BIOSAXS.proposal.getStockSolutionsBySpecimen(macromoleculeId, bufferId);
					if (stockSolutions.length > 0) {
						return "<div><span style='font-size:18px'>" + stockSolutions.length + "</span> x<img height='15px' src='/ispyb/images/SampleHolder_24x24_01.png'></div>";
					}

				}
			}, {
				id : _this.id + 'buttonCreate',
				text : '',
				tooltip : 'Create a new stock solution for shipping',
				width : 170,
				sortable : false,
				renderer : function(value, metaData, record, rowIndex, colIndex, store) {
					return BUI.getGreenButton('NEW STOCK SOLUTION', {
						width : 160
					});
				}
			} ]
	});
	return grid;

};

VolumeGrid.prototype._prepareData = function(experiment) {
	var keys = {};
	for ( var i = 0; i < experiment.getSamples().length; i++) {
		var sample = experiment.getSamples()[i];
		var key = "";
		if (sample.macromoleculeId == null) {
			key = experiment.getBufferById(sample.bufferId).acronym;
			if (keys[key] == null) {
				keys[key] = {
					macromoleculeId : sample.macromoleculeId,
					name : key,
					bufferId : sample.bufferId,
					volume : 0
				};
			}
			keys[key].volume = Number(sample.volume) + Number(keys[key].volume);
		}

		if ((sample.macromolecule3VO != null) || (sample.macromoleculeId != null)) {
			macromoleculeId = sample.macromoleculeId;
			if (sample.macromoleculeId == null) {
				sample.macromoleculeId = sample.macromolecule3VO.macromoleculeId;
			}
			key = BIOSAXS.proposal.getMacromoleculeById(sample.macromoleculeId).acronym + " + " + experiment.getBufferById(sample.bufferId).acronym;
			if (keys[key] == null) {
				keys[key] = {
					macromoleculeId : sample.macromoleculeId,
					name : key,
					bufferId : sample.bufferId,
					volume : 0
				};
			}
			keys[key].volume = Number(sample.volume) + Number(keys[key].volume);
		}
	}
	var data = [];
	for (var keyId in keys) {
		data.push(keys[keyId]);
	}

	return data;
};

VolumeGrid.prototype.refresh = function(experiment) {
	this.experiment = experiment;
	this.macromoleculeGrid.getStore().loadData(this._prepareData(this.experiment), false);
};

VolumeGrid.prototype.render = function() {
	this.macromoleculeGrid = this.getVolumesPanel(this._prepareData(this.experiment), "Estimation of required Volume");

	return {
		xtype : 'container',
		layout : 'vbox',
		margin : "0, 0, 0, 5",
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			margin : "0, 0, 0, 0",
			items : [ this.macromoleculeGrid ]
		} ]
	};
};

VolumeGrid.prototype.input = function(experiment) {
	return {
		experiment : DATADOC.getExperiment_10()
	};
};

VolumeGrid.prototype.test = function(targetId) {
	var volumeGrid = new VolumeGrid();
	BIOSAXS.proposal = new Proposal(new MeasurementGrid().input().proposal);
	var panel = volumeGrid.getPanel(new Experiment(new VolumeGrid().input().experiment));
	Ext.create('Ext.panel.Panel', {
		height : 500,
		width : 1000,
		renderTo : targetId,
		items : [ panel ]
	});
};

/** 
 * Example of a tab panel to be populated with widgets 
 * 
 * @width width in pixels
 * @height height in pixels
 * 
 * #myEvent event that this class is supposed to throw
 * 
 **/
function ExampleTabs(args) {
	this.width = 500;
	this.height = 500;
	
	if (args != null){
		if (args.width != null){
			this.width= args.width;
		}
		if (args.height != null){
			this.height= args.height;
		}
	}
	
	/** Events **/
	this.myEvent = new Event();
}

/** Populate the widget **/
ExampleTabs.prototype.refresh = function(macromolecule) {
	
};

/** It creates a tab panel with the specified with and height **/
ExampleTabs.prototype.getPanel = function() {
	this.panel = Ext.createWidget('tabpanel', {
		height  : this.height,
		width	: this.width,
		style : {
			padding : 2
		},
		items : [ {
			tabConfig : {
				title : 'Test',
				icon : '/ispyb/images/plane-small.gif'
			},
			items : [ {
				xtype : 'container',
				margin : '5 5 5 5',
				items : [ ]
			} ]
		} ]
	});
	return this.panel;
};


/**
 * Shows an experiments with the specimens, measurements, analysis tabs where
 * results are shown and the frames widget
 * 
 * @targetId
 */
function ExperimentTabs(targetId) {
	this.height = 900;
	this.targetId = targetId;

	this.id = BUI.id();
	var _this = this;

	this.INTERVAL_UPDATE = BUI.getUpdateInterval();

	this.gridHeight = 1000;
	/** data * */
	this.experiment = null;

	
	/** Specimen Widget contains a specimenGrid and a sampleChangerWidget than can be displayed with are vertical or horizontal layout **/
	this.specimenWidget = new SpecimenWidget({
		height : 600
	});
	
	
	/** For Overview * */
	/*this.samplePlateGroupWidget = new SamplePlateGroupWidget({
		showTitle : false,
		height : 250,
		margin : 5,
		border : 0

	});*/

	/** For Measurements * */
	/*this.measurementSamplePlateGroupWidget = new SamplePlateGroupWidget({
		showTitle : false,
		height : 250,
		margin : '5 0 0 0',
		border : 0
	});*/

	this.measurementGridDone = new MeasurementGrid({
		height : 600,
		minHeight : 400,
		maxHeight : 800,
		positionColumnsHidden : true,
		showTitle : false,
		estimateTime : true,
		width : 900,
		maxWidth : 1500,
		addBtnEnable : false,
		markDone : true,
		removeBtnEnabled : false
	});
	this.measurementGridDone.onSelected.attach(function(sender, measurements) {
		var specimens = [];
		for ( var i = 0; i < measurements.length; i++) {
			specimens.push(_this.experiment.getSampleById(measurements[i].specimenId));
		}
		//_this.measurementSamplePlateGroupWidget.selectSpecimens(specimens);
	});

	/** AnalysisGrid * */
	this.analysisGrid = new AnalysisGrid({
		height : Ext.getBody().getViewSize().height * 0.9 - 300,
		positionColumnsHidden : true,
		sorters : [ {
			property : 'priorityLevelId',
			direction : 'ASC'
		} ]
	});
	
	
	/** Queue * */
	this.queueGrid = new QueueGrid({
		url : BUI.getQueueUrlByExperiment(),
		height : Ext.getBody().getViewSize().height * 0.9 - 300,
		width : Ext.getBody().getViewSize().width * 0.9 - 300,
		isGrouped : true,
		tbar : false,
		bbar : false,
		sorter : [{
	        property: 'measurementId',
	        direction: 'DESC'
	    }]
	});

}

ExperimentTabs.prototype.error = function(error) {
	var e = JSON.parse(error);
	showError(e);
	this.panel.setLoading(false);
};

ExperimentTabs.prototype.draw = function(experiment) {
	this.renderDataAcquisition(experiment);
};

ExperimentTabs.prototype.refreshAnalysisData = function() {
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		_this.analysisGrid.refresh(data, {experiment : _this.experiment});
	});
	adapter.getAnalysisInformationByExperimentId(this.experiment.experimentId);
	
	/** Auto load **/
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		_this.queueGrid.refresh(data);
	});
	adapter.getCompactAnalysisByExperimentId(this.experiment.experimentId);
	this.queueGrid.store.proxy.url = BUI.getQueueUrlByExperiment(this.experiment.experimentId);
	this.queueGrid.refresh();
};

ExperimentTabs.prototype.getSpecimenContainerHeight = function(experiment) {
	var maxItems = 0;
	if (maxItems < experiment.getSamples().length + 1) {
		maxItems = experiment.getSamples().length + 1;
	}

	var height = (maxItems + 1) * 40 + 40;
	if (height > 400) {
		height = 400;
	}
	return height;
};

ExperimentTabs.prototype.getExperimentTitle = function() {
	var experimentHeaderForm = new ExperimentHeaderForm();
	return experimentHeaderForm.getPanel(this.experiment);
};

ExperimentTabs.prototype.renderDataAcquisition = function(experiment) {
	var _this = this;
	this.experiment = experiment;

	var specimenGrid = new SpecimenGrid({
		height : 400,
		maxHeight : 500,
		width : 890
	});

	specimenGrid.onClick.attach(function(sender, args) {
	});

	specimenGrid.onSelected.attach(function(sender, specimens) {
		//_this.samplePlateGroupWidget.selectSpecimens(specimens);
	});
	var specimenContainer = this.specimenWidget.getPanel();
	this.specimenWidget.refresh(experiment);
	/*
	var specimenContainer = Ext.create('Ext.container.Container', {
		layout : 'hbox',
		width : 900,
		padding : '10 0 0 2',
		items : [ specimenGrid.getPanel() ]
	});
	
	specimenGrid.refresh(experiment);*/
	
	var experimentList = new ExperimentList([ _this.experiment ]);
	var measurementContainer = Ext.create('Ext.container.Container', {
		layout : 'vbox',
		padding : '5px 0px 0px 10px',
		items : []
	});
	measurementContainer.insert(0, _this.measurementGridDone.getPanel(this.experiment.getMeasurements(), experimentList));
//	measurementContainer.insert(1, _this.measurementSamplePlateGroupWidget.getPanel(experiment));

	// this.dataCollectionCurveVisualizer = new DataCollectionCurveVisualizer();
	// this.dataCollectionCurveVisualizer.experiments = [experiment];
	// this.dataCollectionCurveVisualizer.dataCollectionFrameTree.experiments =
	// [experiment];
	// this.dataCollectionCurveVisualizer.dataCollections =
	// experiment.getDataCollections();

	this.panel = Ext.createWidget('tabpanel', {
		plain : true,
		style : {
			padding : 2
		},
		items : [ {
			tabConfig : {
				id : 'genralTabl',
				title : "Overview"
			},
			items : [  specimenContainer ]
		}, {
			tabConfig : {
				title : 'Measurements'
			},
			items : [ measurementContainer]
		}, {
			tabConfig : {
				id : 'SpecimenTab',
				title : 'Analysis',
				hidden : this.isTemplate()
			},
			items : [ {
				xtype : 'container',
				layout : 'vbox',
				padding : '5px 0px 10px 10px',
				items : [ _this.analysisGrid.getPanel([]) ]
			} ]
		},
		{
			tabConfig : {
				id : 'newAnalysisTab',
				title : 'Analysis <span style="font-size:8px;color:red;">BETA</span>',
				hidden : this.isTemplate()
			},
			items : [ {
				xtype : 'container',
				layout : 'vbox',
				padding : '5px 0px 10px 10px',
				items : [ _this.queueGrid.getPanel([]) ]
			} ]
		}
		]
	});

	return this.getPanel(this.panel);
};

ExperimentTabs.prototype.isTemplate = function() {
	if (this.experiment.json.type == "TEMPLATE") {
		return true;
	}
	return false;
};

ExperimentTabs.prototype.update = function() {
	var _this = this;
	var inter;
	if (!_this.isTemplate()) {
		function updateExperiments() {
			_this.refreshAnalysisData();
			window.clearInterval(inter);
			inter = setInterval(function() {
				updateExperiments();
			}, _this.INTERVAL_UPDATE);
			var adapter = new BiosaxsDataAdapter();
			adapter.onSuccess.attach(function(sender, data) {
				var experiment = new Experiment(data);
				_this.measurementGridDone.refresh(experiment.getMeasurements(), new ExperimentList([ experiment ]));
			});
			adapter.getExperimentById(_this.experiment.json.experimentId, "MEDIUM");
		}
		inter = setInterval(function() {
			updateExperiments();
		}, _this.INTERVAL_UPDATE);
	}
};

ExperimentTabs.prototype.getPanel = function(panel) {
	var _this = this;
	if (this.experimentPanel == null) {
		this.experimentPanel = Ext.create('Ext.container.Container', {
			bodyPadding : 2,
			width : Ext.getBody().getViewSize().width * 0.9,
			renderTo : this.targetId,
			style : {
				padding : 2
			},
			items : [ this.getExperimentTitle(), this.panel ],
			listeners : {
				afterrender : function() {
					_this.refreshAnalysisData();
					_this.update();
				}
			}
		});
	}

	return this.experimentPanel;
};

ExperimentTabs.prototype.input = function() {
	return {
		experiment : DATADOC.getExperiment_10(),
		proposal : DATADOC.getProposal_10()
	};
};

ExperimentTabs.prototype.test = function(targetId) {
	var experimentTabs = new ExperimentTabs(targetId);
	BIOSAXS.proposal = new Proposal(experimentTabs.input().proposal);
	experimentTabs.draw(new Experiment(experimentTabs.input().experiment));
};



/**
 * Shows an experiments with the specimens, measurements, analysis tabs where results are shown and the frames widget
 * 
 * @targetId
 */
function HPLCTabs(targetId) {
	this.height = 1400;
	this.targetId = targetId;

	this.id = BUI.id();

	this.gridHeight = 600;
	this.pointsCount = 1036;
	this.plotHeight = 350;
	this.plotWidth = 800;
	this.plotPanelPadding = 5;

	var _this = this;

	this.analysisGrid = new HPLCAnalysisGrid({
		height : Ext.getBody().getViewSize().height * 0.9 - 300,
		positionColumnsHidden : true,
		sorters : [ {
			property : 'priorityLevelId',
			direction : 'ASC'
		} ]
	});

	this.frameGrid = new FrameGrid({
		width : 600,
		height : 60,
		collapsed : false,
		tbar : false
	});
	
	this.peakGrid = new PeakGrid({
		width : 550,
		height : 500,
		collapsed : false,
		tbar : false
	});
	
	this.peakGrid2 = new PeakGrid({
		width : 102,
		height : this.plotHeight,
		collapsed : false,
		tbar : false,
		showExtendedColumns : true
	});
	
	this.mainPlotPanel = new HPLCGraph({
		title : 'I0',
		width : this.plotWidth - 110,
		height : this.plotHeight,
		bbar : true,
		plots : {
			"I0" : true,
			"Rg" : true
		},
		xlabel : "HPLC Frames",
		scaled : true,
		interactionModel : {
			'dblclick' : function(event, g, context) {
				_this._selectFrame(g.lastx_);
				var annotations = [];
				annotations.push({
					series : g.selPoints_[0].name,
					x : g.lastx_,
					width : 100,
					height : 23,
					tickHeight : 4,
					shortText : g.lastx_,
					text : g.lastx_,
					attachAtBottom : true
				});
				g.setAnnotations(annotations);

			}
		}
	});

	this.intensityPlotPanel = new MergesHPLCGraph({
		title : 'Scattering',
		width : this.plotWidth,
		height : 500,
		showRangeSelector : false,
		xParam : 0,
		xlabel : "scattering_I",
		plots : {
			"scattering_I" : true,
			"subtracted_I" : true,
			"buffer_I" : true
		}
	});

}

HPLCTabs.prototype._selectFrame = function(frameNumber) {
	try{
		this._renderScatteringCurve(frameNumber);
		this.frameGrid.refresh([this.mainPlotPanel.getDataByFrameNumber(frameNumber)], this.experiment.experimentId);
	}
	catch(e){
		console.log(e);
	}
};

HPLCTabs.prototype.error = function(error) {
	var e = JSON.parse(error);
	showError(e);
	this.panel.setLoading(false);
};

HPLCTabs.prototype.loadDataMainPlot = function(data) {
	var zeroArray = [];
	for ( var i = 0; i < data.I0.length; i++) {
		zeroArray.push(0);
	}
	data = [ {
		param : "I0",
		data : data.I0,
		std : data.I0_Stdev,
		color : '#0066CC',
		label : "I0"
	}, 
	{
		param : "sum_I",
		label : "sum_I",
		color : "#00FF00",
		data : data.sum_I,
		std : zeroArray
	},
	{
		param : "Rg",
		label : "Rg",
		color : "#21610B",
		data : data.Rg,
		std : data.Rg_Stdev
	}, {
		param : "Mass",
		data : data.mass,
		std : data.mass_Stdev,
		color : '#FF9900',
		label : "Mass"
	}, {
		param : "Vc",
		data : data.Vc,
		std : data.Vc_Stdev,
		color : '#990099',
		label : "Vc"
	}, {
		param : "Qr",
		data : data.Qr,
		std : data.Qr_Stdev,
		color : '#FF0066',
		label : "Qr"
	}, {
		param : "quality",
		label : "quality",
		color : "#FF00FF",
		data : data.quality,
		std : zeroArray
	} ];
	this.data = data;
	this.mainPlotPanel.loadData(data);
};

HPLCTabs.prototype._loadIntensityPlotByFrameNumber = function(frameNumber) {
	var _this = this;
	
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		var array = [];
		data = [ {
			param : "q",
			data : data[frameNumber].q,
			std : data[frameNumber].q,
			fstd : function(a) {
				return parseFloat(a);
			},
			color : '#green',
			label : "q",
			showOnMenu : false
		}, 
		{
			param : "scattering_I",
			data : data[frameNumber].scattering_I,
			fdata : function(a) {
				return Math.log(parseFloat(a));
			},
			std : data[frameNumber].scattering_Stdev,
			fstd : function(a) {
				return Math.log(Math.abs(parseFloat(a)));
			},
			color : 'green',
			label : "Log(I) Sample"
		}, 
		{
			param : "buffer_I",
			data : data[frameNumber].buffer_I,
			fdata : function(a) {
				return Math.log(parseFloat(a));
			},
			fstd : function(a) {
				return Math.log(Math.abs(parseFloat(a)));
			},
			std : data[frameNumber].subtracted_Stdev,
			color : '#0000FF',
			label : "Log(I) Avg Buf."
		}, 
		{
			param : "subtracted_I",
			data : data[frameNumber].subtracted_I,
			fdata : function(a) {
				var value = (Math.log(parseFloat(a)));
				if (isNumber(value))
					return value;
			},
			fstd : function(a) {
				var value =  Math.log(Math.abs(parseFloat(a)));
				if (isNumber(value))
					return value;
			},
			std : data[frameNumber].subtracted_Stdev,
			color : 'red',
			label : "Log(I) Sub."
		}
		];

		_this.intensityPlotPanel.xlabel = "Frame " + frameNumber + " (q, nm-1)";

		if (_this.intensityPlotPanel.hplcData == null) {
			/** It creates also top bar **/
			_this.intensityPlotPanel.loadData(data);
		} else {
			_this.intensityPlotPanel.reloadData(data);
			
		}
		_this.intensityPlotPanel.panel.setLoading(false);
	});
	adapter.onError.attach(function(sender, data) {
		_this.intensityPlotPanel.panel.setLoading(false);
	});
	this.intensityPlotPanel.panel.setLoading("Retrieving Frame " + frameNumber);
	adapter.getH5FrameScattering(this.experiment.json.experimentId, frameNumber);
};

HPLCTabs.prototype._renderScatteringCurve = function(frameNumber) {
	var _this = this;
	
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		_this.intensityPlotPanel.setPeaks(data);
		_this._loadIntensityPlotByFrameNumber(frameNumber);
		try{
			var peaks = [];
			for(key in data){
				peaks.push({
					start	: key.split("-")[0],
					end	: key.split("-")[1],
					experimentId	: _this.experiment.json.experimentId
				});
			}
			_this.peakGrid2.refresh(JSON.parse(JSON.stringify(peaks)));
			_this.peakGrid.refresh(peaks);
//			console.log(peaks);
		}
		catch(e){
			showError(e);
		}
	});
	adapter.onError.attach(function(sender, data) {
		_this.intensityPlotPanel.setLoading(false);
	});
	this.intensityPlotPanel.panel.setLoading("Reading HDF5 File ");
	adapter.getH5FramesMerge(this.experiment.json.experimentId);
};

HPLCTabs.prototype._postRenderOverviewPanel = function() {
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onError.attach(function(sender, data) {
		data = data.replace(/NaN/g, '0');
		_this.loadDataMainPlot(JSON.parse(data));
		

	});
	adapter.onSuccess.attach(function(sender, data) {
		_this.loadDataMainPlot(data);
		_this._renderScatteringCurve(0);
	});
	adapter.getH5fileParameters(this.experiment.json.experimentId, [
		"I0", "I0_Stdev", "sum_I","Rg", "Rg_Stdev", "Vc", "Vc_Stdev", "Qr", "Qr_Stdev", "mass", "mass_Stdev", "quality" ]);

};

HPLCTabs.prototype._postRenderDetailsPanel = function() {
	if (this.data != null) {
		this.I0PlotPanel.loadData(this.data);
		this.RgPlotPanel.loadData(this.data);
		this.MassPlotPanel.loadData(this.data);
		this.VcPlotPanel.loadData(this.data);
	}

};

HPLCTabs.prototype.draw = function(experiment) {
	var _this = this;
	this.renderDataAcquisition(experiment);
};

HPLCTabs.prototype.getExperimentTitle = function() {
	var experimentHeaderForm = new ExperimentHeaderForm();
	return experimentHeaderForm.getPanel(this.experiment);
};

HPLCTabs.prototype.renderDataAcquisition = function(experiment) {
	var _this = this;
	this.experiment = experiment;
	if (this.experimentPanel == null) {
		this.experimentPanel = Ext.create('Ext.container.Container', {
			bodyPadding : 2,
			height : this.height,
			width : Ext.getBody().getViewSize().width * 0.9,
			renderTo : this.targetId,
			style : {
				padding : 2
			},
			items : [ this.getExperimentTitle(), this.getPanel() ],
			listeners : {
				afterrender : function() {
					var adapter = new BiosaxsDataAdapter();
					adapter.onSuccess.attach(function(sender, data) {
						_this.analysisGrid.refresh(data);
					});
					adapter.getAnalysisInformationByExperimentId(_this.experiment.experimentId);
				}
			}
		});
	}
	return this.experimentPanel;
};

HPLCTabs.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.createWidget('tabpanel',
			{
				plain : true,
				height : this.height,
//				width : 900,
				style : {
					padding : 2
				},
				items : [
					{
						tabConfig : {
							title : "Overview"

						},
						items : [ {
							xtype : 'container',
							layout : 'hbox',
							border : 1,
							flex : 1,
							items : [ {
								xtype : 'container',
								layout : 'vbox',
								border : 1,
								items : [ {
									xtype : 'container',
									margin : '10px',
									border : 1,
									items : [ 
											{
												xtype : 'container',
												margin : '0px',
												layout : 'hbox',
												border : 1,
												items : [ 
												         this.peakGrid2.getPanel([]),
												         this.mainPlotPanel.getPanel()
												         ]
											 },
									          {
													xtype : 'container',
													layout : 'vbox',
													border : 1,
													items : [
														         {
														        	 html: '<div style="font-weight:bold;width:600px;border-bottom:1px solid #000000;">Select a frame by double-clicking on the HPLC Frames plot</div>',
														        	 margin: 5,
														        	 border : 0
														         },
														          this.frameGrid.getPanel([]), 
														          this.intensityPlotPanel.getPanel() 
													         ]
									          }
									         
									          ]
								}],
								listeners : {
									afterrender : function() {
										_this._postRenderOverviewPanel();
									}
								}
							} ]
						} ]
					},
//					{
//						tabConfig : {
//							title : "Details"
//						},
//						items : [ {
//							xtype : 'container',
//							layout : 'hbox',
//							border : 1,
//							flex : 1,
//							items : [ {
//								xtype : 'container',
//								layout : 'vbox',
//								border : 1,
//								items : [ {
//									xtype : 'container',
//									padding : '1px',
//									items : [
//										this.I0PlotPanel.getPanel(), this.RgPlotPanel.getPanel(), this.MassPlotPanel.getPanel(),
//										this.VcPlotPanel.getPanel() ]
//								} ],
//								listeners : {
//									afterrender : function() {
//										_this._postRenderDetailsPanel();
//									}
//								}
//							} ]
//						} ]
//					}, 
					{
						tabConfig : {
							title : "Analysis"
						},
						items : [ {
							xtype : 'container',
							layout : 'vbox',
							padding : '5px 0px 10px 10px',
							items : [ _this.analysisGrid.getPanel([]) ]
						} ]
					},
					{
						tabConfig : {
							title : "File Manager"
						},
						items : [ {
										xtype : 'container',
										layout : 'vbox',
										padding : '5px 0px 10px 10px',
										items : [
										         {
										        	 html: '<div style="font-weight:bold;width:900px;border-bottom:1px solid #000000;">Custom Download</div>',
										        	 margin : '10 0 10 5',
										        	 border : 0
										         },
										         {
										        	 html: '<div style="font-weight:bold;width:900px;border:1px solid red;color:red">Download has been temporary disabled. Contact your labcontact if you want to extract the frames from the HDF5 file</div>',
										        	 margin : '10 0 10 5',
										        	 hidden : _this.experiment.experimentId == 2602,
										        	 border : 0
										         },
										         {
														xtype : 'container',
														layout : 'hbox',
														margin : '0 0 0 20',
														flex : 1,
														items :[
																	{
															            xtype: 'numberfield',
															            id: 'field_start',
															            fieldLabel: 'Frames from',
															            value: 0,
															            minValue: 0
															        },
															        {
															            xtype: 'numberfield',
															            id: 'field_end',
															            fieldLabel: 'to',
															            labelWidth : 20,
															            margin : '0 0 0 10',
															            minValue: 0
															        },
															        {
															            xtype: 'button',
															            /** allowing test account to download frames **/
															            disabled : _this.experiment.experimentId != 2602,
															            text : 'Download',
															            margin : '0 0 0 10',
															            handler : function() {
															            	var experimentId = _this.experiment.experimentId;
															            	var start = Ext.getCmp("field_start").getValue();
															            	var end = Ext.getCmp("field_end").getValue();
															            	/** Checking if start is bigger than end **/
															            	if (start > end){
															            		var aux = end;
															            		end = start;
															            		start = aux;
															            	}
															            	var url = BUI.getZipFrameHPLCUrl(experimentId, start, end);
															            	window.open(url)
															            }
															        }
																] 
													},
											         _this.peakGrid.getPanel([])
											        
								         ]
									}
						]
					} 
					]
			});

	return this.panel;
};

/**
 * Main form tab for macromolecule
 * 
 * @width
 * @height
 * 
 * #onClose when user clicks on close button in the MacromoleculeForm
 * #onSave when macromole is saved by macromoleculeForm
 */
function MacromoleculeTabs(args) {
	this.width = 500;
	this.height = 500;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;

	/** Widgets **/

	/** Macromolecule Form **/
	this.macromoleculeForm = new MacromoleculeForm({
		width : this.width - 30,
		height : this.height - 50,
	});

	this.macromoleculeForm.onClose.attach(function(sender) {
		_this.onClose.notify();
	});

	this.macromoleculeForm.onSave.attach(function(sender, macromolecule) {
		_this.onSave.notify(macromolecule);
	});

	this.assemblyForm = new AssemblyForm({
		width : this.width - 30,
		height : this.height - 50,
	});
	
	this.rigibBodyModelingForm = new RigibBodyModelingForm({
		width : this.width - 30,
		height : this.height - 50,
	});
	
	this.rigibBodyModelingForm.onSave.attach(function(sender, macromolecule) {
		_this.onSave.notify(macromolecule);
	});
	

	/** Events **/
	this.onClose = new Event(this);
	this.onSave = new Event(this);
}

/** Populate the widget **/
MacromoleculeTabs.prototype.refresh = function(macromolecule) {
	this.macromoleculeForm.refresh(macromolecule);
	this.assemblyForm.refresh(macromolecule);
	this.rigibBodyModelingForm.refresh(macromolecule);

	if (macromolecule != null){
		if (macromolecule.macromoleculeId == null){
			Ext.getCmp(this.id + "_advancedTab").disable();
			Ext.getCmp(this.id + "_assemblyTab").disable();
		}
		else{
			Ext.getCmp(this.id + "_advancedTab").enable();
			Ext.getCmp(this.id + "_assemblyTab").enable();
		}
	}
	else{
		Ext.getCmp(this.id + "_advancedTab").disable();
		Ext.getCmp(this.id + "_assemblyTab").disable();
	}
};

MacromoleculeTabs.prototype.getItems = function() {
	return [ {
		tabConfig : {
			title : 'General'
		},
		items : [ {
			xtype : 'container',
			items : [ this.macromoleculeForm.getPanel() ]
		} ]
	}, {
		id : this.id + "_assemblyTab",
		tabConfig : {
			title : 'Assembly'
		},
		items : [ {
			xtype : 'container',
			items : [ this.assemblyForm.getPanel() ]
		} ]
	},{
		id : this.id + "_advancedTab",
		tabConfig : {
			title : 'Advanced'
		},
		items : [ this.rigibBodyModelingForm.getPanel() ]
	} ];
};

MacromoleculeTabs.prototype.getPanel = function() {
	this.panel = Ext.createWidget('tabpanel', {
		height : this.height,
		width : this.width,
		plain : true,
		margin : 5,
		border : 0,
		items : this.getItems()
	});
	return this.panel;
};

function ResultTabs() {
}

ResultTabs.prototype.draw = function(targetId, data, macromoleculeId) {
	var panel = this.getPanel(targetId, data, macromoleculeId);
	return Ext.create('Ext.container.Container', {
		renderTo : targetId,
		items : [ BUI.getMacromoleculeHeader(macromoleculeId), panel ]
	});

};

ResultTabs.prototype._splitBySpecimen = function(data) {
	var splitted = {};

	for ( var i = 0; i < data.length; i++) {
		var row = data[i];
		if (splitted[row.macromoleculeId + "_" + row.bufferId] == null) {
			splitted[row.macromoleculeId + "_" + row.bufferId] = [];
		}
		splitted[row.macromoleculeId + "_" + row.bufferId].push(row);
	}
	return splitted;

};

ResultTabs.prototype._getTabTitle = function(key, data) {
	var macromoleculeId = key.split("_")[0];
	var bufferId = key.split("_")[1];

	return BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).acronym + " + " + BIOSAXS.proposal.getBufferById(bufferId).acronym + "(" + data.length + ")";
};

ResultTabs.prototype.getPanel = function(targetId, data, macromoleculeId) {

	var dataFiltered = new AnalysisGrid({
		hideNulls : true,
		grouped : true,
		sorters : [ {
			property : 'quality',
			direction : 'DESC'
		} ]
	})._prepareData(data);

	var items = [ {
		tabConfig : {
			title : 'Analysis (' + dataFiltered.length + ')'
		},
		items : [ {
			xtype : 'container',
			layout : 'vbox',
			padding : 10,
			items : [ new AnalysisGrid({
				isScatteringPlotVisible : false
			}).getPanel(dataFiltered) ]
		} ]
	}, {
		tabConfig : {
			title : 'Concentration Effects'
		},
		items : [ new ResultSummaryForm().getPanel(data) ]
	} ];

	var splitted = this._splitBySpecimen(dataFiltered);
	for ( var key in splitted) {
		items.push({
			tabConfig : {
				title : this._getTabTitle(key, splitted[key])
			},
			items : [ new ResultSummaryForm().getPanel(splitted[key]) ]
		});
	}

	this.panel = Ext.createWidget('tabpanel', {
		style : {
			padding : 2
		},
		items : items
	});
	return this.panel;

};


function ShipmentTabs(targetId) {
	this.targetId = targetId;

	var _this = this;
	this.gridHeight = 500;
	/** data **/
	this.shipment = null;

	/** Shipment Form **/
	this.shipmentForm = new ShipmentForm({
		creationMode : false,
		showTitle : false
	});
	this.shipmentForm.onSaved.attach(function(sender, data) {
		_this.refresh(data);

	});


	/** Cases grid **/
	this.caseGrid = new CaseGrid({
		height : this.gridHeight
	});

	this.caseGrid.onAddButtonClicked.attach(function(sender, dewar) {
		_this.caseGrid.grid.setLoading("ISPyB: Creating a new case");
		var adapter = new BiosaxsDataAdapter();
		adapter.onSuccess.attach(function(sender, shipment) {
			/** updateing shipment on proposal **/
			for ( var i = 0; i < BIOSAXS.proposal.shippings.length; i++) {
				if (BIOSAXS.proposal.shippings[i].shippingId == shipment.shippingId) {
					BIOSAXS.proposal.shippings[i] = shipment;
				}
			}
			_this.refresh(shipment);
		});
		adapter.onError.attach(function(sender, shipment) {
			_this.caseGrid.grid.setLoading(false);
		});
		adapter.addCase(_this.shipment.json.shippingId);
	});

	this.caseGrid.onRemoveButtonClicked.attach(function(sender, dewarId) {
		_this.panel.setLoading("ISPyB: removing case");
		_this.shipment.onSaved.attach(function(sender, shipment) {
			_this.refresh(shipment);

		});
		_this.shipment.removeCase(dewarId);
	});
}

ShipmentTabs.prototype.refresh = function(shipment) {

	var _this = this;
	this.shipment = shipment;
	var proposal = new Proposal();
	proposal.onDataRetrieved.attach(function(sender, plates) {

		_this.refreshWithPlates(shipment, plates);
		_this.caseGrid.grid.setLoading(false);
	});
	proposal.getPlatesByProposal();
};

ShipmentTabs.prototype.refreshWithPlates = function(shipment, plates) {
	this.shipment = new Shipment(shipment);

	this.caseGrid.refresh(this.shipment.getDewars(), plates);
	this.panel.setLoading(false);
};

ShipmentTabs.prototype.error = function(error) {
	var e = JSON.parse(error);
	showError(e);
	this.panel.setLoading(false);
};

//ShipmentTabs.prototype.refreshTabTitles = function() {
/*Ext.getCmp("MacromoleculeTab").setText(this.getMacromoleculeTitle());
Ext.getCmp("BufferTab").setText(this.getBuffersTitle());
Ext.getCmp("SpecimenTab").setText(this.getSpecimenTitle());
Ext.getCmp("PlatesTab").setText(this.getPlatesTitle());
Ext.getCmp("AssembliesTab").setText(this.getShipmentTitle());
Ext.getCmp("PlateGroupsTab").setText(this.getPlateGroupsTitle());*/
//};
ShipmentTabs.prototype.draw = function(shipment) {
	var _this = this;
	_this.plates = [];
	_this.shipment = shipment;
	_this.render(shipment);

	//	var proposal = new Proposal();
	//	proposal.onDataRetrieved.attach(function(sender, plates){
	//		_this.plates = plates;
	//		_this.shipment = shipment;
	//		_this.render(shipment);
	//		
	//	});
	//	proposal.getPlatesByProposal();
};

//ShipmentTabs.prototype.getShipmentTitle = function() {
//	return 'Shipment';
//};

//ShipmentTabs.prototype.getMacromoleculeTitle = function() {
//	return 'Macromolecules (' + this.experiment.getMacromolecules().length + ')';
//};

//ShipmentTabs.prototype.getBuffersTitle = function() {
//	return 'Buffers (' + this.experiment.getBuffers().length + ')';
//};

//ShipmentTabs.prototype.getPlateGroupsTitle = function() {
//	return 'Plate Groups (' + this.experiment.getPlateGroups().length + ')';
//};

//ShipmentTabs.prototype.getSampleChangerTitle = function() {
//	return 'Sample Changer';
//};

//ShipmentTabs.prototype.getSpecimenTitle = function() {
//	return 'Specimens(' + this.experiment.getSpecimenCount() + ')';
//};

//ShipmentTabs.prototype.getPlatesTitle = function() {
//	return 'Plates(' + this.experiment.getSamplePlates().length + ')';
//};

//ShipmentTabs.prototype.getBuffersTip = function() {
/*if (this.experiment.getBuffers().length == 0){
	return BUI.getWarningHTML("There are no buffers. Click on add to create new ones. Click on edit button or double click to edit them");
	
}
else{
	return BUI.getTipHTML("Click on edit button or double click to edit them. Click on duplicate to create an identical buffer including its additives")
}*/
//};

//ShipmentTabs.prototype.refreshTips = function() {
/*Ext.getCmp("BufferTabTip").update(this.getBuffersTip());
Ext.getCmp("SpecimenTabTip").update(this.getSpecimensTip());*/
//};

ShipmentTabs.prototype.render = function(shipment) {
	return this.getPanel(shipment);
};

ShipmentTabs.prototype.getShipmentHeader = function(shipment) {
	var _this = this;
	function getHTMLSource() {
		var name = shipment.json.shippingName;
		var status = shipment.json.shippingStatus;
		var creationDate = shipment.json.creationDate;
		var html = BUI.createFormLabel("Name :", name, 75, 400);
		html = html + BUI.createFormLabel("Status :", status, 75, 400);
		html = html + BUI.createFormLabel("Date :", creationDate, 75, 400);
		return html;
	}

	return Ext.create('Ext.container.Container', {
		frame : false,
		layout : 'hbox',
		title : 'General',
		padding : 5,
		bodyPadding : '5 5 0 0',
		width : 890,
		margin : '0 0 10 0',
		height : 100,
		style : {
			borderColor : '#BDBDBD',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		fieldDefaults : {
			msgTarget : 'side',
			labelWidth : 100
		},
		items : [ {
			margin : "0 0 0 0",
			width : 475,
			border : 0,
			html : getHTMLSource()
		}
		]
	});
};

ShipmentTabs.prototype.getTabPanel = function(shipment) {
	this.panel = Ext.createWidget('tabpanel', {
		height : 600,
		style : {
			padding : 2
		},
		items : [ {
			tabConfig : {
				id : 'Shipment',
				title : 'Shipment',
				icon : '/ispyb/images/plane-small.gif'
			},
			items : [ {
				xtype : 'container',
				margin : '5 5 5 5',
				items : [ this.shipmentForm.getPanel(shipment) ]
			} ]
		}, {
			tabConfig : {
				id : 'Cases',
				title : 'Cases',
				icon : '../images/box-icon-very-small.png'
			},
			items : [ {
				xtype : 'container',
				margin : '5 5 5 5',
				items : [ this.caseGrid.getPanel(shipment.getDewars(), this.plates) ]
			} ]
		} ]
	});
	return this.panel;
};

ShipmentTabs.prototype.getPanel = function(shipment) {
	var _this = this;
	this.shipment = shipment;
	if (this.plates == null) {
		this.plates = [];
	}

	if (this.shipPanel == null) {
		this.shipPanel = Ext.create('Ext.container.Container', {
			bodyPadding : 2,
			width : Ext.getBody().getViewSize().width * 0.9,
			renderTo : this.targetId,
			style : {
				padding : 2
			},
			items : [ this.getShipmentHeader(shipment), this.getTabPanel(shipment) ]
		});
	}

	return this.shipPanel;
};

/**
 * Shows an template with the specimens, measurements and the experiment's
 * requirement
 * 
 * @targetId
 */
function TemplateTabs(targetId) {
	this.height = 600;
	this.targetId = targetId;

	this.id = BUI.id();
	var _this = this;

	this.gridHeight = 1000;
	/** data * */
	this.experiment = null;

	this.specimenSelected = null;

	/** Specimen Widget contains a specimenGrid and a sampleChangerWidget than can be displayed with are vertical or horizontal layout **/
	this.specimenWidget = new SpecimenWidget({
		height : this.height
	});
	
	this.samplePlateGroupWidget = new SamplePlateGroupWidget({
		showTitle : false,
		height : 250,
		margin : 5,
		bbar : true
	});
	
	this.samplePlateGroupWidget.onExperimentChanged.attach(function(sender, experiment) {
		_this.refresh(experiment);
	});

	this.samplePlateGroupWidget.onClick.attach(function(sender, args) {
	});

	this.volumePlanificator = new VolumeGrid();

	/** For Measurements * */
	var storeViscosity = Ext.create('Ext.data.Store', {
		fields : [ 'name' ],
		data : [ {
			"name" : "low"
		}, {
			"name" : "medium"
		}, {
			"name" : "high"
		} ]
	});

	// Create the combo box, attached to the states data store
	var viscosityEditor = Ext.create('Ext.form.ComboBox', {
		fieldLabel : '',
		store : storeViscosity,
		queryMode : 'local',
		displayField : 'name',
		valueField : 'name'
	});

	this.measurementGrid = new MeasurementGrid({
		maxWidth : 1500,
		estimateTime : false,
		positionColumnsHidden : true,
		isPriorityColumnHidden : true,
		isStatusColumnHidden : true,
		isTimeColumnHidden : true,
		updateRowEnabled : true,
		collapsed : true,
		removeBtnEnabled : true,
		showTitle : false,
		collapseBtnEnable : false,
		addBtnMultipleEdit : true,
		sortingBtnEnable : true,
		editor : {
			exposureTemperature : {
				xtype : 'textfield',
				allowBlank : true
			},
			comments : {
				xtype : 'textfield',
				allowBlank : true
			},
			volumeToLoad : {
				xtype : 'numberfield',
				allowBlank : true
			},
			transmission : {
				xtype : 'numberfield',
				allowBlank : true
			},
			viscosity : viscosityEditor,
			waitTime : {
				xtype : 'numberfield',
				allowBlank : true
			},
			flow : {
				xtype : 'checkbox',
				allowBlank : true
			}
		}
	});

	this.measurementGrid.onSelected.attach(function(sender, measurements) {
		var specimens = [];
		for ( var i = 0; i < measurements.length; i++) {
			specimens.push(_this.experiment.getSampleById(measurements[i].specimenId));
		}
	});

	this.measurementGrid.onMeasurementChanged.attach(function(sender, measurement) {
		_this.experiment.setMeasurement(measurement);
		_this.refresh(_this.experiment);
	});

	this.measurementGrid.onExperimentChanged.attach(function(sender, json) {
		_this.refresh(new Experiment(json));
	});

	this.measurementGrid.onRemoved.attach(function(sender, experiment) {
		_this.refreshSpecimen(new Experiment(experiment));
	});

	this.measurementGrid.onUpdateTime.attach(function(sender, args) {
		document.getElementById(_this.id + "_counter").innerHTML = args.hours + 'h,  ' + args.minutes + 'min and ' + args.seconds + ' seconds';
	});
	
}

TemplateTabs.prototype.refreshMeasurement = function(experiment) {
	this.experiment = experiment;
	this.experiment.onSaved = new Event(this);
	this.experiment.onSpecimenSaved = new Event(this);
	var experimentList = new ExperimentList([ this.experiment ]);
	this.measurementGrid.refresh(experimentList.getMeasurementsNotCollected(), experimentList);
};

TemplateTabs.prototype.refreshSpecimen = function(experiment) {
	this.experiment = experiment;
	this.experiment.onSaved = new Event(this);
	this.experiment.onSpecimenSaved = new Event(this);
	this.samplePlateGroupWidget.refresh(this.experiment);
	this.specimenWidget.refresh(this.experiment);
	this.volumePlanificator.refresh(this.experiment);
};

TemplateTabs.prototype.refresh = function(experiment) {
	// var start = new Date().getTime();
	this.experiment = experiment;
	this.experiment.onSaved = new Event(this);
	this.experiment.onSpecimenSaved = new Event(this);

	// var experimentList = new ExperimentList([this.experiment]);
	this.refreshMeasurement(experiment);
	this.refreshSpecimen(experiment);
	/** Refreshing grids * */
	this.panel.setLoading(false);

};

TemplateTabs.prototype.error = function(error) {
	var e = JSON.parse(error);
	showError(e);
	this.panel.setLoading(false);

};

TemplateTabs.prototype.draw = function(experiment) {
	this.render(experiment);
};


TemplateTabs.prototype.getExperimentTitle = function() {
	var _this = this;
	var experimentHeaderForm = new ExperimentHeaderForm();
	return experimentHeaderForm.getPanel(this.experiment);
};

TemplateTabs.prototype.render = function(experiment) {
	var _this = this;
	this.experiment = experiment;

	/** 
	 * 
	 * Depending on the sample Changer configuration we want to display the plates vertically or horizontally 
	 * Default is vertical
	 * 
	 * */
	
	var specimenContainer = this.specimenWidget.getPanel();
	this.specimenWidget.refresh(experiment);
	
	var experimentList = new ExperimentList([ _this.experiment ]);
	var measurementContainer = Ext.create('Ext.container.Container', {
		layout : {
			type : 'vbox'
		},
		defaults : {
			style : {
				padding : '5px 0px 0px 10px'
			}
		},
		items : [ _this.measurementGrid.getPanel(experimentList.getMeasurementsNotCollected(), experimentList) ]
	});

	this.panel = Ext
			.createWidget(
					'tabpanel',
					{
						plain : true,
						items : [
							{
								tabConfig : {
									title : 'Measurements'
								},
								items : [ {
									xtype : 'container',
									layout : 'vbox',
									border : 1,
//									height : _this.gridHeight,
									margin : "0 0 10 0",
									items : [ measurementContainer ]
								}

								]
							},
							{
								tabConfig : {
									id : 'genralTabl',
									title : "Specimens"
								// width : 900,
								// border : 3

								},
								items : [ specimenContainer ]
							},
							{
								tabConfig : {
									title : "Requirements"

								},
								items : [
									{
										html : BUI.getTipHTML("Estimated volume is the maximum volume required. Depending on the order of your measurements you may use less. Click on create stock solutions if you plan to ship these stock solutions"),
										margin : "10 10 10 10",
										border : 0
									}, this.volumePlanificator.getPanel(experiment) ]
							} ]
					});
	// );
	return this.getPanel(this.panel);
};

TemplateTabs.prototype.isTemplate = function() {
	if (this.experiment.json.type == "TEMPLATE") {
		return true;
	}
	return false;
};


TemplateTabs.prototype.getPanel = function(panel) {
	var _this = this;
	if (this.experimentPanel == null) {
		this.experimentPanel = Ext.create('Ext.container.Container', {
			bodyPadding : 2,
			width : 1000,//Ext.getBody().getViewSize().width * 0.9,
			renderTo : this.targetId,
			height : 500,
//			style : {
//				padding : 2
//			},
			items : [ 
			          this.getExperimentTitle(), 
			          this.panel 
	        ],
			listeners : {
				afterrender : function(thisCmp) {
					$("#SchemeReport" + _this.experiment.experimentId).click(function() {
						$(this).target = "_blank";
						window.open('viewProjectList.do?reqCode=display&menu=platescheme&experimentId=' + _this.experiment.experimentId);
						return false;
					});

				}
			}
		});
	}
	return this.experimentPanel;
};

TemplateTabs.prototype.input = function(targetId) {
	return new ExperimentTabs().input();
};

TemplateTabs.prototype.test = function(targetId) {
	var experimentTabs = new TemplateTabs(targetId);
	BIOSAXS.proposal = new Proposal(experimentTabs.input().proposal);
	experimentTabs.draw(new Experiment(experimentTabs.input().experiment));
};

var BUI = {
	//interval : 60000,
		interval : 40000,
	rainbow : function(numOfSteps, step) {
		// This function generates vibrant, "evenly spaced" colours (i.e. no clustering). This is ideal for creating easily distinguishable vibrant markers in Google Maps and other apps.
		// Adam Cole, 2011-Sept-14
		// HSV to RBG adapted from: http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript
		var r, g, b;
		var h = step / numOfSteps;
		var i = ~~(h * 6);
		var f = h * 6 - i;
		var q = 1 - f;
		switch (i % 6) {
			case 0:
				r = 1, g = f, b = 0;
				break;
			case 1:
				r = q, g = 1, b = 0;
				break;
			case 2:
				r = 0, g = 1, b = f;
				break;
			case 3:
				r = 0, g = q, b = 1;
				break;
			case 4:
				r = f, g = 0, b = 1;
				break;
			case 5:
				r = 1, g = 0, b = q;
				break;
		}
		var c = "#" + ("00" + (~~(r * 255)).toString(16)).slice(-2) + ("00" + (~~(g * 255)).toString(16)).slice(-2)
				+ ("00" + (~~(b * 255)).toString(16)).slice(-2);
		return (c);
	},
	getFileNameByPath : function(filePath) {
		if (filePath != null){
			var split = filePath.split("/");
			if (split.length > 0){
				return split[split.length - 1];
			}
		}
		return "Not file";
	},
	getUpdateInterval : function() {
		this.interval = this.interval + 2000;
		return this.interval;
	},
	getRadiationDamageThreshold : function() {
		return 0.7;
	},
	getQualityThreshold : function() {
		return 0.7;
	},
	getCreateShipmentURL : function() {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=create_shipment';
	},
	getCreateShipmentList : function() {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=list_shipment';
	},
	getShippingURL : function(shippingId) {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=shipment&shippingId=' + shippingId;
	},

	getMacromoleculeResultsURLByMultipleSearch : function(array) {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=macromolecule&search='
				+ JSON.stringify(array).replace(new RegExp("\"", 'g'), "'");
	},
	getMacromoleculeResultsURL : function(macromoleculeId) {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=macromolecule&macromoleculeId=' + macromoleculeId;
	},
	getMacromoleculeBufferResultsURL : function(macromoleculeId, bufferId) {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=macromolecule&bufferId=' + bufferId + '&macromoleculeId=' + macromoleculeId;
	},

	getMacromoleculeHeader : function(macromoleculeId) {

		function getHTMLSource(macromoleculeId) {
			if (macromoleculeId != null) {
				var html = BUI.createFormLabel("Name :", BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).name, 75, 400);
				html = html + BUI.createFormLabel("Acronym :", BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).acronym, 75, 400);
				if (BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).comments != null) {
					html = html + BUI.createFormLabel("Comments :", BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).comments, 75, 400);
				}
				return html;
			}
		}

		return Ext.create('Ext.container.Container', {
			frame : false,
			layout : 'hbox',
			title : 'Macromolecule',
			bodyPadding : '5',
			width : 890,
			margin : '0 0 10 0',
			height : 100,
			style : {
				borderColor : '#BDBDBD',
				borderStyle : 'solid',
				borderWidth : '1px'
			},
			fieldDefaults : {
				msgTarget : 'side',
				labelWidth : 100
			},
			items : [ {
				margin : "10 0 0 10",
				width : 475,
				border : 0,
				html : getHTMLSource(macromoleculeId)
			}, {
				margin : "10 0 0 10",
				width : 475,
				border : 0,
				html : BUI.getZipHTMLByMacromoleculeId(macromoleculeId)
			}
			]
		});
	},

	getZipHTMLByMacromoleculeId : function(macromoleculeId) {
		if (macromoleculeId != null) {
			var fileName = BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).acronym;
			return "<div><a style='color:blue;' href='/ispyb/user/dataadapter.do?reqCode=getZipFileByMacromoleculeId&fileName=" + fileName
					+ "&macromoleculeId=" + macromoleculeId + "'><img src='../images/download.png' /> Download</a></div>";
		}
	},
	getZipHTMLByExperimentId : function(experimentId, filename) {
		if (filename == null){
			filename = "experiment";
		}
		return "<div><a style='color:blue;' href='/ispyb/user/dataadapter.do?reqCode=getZipFileByExperimentId&fileName=" + filename
				+ "&experimentId=" + experimentId + "'><img src='../images/download.png' /> Download</a></div>";
	},
	
	getZipURLByAverageId : function(averageId, filename) {
		if (filename == null){
			filename = "experiment";
		}
		return "/ispyb/user/dataadapter.do?reqCode=getZipFileByAverageListId&f&mergeIdsList=" + averageId + "&fileName=" + filename;
	},
	getZipURLBySubtractionId : function(subtractionId, filename) {
		if (filename == null){
			filename = "experiment";
		}
		return "/ispyb/user/dataadapter.do?reqCode=getZipFileByAverageListId&f&subtractionIdList=" + subtractionId + "&fileName=" + filename;
	},
	
	
	getZipHTMLByFrameRangeId : function(experimentId, start, end) {
		var fileName = "experiment";
		return "<div><a style='color:blue;' href='/ispyb/user/dataadapter.do?reqCode=getZipFileH5ByFramesRange&f&experimentId=" + experimentId + 
				"&start=" + Number(start) +"&end="+ Number(end)+"'><img src='../images/download.png' /> Download</a></div>";
	},
	getZipFrameHPLCUrl : function(experimentId, start, end) {
		return "/ispyb/user/dataadapter.do?reqCode=getZipFileH5ByFramesRange&f&experimentId=" + experimentId + "&start=" + Number(start) +"&end="+ Number(end);
	},
	
	getQueueUrl : function() {
		return "/ispyb/user/dataadapter.do?reqCode=getPagingCompactAnalysisByProposalId";
	},
	
	getQueueUrlByExperiment: function(experimentId) {
		return "/ispyb/user/dataadapter.do?reqCode=getPagingCompactAnalysisByExperimentId&f&experimentId=" + experimentId;
	},
	getStandardDeviation : function(values) {
		var sum = 0;
		var count = 0;
		var avg = null;

		var curatedValues = new Array();
		for ( var i = 0; i < values.length; i++) {
			var value = values[i];
			if (value != null) {
				if (!isNaN(value)) {
					count = count + 1;
					sum = sum + Number(value);
					curatedValues.push(Number(value));
				}
			}
		}

		if (count > 0) {
			avg = sum / count;
		} else {
			avg = sum;
		}
		var aux = 0;
		for ( var i = 0; i < curatedValues.length; i++) {
			var value = curatedValues[i];
			aux = aux + Math.pow(value - avg, 2);
		}
		/** std **/
		var std = Math.sqrt(aux / count);
		return {
			std : (std),
			sum : (sum),
			avg : (avg),
			validNumber : count,
			totalNumber : values.length,
			values : values
		};
	},
	
	getHTMLTableForFrameAveraged : function(bufferAcronym, macromoleculeAcronym, bbmerges, molmerges, bamerges, totalframes, bufferId,macromoleculeId, macromoleculeColor) {
		
		function getFrameSpan(framesMerged, total) {
			return "<td style='font:normal 9px tahoma,arial,verdana,sans-serif;color:" + "black" + "'>(" + framesMerged + " of " + total + ")</td>";
		}

		function getColorFrame(framesMerged, total) {
			if (framesMerged / total < 0.5) {
				return "#FA5858";
			}
			if ((framesMerged / total >= 0.5) && (framesMerged / total < 0.8)) {
				return "#FF9900";
			}
			return "white";
		}

		function getRow(color, acroynm, framesMerged, totalframes) {
			return 	"<tr style='background-color:" 
					+ getColorFrame(framesMerged, totalframes)
					+ ";height:12px;padding:1px;'><td style=' width:10px; height:10px;'> " 
					+ BUI.getRectangleColorDIV(color, 10, 10)
					+ "</td> <td style='padding:5px;'> " + acroynm + "</td>" 
					+ getFrameSpan(framesMerged, totalframes) + "</tr>";
		}

		var html = "<table style='margin: 1,1,1,1;width:100%;font:normal 10px tahoma,arial,verdana,sans-serif;'>";

		/** Buffer Before **/
		if (bufferAcronym != null) {
			if (bbmerges != null) {
				color = BIOSAXS.proposal.bufferColors[bufferId];
				html = html + getRow(color, bufferAcronym, bbmerges, totalframes);
			}
		}

		/** Molecule **/
		if (macromoleculeAcronym != null) {
			if (molmerges != null) {
				if (macromoleculeColor == null){
					color = BIOSAXS.proposal.macromoleculeColors[macromoleculeId];
				}
				else{
					color = macromoleculeColor; //BIOSAXS.proposal.macromoleculeColors[macromoleculeId];
				}
				html = html + getRow(color, macromoleculeAcronym, molmerges, totalframes);
			}
		}

		/** Buffer After **/
		if (bufferAcronym != null) {
			if (bamerges != null) {
				color = BIOSAXS.proposal.bufferColors[bufferId];
				html = html + getRow(color, bufferAcronym, bamerges, totalframes);
			}
		}
		return html + "</table>";
	},
	isWebGLEnabled : function(return_context) {
		if (!!window.WebGLRenderingContext) {
			var canvas = document.createElement("canvas");
			names = [ "webgl", "experimental-webgl", "moz-webgl", "webkit-3d" ];
			context = false;
			for ( var i = 0; i < 4; i++) {
				try {
					context = canvas.getContext(names[i]);
					if (context && typeof context.getParameter == "function") {
						// WebGL is enabled                    
						if (return_context) {
							// return WebGL object if the function's argument is present
							return {
								name : names[i],
								gl : context
							};
						}
						// else, return just true
						return true;
					}
				} catch (e) {
				}
			}
			// WebGL is supported, but disabled
			return false;
		}
		// WebGL not supported28.    
		return false;
	},
	getHTMLTableForPrefixes : function(bufferBeforeaverageFilePath, averageFilePath, bufferAfterAverageFilePath) {

		function getRow(bufferBeforeaverageFilePath) {
			file = bufferBeforeaverageFilePath;
			try {
				file = bufferBeforeaverageFilePath.split("/")[bufferBeforeaverageFilePath.split("/").length - 1];
			} catch (e) {
				file = "NA";
			}
			return "<tr><td  style='height:12px;padding:5px;'>" + file + "</td></tr>";
		}
		var html = "<table style='margin: 1,1,1,1;width:100%;font:normal 10px tahoma,arial,verdana,sans-serif;'>";

		/** Buffer Before **/
		if (bufferBeforeaverageFilePath != null) {
			html = html + getRow(bufferBeforeaverageFilePath);
		}

		/** Molecule **/
		if (averageFilePath != null) {
			html = html + getRow(averageFilePath);
		}

		/** Buffer After **/
		if (bufferAfterAverageFilePath != null) {
			html = html + getRow(bufferAfterAverageFilePath);
		}
		return html + "</table>";
	},

	getBaseURL : function() {
		return '/ispyb/user/dataadapter.do';
	},

	getPrintcomponentURL : function(dewarId) {
		return '/ispyb/user/viewDewarAction.do?reqCode=generateLabels&dewarId=' + dewarId;

	},
	getPDBVisualizerURL : function(modelId, subtractionId, experimentId) {
		return '/ispyb/user/viewProjectList.do?reqCode=display&menu=PDBVisualizer&modelId=' + modelId + '&experimentId=' + experimentId
				+ '&subtractionId=' + subtractionId;
	},

	getURL : function() {
		return this.getBaseURL() + '?reqCode=getImage';

	},
	getAbinitioImageURL : function() {
		return this.getBaseURL() + '?reqCode=getAbinitioImage';
	},
	getNSDImageURL : function(modelListId) {
		return BUI.getAbinitioImageURL() + '&type=NSD&modelListId=' + modelListId;
	},
	getCHI2ImageURL : function(modelListId) {
		return BUI.getAbinitioImageURL() + '&type=CHI2&modelListId=' + modelListId;
	},
	getModelFile : function(type, modelId, format) {
		return this.getBaseURL() + '?reqCode=getModelFile' + "&type=" + type + "&modelId=" + modelId + "&format=" + format;
	},
	getPdbURL : function() {
		return this.getBaseURL() + '?reqCode=getPdbFiles';
	},
	getStvArray : function(value, error) {
		value = Number(value);
		error = Number(error);
		return [ value - error, value, value + error ];
	},
	getPointArrayForDygraph : function(x, y, error) {
		return [ x, BUI.getStvArray(y, error) ];
	},
	createDIV : function(text, width, className, backgroundColor) {
		var nameContainer = document.createElement("div");
		var nameSpan = document.createElement("span");
		if (className != null) {
			nameSpan.setAttribute("class", className);
		}
		if (backgroundColor != null) {
			nameSpan.setAttribute("style", "float:left;width:" + width + "px;height:18px;background-color:" + backgroundColor);
		} else {
			nameSpan.setAttribute("style", "float:left;width:" + width + "px;height:18px;");
		}
		nameSpan.appendChild(document.createTextNode(text));
		nameContainer.appendChild(nameSpan);
		return nameContainer;
	},

	createFormLabel : function(labelText, text, labelWidth, textWidth, backgroundColor) {
		var div = document.createElement("div");

		div.appendChild(BUI.createDIV(labelText, labelWidth, "bLabel", backgroundColor));
		div.appendChild(BUI.createDIV(text, textWidth, "btext", backgroundColor));
		return div.innerHTML;
	},

	createTextArea : function(labelText, text, labelWidth, rows, cols) {
		var div = document.createElement("div");
		div.appendChild(BUI.createDIV(labelText, labelWidth, "bLabel"));
		var textArea = document.createElement("textarea");
		textArea.setAttribute("rows", rows);
		textArea.setAttribute("cols", cols);
		textArea.appendChild(document.createTextNode(text));
		div.appendChild(textArea);
		return div.innerHTML;
	},

	showBetaWarning : function() {
		alert("ISPyB for Biosaxs version Beta has not this functionality enabled");
	},

	formatValuesErrorUnitsScientificFormat : function(val, error, unit, args) {
		var fontSize = 14;
		var decimals = 2;
		var errorFontSize = 10;
		/** line break **/
		var lineBreak = true;
		if (args != null) {
			if (args.fontSize != null) {
				fontSize = args.fontSize;
			}
			if (args.decimals != null) {
				decimals = args.decimals;
			}
			if (args.errorFontSize != null) {
				errorFontSize = args.errorFontSize;
			}
			if (args.lineBreak != null) {
				lineBreak = args.lineBreak;
			}

		}

		if (val == "") {
			return "";
		}
		if (error == null) {
			return "<span style='font-size:" + fontSize + "px'>" + Number(val).toFixed(decimals) + "</span>";
		}
		var html = "<span style='font-size:" + fontSize + "px'>" + Number(val).toFixed(decimals) + "<span style='font-size:" + errorFontSize
				+ "px;color:gray'>  " + unit + "</span></span>";
		if (lineBreak) {
			html = html + "<br/>";
		}
		return html + "<span style='font-size:" + errorFontSize + "px'> &#177; " + Number(Number(error).toFixed(3)).toExponential()
				+ "</span></span>";
	},

	formatValuesErrorUnits : function(val, error, unit, args) {
		var fontSize = 16;
		var decimals = 2;
		var errorFontSize = 10;
		/** line break **/
		var lineBreak = true;
		if (args != null) {
			if (args.fontSize != null) {
				fontSize = args.fontSize;
			}
			if (args.decimals != null) {
				decimals = args.decimals;
			}
			if (args.errorFontSize != null) {
				errorFontSize = args.errorFontSize;
			}
			if (args.lineBreak != null) {
				lineBreak = args.lineBreak;
			}

		}

		if (val == "") {
			return "";
		}
		if (error == null) {
			return "<span style='font-size:" + fontSize + "px'>" + Number(val).toFixed(decimals) + "</span>";
		}
		var html = "<span style='font-size:" + fontSize + "px'>" + Number(val).toFixed(decimals) + "<span style='font-size:" + errorFontSize
				+ "px;color:gray'>  " + unit + "</span></span>";
		if (lineBreak) {
			html = html + "<br/>";
		}
		return html + "<span style='font-size:" + errorFontSize + "px'> &#177; " + Number(Number(error).toFixed(8)).toExponential()
				+ "</span></span>";
	},

	formatValuesUnits : function(val, unit, args) {
		var fontSize = 12;
		var decimals = 2;
		var unitsFontSize = 10;
		if (args != null) {
			if (args.fontSize != null) {
				fontSize = args.fontSize;
			}
			if (args.decimals != null) {
				decimals = args.decimals;
			}
			if (args.unitsFontSize != null) {
				unitsFontSize = args.unitsFontSize;
			}

		}

		if (val === "") {
			return "";
		}
		if (unit == null) {
			return "<span style='font-size:" + fontSize + "px'>" + Number(val).toFixed(decimals) + "</span>";
		}
		return "<span style='font-size:" + fontSize + "px'>" + Number(val).toFixed(decimals) + " </span><span style='font-size:" + unitsFontSize
				+ "px;color:gray'>  " + unit + "</span></span>";
	},

	getGreenButton : function(text, args) {
		var width = 70;
		var height = 20;
		if (args != null) {
			if (args.width != null) {
				width = args.width;
			}
			if (args.height != null) {
				height = args.height;
			}
		}

		return '<input type="button" name="btn" style= "font-size:9px;width:' + width + 'px; height:' + height + 'px" class="btn-green" value="' + text + '"/>';
	},
//	getBlueButton : function(text, args) {
//			var width = 70;
//			var height = 20;
//			if (args != null) {
//				if (args.width != null) {
//					width = args.width;
//				}
//				if (args.height != null) {
//					height = args.height;
//				}
//			}
//
//			return '<input type="button" name="btn" style= "font-size:9px;width:' + width + 'px; height:' + height + 'px" class="btn-blue" value="' + text + '"/>';
//	},

	getBlueButton : function(text, args) {
		var width = 70;
		var height = 20;
		var href = null;
		if (args != null) {
			if (args.width != null) {
				width = args.width;
			}
			if (args.height != null) {
				height = args.height;
			}
			if (args.href != null) {
				href = args.href;
			}
		}
		if (href != null) {
			return '<a href=' + href + '><input type="button"  name="btn" style= "width:' + width + 'px; height:' + height
					+ 'px" class="btn-blue" value="' + text + '"></input></a>';
		} else {
			return '<input type="button" name="btn" style= "font-size:9px;width:' + width + 'px; height:' + height + 'px" class="btn-blue" value="' + text + '"/>';
//			return '<a><input type="button"  name="btn" style= "width:' + width + 'px; height:' + height + 'px" class="btn-blue" value="' + text
//					+ '"></input></a>';
		}
	},
	
	getSubmitGreenButton : function(text) {
		return '<input type="submit" type="button" name="btn" class="btn-green" value="' + text + '"/>';
	},

	getRedButton : function(text) {
		return '<input type="button"  name="btn" class="btn-red" value="' + text + '" />';

	},
	getRectangleColorDIV : function(color, height, width) {
		return '<div style="border: 1px solid gray;background-color: ' + color + '; height:' + height + 'px;width:' + width + 'px" ></div>';
	},

	openBufferWindow : function(bufferId) {
		var window = new BufferWindow();
		window.draw(tabs.experiment.getBufferById(bufferId), tabs.experiment);
	},

	/** Render for safety levels on grids **/
	safetyRenderer : function(val, y, specimen) {
		var color = val;
		if (val == "YELLOW") {
			color = "#E9AB17";
		}
		return '<span style="color:' + color + ';">' + val + '</span>';
	},

	getSampleColor : function() {
		return '#CB181D';
	},

	getLightSampleColor : function() {
		return '#FCBBA1';
	},

	getBufferColor : function() {
		return '#6A51A3';
	},
	getLightBufferColor : function() {
		return '#BCBDDC';
	},

	formatConcentration : function(val) {
		if (val != null) {
			return "<span style='font-size:16px'>" + Number(val).toFixed(2) + "</span><span style='font-size:9px'> mg/ml </span>";
		}
		return val;
	},

	formatVolume : function(sample, volume) {
		if (Number(sample.data.volumeToLoad) > Number(sample.data.volume)) {
			return "<span style='color:red;font-weight:bold;'>" + volume + "</span><span style='font-size:9;color:red;'> l</span>";
		}
		if (Number(sample.data.volumeToLoad) == Number(sample.data.volume)) {
			return "<span style='color:orange;font-weight:bold;'>" + volume + "</span><span style='font-size:9;color:orange;'> l</span>";
		}
		return "<span>" + volume + "</span><span style='font-size:9'> l</span>";
	},

	getProposal : function() {
		return new Proposal();
	},

	getSampleNameRenderer : function(val, y, record) {
		var sample = record.data;
		if (record.raw.macromolecule3VO == null) {
			return '<span style="color:blue;">' + sample.code + '</span>';
		} else {
			return '<span style="color:green;">' + sample.code + '</span>';
		}
	},

	getSafetyLevels : function() {
		var safetyLevels = new Array();
		safetyLevels.push({
			safetyLevelId : "",
			name : "UNKNOWN"
		});
		safetyLevels.push({
			safetyLevelId : 1,
			name : "GREEN"
		});
		safetyLevels.push({
			safetyLevelId : 2,
			name : "YELLOW"
		});
		safetyLevels.push({
			safetyLevelId : 3,
			name : "RED"
		});
		return safetyLevels;
	},

	getErrorColor : function() {
		return '#F6CED8';
	},
	getWarningColor : function() {
		return '#F5DA81';
	},
	getValidColor : function() {
		return '#E0F8E0';
	},
	getSamplePlateLetters : function() {
		return [ "A", "B", "C", "D", "E", "F", "G", "H" ];
	},
	getSamplePositionHTML : function(sample, experiment) {
		var plate = "";
		var row = "";
		var column = "";
		var rows = this.getSamplePlateLetters();
		if (sample.sampleplateposition3VO != null) {
			var samplePlate = experiment.getSamplePlateById(sample.sampleplateposition3VO.samplePlateId);
			if (samplePlate != null) {
				plate = (samplePlate.slotPositionColumn);
				row = (sample.sampleplateposition3VO.rowNumber);
				column = (sample.sampleplateposition3VO.columnNumber);
				//				   var html = "<span style='font-weight:italic'>Plate: </span>" + "<span style='font-weight:bold'>" + plate + "</span>";
				//				   html = html +  "<span style='font-weight:italic'>, Row: </span>" + "<span style='font-weight:bold'>" +  rows[row - 1] + "</span>";
				//				   html = html +  "<span style='font-weight:italic'>, Column: </span>" + "<span style='font-weight:bold'>" + column + "</span>";
				var html = "<span style='font-weight:italic'>Plate: </span><span style='font-weight:bold'>" + plate
						+ "</span>-<span style='font-weight:bold'>" + rows[row - 1] + "</span><span style='font-weight:bold'>" + column + "</span>";
				return html;
			}
		}
		return "";
	},

	getSafetyLabelName : function(safetyLevelId) {
		var safetyLevels = BUI.getSafetyLevels();
		for ( var i = 0; i < safetyLevels.length; i++) {
			if (safetyLevels[i].safetyLevelId == safetyLevelId) {
				return safetyLevels[i].name;
			}
		}
		return "UNKNOWN";
	},
	/** generate random id **/
	id : function() {
		var text = "";
		var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

		for ( var i = 0; i < 5; i++)
			text += possible.charAt(Math.floor(Math.random() * possible.length));

		return text;
	},
	showWarning : function(message) {
		Ext.Msg.show({
			title : 'Warning',
			msg : message,
			icon : Ext.Msg.WARNING,
			animEl : 'elId'
		});
	},
	showError : function(message) {
		Ext.Msg.show({
			title : 'Warning',
			msg : message,
			icon : Ext.Msg.ERROR,
			animEl : 'elId'
		});
	},
	getTipHTML : function(message) {
		//return "<div  class='panelMacro' ><table class='tipMacro'><colgroup span='1'><col span='1' width='24'><col span='1'></colgroup><tbody><tr><td colspan='1' rowspan='1' valign='top'><img align='middle' src='https://cwiki.apache.org/confluence/images/emoticons/check.gif' width='16' height='16' alt='' border='0'></td><td colspan='1' rowspan='1'><b>Tip</b><br clear='none'>"
		//		+ message + "</td></tr></tbody></table></div>";
		return "<div  class='panelMacro' ><table class='tipMacro'><colgroup span='1'><col span='1' width='24'><col span='1'></colgroup><tbody><tr><td colspan='1' rowspan='1' valign='top'></td><td colspan='1' rowspan='1'><b>Tip</b><br clear='none'>"
		+ message + "</td></tr></tbody></table></div>";
	},

	getWarningHTML : function(message) {
		return "<div class='panelMacro' ><table class='warningMacro'><colgroup span='1'><col span='1' width='24'><col span='1'></colgroup><tbody><tr><td colspan='1' rowspan='1' valign='top'></td><td colspan='1' rowspan='1'><b>Warning</b><br clear='none'>"
				+ message + "</td></tr></tbody></table></div>";
	},

	getErrorHTML : function(message) {
		return "<div class='panelMacro' ><table class='errorMacro'><colgroup span='1'><col span='1' width='24'><col span='1'></colgroup><tbody><tr><td colspan='1' rowspan='1' valign='top'><img align='middle' src='https://cwiki.apache.org/confluence/images/emoticons/forbidden.gif' width='16' height='16' alt='' border='0'></td><td colspan='1' rowspan='1'><b>Error</b><br clear='none'>"
				+ message + "</td></tr></tbody></table></div>";
	},

	getProgessBar : function(percentage, text) {
		/** percentage 100% green **/
		var color = "#0a0";

		color = "#99CC00";
		if (percentage > 100) {
			color = "yellow";
			percentage = 100;
		}
		if (isNaN(percentage)) {
			color = "white";
			percentage = 0;
		}

		var defaultText = percentage + "%";
		if (text != null) {
			defaultText = text;
		}

		return "<div class='meter-wrap'><div class='meter-value' style='background-color: " + color + " ; width: " + percentage
				+ "%;'><div class='meter-text'>" + defaultText + "</div></div></div>";
	},
	getFileName : function(filePath){
		if (filePath != null){
			return filePath.split("/")[filePath.split("/").length - 1]
		}
		return "";
	}

};

Ext.ux.form.RequiredCombo = Ext.extend(Ext.form.ComboBox, {
	config : {
		cls : 'custom-field-text-required'
	},
	initComponent : function() {
		Ext.ux.form.RequiredCombo.superclass.initComponent.apply(this, arguments);
	},
	checkChange : function() {
		if ((this.getValue() == null) || String(this.getValue()).length == 0) {
			this.addCls('custom-field-text-required');
		} else {
			this.removeCls('custom-field-text-required');
		}
	}
});

Ext.define('Ext.form.field.RequiredNumber', {
	extend : 'Ext.form.field.Number',
	alias : 'widget.requirednumberfield',
	alternateClassName : [ 'Ext.form.RequiredNumberField', 'Ext.form.RequiredNumber' ],
	config : {
		cls : 'custom-field-text-required'
	},

	initComponent : function() {
		var me = this;
		me.callParent();
		me.setMinValue(me.minValue);
		me.setMaxValue(me.maxValue);
	},

	onChange : function() {
		if ((this.getValue() == null) || String(this.getValue()).length == 0) {
			this.addCls('custom-field-text-required');
		} else {
			this.removeCls('custom-field-text-required');
		}
		this.toggleSpinners();
		this.callParent(arguments);
	}
});

Ext.define('Ext.form.field.RequiredText', {
	extend : 'Ext.form.field.Text',
	alias : 'widget.requiredtext',
	requires : [ 'Ext.form.field.VTypes', 'Ext.layout.component.field.Text' ],
	alternateClassName : [ 'Ext.form.RequiredTextField', 'Ext.form.RequiredText' ],
	config : {
		cls : 'custom-field-text-required'
	},
	initComponent : function() {
		var me = this;
		if (me.allowOnlyWhitespace === false) {
			me.allowBlank = false;
		}
		me.callParent();
		me.addEvents(
		/**
		 * @event autosize
		 * Fires when the **{@link #autoSize}** function is triggered and the field is resized according to the
		 * {@link #grow}/{@link #growMin}/{@link #growMax} configs as a result. This event provides a hook for the
		 * developer to apply additional logic at runtime to resize the field if needed.
		 * @param {Ext.form.field.Text} this This text field
		 * @param {Number} width The new field width
		 */
		'autosize',

		/**
		 * @event keydown
		 * Keydown input field event. This event only fires if **{@link #enableKeyEvents}** is set to true.
		 * @param {Ext.form.field.Text} this This text field
		 * @param {Ext.EventObject} e
		 */
		'keydown',
		/**
		 * @event keyup
		 * Keyup input field event. This event only fires if **{@link #enableKeyEvents}** is set to true.
		 * @param {Ext.form.field.Text} this This text field
		 * @param {Ext.EventObject} e
		 */
		'keyup',
		/**
		 * @event keypress
		 * Keypress input field event. This event only fires if **{@link #enableKeyEvents}** is set to true.
		 * @param {Ext.form.field.Text} this This text field
		 * @param {Ext.EventObject} e
		 */
		'keypress');
		me.addStateEvents('change');
		me.setGrowSizePolicy();
	},
	checkChange : function() {
		if ((this.getValue() == null) || String(this.getValue()).length == 0) {
			this.addCls('custom-field-text-required');
		} else {
			this.removeCls('custom-field-text-required');
		}
	}
});

var BIOSAXS_COMBOMANAGER = {

	getComboMacromoleculeByMacromolecules : function(macromolecules, args) {
		var labelWidth = 150;
		var margin = "0 0 5 0";
		var width = 300;

		if (args != null) {
			if (args.labelWidth != null) {
				labelWidth = args.labelWidth;
			}
			if (args.margin != null) {
				margin = args.margin;
			}
			if (args.width != null) {
				width = args.width;
			}
		}

		var store = Ext.create('Ext.data.Store', {
			fields : [ 'macromoleculeId', 'acronym' ],
			data : macromolecules,
			sorters : [ 'acronym' ]
		});

		return Ext.create('Ext.form.ComboBox', {
			fieldLabel : 'Macromolecules',
			labelWidth : labelWidth,
			width : width,
			margin : margin,
			store : store,
			editable: false,
			queryMode : 'local',
			displayField : 'acronym',
			valueField : 'macromoleculeId'
		});
	},
	getComboBuffers : function(buffers, args) {
		var labelWidth = 150;
		var margin = "0 0 5 0";
		var width = 300;
		var fieldLabel = 'Buffer';

		if (args != null) {
			if (args.labelWidth != null) {
				labelWidth = args.labelWidth;
			}
			if (args.margin != null) {
				margin = args.margin;
			}
			if (args.width != null) {
				width = args.width;
			}
			if (args.noLabel != null) {
				fieldLabel = null;
			}
		}

		var store = Ext.create('Ext.data.Store', {
			fields : [ 'bufferId', 'acronym' ],
			data : buffers,
			sorters : [ 'acronym' ]
		});

		return Ext.create('Ext.form.ComboBox', {
			fieldLabel : fieldLabel,
			labelWidth : labelWidth,
			width : width,
			margin : margin,
			editable: false,
			store : store,
			queryMode : 'local',
			displayField : 'acronym',
			valueField : 'bufferId'
		});
	},
	getComboSessions : function(sessions, args) {
		var labelWidth = 150;
		var margin = "0 0 5 0";
		var width = 300;

		if (args != null) {
			if (args.labelWidth != null) {
				labelWidth = args.labelWidth;
			}
			if (args.margin != null) {
				margin = args.margin;
			}
			if (args.width != null) {
				width = args.width;
			}
		}

		for ( var i = 0; i < sessions.length; i++) {
			sessions[i]["startDateFormatted"] = moment(sessions[i].startDate).format("MMM Do YY");
			sessions[i]["sorter"] = moment(sessions[i].startDate).format("YYYYMMDD");
		}

		var store = Ext.create('Ext.data.Store', {
			fields : [ 'sessionId', 'startDateFormatted', 'beamlineName', 'startDate', 'endDate', 'beamlineOperator' ],
			data : sessions,
			sorters : [ 'sorter' ]
		});

		return Ext.create('Ext.form.ComboBox', {
			fieldLabel : 'Sessions',
			labelWidth : labelWidth,
			width : width,
			margin : margin,
			store : store,
			queryMode : 'local',
			//		    	    displayField			: 'startDate',
			valueField : 'sessionId',
			// Template for the dropdown menu.
			// Note the use of "x-boundlist-item" class,
			// this is required to make the items selectable.
			tpl : Ext.create('Ext.XTemplate', '<tpl for=".">',
					'<div class="x-boundlist-item">{startDateFormatted}<span style="font-weight:bold"> {beamlineName}</span></div>', '</tpl>'),
			// template for the content inside text field
			displayTpl : Ext.create('Ext.XTemplate', '<tpl for=".">', '{startDateFormatted}', '</tpl>')

		});
	}
};

 function GenericWindow(args){
       this.title = "title";
       this.width = 700;
       this.height = 500;
       this.id = BUI.id();
       
       this.close = false;
       this.draggable = true;
       this.modal = true;
       
       if (args != null){
          if (args.actions != null){
             this.actions = args.actions;
          }
          if (args.form != null){
              this.form = args.form;
           }
          if (args.width != null){
              this.width = args.width;
           }
          if (args.modal != null){
              this.modal = args.modal;
           }
          
          if (args.height != null){
              this.height = args.height;
           }
          if (args.title != null){
              this.title = args.title;
           }
          if (args.form != null){
              this.form = args.form;
           }
          if (args.close != null){
              this.close = args.close;
           }
          if (args.draggable != null){
              this.draggable = args.draggable;
           }
          
       }
       /** Events **/
       this.onSaved = new Event(this);
 };
 
 

GenericWindow.prototype.getButtons = function() {
	var _this = this;
	
	if (this.close){
		return [ {
			text : 'Close',
			handler : function() {
				_this.panel.close();
			}
		} ];
	}
	else{
		return [ {
			text : 'Save',
			handler : function() {
				_this.save();
				
			}
		}, {
			text : 'Cancel',
			handler : function() {
				_this.panel.close();
			}
		} ];
	}
};

GenericWindow.prototype.save = function (){
	 alert("Method save of GenerciWindow class is abstract");
};

GenericWindow.prototype._postRender = function(data, experiment){
	
};


GenericWindow.prototype.draw = function (data, experiment){
	this._render(data, experiment);
};

GenericWindow.prototype.refresh = function(data, experiment){
	 this.data = data;
	 this.experiment = experiment;
	 this.form.refresh(data, experiment);
};

GenericWindow.prototype._render = function(data, experiment){
    this.data = data;
 	var _this = this;
	if (this.panel == null){
		this.panel  = Ext.create('Ext.Window', {
			id				: this.id,
			title 			: this.title,
			resizable		: true,
			constrain		: true,
			border			: 1,
			modal			: this.modal,
			frame			: false,
			draggable		: this.draggable,
			closable		: true,
			autoscroll		: true,
			layout			: { type: 'vbox',align: 'stretch'},
			width			: this.width,
            height			: this.form.height,
			buttonAlign		:'right',
			buttons			: this.getButtons(),
			items			: this.form.getPanel(data, experiment),
	 		listeners: {
	 						scope		: this,
	 						minimize	: function(){
	 										this.panel.hide();
	 						},
	 						destroy		: function(){
	 										delete this.panel;
	 						}
	    	}
		});
		this.panel.setLoading();
	}
	
	this.panel.show();
	this._postRender();
};
function CalendarWidget(args) {
	this.height = 740;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
	}

	this.onClick = new Event();
}

CalendarWidget.prototype.loadData = function(data) {
	this.events = [];

	for ( var i = 0; i < data.length; i++) {
		var date = moment(data[i].creationDate);
		var textColor = 'black';

		if (data[i].status == "FINISHED") {
			textColor = 'green';
		}
		if (data[i].status == "ABORTED") {
			textColor = 'red';
		}
		this.events.push({
			title : data[i].name,
			start : date.format("YYYY-MM-DD HH:mm:ss"),
			end : date.format("YYYY-MM-DD HH:mm:ss"),
			date : date,
			allDay : false,
			color : textColor,
			className : date.format("YYYY-MM-DD")
		});
	}

};

CalendarWidget.prototype.draw = function(targetId) {
	var _this = this;
	$('#' + targetId).fullCalendar({
		eventClick : function(calEvent, jsEvent, view) {
			_this.onClick.notify(calEvent.className[0]);

		},
		contentHeight : _this.height,
		header : {
			left : 'prev,next today',
			center : 'title',
			right : 'month,basicWeek,basicDay'
		},
		editable : false,
		events : this.events
	});

};

/**
 * It shows a table with the guinier and gnom data as well as passed and
 * discarded measurements
 * 
 * @height
 * @showBufferColumns
 */
function ConcentrationHTMLTableWidget(args) {
	this.id = BUI.id();

	this.showBufferColumns = true;

	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.showBufferColumns != null) {
			this.showBufferColumns = args.showBufferColumns;
		}
	}
}

ConcentrationHTMLTableWidget.prototype.refresh = function(parsedData) {
	document.getElementById(this.id).innerHTML = this.getPanel(parsedData);
};

ConcentrationHTMLTableWidget.prototype.getPanel = function(parsedData) {
	var html = "<div  style='overflow-y: auto;height:" + this.height + "px;'; id='" + this.id + "'>";
	html = html + "<table class='ver-minimalist'  style='width:880px;'>";

	/** Title * */
	html = html + "<tr>";
	html = html + "<th rowspan='2' >Concentration</th>";
	if (this.showBufferColumns) {
		html = html + "<th rowspan='2' >Buffer</th>";
	}
	html = html + "<th  colspan='2'>Measurements</th>";
	html = html + "<th  colspan='3'>Guinier</th>";
	html = html + "<th  colspan='3'>Gnom</th>";
	html = html + "</tr>";

	html = html + "<tr>";
	html = html + "<th>Passed</th>";
	html = html + "<th>Discarded</th>";
	html = html + "<th>Rg</th>";
	html = html + "<th>I0</th>";
	html = html + "<th>Quality</th>";
	html = html + "<th>Rg</th>";
	html = html + "<th>dMax</th>";
	html = html + "</tr>";

	parsedData.concentration.concentrations.sort(function(a, b) {
		return a.concentration - b.concentration;
	});
	/** Row * */
	for ( var i = 0; i < parsedData.concentration.concentrations.length; i++) {
		var row = parsedData[i];

		var tr = "<tr>";
		if (i % 2 == 1) {
			tr = "<tr class='ver-minimalist-odd'>";
		}
		var goodMeasurements = (parsedData.concentration.concentrations[i].frames.length - parsedData.concentration.concentrations[i].frames_warning);
		if (goodMeasurements == 0) {
			tr = "<tr class='ver-minimalist-error'>";
		}
		html = html + tr;
		html = html + "<td>" + parsedData.concentration.concentrations[i].concentration + "</td>";
		if (this.showBufferColumns) {
			html = html + "<td>" + parsedData.concentration.concentrations[i].bufferAcronym + "</td>";
		}
		html = html + "<td><span style='color:green;font-weight:bold;'>" + goodMeasurements + "</span> of " + parsedData.concentration.concentrations[i].frames.length + "</td>";
		html = html + "<td style='color:orange;font-weight:bold;'>" + parsedData.concentration.concentrations[i].frames_warning + "</td>";
		html = html + "<td>" + BUI.formatValuesErrorUnits(parsedData.concentration.concentrations[i].calculation.rgGuinier.avg, parsedData.concentration.concentrations[i].calculation.rgGuinier.std, "nm", {
			lineBreak : false
		}) + "</td>";
		html = html + "<td>" + BUI.formatValuesErrorUnits(parsedData.concentration.concentrations[i].calculation.i0Guinier.avg, parsedData.concentration.concentrations[i].calculation.i0Guinier.std, " ", {
			lineBreak : false
		}) + "</td>";
		html = html + "<td>" + BUI.formatValuesErrorUnits(parsedData.concentration.concentrations[i].calculation.quality.avg, parsedData.concentration.concentrations[i].calculation.quality.std, " ", {
			lineBreak : false
		}) + "</td>";
		html = html + "<td>" + BUI.formatValuesErrorUnits(parsedData.concentration.concentrations[i].calculation.rgGnom.avg, parsedData.concentration.concentrations[i].calculation.rgGnom.std, " ", {
			lineBreak : false
		}) + "</td>";
		html = html + "<td>" + BUI.formatValuesErrorUnits(parsedData.concentration.concentrations[i].calculation.dMax.avg, parsedData.concentration.concentrations[i].calculation.dMax.std, " ", {
			lineBreak : false
		}) + "</td>";
		html = html + "</tr>";
	}
	return html + "</table>";
};

ConcentrationHTMLTableWidget.prototype.input = function() {
	return {
		data : {
			"dataCollectionCount" : 4,
			"buffers" : [ {
				"bufferId" : "422"
			} ],
			"concentration" : {
				"concentrations" : [ {
					"concentration" : "7.17",
					"id" : "7.1699999999999999",
					"bufferId" : "422.00",
					"bufferAcronym" : "B1",
					"rgGuinier" : [ "5.12723" ],
					"frames" : [ {
						"total" : "0.515705406286",
						"bufferBeforeMeasurementId" : 15045,
						"sampleMergeId" : 8176,
						"averagedModelId" : null,
						"I0" : "183.457461646",
						"proposalCode" : "OPD",
						"averagedModel" : null,
						"bufferAfterMergeId" : 8177,
						"framesCount" : "10",
						"bufferBeforeMergeId" : 8175,
						"averageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_065_ave.dat",
						"bufferAfterMeasurementId" : 15048,
						"rgGuinier" : "5.12723",
						"subtractedFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_065_sub.dat",
						"firstPointUsed" : "17",
						"chi2RgFilePath" : null,
						"abInitioModelId" : null,
						"macromoleculeId" : 649,
						"code" : "_4.0_7.17",
						"transmission" : "100.0",
						"timeStart" : "2013-06-05 15:43:54.348723",
						"bufferAcronym" : "B1",
						"quality" : "0.853011",
						"shapeDeterminationModelId" : null,
						"expermientComments" : "[BsxCube] Generated from BsxCube",
						"bufferId" : 422,
						"isagregated" : "False",
						"dmax" : "25.63615",
						"bufferBeforeAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_064_ave.dat",
						"exposureTemperature" : "4.0",
						"subtractionId" : 3377,
						"conc" : "7.1699999999999999",
						"rapidShapeDeterminationModel" : null,
						"experimentCreationDate" : "Jun 5, 2013 3:30:30 PM",
						"lastPointUsed" : "36",
						"modelListId" : null,
						"framesMerge" : "9",
						"rapidShapeDeterminationModelId" : null,
						"bufferAfterAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_066_ave.dat",
						"nsdFilePath" : null,
						"bufferAfterFramesMerged" : "10",
						"experimentId" : 700,
						"macromoleculeAcronym" : "L9",
						"i0stdev" : "0.139364435146",
						"sampleMeasurementId" : 15047,
						"measurementComments" : "[5]",
						"priorityLevelId" : 10,
						"bufferBeforeFramesMerged" : "10",
						"substractionCreationTime" : "Jun 5, 2013 3:46:31 PM",
						"proposalNumber" : "29",
						"rgGnom" : "5.40297914939",
						"volume" : "475.302",
						"shapeDeterminationModel" : null,
						"comments" : null,
						"groupeField" : "L9 B1"
					} ],
					"frames_warning" : 0,
					"calculation" : {
						"rgGuinier" : {
							"std" : 0,
							"sum" : 5.12723,
							"avg" : 5.12723,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "5.12723" ]
						},
						"i0Guinier" : {
							"std" : 0,
							"sum" : 183.457461646,
							"avg" : 183.457461646,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "183.457461646" ]
						},
						"quality" : {
							"std" : 0,
							"sum" : 0.853011,
							"avg" : 0.853011,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "0.853011" ]
						},
						"rgGnom" : {
							"std" : 0,
							"sum" : 5.40297914939,
							"avg" : 5.40297914939,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "5.40297914939" ]
						},
						"dMax" : {
							"std" : 0,
							"sum" : 25.63615,
							"avg" : 25.63615,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "25.63615" ]
						}
					}
				}, {
					"concentration" : "3.53",
					"id" : "3.5299999999999998",
					"bufferId" : "422.00",
					"bufferAcronym" : "B1",
					"rgGuinier" : [ "4.38278" ],
					"frames" : [ {
						"total" : "0.497164741078",
						"bufferBeforeMeasurementId" : 15048,
						"sampleMergeId" : 8178,
						"averagedModelId" : null,
						"I0" : "160.023229462",
						"proposalCode" : "OPD",
						"averagedModel" : null,
						"bufferAfterMergeId" : 8179,
						"framesCount" : "10",
						"bufferBeforeMergeId" : 8177,
						"averageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_067_ave.dat",
						"bufferAfterMeasurementId" : 15051,
						"rgGuinier" : "4.38278",
						"subtractedFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_067_sub.dat",
						"firstPointUsed" : "36",
						"chi2RgFilePath" : null,
						"abInitioModelId" : null,
						"macromoleculeId" : 649,
						"code" : "_4.0_3.53",
						"transmission" : "100.0",
						"timeStart" : "2013-06-05 15:47:04.630129",
						"bufferAcronym" : "B1",
						"quality" : "0.742825",
						"shapeDeterminationModelId" : null,
						"expermientComments" : "[BsxCube] Generated from BsxCube",
						"bufferId" : 422,
						"isagregated" : "False",
						"dmax" : "15.33973",
						"bufferBeforeAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_066_ave.dat",
						"exposureTemperature" : "4.0",
						"subtractionId" : 3378,
						"conc" : "3.5299999999999998",
						"rapidShapeDeterminationModel" : null,
						"experimentCreationDate" : "Jun 5, 2013 3:30:30 PM",
						"lastPointUsed" : "61",
						"modelListId" : null,
						"framesMerge" : "10",
						"rapidShapeDeterminationModelId" : null,
						"bufferAfterAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_068_ave.dat",
						"nsdFilePath" : null,
						"bufferAfterFramesMerged" : "10",
						"experimentId" : 700,
						"macromoleculeAcronym" : "L9",
						"i0stdev" : "0.1499898017",
						"sampleMeasurementId" : 15050,
						"measurementComments" : "[6]",
						"priorityLevelId" : 12,
						"bufferBeforeFramesMerged" : "10",
						"substractionCreationTime" : "Jun 5, 2013 3:49:42 PM",
						"proposalNumber" : "29",
						"rgGnom" : "4.40615474861",
						"volume" : "372.656",
						"shapeDeterminationModel" : null,
						"comments" : null,
						"groupeField" : "L9 B1"
					} ],
					"frames_warning" : 0,
					"calculation" : {
						"rgGuinier" : {
							"std" : 0,
							"sum" : 4.38278,
							"avg" : 4.38278,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "4.38278" ]
						},
						"i0Guinier" : {
							"std" : 0,
							"sum" : 160.023229462,
							"avg" : 160.023229462,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "160.023229462" ]
						},
						"quality" : {
							"std" : 0,
							"sum" : 0.742825,
							"avg" : 0.742825,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "0.742825" ]
						},
						"rgGnom" : {
							"std" : 0,
							"sum" : 4.40615474861,
							"avg" : 4.40615474861,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "4.40615474861" ]
						},
						"dMax" : {
							"std" : 0,
							"sum" : 15.33973,
							"avg" : 15.33973,
							"validNumber" : 1,
							"totalNumber" : 1,
							"values" : [ "15.33973" ]
						}
					}
				}, {
					"concentration" : "1.75",
					"id" : "1.75",
					"bufferId" : "422.00",
					"bufferAcronym" : "B1",
					"rgGuinier" : [],
					"frames" : [ {
						"total" : "0.5538035065",
						"bufferBeforeMeasurementId" : 15051,
						"sampleMergeId" : 8180,
						"averagedModelId" : null,
						"I0" : "146.927428571",
						"proposalCode" : "OPD",
						"averagedModel" : null,
						"bufferAfterMergeId" : 8181,
						"framesCount" : "10",
						"bufferBeforeMergeId" : 8179,
						"averageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_069_ave.dat",
						"bufferAfterMeasurementId" : 15054,
						"rgGuinier" : "4.27139",
						"subtractedFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_069_sub.dat",
						"firstPointUsed" : "33",
						"chi2RgFilePath" : null,
						"abInitioModelId" : null,
						"macromoleculeId" : 649,
						"code" : "_4.0_1.75",
						"transmission" : "100.0",
						"timeStart" : "2013-06-05 15:50:09.395824",
						"bufferAcronym" : "B1",
						"quality" : "0.765999",
						"shapeDeterminationModelId" : null,
						"expermientComments" : "[BsxCube] Generated from BsxCube",
						"bufferId" : 422,
						"isagregated" : "False",
						"dmax" : "14.949865",
						"bufferBeforeAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_068_ave.dat",
						"exposureTemperature" : "4.0",
						"subtractionId" : 3379,
						"conc" : "1.75",
						"rapidShapeDeterminationModel" : null,
						"experimentCreationDate" : "Jun 5, 2013 3:30:30 PM",
						"lastPointUsed" : "62",
						"modelListId" : null,
						"framesMerge" : "6",
						"rapidShapeDeterminationModelId" : null,
						"bufferAfterAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_070_ave.dat",
						"nsdFilePath" : null,
						"bufferAfterFramesMerged" : "10",
						"experimentId" : 700,
						"macromoleculeAcronym" : "L9",
						"i0stdev" : "0.191914285714",
						"sampleMeasurementId" : 15053,
						"measurementComments" : "[7]",
						"priorityLevelId" : 14,
						"bufferBeforeFramesMerged" : "10",
						"substractionCreationTime" : "Jun 5, 2013 3:52:31 PM",
						"proposalNumber" : "29",
						"rgGnom" : "4.28379338749",
						"volume" : "356.326",
						"shapeDeterminationModel" : null,
						"comments" : null,
						"groupeField" : "L9 B1"
					} ],
					"frames_warning" : 1,
					"calculation" : {
						"rgGuinier" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"i0Guinier" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"quality" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"rgGnom" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"dMax" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						}
					}
				}, {
					"concentration" : "0.91",
					"id" : "0.91000000000000003",
					"bufferId" : "422.00",
					"bufferAcronym" : "B1",
					"rgGuinier" : [],
					"frames" : [ {
						"total" : null,
						"bufferBeforeMeasurementId" : 15054,
						"sampleMergeId" : 8182,
						"averagedModelId" : null,
						"I0" : "0.0",
						"proposalCode" : "OPD",
						"averagedModel" : null,
						"bufferAfterMergeId" : 8183,
						"framesCount" : "10",
						"bufferBeforeMergeId" : 8181,
						"averageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_071_ave.dat",
						"bufferAfterMeasurementId" : 15057,
						"rgGuinier" : null,
						"subtractedFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_071_sub.dat",
						"firstPointUsed" : "0",
						"chi2RgFilePath" : null,
						"abInitioModelId" : null,
						"macromoleculeId" : 649,
						"code" : "_4.0_.91",
						"transmission" : "100.0",
						"timeStart" : "2013-06-05 15:52:58.133705",
						"bufferAcronym" : "B1",
						"quality" : "0.0",
						"shapeDeterminationModelId" : null,
						"expermientComments" : "[BsxCube] Generated from BsxCube",
						"bufferId" : 422,
						"isagregated" : "False",
						"dmax" : null,
						"bufferBeforeAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_070_ave.dat",
						"exposureTemperature" : "4.0",
						"subtractionId" : 3380,
						"conc" : "0.91000000000000003",
						"rapidShapeDeterminationModel" : null,
						"experimentCreationDate" : "Jun 5, 2013 3:30:30 PM",
						"lastPointUsed" : "0",
						"modelListId" : null,
						"framesMerge" : "10",
						"rapidShapeDeterminationModelId" : null,
						"bufferAfterAverageFilePath" : " /data/pyarch/bm29/opd29/700/1d/data_072_ave.dat",
						"nsdFilePath" : null,
						"bufferAfterFramesMerged" : "10",
						"experimentId" : 700,
						"macromoleculeAcronym" : "L9",
						"i0stdev" : "0.0",
						"sampleMeasurementId" : 15056,
						"measurementComments" : "[8]",
						"priorityLevelId" : 16,
						"bufferBeforeFramesMerged" : "10",
						"substractionCreationTime" : "Jun 5, 2013 3:55:35 PM",
						"proposalNumber" : "29",
						"rgGnom" : null,
						"volume" : null,
						"shapeDeterminationModel" : null,
						"comments" : null,
						"groupeField" : "L9 B1"
					} ],
					"frames_warning" : 1,
					"calculation" : {
						"rgGuinier" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"i0Guinier" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"quality" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"rgGnom" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						},
						"dMax" : {
							"std" : null,
							"sum" : 0,
							"avg" : 0,
							"validNumber" : 0,
							"totalNumber" : 0,
							"values" : []
						}
					}
				} ]
			},
			"concentrationLabel" : "7.17 mg/ml ,3.53 mg/ml ,1.75 mg/ml ,0.91 mg/ml "
		}
	};
};

ConcentrationHTMLTableWidget.prototype.test = function(targetId) {
	var concentrationHTMLTableWidget = new ConcentrationHTMLTableWidget();
	document.getElementById(targetId).innerHTML = concentrationHTMLTableWidget.getPanel(concentrationHTMLTableWidget.input().data);
};

function DataCollectionWidget() {

};

DataCollectionWidget.prototype.refresh = function(subtractionId) {

};

DataCollectionWidget.prototype.getMacromolecule = function(data) {
	for (var i = 0; i < data.length; i++) {
		if (data[i].macromoleculeId != null) {
			return BIOSAXS.proposal.getMacromoleculeById(data[i].macromoleculeId);
		}
	}
	return null;
};

DataCollectionWidget.prototype.getMacromoleculeContainer = function(data) {
	var macromolecule = this.getMacromolecule(data);

	var disabled = false;
	if (macromolecule == null) {
		disabled = true;
	}

	var acronym = (macromolecule == null ? "" : macromolecule.acronym);
	var mm = (macromolecule == null ? "" : macromolecule.molecularMass);
	var comments = (macromolecule == null ? "" : macromolecule.comments);

	return Ext.create('Ext.Panel', {
		width : 500,
		height : 200,
		disabled : disabled,
		title : "Macromolecule",
		layout : 'form',
		bodyPadding : 5,
		defaultType : 'textfield',
		tbar : {
			defaultButtonUI : 'default',
			items : [ {
				xtype : 'button',
				text : 'Edit',
				cls : 'btn-with-border',
				handler : function() {
					var macromoleculeWindow = new MacromoleculeWindow();
					macromoleculeWindow.draw(macromolecule);
					/** TODO: update when save **/
				}
			} ]
		},
		items : [ {
			fieldLabel : 'Acronym',
			name : 'first',
			readOnly : true,
			value : acronym
		}, {
			fieldLabel : 'Molecular Mass',
			name : 'last',
			readOnly : true,
			value : mm
		}, {
			xtype : 'textareafield',
			fieldLabel : 'Comments',
			value : '',
			name : 'last',
			readOnly : true,
			value : comments
		} ]
	});
};

DataCollectionWidget.prototype.getBufferContainer = function(data) {
	var _this = this;
	var buffer = BIOSAXS.proposal.getBufferById(data[0].bufferId);

	return Ext.create('Ext.Panel', {
		width : 500,
		height : 200,
		title : "Buffer",
		layout : 'form',
		//	    collapsed : true,
		//	    collapsible : true,
		bodyPadding : 5,
		defaultType : 'textfield',
		style : {
			padding : '0px 0px 0px 2px'
		},
		tbar : {
			defaultButtonUI : 'default',
			items : [ {
				xtype : 'button',
				text : 'Edit',
				cls : 'btn-with-border',
				handler : function() {
					var bufferWindow = new BufferWindow();
					bufferWindow.draw(BIOSAXS.proposal.getBufferById(data[0].bufferId));
					/** TODO: update when save **/
				}

			} ]
		},
		items : [ {
			fieldLabel : 'Buffer',
			name : 'acronym',
			readOnly : true,
			value : buffer.acronym
		}, {
			fieldLabel : 'Composition',
			name : 'last',
			readOnly : true,
			value : buffer.composition
		}, {
			xtype : 'textareafield',
			fieldLabel : 'Comments',
			value : buffer.comments,
			name : 'last',
			readOnly : true

		} ]
	});
};

DataCollectionWidget.prototype.getSpecimenContainer = function(data) {
	return Ext.create('Ext.container.Container', {
		layout : {
			type : 'hbox'
		},
		style : {
			margin : '10px 10px 10px 10px'
		},
		border : 0,
		style : {
			borderColor : '#000000',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		defaults : {
			labelWidth : 80,
			// implicitly create Container by specifying xtype
			xtype : 'datefield',
			flex : 1,

		},
		items : [ this.getMacromoleculeContainer(data), this.getBufferContainer(data) ]
	});
};

DataCollectionWidget.prototype.getSeparator = function() {
	return {
		html : "<br/>",
		border : 0
	}
};

DataCollectionWidget.prototype.getFitStructurePanel = function(data) {
	var _this = this;

	return Ext.create('Ext.container.Container', {
		layout : {
			type : 'hbox'
		},
		style : {
			margin : '10px 10px 10px 10px'
		},
		border : 0,
		style : {
			borderColor : '#000000',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		defaults : {
			labelWidth : 80,
			xtype : 'datefield',
			flex : 1
		},
		items : [

		]
	});
};

DataCollectionWidget.prototype.getFitStructurePanelWorkflow = function(data) {
	var _this = this;
	var macromolecule = this.getMacromolecule(data);

	var items = [];

	/** Adding all the pdb files linked to the macromolecule **/
	//	if (macromolecule.structure3VOs != null) {
	//		if (macromolecule.structure3VOs.length > 0) {
	//			
	//			items.push();
	//		}
	//	} else {
	//		items.push({
	//			html : "No apriori information added to this macromolecule. Apriori information needed for further analysis",
	//			margin : "5 5 5 5"
	//		});
	//	}
	var fitStructureToExperimentDataGrid = new FitStructureToExperimentDataGrid();

	fitStructureToExperimentDataGrid.refresh(_this.data[0].subtractionId, _this.getMacromolecule(data));
	return Ext.create('Ext.container.Container', {
		style : {
			margin : '10px 10px 10px 10px'
		},
		border : 0,

		style : {
			borderColor : '#000000',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		defaults : {
			labelWidth : 80,
			xtype : 'datefield',
			flex : 1
		},
		items : [ fitStructureToExperimentDataGrid.getPanel() ],
		listeners : {
			afterrender : function() {
			}
		}
	});
};
/** Static method **/
DataCollectionWidget.prototype.RUNFitScattering = function(subtractionId, structureId) {
	var _this = this;
	/** Add to Workflow **/
	var adapter = new BiosaxsDataAdapter();
	var workflow = {
		'workflowTitle' : 'FitExperimentalDatatoStructure',
		'comments' : 'FitExperimentalDatatoStructure run from ISPyB for subtractionId: ' + subtractionId + ' and structureId ' + structureId
	}

	var inputs = [ {
		name : 'subtractionId',
		value : subtractionId
	}, {
		name : 'structureId',
		value : structureId
	} ];

	adapter.onSuccess.attach(function(sender, data) {
		/** Add to Fit **/
		var adapter2 = new BiosaxsDataAdapter();
		var fit = {
			'workflowId' : data.workflowId,
			'subtractionId' : subtractionId,
			'structureId' : structureId,
			'comments' : 'Sent to workflow engine'
		}
		adapter2.onSuccess.attach(function(sender, fit) {

		});
		adapter2.addFitStructureData(fit);

	});
	adapter.addWorkflow(workflow, inputs);

};

DataCollectionWidget.prototype.getSuperpositionTab = function(data) {
	var _this = this;

	this.superpositionGrid = new SuperpositionGrid();

	return Ext.create('Ext.container.Container', {
		style : {
			margin : '10px 10px 10px 10px'
		},
		border : 0,
		style : {
			borderColor : '#000000',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		items : [ _this.superpositionGrid.getPanel() ],
		listeners : {
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

			},
			afterrender : function() {
				/** Getting Rigid bodies **/
				var adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, result) {
					_this.superpositionGrid.refresh(result);
				});
				adapter.getSuperpositionBySubtractionId(data[1].subtractionId);
			}
		}
	});
};

DataCollectionWidget.prototype.getAdvancedTab = function(data) {
	var _this = this;
	return Ext.create('Ext.container.Container', {
		style : {
			margin : '10px 10px 10px 10px'
		},
		border : 0,
		style : {
			borderColor : '#000000',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		items : [ _this.getFitStructurePanel(data), _this.getFitStructurePanelWorkflow(data) ]
	});
};

DataCollectionWidget.prototype.getRigiBodyForm = function(data) {
	var _this = this;
	_this.rigiBodyGrid = new RigidModelGrid();
	return _this.rigiBodyGrid.getPanel();

};

DataCollectionWidget.prototype.getRigidBodyModelingTab = function(data) {
	var _this = this;
	return Ext.create('Ext.container.Container', {
		style : {
			margin : '10px 10px 10px 10px'
		},
		border : 0,
		style : {
			borderColor : '#000000',
			borderStyle : 'solid',
			borderWidth : '1px'
		},
		items : [ _this.getRigiBodyForm(data) ],
		listeners : {
			cellclick : function(grid, td, cellIndex, record, tr, rowIndex, e, eOpts) {

			},
			afterrender : function() {
				/** Getting Rigid bodies **/
				var adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, result) {
					_this.rigiBodyGrid.refresh(result);
				});
				adapter.getRigidBodyModelingBySubtractionId(data[1].subtractionId);
			}
		}
	});
};

DataCollectionWidget.prototype.getTabs = function(data) {
	var _this = this;

	this.subtractionCurveVisualizer = new SubtractionCurveVisualizer();

	this.tabs = Ext.createWidget('tabpanel', {
		activeTab : 1,
		plain : true,
		defaults : {
			autoScroll : true,
			bodyPadding : 10
		},
		items : [ {
			title : 'Solution',
			items : [ _this.getSpecimenContainer(data) ]
		}, {
			title : 'Primary Data Reduction',
			active : true,
			tabConfig : {
				xtype : 'tab',
				margins : '0 0 0 20',
			},
			items : [ _this.subtractionCurveVisualizer.getPanel() ]
		}, {
			title : 'Abinitio',
			items : [ _this.getAbinitioModellingContainer(data), _this.getSeparator(), _this.getModelViz(data) ]
		}, {
			title : 'Mixtures',
			items : [ _this.getAdvancedTab(data) ]
		}, {
			title : 'Superpositions',
			items : [ _this.getSuperpositionTab(data) ]
		}, {
			title : 'Rigid Body Modeling',
			items : [ _this.getRigidBodyModelingTab(data) ]
		} ]
	});
	return this.tabs;
};

DataCollectionWidget.prototype.getPanel = function(data) {
	var _this = this;
	_this.data = data;
	this.panel = Ext.create('Ext.container.Container', {
		width : 1000,
		layout : {
			type : 'vbox',
			align : 'stretch',
			padding : 5
		},
		items : [ _this.getTabs(data)

		]
	});

	this.panel.on("afterrender", function() {
		_this.subtractionCurveVisualizer.refresh([ _this.data[1].mergeId ], [ _this.data[1].subtractionId ]);
	});
	return this.panel;
};

DataCollectionWidget.prototype.getModelViz = function(data) {
	this.modelViz = new ModelVisualizerForm({
		height : 800,
		width : 1000
	});
	return this.modelViz.getPanel();
};

/**
 * PRIMARY DATA PROCESSING
 */
DataCollectionWidget.prototype.getPrimaryDataProcessingContainer = function(data) {
	var _this = this;
	this.primaryDataProcessingGrid = new PrimaryDataProcessingGrid({
		height : 250,
		width : 1000,
		title : 'Primary Data Processing'
	});

	this.primaryDataProcessingGrid.onSelected.attach(function(sender, selected) {
		/** Refresh tabs **/
		var averagesId = [];
		var subtractionIds = [];

		var subtractionKeys = {};
		for (var i = 0; i < selected.length; i++) {
			if (selected[i].mergeId != null) {
				averagesId.push(selected[i].mergeId);
			}

			if (selected[i].subtractionId != null) {
				if (selected[i].macromoleculeId != null) {
					if (subtractionKeys[selected[i].subtractionId] == null) {
						subtractionIds.push(selected[i].subtractionId);
					}
					subtractionKeys[selected[i].subtractionId] = true;
				}
			}
		}

		/** Refreshing Primary Data Reduction **/
		_this.subtractionCurveVisualizer.refresh(averagesId, subtractionIds);

	});
	return this.primaryDataProcessingGrid.getPanel(data);
};
/**
 * getAbinitioModellingContainer
 */
DataCollectionWidget.prototype.getAbinitioModellingContainer = function(data) {
	var _this = this;

	this.abinitioGrid = new AbinitioGrid();
	this.abinitioGrid.onSelected.attach(function(sender, models) {
		_this.modelViz.refresh(models);

	});
	/** It may be abinitio models linked to the buffers **/
	var abinitioIdList = [];
	for (var i = 0; i < data.length; i++) {
		abinitioIdList.push(data[i].abInitioId);
	}

	var uniqueIds = [];
	$.each(abinitioIdList, function(i, el) {
		if ($.inArray(el, uniqueIds) === -1)
			uniqueIds.push(el);
	});

	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, data) {
		_this.abinitioGrid.refresh(data);
	});
	adapter.getAbinitioByIdsList(uniqueIds);
	return this.abinitioGrid.getPanel([]);
};

/**
 * Edit the information of a buffer
 * 
 * #onSaved 
 * #onRemoveAdditive
 * 
 */
function FitStructureToDataWidget(args) {
	this.id = BUI.id();
	this.width = 875;
	this.height = 565;
}

FitStructureToDataWidget.prototype.getPlotContainerDimensions = function() {
	return {
		width : this.width*2/3 - 4,
		height : this.height - 8
	};
};

FitStructureToDataWidget.prototype.getPlotId = function() {
	return this.id + "plot";
};

FitStructureToDataWidget.prototype.getTextAreaHeight = function() {
	return 200;
};

FitStructureToDataWidget.prototype.getPlotContainer = function() {
	var _this = this;
	
	var textAreaHeight = this.getTextAreaHeight();
	var width = this.getPlotContainerDimensions().width;
	var height = this.getPlotContainerDimensions().height;
	
	function getHTML(){
		var style= "width:" + (width  - 5) + "px;height:" + (height - textAreaHeight - 8) +  "px;";
		return "<div id='"+ _this.getPlotId() +"' style='" + style + "'></div>";
	}
	this.plot =  Ext.create('Ext.panel.Panel', {
		margin : "2 2 2 2",
		layout : 'hbox',
		width : _this.width,
		height : (height - textAreaHeight - 6),
		border : 0,
		items : [
		         {
		        	 html : getHTML()
		         },
		         this.getSummaryContainer()
		       
		],
		listeners : {
			afterrender : function() {
			}
		}
	});
	return this.plot;
};



FitStructureToDataWidget.prototype.getSecondaryContainerDimensions = function() {
	return {
		width  : this.width/3 - 16,
		height : (this.height - 8) / 2
		
	}
};


FitStructureToDataWidget.prototype.getPdbId = function() {
	return this.id + "pdb";
};


FitStructureToDataWidget.prototype.getPdbContainer = function() {
	var width = this.getSecondaryContainerDimensions().width;
	var height = this.getSecondaryContainerDimensions().height;
	
	var _this = this;
	function getHTML(){
		var style= "background-color:black;width:" + (width - 5) + "px;height:" + (height - 5) +  "px;";
		return "<textarea id='" + _this.getPdbId() + "_src'; style='display: none;'></textarea><div id='"+ _this.getPdbId() +"' style='" + style + "'></div>";
	}
	
	this.pdbContainer = Ext.create('Ext.panel.Panel', {
		margin : "2 2 2 2",
		width : width,
		height : height,
		items : [
		         {
		        	 html : getHTML()
		         }
		]
	});
	return this.pdbContainer;
};


FitStructureToDataWidget.prototype.getDataContainer = function() {
	return Ext.create('Ext.panel.Panel', {
		margin : "2 2 2 2",
		width : this.getSecondaryContainerDimensions().width,
		height : this.getSecondaryContainerDimensions().height ,
		items : [
		]
	});
};

FitStructureToDataWidget.prototype.getSummaryContainer = function() {
	return Ext.create('Ext.panel.Panel', {
		margin : "2 2 2 2",
		width : this.width/3 - 10,
		height : this.height - 15 - this.getTextAreaHeight() - 1,
		layout : 'vbox',
		items : [
		         this.getPdbContainer() 
//		         this.getDataContainer()
		],
		listeners : {
			afterrender : function() {
			}
		}
	});
};

FitStructureToDataWidget.prototype.getPanel = function() {
	var _this = this;
	var textAreaHeight = this.getTextAreaHeight();
	
	this.panel = Ext.create('Ext.container.Container', {
		layout : 'vbox',
		width : this.width,
		height : this.height,
		items : [
		         	this.getPlotContainer(),
		         	
		         	
		         	  {
			        	 id			: _this.id + "textArea",
			             xtype      : 'textareafield',
			             grow       : true,
//			             style		: {
//			            	 				font-size : '6px'
//			             },
			             height    : textAreaHeight - 10,
			             width 	   : this.width  - 10,
			             name      : 'message',
//			             fieldLabel: 'Message',
			             anchor    : '100%',
			             margin	   : 5
			         }
		],
		listeners : {
			afterrender : function() {
			}
		}
	});
	return this.panel;
};






FitStructureToDataWidget.prototype.refreshPlot = function(fitStructureToExperimentalDataId) {
	var _this = this;
	/** Plotting FIT file * */
	var adapterFit = new BiosaxsDataAdapter();
	this.plot.setLoading("Plotting");
	adapterFit.onSuccess.attach(function(sender, data){
		var colors = [];
		var labels = ["X"];
		var parsed = [];
		
		function getCoordinates(y, error){
			error = parseFloat(error);
			y = parseFloat(y);
			return DataCollectionCurveVisualizer.prototype._getCoordinates(y,error);
		}
		
		labels.push("fit");
		labels.push("scattering");
		colors.push("#58ACFA");
		colors.push("green");
		
		/** Creating X coordinates * */
		var pointsCount = 0;
		if (data != null){
			if (data.length > 0){
				for ( var key in data[0]) {
					
					var firstFile = data[0][key];
					for (var i = 0; i < firstFile.length; i++) {
						var n = parseFloat(firstFile[i][1]);
						parsed.push([parseFloat(firstFile[i][0])]);
						parsed[parsed.length - 1].push(getCoordinates(firstFile[i][1], firstFile[i][2]));
						var n3 = parseFloat(firstFile[i][3]);
						parsed[parsed.length - 1].push(getCoordinates(n3, n3));
						pointsCount ++;
					}
				}
			}
		}
		/** Plotting * */
		var dygraphObject = new StdDevDyGraph(_this.getPlotId(), {
			width 				: _this.getPlotContainerDimensions().width - 20,
			height				: _this.getPlotContainerDimensions().height - 10 - _this.getTextAreaHeight(),
			xlabel				: "q (nm-1)",
			showRangeSelector	: false
		});
		dygraphObject.draw(parsed, colors, labels);
		_this.plot.setLoading(false);
		
	});   
	adapterFit.getFitStructureToExperimentalDataFile(fitStructureToExperimentalDataId, "fit", "json");
};

FitStructureToDataWidget.prototype.refreshPdbViz = function(structureId){
	var _this =this;
	/** Plotting PDB file **/
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, pdbContent){
		_this.pdbContainer.setLoading("Rendering PDB");
		document.getElementById(_this.getPdbId() +'_src').innerHTML = pdbContent;
		var glmol02 = new GLmol(_this.getPdbId());
		_this.pdbContainer.setLoading(false);
	});
	_this.pdbContainer.setLoading("Reading PDB");
	adapter.getStructureFile(structureId);
};


FitStructureToDataWidget.prototype.refreshOutputfileContent = function(fitStructureToExperimentalDataId){
	var _this =this;
	/** Plotting PDB file **/
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, content){
		console.log(content);
		Ext.getCmp(_this.id + "textArea").setValue(content);
		
	});
	adapter.getFitStructureToExperimentalDataFile(fitStructureToExperimentalDataId, "OUTPUT", "txt");
};

FitStructureToDataWidget.prototype.refresh = function(fitStructureToExperimentalDataId, structureId) {
	this.refreshPlot(fitStructureToExperimentalDataId);
	this.refreshOutputfileContent(fitStructureToExperimentalDataId);
	this.refreshPdbViz(structureId);
};
/**
 * 
 * @width
 * @height
 * 
 */
function DataCollectionPDBWidget(args) {
	this.id = BUI.id();

	this.width = 900;
	this.height = 600;
	this.title = "";

	this.mergedEnabled = true;
	this.damminEnabled = false;
	this.damaverEnabled = false;
	this.damfiltEnabled = false;

	this.radius = 3;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height - 100;
		}
	}
}

DataCollectionPDBWidget.prototype.getPDBViewerPanel = function(model, width, height) {
	return new PDBViewer({
		width : width,
		height : height,
		title : model.title

	}).draw(model);
};

DataCollectionPDBWidget.prototype.get2x2 = function(models, colors) {
	
	return [ {
		xtype : 'container',
		type : 'vbox',
		items : [ this.getPDBViewerPanel([ models[0] ], this.width / 2, this.height / 2),

		this.getPDBViewerPanel([ models[1] ], this.width / 2, this.height / 2) ]
	}, {
		xtype : 'container',
		type : 'vbox',
		padding : '0 0 0 5',
		items : [ this.getPDBViewerPanel([ models[2] ], this.width / 2, this.height / 2), this.getPDBViewerPanel(models[3], this.width / 2, this.height / 2) ]
	} ];
};

DataCollectionPDBWidget.prototype.getContainers = function(models) {
	
	var items = [];
	if (models.length < 4) {
		for (key in models) {
			var model = models[key];
			if (model.length == null) {
				model = [ model ];
			}

			items.push({
				xtype : 'container',
				type : 'vbox',
				margin : '2',
				items : [ this.getPDBViewerPanel(model, this.width / models.length, this.height) ]

			});
		}
	}

	if (models.length == 4) {
		/** First row **/
		return this.get2x2(models);
	}

	return items;

};

DataCollectionPDBWidget.prototype.getColors = function() {
	var colors = [];
	colors.push("0xFF6600");
	colors.push("0x00CC00");
	colors.push("0x0099FF");
	return colors;
};

DataCollectionPDBWidget.prototype.getPDBPanel = function(items) {
	var panel = Ext.create('Ext.panel.Panel', {
		layout : {
			type : 'hbox'
		},
		margin : '5 0 0 0',
		width : this.width,
		items : this.getContainers(items)
	});

	panel.addDocked({
		xtype : 'toolbar',
		items : this.getMenu()
	});
	return panel;
};

/** type is fir or fit **/
DataCollectionPDBWidget.prototype._getFirHTML = function(modelId, width, height, type, desc) {
	var html = "<table>";
	html = html + '<tr style="text-align: center;"><td><a style="color:blue;font-weight:bold;" target="_blank" href="' + BUI.getModelFile("FIT", modelId, "txt") + '" >dammin.' + type + '</a></td></tr>';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td>' + desc + '</td></tr>';
	html = html + '<tr><td><div background-color="red" id="' + (this.id + type + modelId) + '" width="' + width + '" height="' + height + '"></div></td></tr>';
	html = html + '</table>';
	return html;
};

DataCollectionPDBWidget.prototype.getNSDPlot = function(width, height) {
	var html = "<table>";
	html = html + '<tr><td><div background-color="red"  width="' + width + '" height="' + height + '"></div></td></tr>';
	var url = BUI.getNSDImageURL(this.data.modelListId);
	var action = 'window.open("' + url + '")';
	var img = '<img style="width:' + width + 'px;height:' + height + 'px;"   src="' + url + '">';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td><a href=' + url + ' style="color:blue;font-weight:bold;" target="_blank">NSD file</a></td></tr>';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td>Normalized squared displacement comparison</td></tr>';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td> ' + img + '</td></tr>';
	html = html + '</table>';
	return html;
};

DataCollectionPDBWidget.prototype.getCHI2Plot = function(width, height) {
	var html = "<table>";
	html = html + '<tr><td><div background-color="red"  width="' + width + '" height="' + height + '"></div></td></tr>';
	var url = BUI.getCHI2ImageURL(this.data.modelListId);
	var img = '<img style="width:' + width + 'px;height:' + height + 'px;"   src="' + url + '">';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td><a href=' + url + ' style="color:blue;font-weight:bold;" target="_blank">CHI2 file</a></td></tr>';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td>CHI  comparison</td></tr>';
	html = html + '<tr style="text-align: center;font-style:italic;color:gray;"><td> ' + img + '</td></tr>';
	html = html + '</table>';
	return html;
};

DataCollectionPDBWidget.prototype.getImagesPanel = function() {
	var _this = this;
	return {
		xtype : 'container',
		layout : 'hbox',
		width : this.width,
		height : 300,
		border : 1,
		margin : '5 0 0 0',
		items : [ {
			html : _this._getFirHTML(_this.data.shapeDeterminationModelId, (this.width / 4) - 5, 250, "fir", "Fit of the simulated scattering curve versus a smoothed experimental data (spline interpolation)"),
			width : (this.width / 4) - 5,
			height : 300,
			border : 1,
			margin : '0 5 0 0'
		}, {
			html : _this._getFirHTML(_this.data.shapeDeterminationModelId, (this.width / 4) - 5, 250, "fit", "Fit of the simulated scattering curve versus the experimental data."),
			width : (this.width / 4) - 5,
			height : 300,
			border : 1,
			margin : '0 5 0 0'
		}, {
			html : _this.getCHI2Plot(this.width / 4, 250),
			width : (this.width / 4) - 5,
			height : 300,
			border : 1,
			margin : '0 5 0 0'
		}, {
			html : _this.getNSDPlot(this.width / 4, 250),
			width : (this.width / 4) - 5,
			height : 300,
			border : 1
		}

		]
	};
};
DataCollectionPDBWidget.prototype.draw = function(data, targetId) {

	this.data = data;
	var _this = this;
	this.analysisGrid = new AnalysisGrid({
		height : 150,
		grouped : false,
		maxHeight : 200,
		positionColumnsHidden : true,
		sorters : [ {
			property : 'priorityLevelId',
			direction : 'ASC'
		} ]
	});

	this.panelPDB = this.getPDBPanel(this.getModels());
	this.panel = Ext.create('Ext.container.Container', {
		layout : {
			type : 'vbox'
		},
		width : this.width,
		renderTo : targetId,
		listeners : {
			afterrender : function() {
				/** For fir files **/
				var adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, data) {
					var splitted = data.toString().split("\n");
					var array = [];
					for ( var i = 0; i < splitted.length; i++) {
						var line = splitted[i].trim();
						var line_splited = line.split(/\s*[\s,]\s*/);
						if (line_splited.length == 3) {
							array.push([ Number(line_splited[0]), BUI.getStvArray(line_splited[1], 0), BUI.getStvArray(line_splited[2], 0) ]);
						}
					}
					var dygraphWidget = new StdDevDyGraph(_this.id + "fit" + _this.data.shapeDeterminationModelId, {
						width : 400,
						height : 250,
						xlabel : 'q(nm<sup>-1</sup>)'
					});
					dygraphWidget.draw(array, [ "#FF0000", "#0000FF" ], [ "s", "I(exp)", "I(sim)" ]);
				});
				adapter.getModelFile("FIT", _this.data.shapeDeterminationModelId);

				/** For fit files **/
				adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, data) {
				
					var splitted = data.toString().split("\n");
					var array = [];
					for ( var i = 0; i < splitted.length; i++) {
						var line = splitted[i].trim();
						var line_splited = line.split(/\s*[\s,]\s*/);
						if (line_splited.length == 4) {
							array.push([ Number(line_splited[0]), BUI.getStvArray(line_splited[1], line_splited[2]), BUI.getStvArray(line_splited[3], 0) ]);
						}
					}

					var dygraphWidget = new StdDevDyGraph(_this.id + "fir" + _this.data.shapeDeterminationModelId, {
						width : 400,
						height : 250,
						xlabel : 'q(nm<sup>-1</sup>)'
					});
					dygraphWidget.draw(array, [ "#FF0000", "#0000FF", "#FF00FF" ], [ 's', 'I(exp)', 'I(sim)' ]);
				});
				adapter.getModelFile("FIR", _this.data.shapeDeterminationModelId);
			}
		},
		items : [ this.analysisGrid.getPanel([ data ]), this.panelPDB, this.getImagesPanel() ]
	});

};

DataCollectionPDBWidget.prototype.getDamaverModel = function() {
	if (this.data.averagedModel != null){
		return {
			type : "AVERAGED",
			modelId : this.data.averagedModelId,
			abInitioModelId : this.data.abInitioModelId,
			color : this.getColors()[0],
			title : this.data.averagedModel.split("/")[this.data.averagedModel.split("/").length - 1],
			opacity : 0.5,
			radius : this.radius
		};
	}
};

DataCollectionPDBWidget.prototype.getDamfiltModel = function() {
	if (this.data.rapidShapeDeterminationModel != null){
		return {
			type : "RAPIDSHAPEDETERMINATIONMODEL",
			modelId : this.data.rapidShapeDeterminationModelId,
			abInitioModelId : this.data.abInitioModelId,
			color : this.getColors()[1],
			title : this.data.rapidShapeDeterminationModel.split("/")[this.data.rapidShapeDeterminationModel.split("/").length - 1],
			opacity : 0.5,
			radius : this.radius
		};
	}
};

DataCollectionPDBWidget.prototype.getDammin = function() {
	if (this.data.shapeDeterminationModel != null){
		return {
			type : "SHAPEDETERMINATIONMODEL",
			modelId : this.data.shapeDeterminationModelId,
			abInitioModelId : this.data.abInitioModelId,
			color : this.getColors()[2],
			title : this.data.shapeDeterminationModel.split("/")[this.data.shapeDeterminationModel.split("/").length - 1],
			opacity : 0.5,
			radius : this.radius
		};
	}
};

DataCollectionPDBWidget.prototype.refresh = function(models) {
	this.panel.remove(this.panelPDB);
	this.panelPDB = this.getPDBPanel(models);
	this.panel.insert(this.panelPDB, 0);
};

DataCollectionPDBWidget.prototype.getModels = function() {
	var models = [];
	var data = this.data;
	if (this.damaverEnabled) {
		models.push(this.getDamaverModel());
	}

	if (this.damfiltEnabled) {
		models.push(this.getDamfiltModel());
	}

	if (this.damminEnabled) {
		models.push(this.getDammin());
	}

	if (this.mergedEnabled) {
		/** If no models we merge all **/
		var colorsMerged = [];
		var modelsId = [];
		var title = "Merged [";
		var modelsMerged = [];
		if (models.length == 0) {
			var damaverModel = this.getDamaverModel();
			if (damaverModel != null){
				damaverModel.opacity = 0.2;
				modelsMerged.push(damaverModel);
			}

			var damfiltModel = this.getDamfiltModel();
			if (damfiltModel != null){
				damfiltModel.opacity = 0.6;
				modelsMerged.push(damfiltModel);
			}

			var damminModel = this.getDammin();
			if (damminModel != null){
				damminModel.opacity = 0.8;
				modelsMerged.push(damminModel);
			}
			modelsMerged = [ modelsMerged ];
		} else {
			modelsMerged = models;
			modelsMerged.push(JSON.parse(JSON.stringify(modelsMerged)));
		}

		return modelsMerged;
	}
	return models;
};

DataCollectionPDBWidget.prototype.getMenu = function() {
	var _this = this;
	/** Actions buttons **/
	var actions = [];

	actions.push({
		text : 'Dammaver',
		id : _this.id + 'damaverBtn',
		enableToggle : true,
		scope : this,
		toggleHandler : function(item, pressed) {
			_this.damaverEnabled = pressed;
			_this.refresh(_this.getModels());
		},
		pressed : this.damaverEnabled
	});

	actions.push({
		text : 'Damfilt',
		id : _this.id + 'damfiltBtn',
		enableToggle : true,
		scope : this,
		toggleHandler : function(item, pressed) {
			_this.damfiltEnabled = pressed;
			_this.refresh(_this.getModels());
		},
		pressed : this.damfiltEnabled
	});

	actions.push({
		text : 'Dammin',
		id : _this.id + 'damminBtn',
		enableToggle : true,
		scope : this,
		toggleHandler : function(item, pressed) {
			_this.damminEnabled = pressed;
			_this.refresh(_this.getModels());
		},
		pressed : this.damminEnabled
	});

	actions.push({
		text : 'Merged',
		id : _this.id + 'mergedBtn',
		enableToggle : true,
		scope : this,
		toggleHandler : function(item, pressed) {
			_this.mergedEnabled = pressed;
			_this.refresh(_this.getModels());
		},
		pressed : this.mergedEnabled
	});

	return actions;
};

DataCollectionPDBWidget.prototype.input = function() {
	return {
		data : DATADOC.getPDBData()
	};
};

DataCollectionPDBWidget.prototype.test = function(targetId) {
	var dataCollectionPDBWidget = new DataCollectionPDBWidget({
		width : 1000,
		height : 300,
		title : "Damaver"
	});
	dataCollectionPDBWidget.draw(dataCollectionPDBWidget.input().data, targetId);

};

function PDBViewer(args) {
	this.id = BUI.id();
	this.glMol = null;

	this.width = 600;
	this.height = 600;
	this.title = "";

	this.margin = "10 0 0 5";
	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.title != null) {
			this.title = args.title;
		}
		if (args.margin != null) {
			this.margin = args.margin;
		}
	}
}

PDBViewer.prototype.getTitle = function() {
	return "<div style='width:" + this.width + "px; height:20px; font-weight:bold;background-color: #E6E6E6;color:black'>" + this.title + "</div>";
};

PDBViewer.prototype.getTextAreaId = function() {
	return this.id + "_src";
};

PDBViewer.prototype.getCanvas = function() {
	/** For text Area **/
	var textAreaStyle = "width:" + this.width + "px; height: " + this.height + "px;display: none;";
	var textArea = "<textarea id='" + this.getTextAreaId() + "'; style='" + textAreaStyle + "' ></textarea>";
	var style = "width: " + this.width + "px; height: " + this.height + "px; background-color: black;";
	return textArea + "<div id='" + this.id + "'; style='" + style + "' ></div>";

};

PDBViewer.prototype.getDownload = function(type, abInitioModelId) {
	/** For title **/
	var url = BUI.getPdbURL() + '&type=' + type + '&abInitioModelId=' + abInitioModelId;
	html = '<a href=' + url + ' style="color:blue;font-weight:bold;"  height="80" width="80" >Download</a><br /><br />';
	return "<div style='width:" + this.width + "px; height:20px; font-weight:bold;background-color: #336699;color:white'>" + html + "</div>";
};

PDBViewer.prototype.getBar = function() {
	/** For title **/
	return "<div style='width:" + this.width + "px; height:20px; font-weight:bold;background-color: #336699;color:white'></div>";
};

PDBViewer.prototype.refresh = function(models) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = models;
		var adapter = new BiosaxsDataAdapter();
		_this.panel.setLoading("Rendering");
		adapter.onSuccess.attach(function(sender, data) {
			if (data.models != null){
				if (data.models[0] != null){
					document.getElementById(_this.getTextAreaId()).innerHTML = data.models[0].XYZ;
					if (_this.glMol == null) {
						_this.glMol = new GLmol(_this.id);
					} else {
						_this.glMol.loadMolecule();
					}
				}
			}
			_this.panel.setLoading(false);
		});
		adapter.onError.attach(function(sender, data) {
			_this.panel.setLoading("Not available");
		});
		adapter.getDataPDB(models, []);
		
	} else {
		this.webGLNotAvailable();
	}
};

PDBViewer.prototype.getOpacity = function(text) {
	if (text == 'Invisible') {
		return '0';
	}
	if (text == 'Minimum') {
		return '0.2';
	}
	if (text == 'Medium') {
		return '0.5';
	}
	if (text == 'High') {
		return '0.7';
	}
	return '1';
};

PDBViewer.prototype.getMenu = function(model) {
	var _this = this;
	function onItemCheck(comp, checked, eOpts) {
		if (checked) {
			var i = null;
			if (comp.group == 'Opacity') {
				for (i = 0; i < _this.models.length; i++) {
					var opacity = _this.getOpacity(comp.text);
					model.opacity = opacity;
				}
			}

			if (comp.group == 'Radius') {
				for (i = 0; i < _this.models.length; i++) {
					var radius = _this.getOpacity(comp.text);
					model.radius = radius;
				}
			}

			_this.refresh(_this.models);
		}
	}

	return Ext.create('Ext.menu.Menu', {
		items : [ {
			text : 'Opacity',
			menu : {
				items : [ {
					text : 'Invisible',
					checked : false,
					group : 'Opacity',
					checkHandler : onItemCheck
				}, {
					text : 'Minimum',
					checked : false,
					group : 'Opacity',
					checkHandler : onItemCheck
				}, {
					text : 'Medium',
					checked : false,
					group : 'Opacity',
					checkHandler : onItemCheck
				}, {
					text : 'High',
					checked : false,
					group : 'Opacity',
					checkHandler : onItemCheck
				}, {
					text : 'Opaque',
					checked : false,
					group : 'Opacity',
					checkHandler : onItemCheck
				} ]
			}
		}

		]
	});
};

PDBViewer.prototype.getTbar = function() {
	var _this = this;

	var tb = Ext.create('Ext.toolbar.Toolbar');

	var colorItems = [];
	for (var i = 0; i < this.models.length; i++) {
		tb.add({
			text : this.models[i].title,
			menu : this.getMenu(this.models[i])
		});
		var color = "#" + this.models[i].color.replace("0x", "");
		colorItems.push({
			html : "<table><tr><td width='15px'>" + BUI.getRectangleColorDIV(color, 10, 10) + "</td><td>" + this.models[i].title + "</td></table>"
		});
	}

	tb.add({
		xtype : 'numberfield',
		labelWidth : 50,
		width : 120,
		fieldLabel : 'Radius',
		value : 3,
		maxValue : 10,
		step : 0.2,
		minValue : 0.1,
		listeners : {
			change : function(cmp) {
				var radius = cmp.getValue();
				for (var i = 0; i < _this.models.length; i++) {
					_this.models[i].radius = radius;
				}
				_this.refresh(_this.models);
			}
		}
	});
	tb.add("->");
	tb.add(colorItems);
	return tb;
};

PDBViewer.prototype.getPanel = function() {
	var _this = this;
	this.panel = Ext.create('Ext.panel.Panel', {
		margin : this.margin,
		border : 0,
		layout : {
			type : 'vbox'
		},
		width : this.width - 4,
		height : this.height + 30,
		items : [ {
			html : this.getCanvas()
		} ],
		listeners : {
			afterRender : function() {
			}
		}
	});

	this.panel.setLoading("Rendering");
	return this.panel;
};

PDBViewer.prototype.webGLNotAvailable = function() {
	document.getElementById(_this.id).innerHTML = BUI.getWarningHTML("Your browser doesn't support WebGL");
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML + "<br />";
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML
			+ BUI.getTipHTML("<a href='http://www.browserleaks.com/webgl#howto-enable-disable-webgl'>How to enable WebGL</a>");
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML + "<br />";
	document.getElementById(_this.id).innerHTML = document.getElementById(_this.id).innerHTML + BUI.getTipHTML("<a href='http://caniuse.com/webgl'>Can I use WebGL?</a>");
};

/** Deprecated **/
PDBViewer.prototype.draw = function(models) {
	this.models = models;
	var _this = this;
	this.panel = Ext.create('Ext.panel.Panel', {
		margin : 2,
		layout : {
			type : 'vbox'
		},
		tbar : this.getTbar(),
		width : this.width - 4,
		height : this.height + 30,
		items : [ {
			html : this.getCanvas()
		}

		],
		listeners : {
			afterRender : function() {
				_this.refresh(models);
			}
		}
	});

	this.panel.setLoading("Rendering");
	return this.panel;
};

SuperpositionPDBViewer.prototype.draw = PDBViewer.prototype.draw;
SuperpositionPDBViewer.prototype.getBar = PDBViewer.prototype.getBar;
SuperpositionPDBViewer.prototype.getCanvas = PDBViewer.prototype.getCanvas;
SuperpositionPDBViewer.prototype.getDownload = PDBViewer.prototype.getDownload;
SuperpositionPDBViewer.prototype.getMenu = PDBViewer.prototype.getMenu;
SuperpositionPDBViewer.prototype.getOpacity = PDBViewer.prototype.getOpacity;
SuperpositionPDBViewer.prototype.getPanel = PDBViewer.prototype.getPanel;
SuperpositionPDBViewer.prototype.getTbar = PDBViewer.prototype.getTbar;
SuperpositionPDBViewer.prototype.getTextAreaId = PDBViewer.prototype.getTextAreaId;
SuperpositionPDBViewer.prototype.getTitle = PDBViewer.prototype.getTitle;
SuperpositionPDBViewer.prototype.refresh = PDBViewer.prototype.refresh;
SuperpositionPDBViewer.prototype.webGLNotAvailable = PDBViewer.prototype.webGLNotAvailable;

function SuperpositionPDBViewer(args) {
	this.width = 550;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	var _this = this;
	this.form = new BufferForm();
	this.onSuccess = new Event();
	PDBViewer.prototype.constructor.call(this, args);
};

SuperpositionPDBViewer.prototype.refresh = function(superpositions) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = superpositions;
		var adapter = new BiosaxsDataAdapter();
		_this.panel.setLoading("Rendering");
		adapter.onSuccess.attach(function(sender, data) {
			document.getElementById(_this.getTextAreaId()).innerHTML = data.XYZ;
			if (_this.glMol == null) {
				_this.glMol = new GLmol(_this.id);
			} else {
				_this.glMol.loadMolecule();
			}
			_this.panel.setLoading(false);
		});
		adapter.onError.attach(function(sender, data) {
			_this.panel.setLoading("Not available");
		});
		adapter.getAbinitioPDBContentBySuperpositionList(superpositions);
	} else {
		this.webGLNotAvailable();
	}
};




AlignedSuperpositionPDBViewer.prototype.draw = PDBViewer.prototype.draw;
AlignedSuperpositionPDBViewer.prototype.getBar = PDBViewer.prototype.getBar;
AlignedSuperpositionPDBViewer.prototype.getCanvas = PDBViewer.prototype.getCanvas;
AlignedSuperpositionPDBViewer.prototype.getDownload = PDBViewer.prototype.getDownload;
AlignedSuperpositionPDBViewer.prototype.getMenu = PDBViewer.prototype.getMenu;
AlignedSuperpositionPDBViewer.prototype.getOpacity = PDBViewer.prototype.getOpacity;
AlignedSuperpositionPDBViewer.prototype.getPanel = PDBViewer.prototype.getPanel;
AlignedSuperpositionPDBViewer.prototype.getTbar = PDBViewer.prototype.getTbar;
AlignedSuperpositionPDBViewer.prototype.getTextAreaId = PDBViewer.prototype.getTextAreaId;
AlignedSuperpositionPDBViewer.prototype.getTitle = PDBViewer.prototype.getTitle;
AlignedSuperpositionPDBViewer.prototype.refresh = PDBViewer.prototype.refresh;
AlignedSuperpositionPDBViewer.prototype.webGLNotAvailable = PDBViewer.prototype.webGLNotAvailable;

function AlignedSuperpositionPDBViewer(args) {
	this.width = 550;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	var _this = this;
	this.form = new BufferForm();
	this.onSuccess = new Event();
	PDBViewer.prototype.constructor.call(this, args);
};

AlignedSuperpositionPDBViewer.prototype.refresh = function(superpositions) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = superpositions;
		
		_this.panel.setLoading("Rendering PDB");
		

		var adapter = new BiosaxsDataAdapter();
		adapter.onError.attach(function(sender, pdbContent){
			console.log(sender)
		});
		adapter.onSuccess.attach(function(sender, data){
			var superposition = data.superpositions[0][superpositions[0]];
			document.getElementById(_this.id).innerHTML = ""
			_this.glMol = new GLmol(_this.id, false, false, superposition.apriori.data);
			_this.glMol.addSuperpositionXYZ(superposition.aligned.XYZ, "0xFFFFFF", 0.3, 1);
			
			var view = _this.glMol.getView();
			_this.glMol.setView(view);
   
			
			_this.panel.setLoading(false);
		});
		if (superpositions != null){
			if (superpositions.length != 0){
				adapter.getDataPDB([], superpositions);
			}
		}
		
		
		
	} else {
		this.webGLNotAvailable();
	}
};







StructurePDBViewer.prototype.draw = PDBViewer.prototype.draw;
StructurePDBViewer.prototype.getBar = PDBViewer.prototype.getBar;
StructurePDBViewer.prototype.getCanvas = PDBViewer.prototype.getCanvas;
StructurePDBViewer.prototype.getDownload = PDBViewer.prototype.getDownload;
StructurePDBViewer.prototype.getMenu = PDBViewer.prototype.getMenu;
StructurePDBViewer.prototype.getOpacity = PDBViewer.prototype.getOpacity;
StructurePDBViewer.prototype.getPanel = PDBViewer.prototype.getPanel;
StructurePDBViewer.prototype.getTbar = PDBViewer.prototype.getTbar;
StructurePDBViewer.prototype.getTextAreaId = PDBViewer.prototype.getTextAreaId;
StructurePDBViewer.prototype.getTitle = PDBViewer.prototype.getTitle;
StructurePDBViewer.prototype.refresh = PDBViewer.prototype.refresh;
StructurePDBViewer.prototype.webGLNotAvailable = PDBViewer.prototype.webGLNotAvailable;

function StructurePDBViewer(args) {
	this.width = 550;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	var _this = this;
	this.form = new BufferForm();
	this.onSuccess = new Event();
	PDBViewer.prototype.constructor.call(this, args);
};

StructurePDBViewer.prototype.refresh = function(structures) {
	var _this = this;
	if (BUI.isWebGLEnabled()) {
		this.models = structures;
//		var adapter = new BiosaxsDataAdapter();
		_this.panel.setLoading("Rendering");
//		adapter.onSuccess.attach(function(sender, data) {
//			document.getElementById(_this.getTextAreaId()).innerHTML = data.XYZ;
//			if (_this.glMol == null) {
//				_this.glMol = new GLmol(_this.id);
//			} else {
//				_this.glMol.loadMolecule();
//			}
//			_this.panel.setLoading(false);
//		});
		
		var adapter = new BiosaxsDataAdapter();
		adapter.onSuccess.attach(function(sender, pdbContent){
//			_this.pdbContainer.setLoading("Rendering PDB");
			
			document.getElementById(_this.getTextAreaId()).innerHTML = pdbContent;
			var glmol02 = new GLmol(_this.id);
			
			
			_this.panel.setLoading(false);
		});
//		_this.pdbContainer.setLoading("Reading PDB");
//		adapter.getStructureFile(172);
		
//		adapter.onError.attach(function(sender, data) {
//			_this.panel.setLoading("Not available");
//		});
//		adapter.getPDBContentBySuperpositionList(superpositions);
	} else {
		this.webGLNotAvailable();
	}
};
function PrepareExperimentWidget(args) {
	this.id = BUI.id();
	this.height = 800;
	this.width = 900;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;

	/** Macromolecule Grid **/
	this.macromoleculeGrid = new MacromoleculeGrid({
		width : 425,
		height : 350,
		collapsed : false,
		tbar : true
	});

	this.macromoleculeGrid.onMacromoleculesChanged.attach(function(sender) {
		_this.getProposal();

	});

	/** Buffer Grid **/
	this.bufferGrid = new BufferGrid({
		width : 425,
		height : 350,
		collapsed : false,
		tbar : true
	});

	/** Experiment Grid **/
	this.templateGrid = new TemplateGrid({
		width : this.width,
		minHeight : 300,
		height : 440,
		gridType : 'Ext.grid.Panel',
		title : 'Experiments',
		grouping : false,
		tbar : true

	});
}

PrepareExperimentWidget.prototype.draw = function(targetId) {
	this.renderPanel(targetId);
	this.getProposal();
	this.getTemplates();
};

PrepareExperimentWidget.prototype.renderPanel = function(targetId) {
	this.panel = Ext.create('Ext.panel.Panel', {
		plain : true,
		frame : false,
		border : 0,
		height : this.height,
		width : this.width,
		renderTo : targetId,
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			margin : "0, 0, 0, 0",
			items : [ {
				xtype : 'container',
				layout : 'vbox',
				margin : "0, 0, 0, 0",
				width : 450,
				items : [ this.macromoleculeGrid.getPanel([]) ]
			}, this.bufferGrid.getPanel([]) ]
		}, {
			xtype : 'container',
			layout : 'hbox',
			margin : "10, 0, 0, 0",
			items : [ this.templateGrid.getPanel([]) ]
		}

		]
	});
};

PrepareExperimentWidget.prototype.getTemplates = function() {
	var _this = this;

	var adapter = new BiosaxsDataAdapter();

	adapter.onSuccess.attach(function(sender, data) {
		_this.templateGrid.refresh(data);
		_this.templateGrid.grid.setLoading(false);
	});
	_this.templateGrid.grid.setLoading("ISPyB: Retrieving Templates");
	adapter.getExperimentInformationByProposalId();

};

PrepareExperimentWidget.prototype.getProposal = function() {
	var _this = this;

	BIOSAXS.proposal.onInitialized = new Event();
	BIOSAXS.proposal.onInitialized.attach(function(sender) {
		_this.macromoleculeGrid.refresh(BIOSAXS.proposal.macromolecules);
		_this.bufferGrid.refresh(BIOSAXS.proposal.buffers);
		_this.macromoleculeGrid.grid.setLoading(false);
		_this.bufferGrid.grid.setLoading(false);
	});

	_this.macromoleculeGrid.grid.setLoading("ISPyB: Retrieving Macromolecules");
	_this.bufferGrid.grid.setLoading("ISPyB: Retrieving Buffers");
	BIOSAXS.proposal.init();

};

/**
 * It shows an slider for qualityThreshold and radiationDamageThreshold
 * 
 * @qualityThreshold between 0 and 1
 * @radiationDamageThreshold between 0 and 1
 * 
 * #onQualityChanged
 * #onRadiationDatamageChanged
 */

function QualityControlResultsWidget(args) {
	this.id = BUI.id();

	this.qualityThreshold = 0.25;
	this.radiationDamageThreshold = 0.25;

	if (args != null) {
		if (args.qualityThreshold != null) {
			this.qualityThreshold = args.qualityThreshold;
		}
		if (args.radiationDamageThreshold != null) {
			this.radiationDamageThreshold = args.radiationDamageThreshold;
		}
	}

	this.onQualityChanged = new Event(this);
	this.onRadiationDatamageChanged = new Event(this);
}

QualityControlResultsWidget.prototype.getPanel = function() {
	var _this = this;
	var sliderQuality = Ext.create('Ext.slider.Single', {
		width : 400,
		value : _this.qualityThreshold * 100,
		increment : 1,
		fieldLabel : "Quality (%)",
		labelWidth : 220,
		minValue : 0,
		maxValue : 100,
		listeners : {
			change : function(grid, value) {
				Ext.getCmp(_this.id + "_qualityField").setText('> ' + value + " %");
				_this.onQualityChanged.notify(value / 100);
			}
		}
	});

	var sliderRadiationDamage = Ext.create('Ext.slider.Single', {
		width : 400,
		value : _this.radiationDamageThreshold * 100,
		increment : 1,
		fieldLabel : "Radiation Damage/Inhomogenety (%)",
		labelWidth : 220,
		minValue : 0,
		maxValue : 100,
		listeners : {
			change : function(grid, value) {
				Ext.getCmp(_this.id + "_rdField").setText('> ' + value + " %");
				_this.onRadiationDatamageChanged.notify(value / 100);
			}
		}
	});

	return {
		xtype : 'container',
		flex : 1,
		border : false,
		layout : 'anchor',
		defaultType : 'textfield',
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			items : [ sliderQuality, {
				xtype : 'label',
				id : _this.id + "_qualityField",
				labelWidth : 50,
				margin : '0 0 0 20',
				readOnly : true,
				text : '> ' + _this.qualityThreshold * 100 + ' %'
			}, {
				html : "<span style='font-style:italic;'> Guinier Quality <span style='font-weight:bold;'>Recommended value is > 70.</span></span>",
				margin : '0 0 0 20',
				border : 0,
				padding : "0 100 0 0 "
			} ]
		}, {
			xtype : 'container',
			layout : 'hbox',
			items : [ sliderRadiationDamage, {
				xtype : 'label',
				id : _this.id + "_rdField",
				labelWidth : 50,
				margin : '0 0 0 20',
				readOnly : true,
				text : '> ' + _this.radiationDamageThreshold * 100 + ' %'
			}, {
				html : "<span style='font-style:italic;'> Percentage of frames merged <span style='font-weight:bold;'>Recommended value is > 70.</span></span>",
				margin : '0 0 0 20',
				border : 0,
				padding : "0 100 0 0 "
			} ]
		} ]
	};
};

QualityControlResultsWidget.prototype.input = function() {

};

QualityControlResultsWidget.prototype.test = function(targetId) {
	var qualityControlResultsWidget = new QualityControlResultsWidget();
	var panel = qualityControlResultsWidget.getPanel();
	Ext.create('Ext.panel.Panel', {
		width : 1000,
		items : [ panel ],
		renderTo : targetId
	});
};

function SamplePlateGroupWidget(args){
	this.id = BUI.id();
	this.width = 900;
	this.height = 300;

	this.titleTypePlate = 20;

	this.margin = 0;
	this.samplePlateWidgets = [];

	this.bbar = false;
	this.border = 1;
	this.showTitle = true;
	this.title = null;
	
	this.nodeSize = 8;
	
	if (args != null){
		if (args.margin != null){
			this.margin = args.margin;
		}
		if (args.bbar != null){
			this.bbar = args.bbar;
		}

		if (args.showTitle != null){
			this.showTitle = args.showTitle;
			if (this.showTitle){
				this.title = "Plates Groups";
			}
		}
		if (args.border != null){
			this.border = args.border;
		}
		if (args.height != null){
			this.height = args.height;
		}
	}
	
	this.heightPlates = this.height - this.titleTypePlate - 60;

	/** Events * */
	this.onClick = new Event(this);
	this.onExperimentChanged = new Event(this);
}


SamplePlateGroupWidget.prototype.drawPlate = function(experiment, plate, targetId){
	var _this = this;
	
	var samplePlateWidget = new SamplePlateWidget(
			{
				width		: (this.width/3) - 5, 
				height		: this.heightPlates + 10 , 
				nodeSize	: this.nodeSize, 
				fontSize	: 0, 
				strokeWidth	: 1.5
			});

	if (this.isVerticalLayout()){
		samplePlateWidget.width = this.width - 5;
		samplePlateWidget.height = this.heightPlates - 10;
	}
	
	samplePlateWidget.draw(experiment, plate, targetId );
	samplePlateWidget.onVertexUp.attach(function(sender, args){
		_this.onClick.notify(
				{
					samplePlate	: args.samplePlate, 
					row			: args.row, 
					column		: args.column

				}
		);
	});

	this.samplePlateWidgets.push(samplePlateWidget);
};

SamplePlateGroupWidget.prototype.drawPlates = function(experiment){
	if (experiment){
		var plateGroups = experiment.getPlateGroups();
		for ( var i = 0; i < plateGroups.length; i++) {
			var id = plateGroups[i].plateGroupId;
			var plates = experiment.getPlatesByPlateGroupId(id);
			for ( var j = 0; j < plates.length; j++) {
				var targetId = ('id', this.id + "_" + plates[j].samplePlateId);
				if (document.getElementById(targetId) != null){
					this.drawPlate(experiment, plates[j], targetId);
				}
			}
		} 
	}
};

/*
SamplePlateGroupWidget.prototype._sortPlates = function(a, b) {
	return a.slotPositionColumn - b.slotPositionColumn;
};
*/

/** This returns maxSlotPositionRow and maxSlotPositionColumn to set visually the sample changer layout **/
SamplePlateGroupWidget.prototype.getDimensions = function(plates) {
	var maxSlotPositionRow = 0;
	var maxSlotPositionColumn = 0;
	
	if (plates != null){
		for (var i = 0; i < plates.length; i++) {
			/** Row **/
			var slotPositionRow = plates[i].slotPositionRow;
			if (slotPositionRow != null){
				slotPositionRow = parseFloat(slotPositionRow);
				if (slotPositionRow > maxSlotPositionRow){
					maxSlotPositionRow = slotPositionRow;
				}
			}
			/** Column **/
			var slotPositionColumn = plates[i].slotPositionColumn;
			if (slotPositionColumn != null){
				slotPositionColumn = parseFloat(slotPositionColumn);
				if (slotPositionColumn > maxSlotPositionColumn){
					maxSlotPositionColumn = slotPositionColumn;
				}
			}
		}
	}
	return {
		"maxSlotPositionRow" 		: parseFloat(maxSlotPositionRow),
		"maxSlotPositionColumn"		: parseFloat(maxSlotPositionColumn)
	}
};

/** return true or false if the plates are going to be displayed vertically or horizontally **/
SamplePlateGroupWidget.prototype.isVerticalLayout = function() {
	var dimensions = this.getDimensions(this.experiment.getSamplePlates())
	if (dimensions.maxSlotPositionRow < dimensions.maxSlotPositionColumn){
		return false;
	}
	return true;
};

/** This returns a sample plate object based on the position it occupies on the sample plate **/
SamplePlateGroupWidget.prototype.getPlateBySlotPosition = function(plates, row, column) {
	if (plates != null){
		for (var i = 0; i < plates.length; i++) {
			/** Row **/
			if ((plates[i].slotPositionRow == row)&&(plates[i].slotPositionColumn == column)){
				return plates[i];
			}
		}
	}
	return null;
};

/** Returns the html that will be used to display the plates **/
SamplePlateGroupWidget.prototype.getPlatesContainer = function(experiment){
	var plateGroups = [];
	
	if (experiment!= null){
		plateGroups = experiment.getPlateGroups();
	}

	var div  = document.createElement("div");
	var table  = document.createElement("table");

	table.setAttribute('width', this.width - 30 + 'px');
	table.setAttribute('height', this.heightPlates + 'px');
	
	for ( var i = 0; i < plateGroups.length; i++) {
		var id = plateGroups[i].plateGroupId;
		var plates = experiment.getPlatesByPlateGroupId(id);
		var dimensions = this.getDimensions(plates);
		
		for ( var j = 1; j <= dimensions.maxSlotPositionRow; j++) {
			var tr = document.createElement("tr");
			for ( var k = 1; k <= dimensions.maxSlotPositionColumn; k++) {
				var plate = this.getPlateBySlotPosition(plates,j,k);
				var td = document.createElement("td");
				td.setAttribute('id', this.id + "_" + plate.samplePlateId);
				td.setAttribute('style', "background-color:#E6E6E6;border-width:1px;border-style:solid;");
				/** plate Type title * */
				var divTitle = document.createElement("div");
				divTitle.setAttribute("class", "menu-title");
				var text = document.createTextNode(plate.platetype3VO.name);
				divTitle.appendChild(text);
				
				td.appendChild(divTitle);
				tr.appendChild(td);
			}
			table.appendChild(tr);
		}
	} 
	div.appendChild(table);
	return div.innerHTML;
};

SamplePlateGroupWidget.prototype.selectSpecimens = function(specimens){
	/** Clear previous selected * */
	for ( var i = 0; i < this.samplePlateWidgets.length; i++) {
		this.samplePlateWidgets[i].clearSelection();
	}
	for ( var i = 0; i < specimens.length; i++) {
		this.selectSpecimen(specimens[i]);
	}
};

SamplePlateGroupWidget.prototype.selectSpecimen = function(specimen){
	if (specimen.sampleplateposition3VO != null){
		var samplePlateId = specimen.sampleplateposition3VO.samplePlateId;
		for ( var i = 0; i < this.samplePlateWidgets.length; i++) {
			var samplePlateId = this.samplePlateWidgets[i].samplePlate.samplePlateId;
			if ( this.samplePlateWidgets[i].samplePlate.samplePlateId == specimen.sampleplateposition3VO.samplePlateId){
				this.samplePlateWidgets[i].selectSpecimen(specimen);
				return;
			}
		}
	}
};

SamplePlateGroupWidget.prototype._refreshBbar = function(){
	if (this.panel != null){
		this.panel.removeDocked(Ext.getCmp( this.id + 'bbar'));
		this.panel.addDocked(this.getBbar());
	}
};

SamplePlateGroupWidget.prototype.refresh = function(experiment){
	this.experiment = experiment;
	this.samplePlateWidgets = [];

	if (document.getElementById(this.id + "_container") != null){
		document.getElementById(this.id + "_container").innerHTML = "";
		document.getElementById(this.id + "_container").innerHTML = this.getPlatesContainer(experiment);
		this.drawPlates(experiment);
	}

	/** We refrsh also the bbar  but it could not exist yet* */
	this._refreshBbar();	
	

};

SamplePlateGroupWidget.prototype._getAutoFillButton = function(){
	var _this = this;
	var item = null;
	function onButtonClick(){

	}

	function showResult(answer){
		if (answer == 'yes'){
			var samplePlateId = item.samplePlateId;
			var adapter = new BiosaxsDataAdapter();
			_this.panel.setLoading("ISPyB: Saving Plate");
			adapter.onSuccess.attach(function(sender, json){
				_this.onExperimentChanged.notify(json);
				_this.panel.setLoading(false);
			});
			adapter.onError.attach(function(sender){
				alert("error");
				_this.panel.setLoading(false);
			});
			adapter.autoFillPlate(samplePlateId, _this.experiment.experimentId);
		}
	}

	function onItemClick(i){
		item = i;
		Ext.MessageBox.confirm('Confirm', 'Are you sure you want to fill "'+ _this.experiment.getSamplePlateById(item.samplePlateId).platetype3VO.name + '" plate?', showResult);
	}


	var items = [];
	items.push( '<b class="menu-title">Select a plate:</b>');

	if (this.experiment){
		var plates = this.experiment.getSamplePlates();
		plates.sort(function(a,b){return a.slotPositionColumn - b.slotPositionColumn;});
		for ( var i = 0; i < plates.length; i++) {
			items.push({
				samplePlateId			:  plates[i].samplePlateId,
				text					: (i+1) + '.- <b> ' + plates[i].platetype3VO.name +'</b>', 
				handler				: onItemClick
			});
		}
	}

	return Ext.create('Ext.button.Split', {
		text		: 'Auto Fill',
		handler		: onButtonClick,
		tooltip		: {text:'This will fill, if there is place, the specimens in the plate', title:'Auto Fill'},
		menu : {
			items: items
		}
	});
};

SamplePlateGroupWidget.prototype._getZoomButton = function(){
	var _this = this;
	var item = null;

	function onItemClick(item){
// Ext.MessageBox.confirm('Confirm', 'Are you sure you want to empty "'+
// _this.experiment.getSamplePlateById(item.samplePlateId).platetype3VO.name +
// '" plate?', showResult);
		Ext.create('Ext.window.Window', {
			title	: _this.experiment.getSamplePlateById(item.samplePlateId).platetype3VO.name,
			height	: 600,
			width	: 900,
			layout	: 'fit',
			modal	: true,
			listeners: {
				afterrender: function(){
					var samplePlateWidget = new SamplePlateWidget(
							{
								width		: 880, 
								height		: 560, 
								nodeSize	: 4, 
								fontSize	: 0, 
								strokeWidth	: 1.5,
								showLabels	: true,
								backgroundColor : '#FFFFFF'
							});

					samplePlateWidget.draw(_this.experiment, _this.experiment.getSamplePlateById(item.samplePlateId), "plateZoom" );
				}
			},
			items	: [
			     	   {
			     		   html 	: '<div id="plateZoom" style="background-color:red"></div>',
			     		   padding 	: 5
			     	   }
			     	   ]
		}).show();

	}


	var items = [];
	if (this.experiment){
		var plates = this.experiment.getSamplePlates();
		plates.sort(function(a,b){return a.slotPositionColumn - b.slotPositionColumn;});
	
		items.push( '<b class="menu-title">Select a plate:</b>');
		for ( var i = 0; i < plates.length; i++) {
			items.push({
				samplePlateId			:  plates[i].samplePlateId,
				text					: (i+1) + '.- <b> ' + plates[i].platetype3VO.name +'</b>', 
				handler				: onItemClick
			});
		}
	}

	return Ext.create('Ext.button.Split', {
		text		: 'Zoom In',
		tooltip		: {text:'This will show a plate bigger', title:'Zoom In Action'},
		menu 		: {
			items: items
		}
	});
};


SamplePlateGroupWidget.prototype._getEmptyButton = function(){
	var _this = this;
	var item = null;
	function onButtonClick(){

	}

	function showResult(answer){
		if (answer == 'yes'){
			var samplePlateId = item.samplePlateId;
			var adapter = new BiosaxsDataAdapter();
			_this.panel.setLoading("ISPyB: Saving Plate");
			adapter.onSuccess.attach(function(sender, json){
				_this.onExperimentChanged.notify(json);
				_this.panel.setLoading(false);
			});
			adapter.onError.attach(function(sender){
				alert("error");
				_this.panel.setLoading(false);
			});
			adapter.emptyPlate(samplePlateId, _this.experiment.experimentId);
		}
	}

	function onItemClick(i){
		item = i;
		Ext.MessageBox.confirm('Confirm', 'Are you sure you want to empty "'+ _this.experiment.getSamplePlateById(item.samplePlateId).platetype3VO.name + '" plate?', showResult);
	}


	var items = [];
	
	if (this.experiment){
		var plates = this.experiment.getSamplePlates();
		plates.sort(function(a,b){return a.slotPositionColumn - b.slotPositionColumn;});
	
		items.push( '<b class="menu-title">Select a plate:</b>');
		for ( var i = 0; i < plates.length; i++) {
			items.push({
				samplePlateId			:  plates[i].samplePlateId,
				text					: (i+1) + '.- <b> ' + plates[i].platetype3VO.name +'</b>', 
				handler				: onItemClick
			});
		}
	}
	return Ext.create('Ext.button.Split', {
		text		: 'Empty',
		handler		: onButtonClick,
		tooltip		: {text:'This will empty the specimen of a plate. It will NOT remove the specimen but will removed their position', title:'Empty Action'},
		menu : {
			items: items
		}
	});
};

SamplePlateGroupWidget.prototype._getPlateTypes = function(){
	var _this = this;
	var item = null;
	function onButtonClick(){

	}

	function changeType(answer){
		if (answer == 'yes'){
			var samplePlateId = item.samplePlateId;
			var plateTypeId = item.plateTypeId;

			var plateType = BIOSAXS.proposal.getPlateTypeById(plateTypeId);
			var plate = _this.experiment.getSamplePlateById(samplePlateId);
			plate.platetype3VO = plateType;

			var samplePlateId = item.samplePlateId;
			var adapter = new BiosaxsDataAdapter();
			_this.panel.setLoading("ISPyB: Saving Plate");
			adapter.onSuccess.attach(function(sender, json){
				_this.onExperimentChanged.notify(json);
				_this.panel.setLoading(false);
			});
			adapter.onError.attach(function(sender){
				alert("error");
				_this.panel.setLoading(false);
			});
			adapter.savePlates([plate], _this.experiment.experimentId);
		}
	}

	function onItemCheck(i){
		item = i;
		var samplePlateId = i.samplePlateId;
		var plateTypeId = i.plateTypeId;

		if (_this.experiment.getSamplePlateById(samplePlateId).platetype3VO.plateTypeId != plateTypeId){
			Ext.MessageBox.confirm('Confirm', 'Are you sure you want to change the type of "'+ _this.experiment.getSamplePlateById(item.samplePlateId).platetype3VO.name + '" plate?', changeType);
		}
	}


	var items = [];
	items.push( '<b class="menu-title">Select an EMPTY plate:</b>');
	
	var plates = [];
	if (this.experiment != null){
		plates = this.experiment.getSamplePlates();
	}
	plates.sort(function(a,b){return a.slotPositionColumn - b.slotPositionColumn;});


	var types = BIOSAXS.proposal.getPlateTypes();

	for ( var i = 0; i < plates.length; i++) {
		var plate = plates[i];
		var itemTypes = [];
		for ( var j = 0; j < types.length; j++) {

			itemTypes.push({
				text			: types[j].name,
				plateTypeId		: types[j].plateTypeId,
				samplePlateId	: plate.samplePlateId,
				checked			: (plate.platetype3VO.plateTypeId == types[j].plateTypeId),
				group			: 'theme' + plate.samplePlateId,
				checkHandler	: onItemCheck
			});
		}

		items.push({
			text		: (i+1) + '.- <b> ' + plate.platetype3VO.name +'</b>',
			disabled	: (_this.experiment.getSpecimensBySamplePlateId(plate.samplePlateId).length > 0),
			menu		: {       
				items		: itemTypes
			}
		});
	}

	return Ext.create('Ext.button.Split', {
		text		: 'Plate Types',
		handler		: onButtonClick,
		tooltip		: {text:'This will change the type of a plate.', title:'Change plate type'},
		menu : {
			items: items
		}
	});
};

SamplePlateGroupWidget.prototype.getBbar = function(experiment){
	var _this = this;
	if (this.bbar){
		return  Ext.create('Ext.toolbar.Toolbar', {
			id	: _this.id + 'bbar',
			dock: 'bottom',
			items: [
			        this._getPlateTypes(),
			        "-",
			        this._getAutoFillButton(),
			        this._getEmptyButton(),
			        "-",
			        this._getZoomButton()
			        ]
		});
	}
	return null;
};

SamplePlateGroupWidget.prototype.getPanel = function(){
	var _this = this;
	
	var id = this.id + "_container"; 
	this.panel =  Ext.create('Ext.panel.Panel', {
		title		: this.title,
		bbar		: this.getBbar(),
		height		: this.height,
		width		: this.width,
		border		: this.border,
		items		: [
					        {
					        	border		: 0,
					        	height		: this.height,
					        	id			: id,
					        	html		: "<div id='"+ id +"'></div>"
					        }
					   ]
	});

	this.panel.on("afterrender", function(){
		document.getElementById(id).innerHTML = _this.getPlatesContainer(_this.experiment);
		_this.drawPlates(_this.experiment);
		_this._refreshBbar();
	});
	return this.panel ;
};
/**
 * 
 * @nodeSize
 * @fontSize
 * @strokeWidth
 * @showTooltip
 * @showBorderLabels
 * @showFullName
 * @showLabels
 * @backgroundColor
 * 
 **/

function SamplePlateWidget(args) {
	this.actions = [];

	this.width = "1";
	this.height = "1";

	this.legendFontSize = 7;

	this.backgroundColor = "#E6E6E6";
	this.wellColor = "#FFFFFF ";

	this.id = BUI.id();
	this.notSupportedMessage = "IE doesn't support HTML5 features";

	this.nodeSize = 14;
	this.fontSize = 10;
	this.strokeWidth = 2;
	this.showTooltip = true;
	this.showBorderLabels = true;
	this.showFullName = false;
	this.showLabels = false;

	if (args != null) {
		if (args.showBorderLabels != null) {
			this.showBorderLabels = args.showBorderLabels;
		}
		if (args.showLabels != null) {
			this.showLabels = args.showLabels;
		}
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.nodeSize != null) {
			this.nodeSize = args.nodeSize;
		}
		if (args.notSupportedMessage != null) {
			this.notSupportedMessage = args.notSupportedMessage;
		}
		if (args.fontSize != null) {
			this.fontSize = args.fontSize;
		}
		if (args.showFullName != null) {
			this.showFullName = args.showFullName;
		}
		if (args.showTooltip != null) {
			this.showTooltip = args.showTooltip;
		}
		if (args.backgroundColor != null) {
			this.backgroundColor = args.backgroundColor;
		}
		if (args.strokeWidth != null) {
			this.strokeWidth = args.strokeWidth;
		}
	}

	/** this is the ids[specimenId] = nodeId **/
	this.ids = {};
	this.onVertexUp = new Event(this);
	this.selectedSVGNodes = [];
	this.markedSpecimenId = {};
}

SamplePlateWidget.prototype.clear = function(experiment, samplePlate, targetId) {
	if (document.getElementById(this.targetId) != null) {
		document.getElementById(this.targetId).innerHTML = "";
	}
};

SamplePlateWidget.prototype.draw = function(experiment, samplePlate, targetId, windowContainerId) {
	var _this = this;

	/** This is the id of the window where the sampleplateform is just to position correctly the tooltips **/
	this.windowContainerId = windowContainerId;
	if (Ext.isIE6 || Ext.isIE7 || Ext.isIE8) {
		document.getElementById(targetId).innerHTML = BUI.getWarningHTML(this.notSupportedMessage);
		return;
	}

	this.onVertexUp = new Event(this);
	this.samplePlate = samplePlate;
	this.experiment = experiment;

	this.targetId = targetId;

	var rows = this.samplePlate.platetype3VO.rowCount;
	var columns = this.samplePlate.platetype3VO.columnCount;

	this.network = new NetworkWidget({
		targetId : targetId
	});
	var dataset = new GraphDataset();
	var formatter = new NetworkDataSetFormatter({
		defaultFormat : {
			type : "LineEdgeNetworkFormatter",
			'fill-opacity' : 1,
			fill : this.wellColor,
			'stroke-width' : this.strokeWidth,
			'stroke-opacity' : 1,
			stroke : "#000000",
			size : this.nodeSize,
			title : {
				fontSize : this.fontSize,
				fill : "#000000"
			}
		}
	}, null, {
		labeled : false,
		height : this.height,
		width : this.width,
		right : this.width,
		backgroundColor : this.backgroundColor,
		balanceNodes : false,
		nodesMaxSize : 12,
		nodesMinSize : 2
	});

	formatter.dataBind(dataset);
	var layout = new LayoutDataset();
	layout.dataBind(dataset);
	this.network.draw(dataset, formatter, layout);

	for ( var i = 1; i <= rows; i++) {
		for ( var j = 1; j <= columns; j++) {
			this.network.getDataset().addNode("", {
				row : i,
				column : j
			});

			if (this.samplePlate.platetype3VO.name == " 4 x ( 8 + 3 ) Block") {
				if (j < 9) {
					this.network.getFormatter().vertices[this.network.getDataset().getVerticesCount() - 1].getDefault().setSize(this.nodeSize * 0.8);
				} else {
					this.network.getFormatter().vertices[this.network.getDataset().getVerticesCount() - 1].getDefault().setSize(this.nodeSize * 1.4);
				}
			}

		}
	}

	/** EVENT WHEN USER CLICK ON A WELL **/
	this.network.graphCanvas.onVertexUp.attach(function(sender, nodeId) {
		_this.onVertexUp.notify({
			samplePlate : _this.samplePlate,
			row : _this.network.getDataset().getVertexById(nodeId).args.row,
			column : _this.network.getDataset().getVertexById(nodeId).args.column

		});
	});

	this.network.graphCanvas.onVertexOver.attach(function(sender, nodeId) {
	});

	this.relayout(this.network, rows, columns);
	this.fillSimulator(this.experiment.getSamples());

	if (this.showBorderLabels) {
		this.drawBorders();
	}

};

SamplePlateWidget.prototype.drawBorders = function() {
	var xArray = {};
	var yArray = {};

	var xValues = [];
	var yValues = [];

	var verticesLayout = this.network.graphCanvas.getLayout().vertices;
	for ( var vertice in verticesLayout) {
		var verticeX = verticesLayout[vertice].x;
		if (xArray[verticeX] == null) {
			xArray[verticeX] = true;
			xValues.push(verticeX);
		}

		var verticeY = verticesLayout[vertice].y;
		if (yArray[verticeY] == null) {
			yArray[verticeY] = true;
			yValues.push(verticeY);
		}
	}

	/** LEGENG **/
	var letters = BUI.getSamplePlateLetters();
	for ( var i = 1; i <= xValues.length; i++) {
		SVG.drawText(xValues[i - 1] * this.network.graphCanvas.getWidth() - 5, this.network.graphCanvas.getHeight(), i, this.network.graphCanvas._svg,
				[ [ 'font-size', this.legendFontSize + 'px' ], [ 'font-weight', 'bold' ], [ 'fill', 'black' ] ]);
	}

	for ( var i = 1; i <= yValues.length; i++) {
		SVG.drawText(5, yValues[i - 1] * this.network.graphCanvas.getHeight() + 5, letters[i - 1], this.network.graphCanvas._svg, 
				[ [ 'font-size', this.legendFontSize + 'px' ], [ 'font-weight', 'bold' ], [ 'fill', 'black' ] ]);
	}

};

SamplePlateWidget.prototype.addOkIcon = function(x, y, id, specimen) {
	var svg = this.network.graphCanvas._svg;
	var _this = this;

	var id = id + "_marked";
	if (this.markedSpecimenId[id] == null) {
		SVG.drawRectangle(x - 10, y - 10, 22, 22, svg, [ [ "id", id ], [ "fill", "gray" ],["stroke-opacity", "0.5"], [ "fill-opacity", "0.2" ], [ 'stroke', 'black' ] ]);
		$('#' + id).qtip({
			content : {
				text : _this._getToolTipContent(specimen)
			},
			position : {
				adjust : {
					x : 0,
					y : 20
				}
			},
			style : {
				width : true,
				classes : 'ui-tooltip-shadow'
			}
		});
		this.markedSpecimenId[id] = true;
	}
};

SamplePlateWidget.prototype.selectSpecimen = function(specimen) {
	var vertex = this.getVertexByPosition(specimen.sampleplateposition3VO.rowNumber, specimen.sampleplateposition3VO.columnNumber);
	var x = this.network.getLayout().vertices[vertex.id].x * this.width;
	var y = this.network.getLayout().vertices[vertex.id].y * this.height;
	var svg = this.network.graphCanvas._svg;
	this.selectedSVGNodes.push(SVG.drawRectangle(x - 9, y - 9, 20, 20, svg, [["fill", "red"], ["fill-opacity", "0"], ['stroke', 'blue' ], [ 'stroke-width', '2' ] ]));
};

SamplePlateWidget.prototype.clearSelection = function() {
	var svg = this.network.graphCanvas._svg;
	for ( var i = 0; i < this.selectedSVGNodes.length; i++) {
		svg.removeChild(this.selectedSVGNodes[i]);
	}
	this.selectedSVGNodes = [];
};

SamplePlateWidget.prototype.getVertexByPosition = function(row, column) {
	var vertices = this.network.getDataset().getVertices();
	for ( var vertexId in vertices) {
		if ((vertices[vertexId].args.row == row) && (vertices[vertexId].args.column == column)) {
			return vertices[vertexId];
		}
	}
	return null;
};

//SamplePlateWidget.prototype.getOpacity = function(specimen) {
//	var concentrations = this.experiment.getConcentrationsBysample(specimen);
//	var normalized = Normalizer.normalizeArray(concentrations);
//	for ( var i = 0; i < concentrations.length; i++) {
//		if (concentrations[i] == specimen.concentration) {
//			if (normalized[i] == 0)
//				return 0.2;
//			return 0.2 + normalized[i] * 0.6;
//		}
//	}
//	return 1;
//
//};

SamplePlateWidget.prototype.showLabel = function(row, column, specimen) {
	if (specimen != null) {
		var vertex = this.getVertexByPosition(row, column);
		if (this.fontSize != 0) {
			if (specimen.macromolecule3VO != null) {
				if (this.showFullName) {
					vertex.setName(specimen.code);
				} else {
					vertex.setName(specimen.macromolecule3VO.acronym);
				}
			} else {
				if (this.showFullName) {
					vertex.setName(specimen.code);
				} else {
					vertex.setName(specimen.macromolecule3VO.acronym);
				}
			}
		}
	}
};

SamplePlateWidget.prototype.getNodeIdBySpecimenId = function(specimenId) {
	var nodeId = this.ids[specimenId];
};

SamplePlateWidget.prototype.markSpecimenAsOk = function(specimen, x, y, id) {
	if (specimen.measurements != null) {
		for ( var j = 0; j < specimen.measurements.length; j++) {
			if (specimen.measurements[j].merge3VOs != null) {
				if (specimen.measurements[j].merge3VOs.length > 0) {
					this.addOkIcon((x * this.network.graphCanvas.getWidth()), y * this.network.graphCanvas.getHeight(), id, specimen);
				}
			}
		}
	}
};
/**
 * Input: specimenId of the sample containing a macromolecule
 * Ouput: color of the specimen buffer associated
 */
SamplePlateWidget.prototype.getSpecimenBufferColorFromSampleSpecimenId = function(specimenId) {
	var dcs = this.experiment.getDataCollectionsBySpecimenId(specimenId);
	if (dcs.length > 0){
		var dataCollection = dcs[0];
		for (var i = 0; i < dataCollection.measurementtodatacollection3VOs.length; i++) {
			var measurementToDc = dataCollection.measurementtodatacollection3VOs[i];
			if (measurementToDc.dataCollectionOrder == 1){
				var measurement = this.experiment.getMeasurementById(measurementToDc.measurementId);
				if (measurement != null){
					return this.experiment.getSpecimenColorByBufferId(measurement.specimenId);
				}
				return 'pink';
			}
		}
	}
	return 'orange';
};

SamplePlateWidget.prototype.fillWell = function(row, column, specimen) {
	var _this = this;
	if (specimen != null) {
		var vertex = this.getVertexByPosition(row, column);
		if (vertex == null) {
			console.log(row + ", " + column + " not found");
			return;
		}
		var id = this.network.getGraphCanvas().getSVGNodeId(vertex.id);

		this.showLabel(row, column, specimen);
		this.ids[specimen.specimenId] = vertex.id;
		var x = this.network.getLayout().vertices[vertex.id].x;
		var y = this.network.getLayout().vertices[vertex.id].y;
		this.markSpecimenAsOk(specimen, x, y, id);

		if (specimen.macromolecule3VO == null) {
			/** BUFFER * */
			var color = this.experiment.getSpecimenColorByBufferId(specimen.specimenId);
			this.network.getFormatter().getVertexById(vertex.id).getDefault().setFill(color);
//			this.network.getFormatter().getVertexById(vertex.id).getDefault().setStroke(this.experiment.getSpecimenColorByBufferId(specimen.specimenId));
			this.network.getFormatter().getVertexById(vertex.id).getDefault().setStroke('blue');
			this.network.getFormatter().getVertexById(vertex.id).getDefault().setStrokeWidth(2);

		} else {
			this.network.getFormatter().getVertexById(vertex.id).getDefault().setFill(this.experiment.macromoleculeColors[specimen.macromolecule3VO.macromoleculeId]);
//			this.network.getFormatter().getVertexById(vertex.id).getDefault().setStroke(this.getSpecimenBufferColorFromSampleSpecimenId(specimen.specimenId));
			this.network.getFormatter().getVertexById(vertex.id).getDefault().setStroke('black');
			this.network.getFormatter().getVertexById(vertex.id).getDefault().setStrokeWidth(1);
		}

		if (this.showLabels) {
			x = this.network.getLayout().vertices[vertex.id].x;
			y = this.network.getLayout().vertices[vertex.id].y;
			if (specimen.macromolecule3VO != null) {
				var acronym = specimen.macromolecule3VO.acronym;
				if (acronym.length > 10) {
					acronym = acronym.slice(0, 10) + "...";
				}

				SVG.drawText((x * this.network.graphCanvas.getWidth()) - this.nodeSize - 10, y * this.network.graphCanvas.getHeight() + (this.nodeSize * 3) + 20, acronym, this.network.graphCanvas._svg, [
					[ 'font-size', 'xx-small' ], [ 'fill', 'black' ] ]);

				SVG.drawText((x * this.network.graphCanvas.getWidth()) - this.nodeSize - 10, y * this.network.graphCanvas.getHeight() + (this.nodeSize * 3) + 35, Number(specimen.concentration).toFixed(2) + " mg/ml", this.network.graphCanvas._svg, [
					[ 'font-size', 'xx-small' ], [ 'fill', 'black' ] ]);
			}

			var bufferName = this.experiment.getBufferById(specimen.bufferId).acronym;
			if (bufferName.length > 10) {
				bufferName = bufferName.slice(0, 10) + "...";
			}

			SVG.drawText((x * this.network.graphCanvas.getWidth()) - this.nodeSize - 10, y * this.network.graphCanvas.getHeight() + (this.nodeSize * 3) + 5, this.experiment.getBufferById(specimen.bufferId).acronym, this.network.graphCanvas._svg, [
				[ 'font-size', 'xx-small' ], [ 'fill', 'blue' ] ]);
		}

		if (this.showTooltip) {
			var id = this.network.getGraphCanvas().getSVGNodeId(vertex.id);
			if (_this.windowContainerId != null) {
				$('#' + id).qtip({
					content : {
						text : _this._getToolTipContent(specimen)
					},
					position : {
						adjust : {
							x : 0,
							y : 20
						}
					}
				});
			} else {
				$('#' + id).qtip({
					content : {
						text : _this._getToolTipContent(specimen)
					},
					position : {
						adjust : {
							x : 0,
							y : 20
						}
					}
				});

			}
		}
	}
};

SamplePlateWidget.prototype._getToolTipContent = function(specimen) {
	var content = "<table style='font-size:11px;'>";
	content = content + "<TR><TD>" + "Specimen " + "</TD><TD style='color:black; font-weight:bold;'>" + specimen.code + "</TD></TR>";
	content = content + "<TR style='height:20px'><TD>" + "" + "</TD><TD style='color:black; font-weight:bold;'></TD></TR>";
	content = content + "<TR><TD>" + "Buffer: " + "</TD><TD style='color:blue; font-weight:bold;'>" + this.experiment.getBufferById(specimen.bufferId).name + "</TD></TR>";
	if (specimen.macromolecule3VO != null) {
		content = content + "<TR><TD>" + "Macromolecule: " + "</TD><TD  style='color:green; font-weight:bold;'>" + specimen.macromolecule3VO.acronym + "</TD></TR>";
		content = content + "<TR><TD>" + "Concentration: " + "</TD><TD >" + specimen.concentration + "</TD></TR>";
	}
	//	content = content + "<TR><TD>" + "Temperature: "+ "</TD><TD>" + specimen.exposureTemperature + "</TD></TR>";
	content = content + "<TR><TD>" + "Volume: " + "</TD><TD>" + specimen.volume + "</TD></TR>";

	if (specimen.viscosity != null) {
		content = content + "<TR><TD>" + "Viscosity: " + "</TD><TD>" + specimen.viscosity + "</TD></TR>";
	}

	content = content + "</table>";
	return content;
};

SamplePlateWidget.prototype.fillSimulator = function(samples) {
	for ( var i = 0; i < samples.length; i++) {
		var sample = samples[i];
		if (sample.sampleplateposition3VO != null) {
			if (sample.sampleplateposition3VO.samplePlateId == this.samplePlate.samplePlateId) {
				var position = sample.sampleplateposition3VO;
				this.fillWell(position.rowNumber, position.columnNumber, sample);
			}
		}
	}

};

SamplePlateWidget.prototype.relayout = function(network, rows, columns) {
	if (this.samplePlate.platetype3VO.shape == "REC") {
		this.squareRelayout(network, rows, columns);
	}
	if (this.samplePlate.platetype3VO.shape == "CIR") {
		this.circleRelayout(network, rows, columns);
	}
};

SamplePlateWidget.prototype.squareRelayout = function(network, rows, columns) {
	var count = network.getDataset()._getVerticesCount();
	var yMin = 0.07;
	var yMax = 0.9;
	var xMin = 0.075;
	var xMax = 0.95;
	var stepY = (yMax - yMin) / (rows - 1);
	var stepX = (xMax - xMin) / (columns - 1);

	var verticesCoordinates = [];
	for ( var i = 0; i < rows; i++) {
		for ( var j = 0; j < columns; j++) {
			y = i * stepY + yMin;
			x = j * stepX + xMin;

			verticesCoordinates.push({
				'x' : x,
				'y' : y
			});

		}
	}
	var aux = 0;
	for ( var vertex in network.getDataset().getVertices()) {
		if (network.getLayout().vertices[vertex] == null) {
			this.vertices[vertex] = new NodeLayout(vertex, 0, 0);
		}
		network.getLayout().vertices[vertex].setCoordinates(verticesCoordinates[aux].x, verticesCoordinates[aux].y);
		aux++;
		network.getLayout().vertices[vertex].changed.attach(function(sender, item) {
			_this.changed.notify(item);
		});
	}
};

SamplePlateWidget.prototype.circleRelayout = function(network, rows, columns) {
	network.getLayout().getLayout("CIRCLE");
};



function ShippingWidget(args) {
	this.id = BUI.id();
	this.height = 800;
	this.width = 900;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
	}

	var _this = this;

	this.stockSolutionGrid = new StockSolutionGrid({
		width : this.width,
		minHeight : 300,
		height : 350,
		tbar : true
	});

	this.stockSolutionGrid.onProposalChanged.attach(function(sender) {
		_this.refresh();
	});

	this.shipmentGrid = new ShipmentGrid({
		width : this.width,
		minHeight : 300,
		height : 440
	});
}

ShippingWidget.prototype.draw = function(targetId) {
	this.renderPanel(targetId);
	this.refresh();
};

ShippingWidget.prototype.renderPanel = function(targetId) {
	this.panel = Ext.create('Ext.panel.Panel', {
		plain : true,
		frame : false,
		border : 0,
		height : this.height,
		width : this.width,
		renderTo : targetId,
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			margin : "0, 0, 0, 0",
			items : [ {
				xtype : 'container',
				layout : 'vbox',
				margin : "0, 0, 0, 0",
				items : [ this.stockSolutionGrid.getPanel() ]
			}
			]
		}, {
			xtype : 'container',
			layout : 'hbox',
			margin : "10, 0, 0, 0",
			items : [ this.shipmentGrid.getPanel([]) ]
		}

		]
	});
};

ShippingWidget.prototype.refresh = function() {
	var _this = this;
	BIOSAXS.proposal.onInitialized = new Event();
	BIOSAXS.proposal.onInitialized.attach(function(sender) {
		_this.stockSolutionGrid.refresh(BIOSAXS.proposal.getStockSolutions());
		_this.shipmentGrid.refresh(BIOSAXS.proposal.getShipments());
		_this.stockSolutionGrid.grid.setLoading(false);
		_this.shipmentGrid.grid.setLoading(false);
	});

	this.stockSolutionGrid.grid.setLoading("ISPyB: Retrieving Stock Solutions");
	this.shipmentGrid.grid.setLoading("ISPyB: Retrieving shipments");
	BIOSAXS.proposal.init();

};

/**
 * Widget container of Specimen grid and samplePlate widget
 * Depending of the sample changer layout it may be displayed vertically or horizontally
 * 
 * @param args
 * 
 * #onExperimentChanged It happens when specimen are modified
 */
function SpecimenWidget(args){

	this.width = 1000;
	this.height = 600;
	
	if (args != null){
		if (args.width != null){
			this.width = args.width;
		}
		if (args.height != null){
			this.height = args.height;
		}
	}
	
	var _this = this; 
	
	/** Specimen Grid **/
	this.specimenGrid = new SpecimenGrid({
											minHeight 			: 425,
											selectionMode 		: "SINGLE",
											editEnabled 		: false,
											updateRowEnabled 	: true,
											width 				: 900,
											showTitle 			: false
	});

	
	this.specimenGrid.onSpecimenChanged.attach(function(sender, specimen) {
		_this.experiment.setSpecimenById(specimen);
		_this.refresh(_this.experiment);
	});

	this.specimenGrid.onSelected.attach(function(sender, specimens) {
		if (specimens.length > 0) {
			_this.specimenSelected = specimens[0];
		} else {
			_this.specimenSelected = null;
		}
		_this.samplePlateGroupWidget.selectSpecimens(specimens);
	});
	
	
	/** Sample plate Widget **/
	this.samplePlateGroupWidget = new SamplePlateGroupWidget({
		showTitle : false,
		height : 250,
		margin : 5,
		bbar : true
	});
	
	
	this.samplePlateGroupWidget.onExperimentChanged.attach(function(sender, json) {
		_this.refresh(new Experiment(json));
	});

	this.samplePlateGroupWidget.onClick.attach(function(sender, args) {
		/** Clicking on a plate * */
		var row = args.row;
		var column = args.column;
		var samplePlateId = args.samplePlate.samplePlateId;

		/** is specimen selected on the grid? * */
		if (_this.specimenSelected != null) {
			/** Is position target empty * */
			if (_this.experiment.getSampleByPosition(args.samplePlate.samplePlateId, args.row, args.column).length == 0) {
				var specimen = _this.experiment.getSampleById(_this.specimenSelected.specimenId);
				if (specimen.sampleplateposition3VO == null) {
					specimen.sampleplateposition3VO = {};
				}

				specimen.sampleplateposition3VO = {
					columnNumber : column,
					rowNumber : row,
					samplePlateId : samplePlateId
				};

				_this.samplePlateGroupWidget.panel.setLoading("ISPyB: Saving specimen");
				var adapter = new BiosaxsDataAdapter();
				/** If success * */
				adapter.onSuccess.attach(function(sender, experiment) {
					_this.samplePlateGroupWidget.panel.setLoading(false);
				});

				adapter.onError.attach(function(sender, error) {
					_this.samplePlateGroupWidget.panel.setLoading(false);
					showError(error);
				});

				adapter.saveSpecimen(specimen, _this.experiment);

				_this.samplePlateGroupWidget.refresh(_this.experiment);
				_this.specimenGrid.refresh(_this.experiment);
				//_this.refresh(_this.experiment);
				_this.specimenGrid.deselectAll();
				
			} else {
				/**
				 * Can we merge? We can merge when specimen are the
				 * same. So, same buffer, macromolecule, concentration *
				 */
				var target = _this.experiment.getSampleByPosition(args.samplePlate.samplePlateId, args.row, args.column)[0];
				var specimen = _this.experiment.getSampleById(_this.specimenSelected.specimenId);

				if ((specimen.bufferId == target.bufferId) && (specimen.concentration == target.concentration)) {
					if (((specimen.macromolecule3VO != null) && (target.macromolecule3VO != null) && (specimen.macromolecule3VO.macromoleculeId == target.macromolecule3VO.macromoleculeId)) || 
							((specimen.macromolecule3VO == null) && (target.macromolecule3VO == null))) {
						var adapter = new BiosaxsDataAdapter();
						adapter.onSuccess.attach(function(sender, data) {
							_this.refresh(new Experiment(data));
							_this.samplePlateGroupWidget.panel.setLoading(false);
							
							_this.onExperimentChanged.notify(experiment);
						});
						adapter.onError.attach(function(sender, error) {
							_this.samplePlateGroupWidget.panel.setLoading(false);
							showError(error);
						});
						_this.samplePlateGroupWidget.panel.setLoading("ISPyB: Merging specimens");
						adapter.mergeSpecimens(specimen.specimenId, target.specimenId);
					}
				} else {
					alert("Well is not empty. Select another well!");
				}
			}
		} else {
			var specimen = _this.experiment.getSampleByPosition(args.samplePlate.samplePlateId, args.row, args.column)[0];
			if (specimen != null) {
				_this.specimenGrid.selectById(specimen.specimenId);
			}
		}
	});
	
	/** Events **/
	this.onExperimentChanged = new Event(this);
};

/**
 * Return vbox or hbox depending on the slot positions of the plates
 */
SpecimenWidget.prototype.getContainerLayoutConfiguration = function(experiment){
	var dimensions = this.samplePlateGroupWidget.getDimensions(experiment.getSamplePlates());
	if (dimensions.maxSlotPositionRow < dimensions.maxSlotPositionColumn){
		return {
					layout 					: "vbox",
					specimenGridWidth		: this.width - 10,
					specimenGridHeight		: this.height - 260,
					samplePlateGroupWidth	: this.width - 10,
					samplePlateGroupHeight	: 250
				};
	}
	return {
					layout 					: "hbox",
					samplePlateGroupWidth	: this.width*1/3 -10,
					samplePlateGroupHeight	: this.height - 10,
					specimenGridWidth		: this.width*2/3,
					specimenGridHeight		: this.height - 10
	};
	
};


SpecimenWidget.prototype.refresh = function(experiment){
	this.experiment = experiment;
	
	/** Removing all components **/
	this.panel.removeAll();
	
	var layoutConfiguration = this.getContainerLayoutConfiguration(experiment);

	/** Setting new width and height for layout vbox and hbox **/
	this.specimenGrid.width = layoutConfiguration.specimenGridWidth;
	this.specimenGrid.height = layoutConfiguration.specimenGridHeight;

	this.samplePlateGroupWidget.width = layoutConfiguration.samplePlateGroupWidth;
	this.samplePlateGroupWidget.height = layoutConfiguration.samplePlateGroupHeight;
	
	if (layoutConfiguration.layout == "hbox"){
		this.specimenGrid.margin = "0 0 0 5";
		this.specimenGrid.width =this.specimenGrid.width - 5;
	}
	/** Insert container depending on layout [vertical|horizontal] */
	var container = Ext.create('Ext.container.Container', {
		layout 		: layoutConfiguration.layout,
		height		: this.height,
		width 		: this.width,
		padding 	: '2px',
		items 		: [ 		   ]
	});
	if (layoutConfiguration.layout == "vbox"){
		container.insert(this.specimenGrid.getPanel());
		container.insert(this.samplePlateGroupWidget.getPanel());
	}
	else{
		container.insert(this.samplePlateGroupWidget.getPanel());
		container.insert(this.specimenGrid.getPanel());
	}
	
	/** Insert Widget **/
   	this.panel.insert(container);
   	
	/** Load data **/
	this.specimenGrid.refresh(experiment);
	this.samplePlateGroupWidget.refresh(experiment);
	
	
};

/** It creates a dummy container to be inserted the plates once the method refresh has been called 
 * This is necessay because we can not know the sample changer layout before hand
 * **/
SpecimenWidget.prototype.getPanel = function(){
	this.panel = Ext.create('Ext.container.Container', {
		layout 		: 'vbox',
		height 		: this.height,
		border 		: 0,
		margin		: 5,
		width 		: this.width,
		items 		: []
	});
	return this.panel;
};


SpecimenWidget.prototype.input = function() {
	return {
		experiment : DATADOC.getExperiment_10(),
		proposal : DATADOC.getProposal_10()
	};
};

SpecimenWidget.prototype.test = function(targetId) {
	var specimenWidget = new SpecimenWidget({
		height : 500,
		width : 1000
	});
	BIOSAXS.proposal = new Proposal(specimenWidget.input().proposal);
	var experiment = new Experiment(specimenWidget.input().experiment);
	var panel = specimenWidget.getPanel();
	panel.render(targetId);
	specimenWidget.refresh(experiment);

};



function WarningWidget(args) {
	this.actions = [];

	this.width = 580;
	this.height = 380;
	this.title = "Warning";
	this.message = null;
	this.messageType = 1; // "TIP",  "WARNING", "ERROR" -> 0,1,2
	this.pageSize = 3;

	if (args != null) {
		if (args.width != null) {
			this.width = args.width;
		}
		if (args.height != null) {
			this.height = args.height;
		}
		if (args.title != null) {
			this.title = args.title;
		}

		if (args.messageType != null) {
			this.messageType = args.messageType;
		}

		if (args.message != null) {
			this.message = args.message;
		}

	}
	this.onVertexUp = new Event(this);
}

WarningWidget.prototype.draw = function(warning) {
	var _this = this;
	var myData = [];
	for ( var i = 0; i < warning.length; i++) {
		myData.push({
			warnings : warning[i]
		});
	}

	var store = Ext.create('Ext.data.Store', {
		fields : [ 'warnings' ],
		remoteSort : true,
		pageSize : this.pageSize,
		data : myData,
		proxy : {
			type : 'pagingmemory'

		}
	});

	var grid = Ext.createWidget('gridpanel', {
		store : store,
		height : 264,
		border : 0,
		flex : 1,
		columns : [ {
			text : 'Description',
			sortable : true,
			dataIndex : 'warnings',
			flex : 1
		} ],

		bbar : Ext.create('Ext.PagingToolbar', {
			pageSize : this.pageSize,
			store : store,
			displayInfo : true,
			plugins : Ext.create('Ext.ux.SlidingPager', {})
		})
	});

	if (this.message == null) {
		this.height = this.height - 55;
	}

	var items = [];
	if (this.message != null) {
		if (this.messageType == 0) {
			items.push({
				padding : "0 0 0 2",
				border : 0,
				html : BUI.getTipHTML(this.message)
			});
		}

		if (this.messageType == 1) {
			items.push({
				padding : "0 0 0 2",
				border : 0,
				html : BUI.getWarningHTML(this.message)
			});
		}

		if (this.messageType == 2) {
			items.push({
				padding : "0 0 0 2",
				border : 0,
				html : BUI.getErrorHTML(this.message)
			});
		}
	}
	items.push(grid);

	this.window = Ext.create('Ext.Window', {
		title : this.title,
		//resizable			: false,
		//constrain			: true,
		//closable			: true,
		items : items,
		height : this.height,
		width : this.width,
		buttonAlign : 'right',
		listeners : {
			scope : this,
			minimize : function() {
				this.window.hide();
			},
			destroy : function() {
				delete this.window;
			}
		},
		buttons : [ {
			text : 'Close',
			handler : function() {
				_this.window.hide();
			}
		} ]
	});
	this.window.show();
};


function DataCollectionCurveVisualizer(args){
		this.id = BUI.id();
		this.width = 1000;
		this.height = 650;
		this.linear = false;
		
		if (args != null){
			if (args.width != null){
				this.width = args.width;
			}
			
			if (args.height != null){
				this.height = args.height;
			}
			
		}
		
		this.orderColors = {
								1	: "#58ACFA",
								2	: "#0B610B",
								3	: "#08088A"
		}
 };

 
DataCollectionCurveVisualizer.prototype.draw = function (){
	Ext.create('Ext.window.Window', {
	    title: 'Primary Data Processing',
	    height: this.height,
	    width: this.width,
	    layout: 'fit',
	    items: [this.getPanel()]              
	}).show();
};
 
/**
 * Get the path of the average files
 */
DataCollectionCurveVisualizer.prototype._getPrefixes = function (record){
	var bb = ""; //BufferBefore
	var sm = ""; //SampleMacromolecule
	var ba = "";//BufferAfter
	try{
		if (record.bufferBeforeAverageFilePath != null){
			bb = record.bufferBeforeAverageFilePath.split("/")[record.bufferBeforeAverageFilePath.split("/").length - 1].replace("_ave.dat", "");
		}
		if (record.averageFilePath != null){
			sm = record.averageFilePath.split("/")[record.averageFilePath.split("/").length - 1].replace("_ave.dat", "");
		}
		if (record.bufferAfterAverageFilePath != null){
			ba = record.bufferAfterAverageFilePath.split("/")[record.bufferAfterAverageFilePath.split("/").length - 1].replace("_ave.dat", "");
		}
	}
	catch(e){
		console.log(e);
	}
	return [bb, sm, ba]; 
};
	

DataCollectionCurveVisualizer.prototype._getFrames = function (merges, experimentList){
	var frames = new Array();
	for ( var i = 0; i < merges.length; i++) {
		var merge = merges[i];
		for ( var j = 0; j < merge.framelist3VO.frametolist3VOs.length; j++) {
			/** Sorting by frame Id **/
			merge.framelist3VO.frametolist3VOs.sort(function(a, b){return a.frame3VO.frameId - b.frame3VO.frameId;})
			var frametolist3VOs = merge.framelist3VO.frametolist3VOs[j];
			
			/** @ESRF the ave, sub files belong to the set of frames.
			 *  This behaviour is deprecated but old experiments still contains such files as frames 
			 *  **/
			if ((frametolist3VOs.frame3VO.filePath.indexOf("ave.dat") == -1) 
					&& frametolist3VOs.frame3VO.filePath.indexOf("sub.dat") == -1
				    && frametolist3VOs.frame3VO.filePath.indexOf("sub.out") == -1 ){
				/** Work around ESRF because averbuffer is whitin the list of frames **/
				 //&& frametolist3VOs.frame3VO.filePath.indexOf("averbuffer.dat") == -1
				    	
				frames.push(frametolist3VOs.frame3VO);
				frames[frames.length - 1]["specimen"] = experimentList.getSampleById(experimentList.getMeasurementById(merge.measurementId).specimenId);
				frames[frames.length - 1]["merged"] = false;
				frames[frames.length - 1]["merge"] = merge;
				
				if (frametolist3VOs.frame3VO.filePath.indexOf("averbuffer.dat") == -1){
					if (merge.framesMerge != null){
						if (Number(merge.framesMerge) > (j)){
							frames[frames.length - 1]["merged"] = true;
						}
					}
				}
				else{
					frames[frames.length - 1]["merged"] = true;
				}
			}
		}
	}
	return frames;
};

DataCollectionCurveVisualizer.prototype._getAverages = function (merges, experimentList){
	var averages = new Array();
	merges.sort(function(a, b){return a.mergeId - b.mergeId;})
	for ( var i = 0; i < merges.length; i++) {
		averages.push({
			filePath : merges[i].averageFilePath,
			specimen : experimentList.getSampleById(experimentList.getMeasurementById(merges[i].measurementId).specimenId),
			merged	: true,
			merge : merges[i]
		});
	}
	
	/** Work around for experiment where best buffer is within the list of frames **/
//	for ( var i = 0; i < merges.length; i++) {
//		var merge = merges[i];
//		for ( var j = 0; j < merge.framelist3VO.frametolist3VOs.length; j++) {
//			/** Sorting by frame Id **/
//			merge.framelist3VO.frametolist3VOs.sort(function(a, b){return a.frame3VO.frameId - b.frame3VO.frameId;})
//			var frametolist3VOs = merge.framelist3VO.frametolist3VOs[j];
//			
//			/** @ESRF the ave, sub files belong to the set of frames.
//			 *  This behaviour is deprecated but old experiments still contains such files as frames 
//			 *  **/
//			if (frametolist3VOs.frame3VO.filePath.indexOf("averbuffer.dat") != -1){
//				averages.push({
//					filePath : frametolist3VOs.frame3VO.filePath,
//					specimen : experimentList.getSampleById(experimentList.getMeasurementById(merges[i].measurementId).specimenId),
//					merged	: true,
//					merge : merges[i]
//				});
//			}
//		}
//	}
	return averages;
};

DataCollectionCurveVisualizer.prototype._getSubtractionByDataCollectionId = function (dataCollectionId, experimentList){
	if(experimentList.getDataCollectionById(dataCollectionId).substraction3VOs != null){
		if(experimentList.getDataCollectionById(dataCollectionId).substraction3VOs.length > 0){
			return experimentList.getDataCollectionById(dataCollectionId).substraction3VOs[0];
		}
	}
	return null;
};

/**
 * For multiple averages for the same measurementId this methods return the last mergeId processed that should be
 * the one with most of frames
 */
DataCollectionCurveVisualizer.prototype.getLastMerges = function (merges, experimentList, dataCollectionId){
	var result = [];
	function getLastMergeByMeasurementId(merges, measurementId){
		var aux = [];
		for (var i = 0; i < merges.length; i++) {
			var merge = merges[i];
			if (merge.measurementId == measurementId){
				aux.push(merge);
			}
		}
		aux.sort(function(a,b){return a.mergeId - b.mergeId;});
		return aux[aux.length -1];
	}
	
	var datacollection = experimentList.getDataCollectionById(dataCollectionId);
	if (datacollection.measurementtodatacollection3VOs != null){
		for (var i = 0; i < datacollection.measurementtodatacollection3VOs.length; i++) {
			var measurementtodatacollection3VO = datacollection.measurementtodatacollection3VOs[i];
			var measurementId = measurementtodatacollection3VO.measurementId;
			result.push(getLastMergeByMeasurementId(merges, measurementId));
		}
	}
	return result;
};

DataCollectionCurveVisualizer.prototype._prepareData = function (merges, experimentList, dataCollectionId, record){
	var data = [];
	var merges = this.getLastMerges(merges, experimentList, dataCollectionId);
	var subtraction = this._getSubtractionByDataCollectionId(dataCollectionId, experimentList);
	var subtractionId = null;
	if (subtraction != null){
		subtractionId = subtraction.subtractionId;
		var type = "SUBTRACTED";
		data.push({
			filePath		: subtraction.substractedFilePath.split("/")[subtraction.substractedFilePath.split("/").length-1],
			type			: type,
			name			: type,
			frameId			: null,
			mergeId			: null,
			specimen		: null,
			color			: "#DF01D7",
			merged			: true,
			merge			: null,
			subtractionId	: subtractionId
		});
		
	}
	
	/** Json structure for frames containing, specimen, merged, merge, etc... **/
	var averages =  this._getAverages(merges, experimentList);
	for ( var i = 0; i < averages.length; i++) {
		var type = "AVERAGED";
		data.push({
			filePath		: averages[i].filePath.split("/")[averages[i].filePath.split("/").length-1],
			type			: type,
			name			: type,
			frameId			: null,
			mergeId			: averages[i].merge.mergeId,
			specimen		: averages[i].specimen,
			color			: this._getSpecimenColor(averages[i].specimen, averages[i].merge, experimentList, dataCollectionId, averages[i].merged, type),
			merged			: averages[i].merged,
			merge			: averages[i].merge,
			subtractionId	: subtractionId
		});
	}
	
	
	
	/** Json structure for frames containing, specimen, merged, merge, etc... **/
	var frames = this._getFrames(merges, experimentList);
	/** Filling the frames **/
	for ( var i = 0; i < frames.length; i++) {
		var type = "FRAMES";
		data.push({
			filePath		: frames[i].filePath.split("/")[frames[i].filePath.split("/").length-1],
			type			: type,
			name			: type,
			frameId			: frames[i].frameId,
			specimen		: frames[i].specimen,
			color			: this._getSpecimenColor(frames[i].specimen, frames[i].merge, experimentList, dataCollectionId, frames[i].merged, type),
			merged			: frames[i].merged,
			merge			: frames[i].merge,
			subtractionId	: subtractionId
		});
	}
	return data;
};


DataCollectionCurveVisualizer.prototype._renderSpecimenBox = function (merges, experimentList, dataCollectionId, record){
	/** For buffer **/
	try{
			merges = this.getLastMerges(merges, experimentList, dataCollectionId);
			
			var measurement = experimentList.getMeasurementById(merges[1].measurementId);
			var specimen = experimentList.getSampleById(measurement.specimenId);
			var buffer = BIOSAXS.proposal.getBufferById(specimen.bufferId);
			var macromolecule = BIOSAXS.proposal.getMacromoleculeById(record.macromoleculeId);
			
			 bufferAcronym = buffer.acronym;
			 macromoleculeAcronym = macromolecule.acronym; 
			 
			 if (merges[0] != null){
				 bbmerges = merges[0].framesMerge;
			 }
			 else{
				 bbmerges = 'None'; 
			 }
			 
			 if (merges[1] != null){
				 if (merges[1].framesMerge != null){
					 molmerges = merges[1].framesMerge; 
				 }
				 if (merges[1].framesCount != null){
					 totalframes =  merges[1].framesCount; 
				 }
			 }
			 else{
				 molmerges = 'None'; 
			 }

			 if (merges[2] != null){
				 if (merges[2].framesMerge != null){
					 bamerges =  merges[2].framesMerge; 
				 }
			 }
			 else{
				 bamerges =  'None'; 
			 }
			 bufferId = buffer.bufferId; 
			 macromoleculeId = macromolecule.macromoleculeId; 
			 document.getElementById(this.id + '_header').innerHTML = BUI.getHTMLTableForFrameAveraged(bufferAcronym, macromoleculeAcronym, bbmerges, molmerges, bamerges, totalframes, bufferId, macromoleculeId);
	}
	catch(e){
		console.log(e);
	}	 
};

DataCollectionCurveVisualizer.prototype._getImageHTML = function (title, type, subtractionId, height, width){
	var url = BUI.getURL() + '&type=' + type + '&subtractionId=' + subtractionId;
	var event = "OnClick= window.open('" + url + "')";
	return '<table ><tr><td><img src='+ url +'   height="' + height + '" width="' + width + '" ' + event +'></td></tr><tr><td style="font-weight:bold;text-align:center;">'+ title + '</td></tr></table>'  ;
};

DataCollectionCurveVisualizer.prototype.refresh = function (merges, experimentList, dataCollectionId, record){
	var data = this._prepareData(merges, experimentList, dataCollectionId, record);
	this.store.loadData(data);
	this._renderSpecimenBox(merges, experimentList, dataCollectionId, record);
			 
	 /** Images **/
	var width = this.width*1/5 - 50;
	var height = width;
	if (data[0].subtractionId != null){
		document.getElementById(this.id + '_scattering').innerHTML = this._getImageHTML("Scattering", "scattering", data[0].subtractionId, height, width);
		document.getElementById(this.id + '_kratky').innerHTML = this._getImageHTML("Kratky Plot","kratky", data[0].subtractionId, height, width);
		document.getElementById(this.id + '_guinier').innerHTML = this._getImageHTML("Guinier Approx.","guinier", data[0].subtractionId, height, width);
		document.getElementById(this.id + '_gnom').innerHTML = this._getImageHTML("P(r)","gnom", data[0].subtractionId, height, width);
		
	}
	
	/** Loading frames **/
	var selected = new Array();
	for ( var i = 0; i < data.length; i++) {
		var record = data[i];
		if ((record.type == 'AVERAGED')||(record.type == 'SUBTRACTED')){
			selected.push(record);
		}
	}
	
	this._renderPlot(selected);
	this.legendStore.loadData(selected);
};


DataCollectionCurveVisualizer.prototype._getSpecimenColor = function (specimen, merge, experimentList, dataCollectionId, merged, type){
	var dataCollection = experimentList.getDataCollectionById(dataCollectionId);
	var order = null;
	for ( var i = 0; i < dataCollection.measurementtodatacollection3VOs.length; i++) {
		var measurementtodatacollection3VO = dataCollection.measurementtodatacollection3VOs[i];
		if (measurementtodatacollection3VO.measurementId == merge.measurementId){
			order = measurementtodatacollection3VO.dataCollectionOrder;
		}
	}
	
	if (!merged){
			if (type == "FRAMES"){
				return 'gray';
			}
	}
	
	if (type == "SUBTRACTED"){
		return "#DF01D7";
	}
	
	return this.orderColors[order];
};

DataCollectionCurveVisualizer.prototype._getDataStore = function (){
	return Ext.create('Ext.data.Store', {
	    fields			: ['filePath', 'type', 'frameId', 'specimen', 'subtractionId'],
	    data 			: [],
	    groupField		: 'type',
	    sorters			: [{
							        //property: 'frameId',
								property : 'filePath',
							        direction: 'ASC' 
	    }]
	});
	
};

	
DataCollectionCurveVisualizer.prototype.getLegendGrid = function (){
	this.legendStore = this._getDataStore();
	var height = this.height*2/3 - 10 - 60; // 1- is the padding and 50 is the radio button for linear and log
	var width =  this.width/5 - 10;
	
	var panel = this.getFrameGrid(this.legendStore, width, height, 'Legend', false);  
	return panel;
};

DataCollectionCurveVisualizer.prototype.getSettingsPanel = function (width){
     var _this = this;
	 return {
     				xtype 		: 'container',
     				layout		: 'vbox',
     				items		: [
			     	     		  {
			     	     	        xtype: 'fieldset',
//			     	     	        border	: 1,
		     	     		    	height	: 50,
		     	     		    	width	: width,
		     	     		    	margin	: '5 0 5 0',
			     	     	        items: [{
			     	     	        	 		xtype: 'radiogroup',
					     	     	        	listeners : {
					     	     					change : function(checkbox, newValue, oldValue, eOpts) {
					     	     						_this.linear = newValue.linear;
					     	     						_this._renderPlot(_this.selected);
					     	     					}
					     	     				},
					     	     	            items: [
					     	     	                    {boxLabel: 'Log', name: 'linear', inputValue: false, checked: true},
					     	     	                  	{boxLabel: 'Linear', name: 'linear', inputValue: true}
					     	     	            ]
			     	     	        		}]
			     	     	        }
			     	]
     }
};

DataCollectionCurveVisualizer.prototype.getFrameGrid = function (store, width, height, title, selectionMode){
	var _this = this;
	var selModel = null;
	if (selectionMode){
		selModel = Ext.create('Ext.selection.RowModel', {
			allowDeselect		: true,
			mode				: 'MULTI',
			listeners			: {
							        selectionchange: function (sm, selections) {
							            var selected = new Array();
							            for (var i = 0; i < selections.length; i++) {
							                selected.push(selections[i].raw);
							            }
							            _this._renderPlot(selected);
							            _this.legendStore.loadData(selected);
							        }
			}
		});
	}
	
	return Ext.create('Ext.grid.Panel', {
	    store				: store,
	    height 				: height - 120,
	    width				: width,
	    selModel			: selModel,
	    features 			: [{ftype:'grouping'}],
	    columns				: [
	           				   		{ 
	           				   			text			: title,  
	           				   			dataIndex		: 'filePath', 
	           				   			flex			: 1,
	           				   			renderer		:   function(val,b,record,a){ 
	           				   									var fontweight = 'italic';
	           				   									var color = record.raw.color;
	           				   									
	           				   									if (record.raw.merged){
	           				   										fontweight = 'bold';
	           				   									}
	           				   									else{
	           				   										if (record.raw.type == "FRAMES"){
	           				   											val = val + " <span style='font-size:9px;font-weight:bold;color:red';>[discarded]</span>"
	           				   										}
	           				   									}
	           				   									
	           				   									if (((record.raw.type == "SUBTRACTED")||(record.raw.type == "OUT"))&&(color == _this.orderColors[1])){
	           				   										val = val + " <span style='font-size:9px;font-weight:bold;color:gray';>[Previous data collection]</span>"
	           				   									}
	           				   									
	           				   									return "<span style='font-weight:" + fontweight +";color:" + color + "'>" + val + "</span>";
	           				   			}
           				   			},
	           				   		{ text: 'Type',  dataIndex: 'type', flex: 1, hidden: true}
	           				   	
	    ]
	});
};

DataCollectionCurveVisualizer.prototype.getGrid = function (){
	var _this = this;
	
	this.store = this._getDataStore();
	var height = this.height;// - 50;
	var width =  this.width/5 - 5;
	this.framesPanel = this.getFrameGrid(this.store, width, height, 'Frames', true);  
	
	this.framesPanel.on("afterrender", function(){
	});
	return this.framesPanel;
};

DataCollectionCurveVisualizer.prototype._renderPlotFromData = function (data){
//	
	
	var targetId = this.id + '_plot';
	var input = new Array();
	/** Getting point X **/
	if (data != null){
		if (data.length > 0){
			for ( var i = 0; i < data.length; i++) {
				for ( var frameId in data[i]) {
					input.push(data[i][frameId])
				}
			}
		}
	}
	
	/** Getting labels and colors**/
	var labels = ["X"];
	var colors = new Array();
	if (data != null){
		if (data.length > 0){
			for ( var i = 0; i < data.length; i++) {
				for ( var frameId in data[i]) {
					labels.push(frameId);
				}
			}
		}
	}
	for ( var k = 0; k < this.selected.length; k++) {
//		if ((this.selected[k].frameId == frameId)||(this.selected[k].mergeId == frameId)||(this.selected[k].subtractionId == frameId)){
			colors.push(this.selected[k].color);
//		}
	}
	
	
	var parsed = new Array();
	var points = 10000000;
	
	/** It may happen that different files contains different number of points 
	 * in that case we that the file with the smaller number of points
	 * **/
	var index = 0;
	for ( var i = 0; i < input.length; i++) {
		var nPoints = Number(input[i].length);
		if (nPoints < points){
			points = nPoints;
			index = i;
		}
	}
	
	for ( var i = 0; i < input[index].length; i++) {
		var x = Number(input[index][i][0]);
		parsed.push([x]);
	}
	
	for ( var i = 0; i < input.length; i++) {
		for ( var j = 0; j < points; j++) {
			try{
			var y =   (parseFloat(input[i][j][1]));
			var error = Math.abs(parseFloat(input[i][j][2]));
			if (j == 1705){
				
			}
			parsed[j].push(this._getCoordinates(y, error));
			}
			catch(e){
				
			}
		}
	}
	
	this._renderDygraph(targetId, parsed, colors, labels);
};

DataCollectionCurveVisualizer.prototype._renderDygraph = function (targetId, parsed, colors, labels){
	var dygraphObject = new StdDevDyGraph(targetId, {
		width 				: this.width*3/5 - 60,
		height				: this.height*2/3 - 30,
		xlabel				: "q (nm-1)",
		showRangeSelector	: false
	});
	
	dygraphObject.draw(parsed, colors, labels);
};


DataCollectionCurveVisualizer.prototype._getCoordinates = function (y, error){
	var minus = y- error;
	var max = y + error;
	
	if (this.linear){
		return [Math.abs(minus), y , Math.abs(max)];
	}
	if ((minus!= 0)&&(max != 0)){
		return [Math.log(Math.abs( minus)), Math.log(y), Math.log(Math.abs(max))];
	}
	else{
		return [Math.log(y), Math.log(y), Math.log(y)];
	}
};


DataCollectionCurveVisualizer.prototype._renderPlot = function (selected){
	var _this = this;
	
	this.selected = selected;
	
	
	var frameIds = new Array();
	var mergeIds = new Array();
	var subtractionIds = new Array();
	for ( var i = 0; i < selected.length; i++) {
		if (selected[i].frameId != null){
			frameIds.push(selected[i].frameId);
		}
		if (selected[i].mergeId != null){
			mergeIds.push(selected[i].mergeId);
		}
		
		if ((selected[i].mergeId == null)&&(selected[i].frameId == null)){
			if (selected[i].subtractionId != null){
				subtractionIds.push(selected[i].subtractionId);
			}
		}
	}
	
	var dataAdapter = new BiosaxsDataAdapter();
	dataAdapter.onSuccess.attach(function(sender, data){
		_this._renderPlotFromData(data);
	});

	dataAdapter.onError.attach(function(sender, error){
		alert("Oooops... there was an error")
	});
	
	
	dataAdapter.getScatteringCurveByFrameIdsList(frameIds, mergeIds, subtractionIds);
};

DataCollectionCurveVisualizer.prototype.getPanel = function (){
	var _this = this;
	this.panel =  Ext.create('Ext.form.Panel', {
			id 		: this.id + 'main', 
	        border	: 0,
	        height	: this.height,
	        width 	: this.width,
	        layout: {
	            type: 'table',
	            columns: 3
	        },
	        layout: 'hbox',
	        items: [
	               
	                {
	                	xtype 		: 'container',
	                	layout		: 'vbox',
	                	items		: [
	                	     		    {
	                	     		    	html	: '<div style="background-color:gray;" id="'+ _this.id + '_header";></div>',
	                	     		    	height	: 70,
	                	     		    	width	: _this.width/5 - 5,
	                	     		    	margin	: '0 0 5 0'
	                	     		    },
	                	     		   	this.getGrid()
	                	     		   
	                	]
	                },
	                {
	                	xtype 		: 'container',
	                	layout		: 'vbox',
	                	items		: [
			                	     		{
			              	                	xtype 		: 'container',
			              	                	layout		: 'hbox',
			              	                	width		: this.width*4/5 - 40,
			              	                	height		: this.height*2/3 - 10,
			              	                	items		: [
			              	                	     		  {
				      			              	                	html	: '<br/><div id="' + this.id + '_plot" ></div>',
				      			              	                	width	: this.width*3/5 - 40,
				      			              	                	height	: this.height*2/3 - 10,
				      			              	                	margin	: '0 5 0 5'
			              	                	     		  },
				              	                	     	{
				      			              	                	xtype 		: 'container',
				      			              	                	layout		: 'vbox',
				      			              	                	items 		: [
				      			              	                	      		   	this.getLegendGrid(),
				      			              	                	      		   	this.getSettingsPanel(this.width/5 - 10)
			              	                	     		  					]
				              	                	     		}
			              	                	]
			              	                },
			              	                {
			              	                	xtype 		: 'container',
			              	                	layout		: 'hbox',
			              	                	width		: this.width*4/5 - 40,
			              	                	height		: this.height/2 - 10,
			              	                	margin		: "5 0 0 0",
			              	                	items		: [
			              	                	     		  {
				      			              	                	html			: '<div id="' + this.id + '_scattering" ></div>',
				      			              	                	width			: this.width*1/5 - 20,
				      			              	                	height			: this.height/3 - 45,
				      			              	                	margin			: '0 5 0 5'
			              	                	     		  },
			              	                	     		  {
				              	                	     			  html			: '<div id="' + this.id + '_kratky" ></div>',
				              	                	     			  width			: this.width*1/5  - 20,
				              	                	     			  height		: this.height/3 - 45,
				              	                	     			  margin		: '0 5 0 5'
			              	                	     		  },
			              	                	     		  {
				      			              	                	html			: '<div id="' + this.id + '_guinier" ></div>',
				      			              	                	width			: this.width*1/5  - 20,
				      			              	                	height			: this.height/3 - 45,
				      			              	                	margin			: '0 5 0 5'
			              	                	     		  },
			              	                	     		  {
				      			              	                	html			: '<div id="' + this.id + '_gnom" ></div>',
				      			              	                	width			: this.width*1/5  - 20,
				      			              	                	height			: this.height/3 - 45,
				      			              	                	margin			: '0 5 0 5'
			              	                	     		  },
			              	                	]
			              	                }
	                	]
	                }
	               
	                
            ]
	    });
	
	 return this.panel;
};
 







function CurveVisualizer(args){
	if (args == null){
		args = {};
	}
	this.width = 800;
	this.height = 500;
	if (args != null){
		if (args.width != null){
			this.width = args.width;
		}
		
		if (args.height != null){
			this.height = args.height;
		}
	}
	
	DataCollectionCurveVisualizer.prototype.constructor.call(this, {width : this.width, height : this.height});
};

CurveVisualizer.prototype.draw = DataCollectionCurveVisualizer.prototype.draw;
//CurveVisualizer.prototype._getPrefixes =	DataCollectionCurveVisualizer.prototype._getPrefixes;
CurveVisualizer.prototype._getFrames =DataCollectionCurveVisualizer.prototype._getFrames;
CurveVisualizer.prototype._getAverages = DataCollectionCurveVisualizer.prototype._getAverages;
CurveVisualizer.prototype._getSubtractionByDataCollectionId = DataCollectionCurveVisualizer.prototype._getSubtractionByDataCollectionId ;
CurveVisualizer.prototype.getLastMerges = DataCollectionCurveVisualizer.prototype.getLastMerges;
CurveVisualizer.prototype._prepareData = DataCollectionCurveVisualizer.prototype._prepareData;
CurveVisualizer.prototype._getImageHTML = DataCollectionCurveVisualizer.prototype._getImageHTML;
CurveVisualizer.prototype._getDataStore = DataCollectionCurveVisualizer.prototype._getDataStore;
//CurveVisualizer.prototype.getLegendGrid = DataCollectionCurveVisualizer.prototype.getLegendGrid;
//CurveVisualizer.prototype.getSettingsPanel = DataCollectionCurveVisualizer.prototype.getSettingsPanel;
CurveVisualizer.prototype.getGrid = DataCollectionCurveVisualizer.prototype.getGrid;
CurveVisualizer.prototype._renderPlotFromData = DataCollectionCurveVisualizer.prototype._renderPlotFromData;
CurveVisualizer.prototype._getCoordinates = DataCollectionCurveVisualizer.prototype._getCoordinates;
//CurveVisualizer.prototype._renderPlot = DataCollectionCurveVisualizer.prototype._renderPlot;

CurveVisualizer.prototype.refresh = function(mergeIdsList){
	this.mergeIdsList = mergeIdsList;
	this.draw();
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, averageList){
		var averageListId = [];
		if (averageList != null){
			if (averageList.length > 0){
				for(var i = 0; i < averageList.length; i++){
					var average = averageList[i];
					averageListId.push(average.mergeId);
					if (average.framelist3VO != null){
						var frames = [];
						if (average.framelist3VO.frametolist3VOs != null){
							var framesId = [];
							/** Adding averaged **/
							frames.push({
								type : "AVERAGE",
								color : "blue",
								merged : "true",
								filePath : average.averageFilePath,
								frameId : null,
								mergeId : average.mergeId
								
							});
						
							
							/** Sorting average.framelist3VO.frametolist3VOs **/
							average.framelist3VO.frametolist3VOs.sort(function(a,b){ return a.frame3VO.frameId - b.frame3VO.frameId;});
							for (var j = 0; j < average.framelist3VO.frametolist3VOs.length; j++){
								if (average.framelist3VO.frametolist3VOs[j].frame3VO != null){
									framesId.push(average.framelist3VO.frametolist3VOs[j].frame3VO.frameId);
									frames.push(average.framelist3VO.frametolist3VOs[j].frame3VO);
									
									if ((parseInt(average.framesMerge)) > j){
										frames[frames.length -1]["type"] = "FRAMES";
										frames[frames.length -1]["merged"] = true;
										frames[frames.length -1]["color"] = "green";
									}
									else{
										frames[frames.length -1]["type"] = "FRAMES";
										frames[frames.length -1]["merged"] = false;
										frames[frames.length -1]["color"] = "red";
									}
								}
							}
							/** All frames are selected so they will be plotted **/
							_this.selected = frames;
							_this.store.loadData(frames, true);
						}
					}
				}
				var adapter2 = new BiosaxsDataAdapter();
				adapter2.onSuccess.attach(function(sender, data){
					
					_this._renderPlotFromData(data);
				});
				/** Read the file and returns a json with the three columns values **/
				adapter2.getScatteringCurveByFrameIdsList(framesId, averageListId, []);
			}
		}
	});
	adapter.getMergesByIdsList(mergeIdsList);	
};



CurveVisualizer.prototype.getPanel = function (){
	var _this = this;
	this.panel =  Ext.create('Ext.form.Panel', {
			id 		: this.id + 'main', 
	        bodyStyle: 'padding:5px 5px 5px  5px',
	        height	: this.height,
	        width 	: this.width,
	        layout: 'hbox',
	        items: [  {
		                	xtype 		: 'container',
		                	layout		: 'vbox',
		                	items		: [this.getGrid()  ]
		              },
		     		  {
	  	                	html	: '<br/><div id="' + this.id + '_plot" ></div>',
	  	                	width	: this.width*4/5 - 30,
	  	                	height	: this.height - 50,
	  	                	margin	: '0 5 0 5'
		     		  }]
	    });
	
	 return this.panel;
};
 
CurveVisualizer.prototype.getFrameGrid = function (store, width, height, title, selectionMode){
	var _this = this;
	var selModel = null;
	if (selectionMode){
		selModel = Ext.create('Ext.selection.RowModel', {
			allowDeselect		: true,
			mode				: 'MULTI',
			listeners			: {
							        selectionchange: function (sm, selections) {
							            var selected = new Array();
							            for (var i = 0; i < selections.length; i++) {
							                selected.push(selections[i].raw);
							            }
							            _this._renderPlot(selected);
							        }
			}
		});
	}
	
	return Ext.create('Ext.grid.Panel', {
	    store				: store,
	    height 				: height - 50,
	    width				: width,
	    selModel			: selModel,
	    features 			: [{ftype:'grouping'}],
	    dockedItems: [{
	        xtype: 'toolbar',
	        dock: 'bottom',
	        items: [
	            { 
	            	xtype	: 'button', 
	            	text	: 'Download',
	            	handler	: function(){
	            		var fileName = "download";
	            		var url = "/ispyb/user/dataadapter.do?reqCode=getZipFileByAverageListId&fileName=" + fileName
    					+ "&mergeIdsList=" + _this.mergeIdsList.toString() + "&subtractionIdList=" + _this.subtractionIdList.toString();
	            		
	            		console.log(url);
	            		window.location.href = url;
	            	} 
	            }
	        ]
	    }],
	    columns				: [
	           				   		{ 
	           				   			text			: title,  
	           				   			dataIndex		: 'filePath', 
	           				   			flex			: 1,
	           				   			renderer		:   function(val,b,record,a){ 
	           				   									val = val.split("/")[val.split("/").length -1];
	           				   									var fontweight = 'italic';
	           				   									var color = record.raw.color;
	           				   									
	           				   									if (record.raw.merged){
	           				   										fontweight = 'bold';
	           				   									}
	           				   									else{
	           				   										if (record.raw.type == "FRAMES"){
	           				   											val = val;
	           				   										}
	           				   									}
	           				   									if (((record.raw.type == "SUBTRACTED")||(record.raw.type == "OUT"))&&(color == _this.orderColors[1])){
	           				   										val = val + " <span style='font-size:9px;font-weight:bold;color:gray';>[Previous data collection]</span>"
	           				   									}
	           				   									return "<span style='font-weight:" + fontweight +";color:" + color + "'>" + val + "</span>";
	           				   			}
           				   			},
	           				   		{ text: 'Type',  dataIndex: 'type', flex: 1, hidden: true}
	           				   	
	    ]
	});
};

CurveVisualizer.prototype._renderDygraph = function (targetId, parsed, colors, labels){
	var dygraphObject = new StdDevDyGraph(targetId, {
		width 				: this.width*4/5 - 60,
		height				: this.height - 50,
		xlabel				: "q (nm-1)",
		showRangeSelector	: false
	});
	dygraphObject.draw(parsed, colors, labels);
};


/**
SUBTRACTION CURVE VISUALIZER
**/
function SubtractionCurveVisualizer(args){
	if (args == null){
		args = {};
	}
	this.width = 800;
	this.height = 500;
	if (args != null){
		if (args.width != null){
			this.width = args.width;
		}
		
		if (args.height != null){
			this.height = args.height;
		}
	}
	
	CurveVisualizer.prototype.constructor.call(this, {width : this.width, height : this.height});
};

SubtractionCurveVisualizer.prototype.draw = CurveVisualizer.prototype.draw;
SubtractionCurveVisualizer.prototype._getFrames =CurveVisualizer.prototype._getFrames;
SubtractionCurveVisualizer.prototype._getAverages = CurveVisualizer.prototype._getAverages;
SubtractionCurveVisualizer.prototype._getSubtractionByDataCollectionId = CurveVisualizer.prototype._getSubtractionByDataCollectionId ;
SubtractionCurveVisualizer.prototype.getLastMerges = CurveVisualizer.prototype.getLastMerges;
SubtractionCurveVisualizer.prototype._prepareData = CurveVisualizer.prototype._prepareData;
SubtractionCurveVisualizer.prototype._getImageHTML = CurveVisualizer.prototype._getImageHTML;
SubtractionCurveVisualizer.prototype._getDataStore = CurveVisualizer.prototype._getDataStore;
SubtractionCurveVisualizer.prototype.getGrid = CurveVisualizer.prototype.getGrid;
SubtractionCurveVisualizer.prototype._renderPlotFromData = CurveVisualizer.prototype._renderPlotFromData;
SubtractionCurveVisualizer.prototype._getCoordinates = CurveVisualizer.prototype._getCoordinates;

SubtractionCurveVisualizer.prototype.refresh = function(mergeIdsList, subtractionIdList){
	this.mergeIdsList = mergeIdsList;
	this.subtractionIdList = subtractionIdList;
//	this.draw();
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	_this.rawFrameData = [];
	/** Clean store **/
	_this.store.loadData([], false);
	
	var framesId = [];
	adapter.onSuccess.attach(function(sender, averageList){
		var averageListId = [];
		_this.selected = [];
		if (averageList != null){
			if (averageList.length > 0){
				for(var i = 0; i < averageList.length; i++){
					var average = averageList[i];
					averageListId.push(average.mergeId);
					if (average.framelist3VO != null){
						var frames = [];
						if (average.framelist3VO.frametolist3VOs != null){
							
							/** Adding averaged **/
							frames.push({
								type : "AVERAGE",
								color : "blue",
								merged : "true",
								filePath : average.averageFilePath,
								frameId : null,
								mergeId : average.mergeId,
								key : average.mergeId
							});
						
							/** Selection only the averages **/
							_this.selected.push(frames[frames.length-1]);

							/** Sorting average.framelist3VO.frametolist3VOs **/
							average.framelist3VO.frametolist3VOs.sort(function(a,b){ return a.frame3VO.frameId - b.frame3VO.frameId;});
							for (var j = 0; j < average.framelist3VO.frametolist3VOs.length; j++){
								if (average.framelist3VO.frametolist3VOs[j].frame3VO != null){
									var frameId = average.framelist3VO.frametolist3VOs[j].frame3VO.frameId;
									framesId.push(frameId);
									frames.push(average.framelist3VO.frametolist3VOs[j].frame3VO);
									
									frames[frames.length -1]["type"] = "FRAME";
									frames[frames.length -1]["key"] = frameId;
									
									if ((parseInt(average.framesMerge)) > j){
										frames[frames.length -1]["merged"] = true;
										frames[frames.length -1]["color"] = "#00CC66";
										
									}
									else{
										frames[frames.length -1]["merged"] = false;
										frames[frames.length -1]["color"] = "#FF6666";
									}
								}
							}
							/** NOT All frames are selected so they will NOT be plotted **/
							//_this.selected = frames;
							_this.store.loadData(frames, true);
						}
					}
				}
				var adapter2 = new BiosaxsDataAdapter();
				adapter2.onSuccess.attach(function(sender, data){
					/** We keep all the data in order to redisplay when users click in a frame **/
					_this.rawFrameData = _this.rawFrameData.concat(data);
					/**
					 * Frames to be added to the list of frames
					 */
					var subtractionFrames = [];
					var CONSTANT_SUBSTRACTION = "*SUBTRACTION*";
					
					/** Looking for the subtracted **/
					for (index in Object.keys(data)){
						var key = Object.keys(data[index])[0];
						
						if (key.indexOf(CONSTANT_SUBSTRACTION) != -1){
							framesId.push(key);
							/** Getting the filename **/
							var fileName = key.split("*")[key.split("*").length -1];
							subtractionFrames.push({
									filePath : fileName,
									color : "purple",
									merged : true,
									type : "SUBTRACTION",
									key : key
							});
						}
					}
					
					/** 
					 * This data could contains the average sample and buffer in case of having subtractions,
					 * These files are composed by:
					 * subtractionId + "_SAMPLE_AVERAGE" + filename
					 * subtractionId + "_BUFFER_AVERAGE" + filename
					 */
					var CONSTANT_SAMPLE = "*SAMPLE*AVERAGE*";
					var CONSTANT_BUFFER = "*BUFFER*AVERAGE*";
				
					for (index in Object.keys(data)){
						var key = Object.keys(data[index])[0];
						if (key.indexOf(CONSTANT_SAMPLE) != -1){
							framesId.push(key);
							/** Getting the filename **/
							var fileName = key.split("*")[key.split("*").length -1];
							subtractionFrames.push({
									filePath : fileName,
									color : "black",
									merged : true,
									type : "SUBTRACTION",
									key : key
							});
							
						}
						if (key.indexOf(CONSTANT_BUFFER) != -1){
							framesId.push(key);
							/** Getting the filename **/
							var fileName = key.split("*")[key.split("*").length -1];
							subtractionFrames.push({
									filePath : fileName,
									color : "grey",
									merged : true,
									type : "SUBTRACTION",
									key : key
							});
						}
					}
					
					_this.selected = _this.selected.concat(subtractionFrames);
					_this.store.loadData(subtractionFrames, true);
					
					/** Selecting the data from the selected **/
					var selectedKeys = {};
					for (var i in _this.selected){
						selectedKeys[_this.selected[i].key] = true;
					}
					
					var selectedData = [];
					for (var i =0; i< data.length; i++){
						var key = Object.keys(data[i])[0];
						if (selectedKeys[key] != null){
							selectedData.push(data[i]);
						}
					}
					

					_this._renderPlotFromData(selectedData);
//					_this.framesPanel.setLoading(false);
				});
				
				/** Read the file and returns a json with the three columns values **/
				adapter2.getScatteringCurveByFrameIdsList(framesId, averageListId, subtractionIdList);
			}
		}
	});
//	this.framesPanel.setLoading("Retrieving");
	adapter.getMergesByIdsList(mergeIdsList);	
};



SubtractionCurveVisualizer.prototype.getPanel = function (){
	var _this = this;
	this.panel =  Ext.create('Ext.form.Panel', {
			id 		: this.id + 'main', 
	        bodyStyle: 'padding:5px 5px 5px  5px',
	        height	: this.height,
	        width 	: this.width,
	        layout: 'hbox',
	        items: [  {
		                	xtype 		: 'container',
		                	layout		: 'vbox',
		                	items		: [this.getGrid()  ]
		              },
		     		  {
	  	                	html	: '<br/><div id="' + this.id + '_plot" ></div>',
	  	                	width	: this.width*4/5 - 30,
	  	                	height	: this.height - 50,
	  	                	margin	: '0 5 0 5'
		     		  }]
	    });
	
	 return this.panel;
};
 
SubtractionCurveVisualizer.prototype.getFrameGrid = function (store, width, height, title, selectionMode){
	var _this = this;
	var selModel = null;
	if (selectionMode){
		selModel = Ext.create('Ext.selection.RowModel', {
			allowDeselect		: true,
			mode				: 'MULTI',
			listeners			: {
							        selectionchange: function (sm, selections) {
							            var selected = new Array();
							            for (var i = 0; i < selections.length; i++) {
							                selected.push(selections[i].raw);
							            }
							            
							            /** This is because selection changes from not selected values to selected values **/
							            if (selected.length > 0){
							            	_this._renderPlot(selected);
							            }
							        }
			}
		});
	}
	this.frameGrid =  Ext.create('Ext.grid.Panel', {
	    store				: store,
	    height 				: height - 50,
	    width				: width,
	    selModel			: selModel,
	    features 			: [{ftype:'grouping'}],
	    dockedItems: [{
	        xtype: 'toolbar',
	        dock: 'bottom',
	        items: [
	            { 
	            	xtype	: 'button', 
	            	text	: 'Download',
	            	handler	: function(){
	            		var fileName = "download";
	            		var url = "/ispyb/user/dataadapter.do?reqCode=getZipFileByAverageListId&fileName=" + fileName
    					+ "&mergeIdsList=" + _this.mergeIdsList.toString() + "&subtractionIdList=" + _this.subtractionIdList.toString();
	            		window.location.href = url;
	            	} 
	            }
	        ]
	    }],
	    columns				: [
	           				   		{ 
	           				   			text			: title,  
	           				   			dataIndex		: 'filePath', 
	           				   			flex			: 1,
	           				   			renderer		:   function(val,b,record,a){ 
	           				   									val = val.split("/")[val.split("/").length -1];
	           				   									var fontweight = 'italic';
	           				   									var color = record.raw.color;
	           				   									
	           				   									if (record.raw.merged){
	           				   										fontweight = 'bold';
	           				   									}
	           				   									else{
	           				   										if (record.raw.type == "FRAMES"){
	           				   											val = val;
	           				   										}
	           				   									}
	           				   									if (((record.raw.type == "SUBTRACTED")||(record.raw.type == "OUT"))&&(color == _this.orderColors[1])){
	           				   										val = val + " <span style='font-size:9px;font-weight:bold;color:gray';>[Previous data collection]</span>"
	           				   									}
	           				   									return "<span style='font-weight:" + fontweight +";color:" + color + "'>" + val + "</span>";
	           				   			}
           				   			},
	           				   		{ text: 'Type',  dataIndex: 'type', flex: 1, hidden: true}
	           				   	
	    ]
	});
	
	return this.frameGrid;
};

SubtractionCurveVisualizer.prototype._renderDygraph = function (targetId, parsed, colors, labels){
	var dygraphObject = new StdDevDyGraph(targetId, {
		width 				: this.width*4/5 - 60,
		height				: this.height - 50,
		xlabel				: "q (nm-1)",
		showRangeSelector	: false
	});
	dygraphObject.draw(parsed, colors, labels);
};


SubtractionCurveVisualizer.prototype._renderPlot = function (selected){
	var _this = this;
	
	this.selected = selected;
	
	var data = [];
	for (var j = 0; j < selected.length; j++) {
		for (var i = 0; i < _this.rawFrameData.length; i++){
			if (Object.keys(_this.rawFrameData[i])[0] == selected[j].key){
				data.push(_this.rawFrameData[i]);
			}
		}
	}

	this._renderPlotFromData(data);
};

/**
 * 
 * DataCollectionFrameTree a list tree with the 1D files sorted by: none, macromolecules, datacollections
 * 
 * @height
 * #onSelectionChanged when clicked on an item
 */
function DataCollectionFrameTree(args) {
	this.height = 100;
	if (args != null) {
		if (args.height != null) {
			this.height = args.height;
		}
	}
	this.id = BUI.id();
	this.framesIdToVisualize = [];
	this.framesId = {};
	this.labelsId = {};

	/** Events **/
	this.onSelectionChanged = new Event();
}

DataCollectionFrameTree.prototype.getPanel = function() {
	return {
		id : this.id,
		title : 'Criteria',
		split : true,
		width : 250,
		minHeight : 550,
		collapsible : true,
		collapseDirection : Ext.Component.DIRECTION_LEFT,
		margins : '0 5 5 0',
		layout : 'accordion',
		height : this.height - 90,

		layoutConfig : {
			animate : true
		},
		items : [ {
			title : 'List',
			autoScroll : true,
			border : false,
			items : [ this.getListGrid() ]
		},
		{
			title : 'Tree',
			border : false,
			autoScroll : true,
			items : [ this.getFramesTree() ]
		} ]
	};
};

/** Macromolecule Grid **/
DataCollectionFrameTree.prototype.getListGrid = function() {
	var _this = this;
	this.listStore = Ext.create('Ext.data.Store', {
		fields : [ 'frameId', 'filePath' ],
		autoload : false
	});

	this.listStore.sort('filePath');
	this.listGrid = Ext.create('Ext.grid.Panel', {
		id : 'listGrid' + this.id,
		store : this.listStore,
		columns : [ {
			text : 'File',
			dataIndex : 'filePath',
			flex : 1,
			renderer : function(val) {
				return val.split("/")[val.split("/").length - 1];

			}
		} ],
		columnLines : true,
		multiSelect : true,
		flex : 1,
		border : 0,
		listeners : {
			'selectionchange' : function(model, selected, eOpts) {
				var selectedFrames = [];
				for ( var i = 0; i < selected.length; i++) {
					selectedFrames.push(selected[i].data.frameId);
				}
				_this.notifySelectionChanged(selectedFrames);
			}
		}
	});
	return this.listGrid;
};

DataCollectionFrameTree.prototype.getDataCollectionCode = function(dataCollection) {
	var code = "";
	for ( var i = 0; i < dataCollection.measurementtodatacollection3VOs.length; i++) {
		var macromolecule = this.getMacromoleculeByMeasurementId(dataCollection.measurementtodatacollection3VOs[i].measurementId);//BIOSAXS.proposal.getMacromoleculeById(specimen);
		if (macromolecule != null) {
			return macromolecule.acronym;// + ":  " + parseFloat(sample.concentration).toFixed(2) + " mg/ml";
		}
	}
	return code;
};

DataCollectionFrameTree.prototype.getCollectionNode = function(dataCollection, merges) {
	return {
		File : this.getDataCollectionCode(dataCollection),
		expanded : true,
		children : this.getMeasurements(dataCollection, merges)
	};
};

DataCollectionFrameTree.prototype.getData = function(dataCollections, merges) {
	var treeData = [];
	for ( var i = 0; i < dataCollections.length; i++) {
		dataCollection = dataCollections[i];
		treeData.push(this.getCollectionNode(dataCollection, merges));
	}
	return treeData;
};

DataCollectionFrameTree.prototype.getSpecimenByMeasurementId = function(measurementId) {
	var measurement = this.experiments[0].getMeasurementById(measurementId);
	return this.experiments[0].getSpecimenById(measurement.specimenId);
};

DataCollectionFrameTree.prototype.getMacromoleculeByMeasurementId = function(measurementId) {
	var specimen = this.getSpecimenByMeasurementId(measurementId);//this.experiments[0].getSpecimenById(measurement.specimenId);
	return BIOSAXS.proposal.getMacromoleculeById(specimen);
};

DataCollectionFrameTree.prototype.getMeasurements = function(dataCollection, merges) {
	var children = [];
	for ( var i = 0; i < dataCollection.measurementtodatacollection3VOs.length; i++) {
		var sample = this.getSpecimenByMeasurementId(dataCollection.measurementtodatacollection3VOs[i].measurementId);
		var code = "BUFFER";
		if (sample.macromolecule3VO != null) {
			code = sample.macromolecule3VO.acronym + ":  " + parseFloat(sample.concentration).toFixed(2) + " mg/ml";
		} else {
			code = BIOSAXS.proposal.getBufferById(sample.bufferId);//this.getBufferById(sample.bufferId).acronym;
		}
		var childrenFrames = this.getFrames(dataCollection.measurementtodatacollection3VOs[i].measurementId, merges);
		if (childrenFrames.length > 0) {
			/** Removing if there are no frames **/
			var childrenFiltered = [];
			for ( var j = 0; j < childrenFrames.length; j++) {
				if (childrenFrames[j].children != null) {
					if (childrenFrames[j].children.length > 0) {
						childrenFiltered.push(childrenFrames[j]);
					}
				} else {
					childrenFiltered.push(childrenFrames[j]);
				}
			}

			children.push({
				File : code,
				dataCollectionOrder : dataCollection.measurementtodatacollection3VOs[i].dataCollectionOrder,
				expanded : false,
				children : childrenFiltered,
				frameId : null
			});
		}
	}
	return children;
};

DataCollectionFrameTree.prototype.getFrames = function(measurementId, merges) {
	var data = [];
	if (merges != null) {
		for ( var i = 0; i < merges.length; i++) {
			if (merges[i].measurementId == measurementId) {
				for ( var f = 0; f < merges[i].framelist3VO.frametolist3VOs.length; f++) {
					var fileName = merges[i].framelist3VO.frametolist3VOs[f].frame3VO.filePath.split("/")[merges[i].framelist3VO.frametolist3VOs[f].frame3VO.filePath.split("/").length - 1];
					this.framesId[merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId] = this.getSpecimenByMeasurementId(measurementId);

					this.labelsId[merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId] = fileName;
					if (fileName.indexOf("_ave.dat") != -1) {
						data.push({
							File : fileName,
							frameId : merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId,
							id : merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId,
							expanded : true,
							leaf : true
						});
						this.framesIdToVisualize.push(merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId);
					}
				}
			}
		}
		data.push({
			File : "Frames",
			children : this.getFramesNoAverage(measurementId, merges),
			expanded : false,
			leaf : false
		});

	}
	return data;
};

DataCollectionFrameTree.prototype.getFramesNoAverage = function(measurementId, merges) {
	var data = [];
	if (merges != null) {
		for ( var i = 0; i < merges.length; i++) {
			if (merges[i].measurementId == measurementId) {
				for ( var f = 0; f < merges[i].framelist3VO.frametolist3VOs.length; f++) {
					var fileName = merges[i].framelist3VO.frametolist3VOs[f].frame3VO.filePath.split("/")[merges[i].framelist3VO.frametolist3VOs[f].frame3VO.filePath.split("/").length - 1];
					this.framesId[merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId] = this.getSpecimenByMeasurementId(measurementId);
					this.labelsId[merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId] = fileName;

					if (fileName.indexOf("_ave.dat") == -1) {
						data.push({
							File : fileName,
							frameId : merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId,
							id : merges[i].framelist3VO.frametolist3VOs[f].frame3VO.frameId,
							expanded : false,
							leaf : true
						});
					}
				}
			}
		}
	}
	return data;
};

DataCollectionFrameTree.prototype.getSpecimenById = function(specimenId) {
	for ( var i = 0; i < this.experiments.length; i++) {
		var specimen = this.experiments[i].getMeasurementById(specimenId);
		if (specimen != null) {
			return specimen;
		}
	}
	return null;
};

DataCollectionFrameTree.prototype.loadDatacollections = function(dataCollections, merges, experiments) {
	this.experiments = experiments;
	var macromolecules = [];
	var macromoleculesHash = [];
	for ( var i = 0; i < merges.length; i++) {
		var measurement = this.experiments[0].getMeasurementById(merges[i].measurementId);
		var specimen = this.experiments[0].getSpecimenById(measurement.specimenId);
		var macromolecule = BIOSAXS.proposal.getMacromoleculeById(specimen);
		if (macromolecule != null) {
			if (macromoleculesHash[macromolecule.acronym] == null) {
				macromolecules.push(macromolecule);
				macromoleculesHash[macromolecule.acronym] = true;
			}
		}
	}
	this.store.getRootNode().removeAll();
	this.store.getRootNode().appendChild(this.getData(dataCollections, merges));
	var frames = new ExperimentList().getFrames(merges);
	this.listStore.loadData(frames);
};

DataCollectionFrameTree.prototype.getDataCollectionById = function(dataCollectionId) {
	for ( var i = 0; i < this.experiments.length; i++) {
		var dataCollection = this.experiments[i].getDataCollectionById(dataCollectionId);
		if (dataCollection != null) {
			return dataCollection;
		}
	}
	return null;
};

DataCollectionFrameTree.prototype.notifySelectionChanged = function(frameListSelectedIds) {
	this.onSelectionChanged.notify({
		ids : frameListSelectedIds,
		framesHash : this.framesId,
		labelsHash : this.labelsId

	});
};

DataCollectionFrameTree.prototype.getFramesTree = function() {
	var _this = this;
	Ext.define('File', {
		extend : 'Ext.data.Model',
		fields : [ {
			name : 'dataCollectionOrder',
			type : 'string'
		}, {
			name : 'File',
			type : 'string'
		}, {
			name : 'frameId',
			type : 'string'
		}, {
			name : 'id',
			type : 'string'
		} ]
	});

	this.store = Ext.create('Ext.data.TreeStore', {
		model : 'File',
		root : {
			expanded : true,
			children : []
		},
		autoload : true
	});

	this.store.sort([ {
		property : 'dataCollectionOrder',
		direction : 'ASC'
	}, {
		property : 'File',
		direction : 'ASC'
	} ]);

	this.tree = Ext.create('Ext.tree.Panel', {
		height : '465',
		minHeight : '465',
		selModel : {
			mode : 'MULTI',
			allowDeselect : true
		},
		allowDeselect : true,
		rootVisible : false,
		store : this.store,
		columns : [ {
			xtype : 'treecolumn',
			text : 'Data Collections',
			flex : 2,
			sortable : true,
			dataIndex : 'File',
			renderer : function(val, y, sample) {
				if (sample.raw.frameId == null) {
					return "<span style='font-size:small;'>" + val + "</span>";
				}

				if (val.indexOf("_ave.dat") != -1) {
					return "<span style='font-weight:bold;'>" + val + "</span>";
				}
				return "<span style='font-size:x-small;'>" + val + "</span>";
			}
		} ],
		listeners : {
			'selectionchange' : function(model, selected, eOpts) {
				var frameIdsList = [];
				for ( var i = 0; i < selected.length; i++) {
					if (selected[i].data.frameId != null) {
						if (selected[i].data.frameId != null) {
							if (selected[i].data.frameId != "") {
								frameIdsList.push(selected[i].data.frameId);
							}
						}
					}
				}

				if (frameIdsList.length > 0) {
					_this.notifySelectionChanged(frameIdsList);
				}
			}
		}
	});

	return this.tree;
};

DataCollectionFrameTree.prototype.input = function() {
	return DATADOC.getFrameTreeData();
};

DataCollectionFrameTree.prototype.test = function(targetId) {
	var dataCollectionFrameTree = new DataCollectionFrameTree({
		height : this.height
	});
	BIOSAXS.proposal = new Proposal(dataCollectionFrameTree.input().proposal);
	var panel = dataCollectionFrameTree.getPanel();
	dataCollectionFrameTree.loadDatacollections(dataCollectionFrameTree.input().dataCollections, dataCollectionFrameTree.input().merges, [ new Experiment(dataCollectionFrameTree.input().experiment) ]);
	Ext.create('Ext.panel.Panel', {
		width : 1000,
		items : [ panel ],
		renderTo : targetId
	});
};

function ExperimentTypeWizardForm(args) {
	var _this = this;
	this.height = 500;
	GenericStepWizardForm.call(
					this,
					"Select your type of experiment",
					{
						margin : "0 0 0 0",
						width : 475,
						border : 0,
						html : "Two type of experiments are allowed: <span style='font-weight:bold'>STATIC</span> and  <span style='font-weight:bold'>HPLC</span>. Static use quartz capillary as a part of automated sample changer allowing temperature variations (from 4 to 60C). HPLC (high performance liquid chromatography) system can be used in parallel with sample changer"
					}, {
						experimentType : "None"
					}, function() {
						console.log(_this.data);
					}, function() {
					});

}

ExperimentTypeWizardForm.prototype.getForm = function() {
	var _this = this;
	return Ext.create('Ext.panel.Panel', {
		width : 600,
		height : 250,
		border : 0,
		margin : "100 0 0 150",
		layout : "vbox",
		items : [ {
			xtype : 'fieldset',
			items : [ {
				xtype : 'checkboxgroup',
				width : 400,
				height : 100,
				border : 0,
				fieldLabel : 'Experiment Type',
				columns : 1,
				items : [ {
					boxLabel : 'Sample Changer',
					name : 'cb-col-2',
					checked : true
				}, {
					boxLabel : 'HPLC',
					name : 'cb-col-3',
					disabled : true
				} ]
			} ]
		} ]
	});
};

ExperimentTypeWizardForm.prototype.getNextForm = function() {
	return new MacromoleculeSelectorWizardForm();
};

ExperimentTypeWizardForm.prototype.input = function() {
	return [];
};

ExperimentTypeWizardForm.prototype.test = function(targetId) {
	var experimentTypeWizardForm = new ExperimentTypeWizardForm();
	var form = experimentTypeWizardForm.getForm();
	form.render(targetId);
};

function FinalStepWizardForm(measurements) {
	this.result = {};

	this.id = BUI.id();
	this.title = "Confirmation";
	this.description = "This is the last step of this wizard. Write a name and a description (optional) for your experiment. Remember you are able to add new measurements later on";
	this.height = 500;

	this.data = {
		measurements : measurements
	};
	var _this = this;
	this.onNext = function(data) {

		this.result = {
			name : Ext.getCmp(_this.id + "name").getValue(),
			comments : Ext.getCmp(_this.id + "description").getValue(),
			data : _this.data.measurements
		};

		_this.onWizardFinished.notify(this.result);
	};
	this.onBack = function() {
	};
	this.onWizardFinished = new Event(this);
}

FinalStepWizardForm.prototype.getForm = function() {
	this.panel = Ext.create('Ext.panel.Panel', {
		plain : true,
		frame : false,
		border : 1,
		margin : "100 100 100 100",

		fieldDefaults : {
			labelAlign : 'left',
			labelWidth : 90,
			anchor : '100%'
		},
		items : [ {
			xtype : 'textfield',
			name : 'Name',
			id : this.id + "name",
			width : 600,
			fieldLabel : 'Name',
			margin : '20 20 20 20',
			value : ''
		}, {
			xtype : 'textareafield',
			name : 'textarea1',
			id : this.id + "description",
			margin : '20 20 20 20',
			width : 600,
			fieldLabel : 'Description',
			value : ''
		} ]
	});
	return this.panel;
};

FinalStepWizardForm.prototype.getNextForm = function() {
	return null;
};

FinalStepWizardForm.prototype.input = function() {
	return [];
};

FinalStepWizardForm.prototype.test = function(targetId) {
	var experimentTypeWizardForm = new FinalStepWizardForm();
	var form = experimentTypeWizardForm.getForm();
	form.render(targetId);
};

/**
 * Class for managing wizards
 * 
 * @title
 * @description
 * @data
 * @onNextFn
 * @onBackFn
 **/ 
function GenericStepWizardForm(title, description, data, onNextFn, onBackFn){
	this.id = BUI.id();
	this.title = title;
	this.description = description;
	this.data = data;
	this.onNext = onNextFn;
	this.onBack = onBackFn;
}

GenericStepWizardForm.prototype.getForm = function(){
	alert("[getForm] Not implemented");

};

GenericStepWizardForm.prototype.getNextForm = function(){
	alert("[getNextForm] Not implemented");
};

/** When coming back to the same form **/
GenericStepWizardForm.prototype.reload = function(){
	alert("[getNextForm] Not implemented");
};



/** MACROMOLECULES SELECTOR **/
function MacromoleculeSelectorWizardForm(args) {
	var _this = this;
	this.height = 500;
	GenericStepWizardForm.call(this, "Select Macromolecules", {
		margin : "0 0 0 0",
		width : 475,
		border : 0,
		html : "Define the macromolecules involved in the experiment.<br /> Click on the macromolecule you want to select and <span style='font-weight:bold'>hold CONTROL</span> to select severals"
	}, {
		macromoleculesSelected : null
	}, function() {
		if (_this.nextForm != null) {
		}
	}, function() {

	});

}

MacromoleculeSelectorWizardForm.prototype.reload = function() {
	if (this.data.macromoleculesSelected != null) {
		for ( var i = 0; i < this.data.macromoleculesSelected.length; i++) {
			this.MacromoleculeGrid.selectById(this.data.macromoleculesSelected[i].macromoleculeId);
		}
	}
};

MacromoleculeSelectorWizardForm.prototype.getForm = function() {
	var _this = this;
	this.MacromoleculeGrid = new MacromoleculeGrid({
		height : 310,
		searchBar : false,
		tbar : false,
		collapsed : false,
		collapsible : false,
		btnEditVisible : false,
		btnRemoveVisible : false,
		multiselect : true,
		cssFontStyle : "font-size:small;"

	});

	this.MacromoleculeGrid.onSelected.attach(function(sender, selections) {
		_this.data.macromoleculesSelected = selections;
		var text = "Selected: ";
		for ( var i = 0; i < selections.length; i++) {
			text = text + selections[i].acronym + ", ";
			if (i == 5) {
				text = text + "<span style='font-weight:bold;'> and " + (selections.length - 6) + " more</span>";
				i = selections.length - 1;
			}
		}
		document.getElementById(_this.id + "selectHTML").innerHTML = text;
	});

	this.panel = Ext.create('Ext.panel.Panel', {
		plain : true,
		frame : false,
		height : 450,
		border : 0,
		margin : "20 5 5 10",
		items : [ _this.MacromoleculeGrid.getPanel([]), {
			margin : "10 0 0 10",
			width : 475,
			border : 0,
			html : "<div id='" + _this.id + "selectHTML'>None selected</div>"
		} ]
	});

	BIOSAXS.proposal.onInitialized.attach(function(sender) {
		_this.macromolecules = BIOSAXS.proposal.macromolecules;
		_this.MacromoleculeGrid.refresh(_this.macromolecules);
	});
	BIOSAXS.proposal.init();
	return this.panel;
};

MacromoleculeSelectorWizardForm.prototype.getNextForm = function() {
	if (this.nextForm == null) {
		this.nextForm = new MeasurementCreatorStepWizardForm(this.data.macromoleculesSelected);
	}
	return this.nextForm;
};

/** MEASUREMENTS SELECTOR **/
function MeasurementCreatorStepWizardForm(macromolecules, args) {
	var _this = this;

	this.height = 700;
	this.noNext = false;

	this.macromolecules = macromolecules;
	GenericStepWizardForm.call(this, "Define Measurements", {
		margin : "0 0 0 0",
		width : 475,
		border : 0,
		html : "Define only the macromolecule's measurement you want to make. This wizard will add <span style='font-weight:bold;'> buffers' measurement needed for substraction automatically. </span>"
	}, {
		measurementsSelected : null
	},
	/** Fuction next **/
	function() {

		if (_this.noNext) {
			var result = {
				name : "",
				comments : "",
				data : JSON.stringify(_this.parseMeasurements(_this.data.measurementsSelected))
			};
			_this.onWizardFinished.notify(result);
		}
	}, function() {
	});

	if (args != null) {
		if (args.noNext != null) {
			this.noNext = args.noNext;
		}
	}

	if (this.noNext) {
		this.onWizardFinished = new Event(this);
	}
}

MeasurementCreatorStepWizardForm.prototype.setData = function(data) {
	this.data.measurementsSelected = data;
	var buffers = {};
	var macromolecules = {};
	for ( var i = 0; i < this.data.measurementsSelected.length; i++) {
		var record = this.data.measurementsSelected[i];
		if (buffers[record.bufferId] == null) {
			buffers[record.bufferId] = {
				buffer : record.buffer_acronym,
				bufferId : record.bufferId,
				volume : 0,
				concentration : 0
			};
		}

		var macromoleculeId = record.macromoleculeId + "_" + record.bufferId + "_" + record.concentration;
		if (macromolecules[macromoleculeId] == null) {
			macromolecules[macromoleculeId] = {
				macromolecule : record.acronym,
				macromoleculeId : record.macromoleculeId,
				buffer : record.buffer_acronym,
				bufferId : record.bufferId,
				volume : 0,
				concentration : record.concentration
			};
		}

		buffers[record.bufferId].volume = Number(buffers[record.bufferId].volume) + (2 * record.volumeToLoad);
		macromolecules[macromoleculeId].volume = Number(macromolecules[macromoleculeId].volume) + (record.volumeToLoad);
	}

};

MeasurementCreatorStepWizardForm.prototype.getSingleMeasurementForm = function() {
	var macromoleculesComboManager = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.macromolecules, {
		width : 200,
		labelWidth : 100
	});
	var buffersCombo = BIOSAXS_COMBOMANAGER.getComboBuffers(BIOSAXS.proposal.getBuffers(), {
		margin : "0 0 0 80",
		width : 200,
		labelWidth : 100
	});

	var addButton = Ext.create('Ext.Button', {
		width : 200,
		height : 25,
		margin : "0 0 20 300",
		text : 'Add',
		scope : this,
		handler : function() {
			var quantity = Ext.getCmp(this.id + "quantity").getValue();
			var measurements = [];
			for (var i = 0; i < quantity; i++) {
				measurements.push(
						{
							acronym : BIOSAXS.proposal.getMacromoleculeById(macromoleculesComboManager.getValue()).acronym,
							macromoleculeId : macromoleculesComboManager.getValue(),
							bufferId : buffersCombo.getValue(),
							buffer_acronym : BIOSAXS.proposal.getBufferById(buffersCombo.getValue()).acronym,
							concentration : Ext.getCmp(this.id + "conc").getValue(),
							volumeToLoad : Ext.getCmp(this.id + "volume").getValue(),
							exposureTemperature : Ext.getCmp(this.id + "seu").getValue(),
							transmission : Ext.getCmp(this.id + "transmission").getValue(),
							waitTime : Ext.getCmp(this.id + "waitTime").getValue(),
							viscosity : Ext.getCmp(this.id + "viscosity").getValue(),
							flow : Ext.getCmp(this.id + "flow").getValue()
						});
			}
			this.measurementGrid.grid.getStore().loadData(measurements, true);

			this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items, 'data'))));
		}
	});

	return Ext.create('Ext.panel.Panel', {
		padding : "0 0 0 0",
		border : 0,
		margin : "10 5 20 10",
		height : 220,
		items : [ {
			xtype : 'container',
			layout : 'hbox',
			items : [ macromoleculesComboManager, buffersCombo,  {
				xtype : 'numberfield',
				id : this.id + "quantity",
				fieldLabel : 'Repeat',
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 50",
				minValue : 0,
				maxValue : 300,
				value : 1
			} ]
		}, {
			xtype : 'container',
			layout : 'hbox',
			items : [ {
				xtype : 'numberfield',
				id : this.id + "conc",
				fieldLabel : 'Conc. (mg/ml)',
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 0",
				minValue : 0,
				maxValue : 300,
				value : 1
			}, {
				xtype : 'numberfield',
				id : this.id + "seu",
				fieldLabel : 'Exposure. Temp.',
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 80",
				value : 4,
				minValue : 4,
				maxValue : 60
			} ]
		}, {
			xtype : 'container',
			margin : "5 0 0 0",
			layout : 'hbox',
			items : [ {
				xtype : 'numberfield',
				id : this.id + "volume",
				fieldLabel : 'Vol. To Load (&#181l)',
				labelWidth : 100,
				width : 200,
				value : 40,
				minValue : 10,
				maxValue : 300
			},

			{
				xtype : 'numberfield',
				id : this.id + "transmission",
				fieldLabel : 'Transmission (%)',
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 80",
				value : 100,
				minValue : 0,
				maxValue : 100
			}

			]
		}, {
			xtype : 'container',
			layout : 'hbox',
			margin : "5 0 0 0",
			items : [ {
				xtype : 'numberfield',
				id : this.id + "waitTime",
				fieldLabel : 'Wait Time',
				labelWidth : 100,
				width : 200,
				value : 0,
				minValue : 0,
				maxValue : 100
			}, {
				xtype : 'combo',
				id : this.id + "viscosity",
				store : [ "low", "medium", "high" ],
				fieldLabel : 'SC Viscosity',
				value : "low",
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 80"
			}, {
				xtype : 'checkbox',
				id : this.id + "flow",
				checked : true,
				fieldLabel : 'Flow',
				labelWidth : 100,
				width : 250,
				margin : "0 0 0 80"
			} ]
		}, {
			xtype : 'container',
			layout : 'hbox',
			margin : "30 0 0 0",
			items : [ addButton ]
		} ]
	});
};

MeasurementCreatorStepWizardForm.prototype.getConcentrationMeasurementForm = function() {

	var macromoleculesComboManager = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(this.macromolecules, {
		width : 200,
		labelWidth : 100
	});
	var buffersCombo = BIOSAXS_COMBOMANAGER.getComboBuffers(BIOSAXS.proposal.getBuffers(), {
		margin : "0 0 0 80",
		width : 200,
		labelWidth : 100
	});

	var addButton = Ext.create('Ext.Button', {
		width : 200,
		height : 25,
		margin : "0 0 20 300",
		text : 'Add',
		scope : this,
		handler : function() {
			var macromoleculeId = macromoleculesComboManager.getValue();
			var bufferId = buffersCombo.getValue();
			var concentrationCount = Ext.getCmp(this.id + "_cs_conc").getValue();
			var volume = Ext.getCmp(this.id + "_cs_volume").getValue();

			var transmission = Ext.getCmp(this.id + "_cs_transmission").getValue();
			var seu = Ext.getCmp(this.id + "_cs_seu").getValue();
			var waitTime = Ext.getCmp(this.id + "_cs_waitTime").getValue();
			var viscosity = Ext.getCmp(this.id + "_cs_viscosity").getValue();
			var flow = Ext.getCmp(this.id + "_cs_flow").getValue();

			var dataToBeLoaded = [];
			for ( var i = 1; i <= concentrationCount; i++) {
				dataToBeLoaded.push({
					acronym : BIOSAXS.proposal.getMacromoleculeById(macromoleculeId).acronym,
					macromoleculeId : macromoleculeId,
					bufferId : bufferId,
					buffer_acronym : BIOSAXS.proposal.getBufferById(bufferId).acronym,
					concentration : i,
					volumeToLoad : volume,
					exposureTemperature : seu,
					transmission : transmission,
					waitTime : waitTime,
					viscosity : viscosity,
					flow : flow

				});
			}
			this.measurementGrid.grid.getStore().loadData(dataToBeLoaded, true);
			this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items, 'data'))));
		}
	});

	return Ext.create('Ext.panel.Panel', {
		padding : "0 0 0 0",
		border : 0,
		margin : "5 5 20 10",
		height : 220,
		items : [

		{
			xtype : 'container',
			layout : 'hbox',
			items : [ macromoleculesComboManager, buffersCombo ]
		}, {
			xtype : 'container',
			layout : 'hbox',
			items : [ {
				xtype : 'requirednumberfield',
				id : this.id + "_cs_conc",
				fieldLabel : 'How many unknow concentrations do you have?',
				labelWidth : 380,
				style : {

					fontWeight : "bold"
				},
				width : 480,
				margin : "10 0 0 0",
				minValue : 0,
				maxValue : 20,
				value : 0
			} ]
		}, {
			xtype : 'container',
			margin : "10 0 0 0",
			layout : 'hbox',
			items : [ {
				xtype : 'numberfield',
				id : this.id + "_cs_seu",
				fieldLabel : 'Exposure. Temp.',
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 0",
				value : 4,
				minValue : 4,
				maxValue : 60
			}, {
				xtype : 'numberfield',
				margin : "0 0 0 80",
				id : this.id + "_cs_volume",
				fieldLabel : 'Vol. To Load (&#181l)',
				labelWidth : 100,
				width : 200,
				value : 40,
				minValue : 10,
				maxValue : 300
			},

			{
				xtype : 'numberfield',
				id : this.id + "_cs_transmission",
				fieldLabel : 'Transmission (%)',
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 80",
				value : 100,
				minValue : 0,
				maxValue : 100
			}

			]
		}, {
			xtype : 'container',
			layout : 'hbox',
			margin : "5 0 0 0",
			items : [ {
				xtype : 'numberfield',
				id : this.id + "_cs_waitTime",
				fieldLabel : 'Wait Time',
				labelWidth : 100,
				width : 200,
				value : 0,
				minValue : 0,
				maxValue : 100
			}, {
				xtype : 'combo',
				id : this.id + "_cs_viscosity",
				store : [ "low", "medium", "high" ],
				fieldLabel : 'SC Viscosity',
				value : "low",
				labelWidth : 100,
				width : 200,
				margin : "0 0 0 80"
			}, {
				xtype : 'checkbox',
				id : this.id + "_cs_flow",
				fieldLabel : 'Flow',
				checked : true,
				labelWidth : 100,
				width : 250,
				margin : "0 0 0 80"
			} ]
		}, {
			xtype : 'container',
			layout : 'hbox',
			margin : "20 0 0 0",
			items : [ addButton ]
		} ]
	});
};

MeasurementCreatorStepWizardForm.prototype.getForm = function() {
	var _this = this;

	this.formPanel = Ext.create('Ext.tab.Panel', {
		padding : "0 0 0 0",
		margin : "20 5 20 10",
		height : 220,
		items : [ {
			tabConfig : {
				title : 'Concentration Series'
			},
			items : this.getConcentrationMeasurementForm()
		},{
			tabConfig : {
				title : 'Individual Measurement'
			},
			items : [ this.getSingleMeasurementForm() ]
		} ]


	});
	this.measurementGrid = new MeasurementGrid({
		height : 300,
		maxHeight : 300,
		minHeight : 300,
		width : 870,
		tbar : false,
		maxWidth : 870,
		resizable : false,
		margin : "0 10 10 10",
		isStatusColumnHidden : true,
		isTimeColumnHidden : true,
		removeBtnEnabled : true,
		isPriorityColumnHidden : true
	});

	this.measurementGrid.onRemoved.attach(function(sender, data) {
		_this.setData(JSON.parse(Ext.encode(Ext.pluck(_this.measurementGrid.grid.getStore().data.items, 'data'))));
	});

	this.panel = Ext.create('Ext.panel.Panel', {
		plain : true,
		frame : false,
		border : 0,
		items : [ this.formPanel, this.addButton, this.measurementGrid.getPanel([]) ]
	});

	if (this.data.measurementsSelected != null) {
		/** Recover Data **/
		this.measurementGrid.grid.getStore().loadData(this.data.measurementsSelected, false);
		this.setData(JSON.parse(Ext.encode(Ext.pluck(this.measurementGrid.grid.getStore().data.items, 'data'))));
	}
	return this.panel;
};

MeasurementCreatorStepWizardForm.prototype.getBuffers = function(measurements) {
	var buffers = {};
	var macromolecules = {};
	var record = null;
	for ( var i = 0; i < measurements.length; i++) {
		record = measurements[i];
		if (buffers[record.bufferId] == null) {
			buffers[record.bufferId] = {
				buffer : record.buffer_acronym,
				bufferId : record.bufferId,
				volumeToLoad : record.volumeToLoad,
				volume : 0,
				concentration : 0,
				transmission : record.transmission,
				flow : record.flow,
				viscosity : record.viscosity,
			};
		}

		buffers[record.bufferId].volume = Number(buffers[record.bufferId].volume) + (2 * record.volumeToLoad);
	}

	/** Removing all **/
	var bufferSpecimens = [];
	for ( var buffer in buffers) {
		if (buffers.hasOwnProperty(buffer)) {
			record = buffers[buffer];
			bufferSpecimens.push({
				bufferId : record.bufferId,
				buffer : BIOSAXS.proposal.getBufferById(record.bufferId).acronym,
				concentration : record.concentration,
				volume : record.volume,
				volumeToLoad : record.volumeToLoad,
				transmission : record.transmission,
				flow : record.flow,
				viscosity : record.viscosity
	
			});
		}
	}
	return bufferSpecimens;
};

//MeasurementCreatorStepWizardForm.prototype.getBufferPosition = function(i) {
//	return {
//				plate : 2,
//				row : Math.floor(i / 3) + 1,
//				well : Number(Number(i % 3) + 9)
//	};
//};
//
//MeasurementCreatorStepWizardForm.prototype.getSamplePosition = function(i) {
//	return {
//				plate : 2,
//				row : Math.floor(i / 3) + 1,
//				well : Number(Number(i % 3) + 9)
//	};
//};

MeasurementCreatorStepWizardForm.prototype.parseMeasurements = function(measurements) {
	var _this = this;
	var parsed = [];
	var measurement = null;
	var i = null;
	/** For buffers **/
	var specimenBuffers = this.getBuffers(measurements);
	for (  i = 0; i < specimenBuffers.length; i++) {
//		var position = this.getBufferPosition(i);

		measurement = specimenBuffers[i];
		parsed.push({
			SEUtemperature 	: "",
			buffer 			: measurement.buffer,
			buffername 		: measurement.buffer,
			code 			: measurement.buffer,
			comments 		: "",
			concentration 	: 0,
			enable 			: true,
			flow 			: measurement.flow,
			recuperate 		: false,
			title 			: "",
			transmission 	: measurement.transmission,
			macromolecule 	: measurement.buffer,
			type 			: "Buffer",
			typen 			: 1,
			viscosity 		: measurement.viscosity,
			volume 			: measurement.volume,
			volumeToLoad 	: measurement.volumeToLoad,
			waittime 		: 0,
			plate 			: null,
			row 			: null,
			well 			: null
		});
	}

//	var positionHash = {};
//	var savedPositions = 0;
	for ( i = 0; i < measurements.length; i++) {
		measurement = measurements[i];
		var type = "Buffer";
		var macromolecule = "";
		if (measurement.macromoleculeId != null) {
			type = "Sample";
			macromolecule = BIOSAXS.proposal.getMacromoleculeById(measurement.macromoleculeId).acronym;
		}

//		var position = {
//			plate : 2,
//			row : Math.floor(i / 8) + 1,
//			well : Number(i % 8) + 1 - savedPositions
//		};
		/** Position is importante because is the way to distiguish between same samples **/
//		var positionId = measurement.macromoleculeId + "_" + measurement.buffer_acronym + "_" + measurement.concentration;
//		if (positionHash[positionId] == null) {
//			positionHash[positionId] = position;
//		} else {
//			savedPositions = savedPositions + 1;
//		}
//		position = positionHash[positionId];

		parsed.push({
			SEUtemperature : measurement.exposureTemperature,
			buffer : measurement.buffer_acronym,
			buffername : measurement.buffer_acronym,
			code : macromolecule,
			comments : "",
			concentration : measurement.concentration,
			enable : true,
			flow : measurement.flow,
			recuperate : false,
			title : "",
			transmission : measurement.transmission,
			macromolecule : macromolecule,
			type : type,
			typen : 1,
			viscosity : measurement.viscosity,
			volume : measurement.volumeToLoad,
			volumeToLoad : measurement.volumeToLoad,
			waittime : measurement.waitTime,
			plate : null,
			row : null,
			well : null
		});
	}
	
	var automatic = new SampleAutomaticPositionFactory(parsed);
	return automatic.setPosition();
};

MeasurementCreatorStepWizardForm.prototype.getNextForm = function() {
	return new FinalStepWizardForm(JSON.stringify(this.parseMeasurements(this.data.measurementsSelected)));
};



/**
 * Given a set of measurements this class will set the a priori right position for each specimen
 * @sampleParsed Array of:{"SEUtemperature":"","buffer":"CaCl2","buffername":"CaCl2","code":"CaCl2","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"CaCl2","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":null,"row":null,"well":null}
 */
function SampleAutomaticPositionFactory(sampleParsed){
	this.samples = sampleParsed;
//	this.samples  = JSON.parse('[{"SEUtemperature":"","buffer":"CaCl2","buffername":"CaCl2","code":"CaCl2","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"CaCl2","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":9},{"SEUtemperature":"","buffer":"B2dtt","buffername":"B2dtt","code":"B2dtt","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"B2dtt","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":10},{"SEUtemperature":"","buffer":"BSA","buffername":"BSA","code":"BSA","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"BSA","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":11},{"SEUtemperature":"","buffer":"AE","buffername":"AE","code":"AE","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"AE","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":9},{"SEUtemperature":"","buffer":"ATP","buffername":"ATP","code":"ATP","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"ATP","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":10},{"SEUtemperature":"","buffer":"B1","buffername":"B1","code":"B1","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"B1","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":11},{"SEUtemperature":"","buffer":"B2","buffername":"B2","code":"B2","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"B2","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":9},{"SEUtemperature":"","buffer":"CB-RE","buffername":"CB-RE","code":"CB-RE","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"CB-RE","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":10},{"SEUtemperature":"","buffer":"HEPES7","buffername":"HEPES7","code":"HEPES7","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"HEPES7","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":11},{"SEUtemperature":"","buffer":"FUR","buffername":"FUR","code":"FUR","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"FUR","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":9},{"SEUtemperature":"","buffer":"BTris","buffername":"BTris","code":"BTris","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"BTris","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":10},{"SEUtemperature":"","buffer":"AA","buffername":"AA","code":"AA","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"AA","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":11},{"SEUtemperature":"","buffer":"CVCBuf","buffername":"CVCBuf","code":"CVCBuf","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"CVCBuf","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":9},{"SEUtemperature":"","buffer":"BufferMax","buffername":"BufferMax","code":"BufferMax","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"BufferMax","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":10},{"SEUtemperature":"","buffer":"BufferCicine","buffername":"BufferCicine","code":"BufferCicine","comments":"","concentration":0,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"BufferCicine","type":"Buffer","typen":1,"viscosity":"low","volume":800,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":11},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":1},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":2},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":3},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":4},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":5},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":6},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":7},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":1,"well":8},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":1},{"SEUtemperature":4,"buffer":"AA","buffername":"AA","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":2},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":3},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":4},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":5},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":6},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":7},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":2,"well":8},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":1},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":2},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":3},{"SEUtemperature":4,"buffer":"AE","buffername":"AE","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":4},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":5},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":6},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":7},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":3,"well":8},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":1},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":2},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":3},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":4},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":5},{"SEUtemperature":4,"buffer":"ATP","buffername":"ATP","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":6},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":7},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":4,"well":8},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":1},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":2},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":3},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":4},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":5},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":6},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":7},{"SEUtemperature":4,"buffer":"B1","buffername":"B1","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":5,"well":8},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":1},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":2},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":3},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":4},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":5},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":6},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":7},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":6,"well":8},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":1},{"SEUtemperature":4,"buffer":"B2","buffername":"B2","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":2},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":3},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":4},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":5},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":6},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":7},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":7,"well":8},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":1},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":2},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":3},{"SEUtemperature":4,"buffer":"B2dtt","buffername":"B2dtt","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":4},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":5},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":6},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":7},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":8,"well":8},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":1},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":2},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":3},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":4},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":5},{"SEUtemperature":4,"buffer":"BSA","buffername":"BSA","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":6},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":7},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":9,"well":8},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":1},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":2},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":3},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":4},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":5},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":6},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":7},{"SEUtemperature":4,"buffer":"BTris","buffername":"BTris","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":10,"well":8},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":1},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":2},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":3},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":4},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":5},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":6},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":7},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":11,"well":8},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":1},{"SEUtemperature":4,"buffer":"BufferCicine","buffername":"BufferCicine","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":2},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":3},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":4},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":5},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":6},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":7},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":12,"well":8},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":1},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":2},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":3},{"SEUtemperature":4,"buffer":"BufferMax","buffername":"BufferMax","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":4},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":5},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":6},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":7},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":13,"well":8},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":1},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":2},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":3},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":4},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":5},{"SEUtemperature":4,"buffer":"CB-RE","buffername":"CB-RE","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":6},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":7},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":14,"well":8},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":1},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":2},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":3},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":4},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":5},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":6},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":7},{"SEUtemperature":4,"buffer":"CVCBuf","buffername":"CVCBuf","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":15,"well":8},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":1},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":2},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":3},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":4},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":5},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":6},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":7},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":16,"well":8},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":1},{"SEUtemperature":4,"buffer":"CaCl2","buffername":"CaCl2","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":2},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":3},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":4},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":5},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":6},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":7},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":17,"well":8},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":1},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":2},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":3},{"SEUtemperature":4,"buffer":"FUR","buffername":"FUR","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":4},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":1,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":5},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":2,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":6},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":3,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":7},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":4,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":18,"well":8},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":5,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":19,"well":1},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":6,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":19,"well":2},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":7,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":19,"well":3},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":8,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":19,"well":4},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":9,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":19,"well":5},{"SEUtemperature":4,"buffer":"HEPES7","buffername":"HEPES7","code":"A","comments":"","concentration":10,"enable":true,"flow":true,"recuperate":false,"title":"","transmission":100,"macromolecule":"A","type":"Sample","typen":1,"viscosity":"low","volume":40,"volumeToLoad":40,"waittime":0,"plate":2,"row":19,"well":6}]');
};

SampleAutomaticPositionFactory.prototype.getAvailablePlates = function() {
	var plates = BIOSAXS.proposal.getPlateByFlavour();
	var bufferPositions = [];
	var samplePositions = [];
	
	/** is there a 4x(8x3) Block **/
	for (var i = 0; i < plates.length; i++) {
		if (plates[i].plateTypeId == 2){
			/** Booking place for buffers **/
			for (var index = 0; index < 12; index++) {
				bufferPositions.push({
										plate : 2,
										row : Math.floor(index / 3) + 1,
										well : Number(Number(index % 3) + 9)
									});
			}
			/** Booking place for macromolecules **/
			var savedPositions = 0;
			var positionHash = {};
			for (var index = 0; index < 32; index++) {
					var position = {
						plate : 2,
						row : Math.floor(index / 8) + 1,
						well : Number(index % 8) + 1 - savedPositions
					};
					samplePositions.push(position);
			}
		}
	}

	/** Rest of the plates **/
	for (var i = 0; i < plates.length; i++) {
		if (plates[i].plateTypeId != 2){
			/** Booking place for buffers **/
			for (var indexRow = 0; indexRow < plates[i].rowCount; indexRow++) {
				for (var indexColumn = 0; indexColumn < plates[i].columnCount; indexColumn++) {
					bufferPositions.push({
											plate 	: i + 1, 
											row 	: indexRow + 1,
											well 	: indexColumn + 1
										});
				}
			}
			
			/** Booking place for samples **/
			for (var indexRow = 0; indexRow < plates[i].rowCount; indexRow++) {
				for (var indexColumn = 0; indexColumn < plates[i].columnCount; indexColumn++) {
					samplePositions.push({
											plate 	: i + 1,
											row 	: indexRow + 1,
											well 	: indexColumn + 1
										});
				}
			}
		}
	}
	return {
		buffer : bufferPositions.reverse(),
		sample : samplePositions.reverse()
	};
};

SampleAutomaticPositionFactory.prototype._getKey = function(plate, row, well) {
	return plate + ":" +  row + "-" + well;
};

SampleAutomaticPositionFactory.prototype.setPosition = function() {
	var positions = (this.getAvailablePlates());
	
	var occupied = {};
	/** First, we set positions for buffers **/
	for (var i = 0; i < this.samples.length; i++) {
		if (this.samples[i].type == 'Buffer'){
			var key = this._getKey(this.samples[i].plate, this.samples[i].row, this.samples[i].well);
			this.samples[i].plate = positions.buffer[ positions.buffer.length - 1].plate,
			this.samples[i].row = positions.buffer[ positions.buffer.length - 1].row;
			this.samples[i].well =  positions.buffer[ positions.buffer.length - 1].well;
			occupied[key] = true;
			positions.buffer.pop();
		}
	}
	
	var positionHash = {};
	
	for (var i = 0; i < this.samples.length; i++) {
		if (this.samples[i].type == 'Sample'){
			var key = this._getKey(positions.sample[ positions.sample.length - 1].plate,  positions.sample[ positions.sample.length - 1].row, positions.sample[ positions.sample.length - 1].well);
			
			/** If this position is already occupied by a buffer we pop the stack **/
			while (occupied[key] != null){
				positions.sample.pop();
				key = this._getKey(positions.sample[ positions.sample.length - 1].plate,  positions.sample[ positions.sample.length - 1].row, positions.sample[ positions.sample.length - 1].well);
			}
			
			/**
			 * Position is important as it is the way to distiguish between same sample 
			 * For temperatures series two measurements pointing to the same macromolecule and buffer and concentration
			 * means that it is the same specimen
			 * **/
			var positionId = this.samples[i].macromolecule + "_" + this.samples[i].buffer + "_" + this.samples[i].concentration;
			if (positionHash[positionId] == null) {
				positionHash[positionId] = {
						plate : positions.sample[ positions.sample.length - 1].plate,
						row : positions.sample[ positions.sample.length - 1].row,
						well : positions.sample[ positions.sample.length - 1].well,
				};
			} else {
				/** There is already a specimen so we point out to its position **/
				this.samples[i].plate = positionHash[positionId].plate,
				this.samples[i].row = positionHash[positionId].row;
				this.samples[i].well =  positionHash[positionId].well;
				continue;
			}
			
			this.samples[i].plate = positions.sample[ positions.sample.length - 1].plate,
			this.samples[i].row = positions.sample[ positions.sample.length - 1].row;
			this.samples[i].well =  positions.sample[ positions.sample.length - 1].well;
			
			occupied[key] = true;
			positions.sample.pop();
		}
	}
	return this.samples;
};






function WizardWidget(args) {
	this.targetId = null;
	this.width = 910;
	this.height = 400;
	this.windowMode = true;

	if (args != null) {
		if (args.windowMode != null) {
			this.windowMode = args.windowMode;
		}

	}

	this.step = 0;
	this.forms = [];

	this.onFinished = new Event(this);
}

WizardWidget.prototype.draw = function(targetId, form) {
	this.targetId = targetId;
	this.forms.push(form);
	this.renderMasterContainer();
};

WizardWidget.prototype.getButtons = function(step, onNext, onBack) {
	var _this = this;

	/** For the last step **/
	if (_this.forms[_this.step].onWizardFinished != null) {
		return [ {
			text : 'Back',
			handler : function() {
				_this.step = _this.step - 1;
				_this.renderMasterContainer();
				onBack();
				_this.forms[_this.step].reload();
			}
		}, "->", {
			text : 'Finish',
			handler : function() {
				_this.forms[_this.step].onWizardFinished.attach(function(sender, result) {
					_this.onFinished.notify(result);
				});
				_this.step = _this.step + 1;
				onNext(_this.forms[_this.step - 1].data);
			}
		} ];
	}

	/** First **/
	if (step == 0) {
		return [ "->", {
			text : 'Next',
			handler : function() {
				_this.forms.push(_this.forms[_this.step].getNextForm());
				_this.step = _this.step + 1;
				_this.renderMasterContainer();
				onNext(_this.forms[_this.step - 1].data);
			}
		} ];
	}

	if ((this.step > 0) && (this.forms[_this.step].onWizardFinished == null)) {
		return [ {
			text : 'Back',
			handler : function() {
				_this.step = _this.step - 1;
				_this.renderMasterContainer();
				onBack();
				_this.forms[_this.step].reload();
			}
		}, "->", {
			text : 'Next',
			handler : function() {
				if (_this.forms[_this.step].onWizardFinished == null) {
					_this.forms.push(_this.forms[_this.step].getNextForm());
					_this.step = _this.step + 1;
					onNext(_this.forms[_this.step - 1].data);
					_this.renderMasterContainer();
				} else {
					_this.forms[_this.step].onWizardFinished.attach(function(sender, result) {
						_this.window.close();
						_this.onFinished.notify(result);
					});
					_this.step = _this.step + 1;
					onNext(_this.forms[_this.step - 1].data);
				}
			}
		} ];
	}

};

WizardWidget.prototype.renderMasterContainer = function() {
	var _this = this;

	if (this.current != null) {
		this.current.destroy();
	}
	if (this.window != null) {
		this.window.destroy();
	}

	this.current = Ext.create('Ext.form.Panel', {
		width : this.width,
		height : this.forms[this.step].height,
		items : [ {
			margin : "10 0 0 20",
			width : 475,
			border : 0,
			html : "<span style='font-weight:bold;'>" + this.forms[this.step].title + "</span>"
		}, {
			margin : "10 0 0 40",
			width : 475,
			border : 0,
			html : this.forms[this.step].description
		}, this.forms[this.step].getForm() ],
		buttons : this.getButtons(this.step, this.forms[this.step].onNext, this.forms[this.step].onBack)
	});

	if (this.windowMode == false) {
		this.current.render(this.targetId);
	} else {

		this.window = Ext.create('Ext.Window', {
			id : this.id,
			resizable : true,
			constrain : true,
			border : 1,
			modal : true,
			frame : false,
			draggable : true,

			autoscroll : true,
			layout : {
				type : 'vbox',
				align : 'stretch'
			},
			items : this.current,
			width : this.width,
			title : "BIOSAXS Experiment Designer",
			height : this.forms[this.step].height + 60,
			listeners : {
				scope : this,
				minimize : function() {
					this.panel.hide();
				},
				destroy : function() {
					delete this.panel;
				}
			}
		});

		this.window.show();
	}
};


function AbinitioWindow(args) {

}

AbinitioWindow.prototype.getGrid = function(abinitios) {
	this.grid = new AbinitioGrid().getPanel(abinitios);
	return this.grid;
};

AbinitioWindow.prototype.show = function(models) {
	Ext.create('Ext.window.Window', {
		title : 'Abinitio Models',
		height : 500,
		width : 800,
		layout : 'fit',
		items : [ this.getGrid(models) ]
	}).show();
};

BufferWindow.prototype.getButtons = GenericWindow.prototype.getButtons; 
BufferWindow.prototype._render = GenericWindow.prototype._render; 
BufferWindow.prototype._postRender = GenericWindow.prototype._postRender; 

function BufferWindow(args){
	  this.width = 550;
      this.height = 500;

       if (args != null){
          if (args.actions != null){
             this.actions = args.actions;
          }
       }
       
       var _this = this;
       this.form = new BufferForm();
       
       
       this.onSuccess = new Event();
       GenericWindow.prototype.constructor.call(this, {form:this.form, width:this.width, height:this.height});
 };

 
BufferWindow.prototype.save = function (){
	var _this = this;
	
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, proposal){
		BIOSAXS.proposal.setItems(proposal);
		_this.onSuccess.notify(proposal);
		_this.panel.close();
	});
	
	if (this.form.getBuffer().name == ""){
		BUI.showError("Name field is mandatory");
		return;
	}
	if (this.form.getBuffer().acronym == ""){
		BUI.showError("Acroynm field is mandatory");
		return;
	}
	if (this.form.getBuffer().composition == ""){
		BUI.showError("Composition field is mandatory");
		return;
	}
	this.panel.setLoading("ISPyB: Saving buffer")
	adapter.saveBuffer(this.form.getBuffer());
};


BufferWindow.prototype.draw = function (buffer){
	if (buffer.bufferId == null){
		this.title =  'New buffer';
	}
	else{
		this.title =  buffer.name;
	}
	this._render(buffer);
};
CaseWindow.prototype.getButtons = GenericWindow.prototype.getButtons; 
CaseWindow.prototype._render = GenericWindow.prototype._render; 
CaseWindow.prototype._postRender = GenericWindow.prototype._postRender; 

function CaseWindow(args){
	  this.width = 720;
      this.height = 500;

       if (args != null){
          if (args.actions != null){
             this.actions = args.actions;
          }
       }
       
       var _this = this;
       this.onRemoveAdditive = new Event(this);
       
       this.form = new CaseForm();
       this.form.onAddPlates.attach(function(sender, plates){
    	   _this.onSavePlates.notify(plates);
    	   
       });
       
       this.form.onRemovePlates.attach(function(sender, plate){
    	   _this.onSavePlates.notify([plate]);
       });

       GenericWindow.prototype.constructor.call(this, {
    	   													title		: 'Edit Case',
    	   													form		: this.form, 
    	   													width		: this.width, 
    	   													height		: this.height
	   													});
       
 }

CaseWindow.prototype.save = function (){
		/** Checking values **/
		if (this.form.getDewar().code == ""){
			BUI.showError("Code field is mandatory");
			return;
		}
	
	  this.onSaved.notify(this.form.getDewar());
	  this.panel.close();
};


CaseWindow.prototype.draw = function (dewar, plates){
	this.dewar = dewar;
	this.plates = plates;
	this._render(dewar, plates);
};

/**
 * #onSaved
 */
function ExperimentWindow(args){
   this.id = BUI.id();
   this.actions = new Array();

   if (args != null){
      if (args.actions != null){
         this.actions = args.actions;
      }
   }
   
   this.onSaved = new Event(this);
};

ExperimentWindow.prototype.getButtons = function(){
		var _this = this;
		
		return [ {
			text : 'Save',
			handler : function() {
					var experimentId =	_this.experiment.json.experimentId;
					var name =	Ext.getCmp(_this.form.id + 'name').getValue();
					var type =	Ext.getCmp(_this.form.id + 'type').getValue();
					var comments =	Ext.getCmp(_this.form.id + 'comments').getValue();
					var adapter = new BiosaxsDataAdapter();
					_this.form.panel.setLoading("ISPyB: Saving experiment");
					adapter.onSuccess.attach(function(sender){
						_this.form.panel.setLoading(false);
						_this.onSaved.notify(
								{
									name		: name,
									type		: type,
									comments	: comments
								}
						);
						_this.panel.close();
					});
					adapter.onError.attach(function(sender){
						_this.form.panel.setLoading(false);
						BUI.showError("Ooops: There was an error");
					});
					adapter.saveExperiment(experimentId, name, type, comments);
			}
		}, {
			text : 'Cancel',
			handler : function() {
				_this.panel.close();
			}
		} ];
	};

ExperimentWindow.prototype.show = function(experiment){
	this.experiment = experiment;
	this.form = new ExperimentForm();
	this.panel = Ext.create('Ext.window.Window', {
	    title			: 'Experiment',
	    height			: 300,
	    width			: 500,
	    layout			: 'fit',
	    buttonAlign		:'right',
		buttons			: this.getButtons(),
	    items			: [ 	this.form.getPanel(experiment)	]
	});
	this.panel.show();
};


function MacromoleculeWindow(args) {
	this.width = 600;
	this.height = 500;
	if (args != null) {
		if (args.actions != null) {
			this.actions = args.actions;
		}
	}

	this.macromoleculeTabs = new MacromoleculeTabs({
		width : this.width - 10,
		height : this.height - 50
	});

	var _this = this;
	
	this.macromoleculeTabs.onSave.attach(function(sender, macromolecule) {
		_this.onSave.notify();
		_this.refresh(macromolecule);
	});
	
	this.macromoleculeTabs.onClose.attach(function(sender) {
		_this.panel.close();
	});

	/** Events **/
	this.onSave = new Event();
}


MacromoleculeWindow.prototype.refresh = function(macromolecule) {
	this.macromoleculeTabs.refresh(macromolecule);
	if (macromolecule != null){
		this.panel.setTitle(macromolecule.acronym);
	}
};


MacromoleculeWindow.prototype.draw = function(macromolecule) {
	var _this = this;
	this.panel = Ext.create('Ext.Window', {
		id : this.id,
		title : this.title,
		resizable : true,
		constrain : true,
		border : 0,
		modal : true,
		frame : false,
		draggable : true,
		closable : true,
		autoscroll : true,
		layout : {
			type : 'vbox',
			align : 'stretch'
		},
		items : this.macromoleculeTabs.getPanel(),
		width : this.width,
		height : this.height,
		buttonAlign : 'right',
		listeners : {
			scope : this,
			minimize : function() {
				this.panel.hide();
			},
			destroy : function() {
				delete this.panel;
			}
		}
	});
	this.panel.show();
	this.refresh(macromolecule);

};

function MultipleEditMeasurementGridWindow(){
	this.id = BUI.id();
	var _this = this;
	this.measurementGrid = new MeasurementGrid({
		height					: 400, 
		maxHeight				: 400, 
		width					: 960, 
		maxWidth				: 1000,
		resizable				: false,
		estimateTime			: false, 
		positionColumnsHidden	: true, 
		isPriorityColumnHidden	: true,
		isStatusColumnHidden	: true,
		isTimeColumnHidden		: true,
		updateRowEnabled		: false,
		collapsed				: true,
		addBtnEnable			: false,
		showTitle				: false,
		removeBtnEnabled		: false,
		collapseBtnEnable		: false,
		addBtnMultipleEdit		: false,
		selModel 				: Ext.create('Ext.selection.CheckboxModel', {
									 	allowDeselect : true,
									 	scope			: this,
									 	mode			: 'MULTI',
								        listeners: {
								            selectionchange: function(sm, selections) {
								            	if (selections.length == 0){
								            		this.scope.measurementGrid._showStatusBarBusy("No measurements Selected");
								            		this.scope.saveBtn.setDisabled(true);
								            		this.scope.macromoleculeSaveBtn.setDisabled(true);
								            		this.scope.bufferSaveBtn.setDisabled(true);
								            	}
								            	else{
								            		this.scope.measurementGrid._showStatusBarReady(selections.length + " measurements selected");
								            		this.scope.saveBtn.setDisabled(false);
								            		this.scope.macromoleculeSaveBtn.setDisabled(false);
								            		this.scope.bufferSaveBtn.setDisabled(false);
								            	}
								            	
								            }
								        }
	    }),
		editor					: {},
		sorter					: [
		      					   		{
		      					   				property : 'priority',
		      					   				direction: 'ASC'
										}
										]
	});
	
	this.onExperimentChanged = new Event(this);
	
};


MultipleEditMeasurementGridWindow.prototype.getMacromoleculeCombo = function(){
	 this.macromoleculeCombo = BIOSAXS_COMBOMANAGER.getComboMacromoleculeByMacromolecules(BIOSAXS.proposal.getMacromolecules(), 
			 {
		 			labelWidth 	: 100,
		 			margin 		: '0 0 0 10',
		 			width 		: 300
		 
			 });
	this.macromoleculeCombo.setFieldLabel("or Macromolecule");
	return this.macromoleculeCombo;
};

MultipleEditMeasurementGridWindow.prototype.getBufferCombo = function(){
	 this.bufferCombo = BIOSAXS_COMBOMANAGER.getComboBuffers(BIOSAXS.proposal.getBuffers(),  {
		 	labelWidth 	: 100,
			margin 		: '0 0 0 10',
			width 		: 300

	 });
	 this.bufferCombo.setFieldLabel("or Buffer");
	 return this.bufferCombo;
};

MultipleEditMeasurementGridWindow.prototype.save = function(parameter, value){
		var selections = this.measurementGrid.grid.getSelectionModel().getSelection();
		var ids = new Array();
		for (var i = 0; i < selections.length; i++){
			ids.push(selections[i].raw.measurementId);
		}
		var _this = this;
		if (parameter != ""){
			this.measurementGrid.grid.setLoading("ISPyB: Saving measurements")
			if (ids.length > 0){
				var adapter = new BiosaxsDataAdapter();
				adapter.onSuccess.attach(function(sender, data){
					var experimentAdapter = new BiosaxsDataAdapter();
					experimentAdapter.onSuccess.attach(function(sender, data){
						var experiment = new Experiment(data);
						_this.measurementGrid.refresh(experiment.getMeasurements(), new ExperimentList([experiment]));
						_this.measurementGrid.grid.setLoading(false);
						_this.onExperimentChanged.notify(data);
						_this.measurementGrid._showStatusBarReady("Ready");
					});
					_this.measurementGrid.grid.setLoading("ISPyB: Getting Experiment")
					experimentAdapter.getExperimentById(_this.experiments.experiments[0].experimentId, "MEDIUM");
				});
				adapter.setMeasurementParameters( ids, parameter, value);
			}
		}
};

MultipleEditMeasurementGridWindow.prototype.draw = function(measurements, experients){
	var _this = this;
	this.experiments = experients;
	this.parameterComboBox =  Ext.create('Ext.form.ComboBox', {
	    fieldLabel				: 'Select Parameter',
	    labelWidth				: 100,
  	    width					: 300,
	    margin 					: "10 0 10 10",
	    store					: ["Exp. Temp.", "Volume To Load", "Transmission", "Wait Time", "Viscosity"],
	    queryMode				: 'local'
	});
	
	this.macromoleculeComboBox =  this.getMacromoleculeCombo();
	this.bufferComboBox = this.getBufferCombo();
	
	this.saveBtn = Ext.create('Ext.Button', {
	    text    		: 'Save',
	    width			: 100,
	    disabled		: true,
	    margin 			: "10 0 10 20",
	    scope			: this,
	    handler 		: function() {
	            						_this.save(this.parameterComboBox.getRawValue(), Ext.getCmp(this.id + "value").getValue());
	    }
	});
	
	this.macromoleculeSaveBtn = Ext.create('Ext.Button', {
	    text    		: 'Save',
	    width			: 100,
	    disabled		: true,
	    margin 			: "0 0 10 20",
	    scope			: this,
	    handler 		: function() {
	    								_this.save("macromoleculeId", this.macromoleculeComboBox.getValue());
	    }
	});
	
	this.bufferSaveBtn = Ext.create('Ext.Button', {
	    text    		: 'Save',
	    width			: 100,
	    disabled		: true,
	    margin 			: "0 0 10 20",
	    scope			: this,
	    handler 		: function() {
	    								_this.save("bufferId", this.bufferComboBox.getValue());
	    }
	});
	
	this.panel  = Ext.create('Ext.Window', {
		id				: this.id,
		title 			: "Multiple Edit",
		resizable		: true,
		constrain		: true,
		border			: 1,
		modal			: true,
		frame			: false,
		closable		: true,
		
		autoscroll		: true,
		layout			: { type: 'vbox',align: 'stretch'},
		width			: this.measurementGrid.width + 50,
        height			: this.measurementGrid.height +200,
		buttonAlign		:'right',
		items			:  [{
								xtype		: 'container',
								layout		: 'vbox',
								padding			: 10,
								items		: [
								     		   		this.measurementGrid.getPanel(measurements, experients),
								     		   		{
														xtype		: 'container',
														layout		: 'hbox',
														items		: [
														     		   		this.parameterComboBox,
															     		   	{
																          			xtype			: 'requiredtext',
																          			fieldLabel 		: 'Value',
																          			id				: _this.id + "value",
																          			margin 			: "10 0 10 20",
																          			width 			: '200',
																          			labelWidth		: 50,
																          			value 			: ''
																          	},
																          	this.saveBtn
														]
													},
													{
														xtype		: 'container',
														layout		: 'hbox',
														items		: [
														     		   		this.macromoleculeComboBox,
																          	this.macromoleculeSaveBtn
														]
													}
//													,
//													{
//														xtype		: 'container',
//														layout		: 'hbox',
//														items		: [
//														     		   		this.bufferComboBox,
//																          	this.bufferSaveBtn
//														]
//													}
								]
							}
		],
 		listeners: {
 						scope		: this,
 						minimize	: function(){
 										this.panel.hide();
 						},
 						destroy		: function(){
 										delete this.panel;
 						}
    	}
	});
	this.panel.show();
	
};








StockSolutionWindow.prototype.getButtons = GenericWindow.prototype.getButtons; 
StockSolutionWindow.prototype._render = GenericWindow.prototype._render; 
StockSolutionWindow.prototype._postRender = GenericWindow.prototype._postRender; 

function StockSolutionWindow(args){
	  this.width = 550;
      this.height = 300;

       if (args != null){
          if (args.actions != null){
             this.actions = args.actions;
          }
       }
       
       _this = this;
       
       this.form = new StockSolutionForm();
       this.form.onSaved.attach(function(evt, buffer){
    	   _this.save();
       });
       
       GenericWindow.prototype.constructor.call(this, {form:this.form, width:this.width, height:this.height});
       
       /** Events **/
       this.onSaved = new Event(this);
 };

 
StockSolutionWindow.prototype.save = function (){
	var _this = this;
	var adapter = new BiosaxsDataAdapter();
	adapter.onSuccess.attach(function(sender, stockSolution){
		_this.panel.close();
		_this.onSaved.notify(stockSolution);
	});
	
//	if (this.form.getStockSolution().macromoleculeId == null){
//		BUI.showError("Macromolecule field is mandatory");
//		return;
//	}
	if (this.form.getStockSolution().bufferId == null){
		BUI.showError("Buffer field is mandatory");
		return;
	}
	
	if (this.form.getStockSolution().name == ""){
		BUI.showError("Acronym field is mandatory");
		return;
	}
	
	if (this.form.getStockSolution().concentration == ""){
		BUI.showError("Concentration field is mandatory");
		return;
	}
	
	if (this.form.getStockSolution().volume == ""){
		BUI.showError("Volume field is mandatory");
		return;
	}
	
	this.panel.setLoading("ISPyB: saving stock solution");
	adapter.saveStockSolution(this.form.getStockSolution());
	
};


StockSolutionWindow.prototype.draw = function (stockSolution, experiment){
	this.experiment = experiment;
	this.title = "Stock Solution";
	this._render(stockSolution, experiment);
};
